{"version":3,"file":"ngx-tethys-avatar.js","sources":["../../src/avatar/avatar.service.ts","../../src/avatar/avatar.component.ts","../../src/avatar/avatar.pipe.ts","../../src/avatar/avatar.module.ts","../../src/avatar/ngx-tethys-avatar.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { SafeHtml } from '@angular/platform-browser';\n\nexport abstract class ThyAvatarService {\n    ignoreAvatarSrcPaths = [`default.png`];\n\n    abstract avatarSrcTransform(src: string, size: number): string;\n\n    abstract nameTransform(name: string): string | SafeHtml;\n}\n\n@Injectable()\nexport class ThyDefaultAvatarService extends ThyAvatarService {\n    avatarSrcTransform(src: string, size: number): string {\n        return src;\n    }\n\n    nameTransform(name: string): string | SafeHtml {\n        return name;\n    }\n}\n","import { Component, Input, Output, EventEmitter, ElementRef, HostBinding, OnInit, ChangeDetectionStrategy } from '@angular/core';\nimport { isNumber, coerceBooleanProperty } from 'ngx-tethys/util';\nimport { UpdateHostClassService } from 'ngx-tethys/core';\nimport { ThyAvatarService } from './avatar.service';\nimport { isString } from 'ngx-tethys/util';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\nconst sizeArray = [22, 24, 28, 32, 36, 48, 68, 110, 160];\n\nconst DEFAULT_SIZE = 36;\n\nexport const thyAvatarSizeMap = {\n    xxs: 22,\n    xs: 24,\n    sm: 32,\n    md: 36,\n    lg: 48\n};\n\n@Component({\n    selector: 'thy-avatar',\n    templateUrl: './avatar.component.html',\n    providers: [UpdateHostClassService],\n    changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ThyAvatarComponent implements OnInit {\n    _src: string;\n    _name: string;\n    _size: number;\n    _showRemove = false;\n\n    public avatarSrc: string;\n    public avatarName?: string;\n    public avatarNameSafeHtml?: SafeHtml;\n\n    @HostBinding('class.thy-avatar') _isAvatar = true;\n\n    @Output() thyOnRemove = new EventEmitter();\n\n    @Output() thyError: EventEmitter<Event> = new EventEmitter<Event>();\n\n    @Input() thyShowName: boolean;\n\n    @Input()\n    set thySrc(value: string) {\n        this._setAvatarSrc(value);\n    }\n\n    @Input()\n    set thyName(value: string) {\n        // this._name = value;\n        this._setAvatarName(value);\n    }\n\n    @Input()\n    set thySize(value: number | string) {\n        if (thyAvatarSizeMap[value]) {\n            this._setAvatarSize(thyAvatarSizeMap[value]);\n        } else {\n            this._setAvatarSize((value as number) * 1);\n        }\n    }\n\n    @Input()\n    set thyShowRemove(value: boolean) {\n        this._showRemove = coerceBooleanProperty(value);\n    }\n\n    @Input() thyImgClass: string;\n\n    @Input() thyDisabled: boolean;\n\n    private _setAvatarSize(size: number) {\n        if (sizeArray.indexOf(size) > -1) {\n            this._size = size;\n        } else {\n            this._size = this.findClosestSize(sizeArray, size);\n        }\n    }\n\n    private findClosestSize(sizes: number[], value: number): number {\n        let left = 0,\n            right = sizes.length - 1,\n            middle: number,\n            result: number;\n\n        while (left <= right) {\n            middle = Math.floor((left + right) / 2);\n            if (right - left <= 1) {\n                result = sizes[right];\n                break;\n            }\n            result = sizes[middle];\n            if (result === value) {\n                return value;\n            } else if (result > value) {\n                right = middle;\n            } else {\n                left = middle;\n            }\n        }\n        return value - sizes[left] < sizes[right] - value ? sizes[left] : sizes[right];\n    }\n\n    private _setAvatarSrc(src: string) {\n        if (src && this.thyAvatarService.ignoreAvatarSrcPaths.indexOf(src) < 0) {\n            this._src = src;\n        } else {\n            this._src = null;\n        }\n    }\n\n    private _setAvatarName(value: string) {\n        const name = this.thyAvatarService.nameTransform(value);\n        if (isString(name)) {\n            this.avatarName = name as string;\n        } else {\n            this.avatarName = value;\n            this.avatarNameSafeHtml = name;\n        }\n    }\n\n    constructor(\n        private updateHostClassService: UpdateHostClassService,\n        private elementRef: ElementRef,\n        private thyAvatarService: ThyAvatarService,\n        private domSanitizer: DomSanitizer\n    ) {\n        updateHostClassService.initializeElement(elementRef.nativeElement);\n    }\n\n    ngOnInit() {\n        if (!this._size) {\n            this._setAvatarSize(DEFAULT_SIZE);\n        }\n        this.updateHostClassService.updateClass([`thy-avatar-${this._size}`]);\n    }\n\n    remove($event: Event) {\n        this.thyOnRemove.emit($event);\n    }\n\n    avatarImgError($event: Event) {\n        this._setAvatarSrc(null);\n        this.thyError.emit($event);\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { ThyAvatarService } from './avatar.service';\n\n@Pipe({ name: 'avatarShortName' })\nexport class AvatarShortNamePipe implements PipeTransform {\n    transform(name: string): string {\n        if (!name) {\n            return;\n        }\n        name = name.trim();\n        if (/^[\\u4e00-\\u9fa5]+$/.test(name)) {\n            if (name.length > 2) {\n                return name.substr(name.length - 2, 2);\n            }\n        }\n        if (/^[a-zA-Z\\/ ]+$/.test(name)) {\n            if (name.indexOf(' ') > 0) {\n                const ens: string[] = name.split(' ');\n                return (ens[0].substr(0, 1) + ens[1].substr(0, 1)).toUpperCase();\n            }\n        }\n        if (name.length > 2) {\n            return name.substr(0, 2).toUpperCase();\n        }\n        return name.toUpperCase();\n    }\n}\n\n@Pipe({ name: 'avatarBgColor' })\nexport class AvatarBgColorPipe implements PipeTransform {\n    transform(name: string) {\n        if (!name) {\n            return;\n        }\n        const colors = [\n            '#56abfb',\n            '#5dcfff',\n            '#84e17e',\n            '#73d897',\n            '#ff9f73',\n            '#fa8888',\n            '#fb7fb7',\n            '#9a7ef4',\n            '#868af6'\n        ];\n        const nameArray: string[] = name.split('');\n        const code: number =\n            name && name.length > 0\n                ? nameArray.reduce(\n                      function(result, item) {\n                          result.value += item.charCodeAt(0);\n                          return result;\n                      },\n                      { value: 0 }\n                  ).value\n                : 0;\n        return {\n            'background-color': colors[code % 9]\n        };\n    }\n}\n\n@Pipe({ name: 'thyAvatarSrc' })\nexport class AvatarSrcPipe implements PipeTransform {\n    constructor(private thyAvatarService: ThyAvatarService) {}\n    transform(src: string, size: number) {\n        return this.thyAvatarService.avatarSrcTransform(src, size);\n    }\n}\n\nexport const AvatarPipes = [AvatarShortNamePipe, AvatarBgColorPipe, AvatarSrcPipe];\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ThyAvatarComponent } from './avatar.component';\nimport { AvatarPipes } from './avatar.pipe';\nimport { ThyAvatarService, ThyDefaultAvatarService } from './avatar.service';\nimport { ThyIconModule } from 'ngx-tethys/icon';\n\n@NgModule({\n    declarations: [ThyAvatarComponent, AvatarPipes],\n    imports: [CommonModule, ThyIconModule],\n    providers: [\n        {\n            provide: ThyAvatarService,\n            useClass: ThyDefaultAvatarService\n        }\n    ],\n    exports: [ThyAvatarComponent, AvatarPipes]\n})\nexport class ThyAvatarModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}