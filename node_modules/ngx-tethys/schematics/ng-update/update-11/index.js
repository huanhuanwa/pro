"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const class_1 = require("../../class");
const html_migration_schematics_rule_1 = require("../../class/html-migration-schematics.rule");
const component_tag_change_1 = require("./migrations/component-tag-change");
const import_entry_point_change_1 = require("./migrations/import-entry-point-change");
const import_name_change_1 = require("./migrations/import-name-change");
function main() {
    return (tree, ctx) => {
        return schematics_1.chain([
            class_1.TsMigrationSchematicsRule([import_entry_point_change_1.ImportEntryPointChangeMigrationByNg11, import_name_change_1.ImportNameChangeMigrationByNg11], compilerHost => {
                const oldDirectoryExists = compilerHost.directoryExists;
                compilerHost.directoryExists = (fileName) => {
                    if ([
                        '/node_modules/ngx-tethys/table',
                        '/node_modules/ngx-tethys/grid',
                        '/node_modules/ngx-tethys',
                        '/node_modules'
                    ].includes(fileName)) {
                        return true;
                    }
                    return oldDirectoryExists.call(compilerHost, fileName);
                };
                const oldFileExists = compilerHost.fileExists;
                compilerHost.fileExists = (fileName) => {
                    if ([`/node_modules/ngx-tethys/table.ts`, `/node_modules/ngx-tethys/grid.ts`].includes(fileName)) {
                        return true;
                    }
                    return oldFileExists.call(compilerHost, fileName);
                };
                const oldReadDirectory = compilerHost.readDirectory;
                compilerHost.readDirectory = (fileName) => {
                    return oldReadDirectory.call(compilerHost, fileName);
                };
                const oldReadFile = compilerHost.readFile;
                compilerHost.readFile = fileName => {
                    if (['/node_modules/ngx-tethys/table.ts', '/node_modules/ngx-tethys/grid.ts'].includes(fileName)) {
                        return Object.keys(import_name_change_1.IMPORT_NAME_CHANGE_RELATION)
                            .map(item => `export const ${item}:'__hook${item}';export type ${item}='__hook${item}'`)
                            .join('\n');
                    }
                    return oldReadFile.call(compilerHost, fileName);
                };
                return compilerHost;
            }),
            html_migration_schematics_rule_1.HtmlMigrationSchematicsRule([component_tag_change_1.ComponentTagChangeMigrationByNg11])
        ]);
    };
}
exports.default = main;
