!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/cdk/platform"),require("rxjs"),require("rxjs/operators"),require("ngx-tethys/util"),require("ngx-tethys/core"),require("ngx-tethys/affix")):"function"==typeof define&&define.amd?define("ngx-tethys/anchor",["exports","@angular/core","@angular/common","@angular/cdk/platform","rxjs","rxjs/operators","ngx-tethys/util","ngx-tethys/core","ngx-tethys/affix"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ngx-tethys"]=t["ngx-tethys"]||{},t["ngx-tethys"].anchor={}),t.ng.core,t.ng.common,t.ng.cdk.platform,t.rxjs,t.rxjs.operators,t["ngx-tethys"].util,t["ngx-tethys"].core,t["ngx-tethys"].affix)}(this,(function(t,e,n,i,o,r,s,h,l){"use strict";var a=/#([^#]+)$/,c=function(){function t(t,n,i,r,s,h){this.document=t,this.cdr=n,this.platform=i,this.zone=r,this.renderer=s,this.scrollService=h,this.thyAffix=!0,this.thyBounds=5,this.thyOffsetTop=void 0,this.thyTarget="",this.thyClick=new e.EventEmitter,this.thyScroll=new e.EventEmitter,this.visible=!1,this.wrapperStyle={"max-height":"100vh"},this.links=[],this.animating=!1,this.destroy$=new o.Subject,this.handleScrollTimeoutID=-1}return t.prototype.registerLink=function(t){this.links.push(t)},t.prototype.unregisterLink=function(t){this.links.splice(this.links.indexOf(t),1)},t.prototype.getContainer=function(){return this.container||window},t.prototype.ngAfterViewInit=function(){this.registerScrollEvent()},t.prototype.ngOnDestroy=function(){clearTimeout(this.handleScrollTimeoutID),this.destroy$.next(),this.destroy$.complete()},t.prototype.registerScrollEvent=function(){var t=this;this.platform.isBrowser&&(this.destroy$.next(),this.zone.runOutsideAngular((function(){o.fromEvent(t.getContainer(),"scroll").pipe(r.throttleTime(50),r.takeUntil(t.destroy$)).subscribe((function(){return t.handleScroll()}))})),this.handleScrollTimeoutID=setTimeout((function(){return t.handleScroll()})))},t.prototype.handleScroll=function(){var t=this;if("undefined"!=typeof document&&!this.animating){var e=this.container instanceof HTMLElement?this.container:this.document,n=[],i=(this.thyOffsetTop||0)+this.thyBounds;if(this.links.forEach((function(o){var r=a.exec(o.thyHref.toString());if(r){var h=e.querySelector("#"+r[1]);if(h){var l=s.getOffset(h,t.getContainer()).top;l<i&&n.push({top:l,linkComponent:o})}}})),this.visible=!!n.length,this.visible){var o=n.reduce((function(t,e){return e.top>t.top?e:t}));this.handleActive(o.linkComponent)}else this.clearActive(),this.cdr.detectChanges();this.setVisible()}},t.prototype.clearActive=function(){this.links.forEach((function(t){t.unsetActive()}))},t.prototype.handleActive=function(t){this.clearActive(),t.setActive();var e=t.getLinkTitleElement();this.ink.nativeElement.style.top=e.offsetTop+"px",this.ink.nativeElement.style.height=e.clientHeight+"px",this.visible=!0,this.setVisible(),this.thyScroll.emit(t)},t.prototype.setVisible=function(){var t=this.visible,e="visible";this.ink&&(t?this.renderer.addClass(this.ink.nativeElement,e):this.renderer.removeClass(this.ink.nativeElement,e))},t.prototype.handleScrollTo=function(t){var e=this,n=(this.container instanceof HTMLElement?this.container:this.document).querySelector(t.thyHref);if(n){this.animating=!0;var i=this.scrollService.getScroll(this.getContainer())+s.getOffset(n,this.getContainer()).top-(this.thyOffsetTop||0);this.scrollService.scrollTo(this.getContainer(),i,void 0,(function(){e.animating=!1})),this.handleActive(t),this.thyClick.emit(t)}},t.prototype.ngOnChanges=function(t){var e=t.thyOffsetTop,n=t.thyContainer;if(e&&(this.wrapperStyle={"max-height":"calc(100vh - "+this.thyOffsetTop+"px)"}),n&&this.thyContainer){var i=this.thyContainer||this.thyTarget;this.container="string"==typeof i?this.document.querySelector(i):i,this.registerScrollEvent()}},t}();c.decorators=[{type:e.Component,args:[{selector:"thy-anchor",exportAs:"thyAnchor",preserveWhitespaces:!1,template:'\n        <thy-affix *ngIf="thyAffix; else content" [thyOffsetTop]="thyOffsetTop" [thyContainer]="container">\n            <ng-template [ngTemplateOutlet]="content"></ng-template>\n        </thy-affix>\n        <ng-template #content>\n            <div class="thy-anchor-wrapper" [ngStyle]="wrapperStyle">\n                <div class="thy-anchor">\n                    <div class="thy-anchor-ink">\n                        <div class="thy-anchor-ink-full" #ink></div>\n                    </div>\n                    <ng-content></ng-content>\n                </div>\n            </div>\n        </ng-template>\n    ',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush}]}],c.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[n.DOCUMENT]}]},{type:e.ChangeDetectorRef},{type:i.Platform},{type:e.NgZone},{type:e.Renderer2},{type:h.ThyScrollService}]},c.propDecorators={ink:[{type:e.ViewChild,args:["ink"]}],thyAffix:[{type:e.Input}],thyBounds:[{type:e.Input}],thyOffsetTop:[{type:e.Input}],thyContainer:[{type:e.Input}],thyTarget:[{type:e.Input}],thyClick:[{type:e.Output}],thyScroll:[{type:e.Output}]};var p=function(){function t(t,e,n,i){this.elementRef=t,this.anchorComponent=e,this.platform=n,this.renderer=i,this.thyHref="#",this.title="",this.renderer.addClass(t.nativeElement,"thy-anchor-link")}return Object.defineProperty(t.prototype,"thyTitle",{set:function(t){t instanceof e.TemplateRef?(this.title=null,this.titleTemplate=t):this.title=t},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.anchorComponent.registerLink(this)},t.prototype.getLinkTitleElement=function(){return this.linkTitle.nativeElement},t.prototype.setActive=function(){this.renderer.addClass(this.elementRef.nativeElement,"thy-anchor-link-active")},t.prototype.unsetActive=function(){this.renderer.removeClass(this.elementRef.nativeElement,"thy-anchor-link-active")},t.prototype.goToClick=function(t){t.preventDefault(),t.stopPropagation(),this.platform.isBrowser&&this.anchorComponent.handleScrollTo(this)},t.prototype.ngOnDestroy=function(){this.anchorComponent.unregisterLink(this)},t}();p.decorators=[{type:e.Component,args:[{selector:"thy-link",exportAs:"thyLink",preserveWhitespaces:!1,template:'\n        <a #linkTitle (click)="goToClick($event)" href="{{ thyHref }}" class="thy-anchor-link-title" title="{{ title }}">\n            <span *ngIf="title; else titleTemplate || thyTemplate">{{ title }}</span>\n        </a>\n        <ng-content></ng-content>\n    ',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush}]}],p.ctorParameters=function(){return[{type:e.ElementRef},{type:c},{type:i.Platform},{type:e.Renderer2}]},p.propDecorators={thyHref:[{type:e.Input}],thyTitle:[{type:e.Input}],thyTemplate:[{type:e.ContentChild,args:["thyTemplate"]}],linkTitle:[{type:e.ViewChild,args:["linkTitle",{static:!0}]}]};var y=function(){};y.decorators=[{type:e.NgModule,args:[{declarations:[c,p],exports:[c,p],imports:[n.CommonModule,i.PlatformModule,l.ThyAffixModule]}]}],t.ThyAnchorComponent=c,t.ThyAnchorLinkComponent=p,t.ThyAnchorModule=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-anchor.umd.min.js.map