!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("ngx-tethys/core"),require("ngx-tethys/util"),require("ngx-tethys/input"),require("rxjs"),require("rxjs/operators"),require("ngx-tethys/alert"),require("ngx-tethys/icon")):"function"==typeof define&&define.amd?define("ngx-tethys/form",["exports","@angular/core","@angular/common","@angular/forms","ngx-tethys/core","ngx-tethys/util","ngx-tethys/input","rxjs","rxjs/operators","ngx-tethys/alert","ngx-tethys/icon"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ngx-tethys"]=t["ngx-tethys"]||{},t["ngx-tethys"].form={}),t.ng.core,t.ng.common,t.ng.forms,t["ngx-tethys"].core,t["ngx-tethys"].util,t["ngx-tethys"].input,t.rxjs,t.rxjs.operators,t["ngx-tethys"].alert,t["ngx-tethys"].icon)}(this,(function(t,e,o,r,n,i,a,s,l,c,u){"use strict";var p=new e.InjectionToken("VALIDATION_CONFIG"),h=new e.InjectionToken("THY_FORM_CONFIG"),y={layout:"horizontal",footerAlign:"left"},f={provide:h,useValue:y},d=/\{(.+?)\}/g,m="is-invalid",g={showElementError:!0,removeElementError:!0,validationMessages:{}},b={required:"该选项不能为空",maxlength:"该选项输入值长度不能大于{maxlength}",minlength:"该选项输入值长度不能小于{minlength}",thyUniqueCheck:"输入值已经存在，请重新输入",email:"输入邮件的格式不正确",confirm:"两次输入不一致",pattern:"该选项输入格式不正确",number:"必须输入数字",url:"输入URL格式不正确",max:"该选项输入值不能大于{max}",min:"该选项输入值不能小于{min}"},v=function(){function t(t){this.config=Object.assign({},g,t)}return t.prototype.getDefaultValidationMessage=function(t){return this.config.globalValidationMessages&&this.config.globalValidationMessages[t]?this.config.globalValidationMessages[t]:b[t]},Object.defineProperty(t.prototype,"validationMessages",{get:function(){return this.config.validationMessages},enumerable:!1,configurable:!0}),t.prototype.getErrorMessage=function(t,e){return this.validationMessages[t]&&this.validationMessages[t][e]?this.validationMessages[t][e]:this.getDefaultValidationMessage(e)},t.prototype.getErrorMessages=function(t,e){var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(this.getErrorMessage(t,r));return o},t.prototype.defaultShowError=function(t,e){if(t&&t.parentElement){var o=document.createDocumentFragment(),r=document.createElement("DIV"),n=document.createTextNode(e[0]);r.appendChild(n),r.setAttribute("class","invalid-feedback"),o.appendChild(r),t.parentElement.append(o)}},t.prototype.defaultRemoveError=function(t){if(t&&t.parentElement){var e=t.parentElement.querySelector(".invalid-feedback");t.parentElement.removeChild(e)}},t.prototype.removeError=function(t){t.classList.remove(m),i.helpers.isFunction(this.config.removeElementError)?this.config.removeElementError(t):this.config.showElementError&&this.defaultRemoveError(t)},t.prototype.showError=function(t,e){t.classList.add(m),i.helpers.isFunction(this.config.showElementError)?this.config.showElementError(t,e):this.config.showElementError&&this.defaultShowError(t,e)},t.prototype.addValidationMessages=function(t){Object.assign(this.config.validationMessages,t)},t.prototype.setGlobalValidationMessages=function(t){this.config.globalValidationMessages=t},t}();v.decorators=[{type:e.Injectable}],v.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Optional},{type:e.Inject,args:[p]}]}]};var E,F=function(){function t(t){this.thyFormValidateLoader=t,this.errors=[],this.validations={}}return t.prototype._getElement=function(t){var e=this._formElement[t];return e||this._formElement.querySelector("[name='"+t+"']")},t.prototype._clearElementError=function(t){this.validations[t]&&this.validations[t].hasError&&(this.validations[t].hasError=!1,this.validations[t].errorMessages=[],this.thyFormValidateLoader.removeError(this._getElement(t)))},t.prototype._tryGetValidation=function(t){return this.validations[t]||this._initializeFormControlValidation(t,this._ngForm.controls[t]),this.validations[t]},t.prototype._addError=function(t){this.errors.unshift(t)},t.prototype._clearErrors=function(){this.errors=[]},t.prototype._initializeFormControlValidation=function(t,e){var o=this;this.validations[t]={hasError:!1,errorMessages:[]},e.valueChanges.subscribe((function(){o._clearElementError(t),o._clearErrors()}))},t.prototype._restFormControlValidation=function(t){var e=this.validations[t];e&&(e.hasError=!1,e.errorMessages=[])},t.prototype._formatValidationMessage=function(t,e){var o=this._ngForm.controls[t];return o?e.replace(d,(function(t,e){if(e)return o.errors[e][e]||o.errors[e].requiredLength})):e},t.prototype._getValidationMessage=function(t,e){var o=null;return o=this._config&&this._config.validationMessages&&this._config.validationMessages[t]&&this._config.validationMessages[t][e]?this._config.validationMessages[t][e]:this.thyFormValidateLoader.getErrorMessage(t,e),this._formatValidationMessage(t,o)},t.prototype._getValidationMessages=function(t,e){var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(this._getValidationMessage(t,r));return o},t.prototype._setControlValidationError=function(t,e){var o=this._tryGetValidation(t);o.errorMessages=e,o.hasError=!0,this.thyFormValidateLoader.showError(this._getElement(t),e)},t.prototype.initialize=function(t,e){this._ngForm=t,this._formElement=e},t.prototype.setValidatorConfig=function(t){this._config=t},t.prototype.validateControl=function(t){this._clearElementError(t);var e=this._ngForm.controls[t];if(e&&e.invalid){var o=this._getValidationMessages(t,e.errors);this._setControlValidationError(t,o)}},t.prototype.validateControls=function(){var t=this;for(var e in this._ngForm.controls)this._ngForm.controls.hasOwnProperty(e)&&(this._tryGetValidation(e),this.validateControl(e));Object.keys(this.validations).forEach((function(e){t._ngForm.controls[e]||delete t.validations[e]}))},t.prototype.addError=function(t){this._addError(t)},t.prototype.validate=function(t){return this._ngForm.onSubmit(t),this.validateControls(),this._ngForm.valid},t.prototype.reset=function(){for(var t in this._ngForm.reset(),this.validations)this.validations.hasOwnProperty(t)&&(this._restFormControlValidation(t),this._clearElementError(t))},t.prototype.setElementErrorMessage=function(t,e){this._clearElementError(t),this._setControlValidationError(t,[e])},t}();F.decorators=[{type:e.Injectable}],F.ctorParameters=function(){return[{type:v}]},t.ThyEnterKeyMode=void 0,(E=t.ThyEnterKeyMode||(t.ThyEnterKeyMode={})).submit="submit",E.alwaysSubmit="alwaysSubmit",E.forbidSubmit="forbidSubmit";var _=function(){function e(t,e,o,r,n,i,a){this.ngForm=t,this.elementRef=e,this.renderer=o,this.ngZone=r,this.updateHostClassService=n,this.validator=i,this.config=a,this.initialized=!1,this.wasValidated=!1,this.updateHostClassService.initializeElement(this.elementRef.nativeElement),this.layout=this.config.layout}return Object.defineProperty(e.prototype,"thyLayout",{get:function(){return this.layout},set:function(t){t&&(this.layout=t,this.initialized&&this.updateClasses())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHorizontal",{get:function(){return"horizontal"===this.layout},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thyFormValidatorConfig",{set:function(t){this.validator.setValidatorConfig(t)},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.ngZone.runOutsideAngular((function(){t._unsubscribe=t.renderer.listen(t.elementRef.nativeElement,"keydown",t.onKeydown.bind(t))})),this.updateClasses(),this.initialized=!0,this.validator.initialize(this.ngForm,this.elementRef.nativeElement)},e.prototype.submit=function(t){this.validator.validate(t)&&this.onSubmitSuccess(t)},e.prototype.updateClasses=function(){var t;this.updateHostClassService.updateClassByMap(((t={})["thy-form-"+this.thyLayout]=!0,t))},e.prototype.submitRunInZone=function(t){var e=this;this.ngZone.run((function(){e.submit(t)}))},e.prototype.onKeydown=function(e){var o=document.activeElement;(e.which||e.keyCode)===i.keycodes.ENTER&&o.tagName&&(this.thyEnterKeyMode&&this.thyEnterKeyMode!==t.ThyEnterKeyMode.submit?this.thyEnterKeyMode===t.ThyEnterKeyMode.alwaysSubmit&&(e.preventDefault(),this.submitRunInZone(e)):"TEXTAREA"===o.tagName||i.coerceBooleanProperty(o.getAttribute("contenteditable"))?(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.submitRunInZone(e)):(e.preventDefault(),this.submitRunInZone(e)))},e.prototype.ngOnDestroy=function(){this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null)},e}();_.decorators=[{type:e.Directive,args:[{selector:"[thyForm],[thy-form]",providers:[n.UpdateHostClassService,F],exportAs:"thyForm",host:{class:"thy-form"}}]}],_.ctorParameters=function(){return[{type:r.NgForm},{type:e.ElementRef},{type:e.Renderer2},{type:e.NgZone},{type:n.UpdateHostClassService},{type:F},{type:void 0,decorators:[{type:e.Inject,args:[h]}]}]},_.propDecorators={thyLayout:[{type:e.Input}],thyEnterKeyMode:[{type:e.Input}],thyFormValidatorConfig:[{type:e.Input}],wasValidated:[{type:e.HostBinding,args:["class.was-validated"]}]};var T={date:"wtf wtf-schedule-o"},C=function(){function t(t,e){this.thyParentForm=t,this.thyTranslate=e,this.labelRequired=!1,this.labelPaddingTopClear=!1,this._rowFill=!1,this._isFormGroup=!0,this.isHorizontal=!0,this.hasFeedback=!1}return Object.defineProperty(t.prototype,"thyLabelText",{set:function(t){this.labelText=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyLabelTextTranslateKey",{set:function(t){this.labelText=t?this.thyTranslate.instant(t):""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyLabelRequired",{set:function(t){this.labelRequired=i.coerceBooleanProperty(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyLabelPaddingTopClear",{set:function(t){this.labelPaddingTopClear=i.coerceBooleanProperty(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyFeedbackIcon",{set:function(t){this.hasFeedback=!0,T[t]?(this.feedbackIcon=T[t],this.feedbackSvgIconName=null):(this.feedbackSvgIconName=t,this.feedbackIcon=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyTips",{set:function(t){this.tips=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyTipsTranslateKey",{set:function(t){this.tips=this.thyTranslate.instant(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyRowFill",{set:function(t){this._rowFill=i.coerceBooleanProperty(t)},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.isHorizontal=!this.thyParentForm||this.thyParentForm.isHorizontal},t}();C.decorators=[{type:e.Component,args:[{selector:"thy-form-group",template:'<ng-container *ngIf="contentTemplateRef; else defaultTpl">\n  <ng-container [ngTemplateOutlet]="contentTemplateRef"></ng-container>\n  <ng-container *ngIf="feedbackSvgIconName; else iconFont">\n    <thy-icon class="form-control-feedback" [thyIconName]="feedbackSvgIconName"></thy-icon>\n  </ng-container>\n</ng-container>\n<ng-template #defaultTpl>\n  <label\n    *ngIf="!(!isHorizontal && !labelText)"\n    class="form-label "\n    [ngClass]="{\n      \'col-sm-2 col-form-label\': isHorizontal,\n      \'label-required\': labelRequired,\n      \'pt-0\': labelPaddingTopClear\n    }"\n    >{{ labelText }}</label\n  >\n  <div [ngClass]="{ \'col-sm-10 col-form-control\': isHorizontal, \'position-relative\': !isHorizontal }">\n    <ng-content></ng-content>\n    <ng-container *ngIf="feedbackSvgIconName; else iconFont">\n      <thy-icon class="form-control-feedback" [thyIconName]="feedbackSvgIconName"></thy-icon>\n    </ng-container>\n    <span *ngIf="tips" class="form-text text-desc">{{ tips }}</span>\n  </div>\n</ng-template>\n\n<ng-template #iconFont>\n  <span *ngIf="feedbackIcon" class="form-control-feedback {{ feedbackIcon }}"></span>\n</ng-template>\n',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush}]}],C.ctorParameters=function(){return[{type:_,decorators:[{type:e.Optional}]},{type:n.ThyTranslate}]},C.propDecorators={_rowFill:[{type:e.HostBinding,args:["class.row-fill"]}],_isFormGroup:[{type:e.HostBinding,args:["class.form-group"]}],isHorizontal:[{type:e.HostBinding,args:["class.row"]}],hasFeedback:[{type:e.HostBinding,args:["class.has-feedback"]}],thyLabelText:[{type:e.Input}],thyLabelTextTranslateKey:[{type:e.Input}],thyLabelRequired:[{type:e.Input}],thyLabelPaddingTopClear:[{type:e.Input}],thyFeedbackIcon:[{type:e.Input}],thyTips:[{type:e.Input}],thyTipsTranslateKey:[{type:e.Input}],thyRowFill:[{type:e.Input}],contentTemplateRef:[{type:e.ContentChild,args:["formGroup"]}]};var I=function(){function t(t){this.thyTranslate=t,this.labelRequired=!1,this._isFormGroupLabel=!0}return Object.defineProperty(t.prototype,"thyLabelText",{set:function(t){this.labelText=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyLabelTranslateKey",{set:function(t){t&&(this.labelText=this.thyTranslate.instant(t))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thyLabelRequired",{set:function(t){this.labelRequired=i.coerceBooleanProperty(t)},enumerable:!1,configurable:!0}),t}();I.decorators=[{type:e.Directive,args:[{selector:"[thyFormGroupLabel]"}]}],I.ctorParameters=function(){return[{type:n.ThyTranslate}]},I.propDecorators={labelRequired:[{type:e.HostBinding,args:["class.label-required"]}],_isFormGroupLabel:[{type:e.HostBinding,args:["class.col-form-label"]}],thyLabelText:[{type:e.Input}],thyLabelTranslateKey:[{type:e.Input}],thyLabelRequired:[{type:e.Input}]};var M=function(){function t(t,o){this.ngForm=t,this.thyFormDirective=o,this.thyFormSubmit=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;this.thyFormDirective.onSubmitSuccess=function(e){t.thyFormSubmit.emit(e)}},t.prototype.onSubmit=function(t){this.thyFormDirective.submit(t)},t}();M.decorators=[{type:e.Directive,args:[{selector:"[thyFormSubmit],[thy-form-submit]"}]}],M.ctorParameters=function(){return[{type:r.NgForm},{type:_}]},M.propDecorators={thyFormSubmit:[{type:e.Output}],onSubmit:[{type:e.HostListener,args:["click",["$event"]]}]};var O=function(){function t(t,e){this.thyParentForm=t,this.defaultConfig=e,this._isFormGroup=!0,this.isHorizontal=!0,this.footerClassMap={}}return Object.defineProperty(t.prototype,"align",{get:function(){return this.thyAlign?this.thyAlign:this.defaultConfig.footerAlign},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.thyParentForm&&(this.isHorizontal=this.thyParentForm.isHorizontal),this.setFooterClassMap()},t.prototype.setFooterClassMap=function(){var t;this.footerClassMap=((t={"form-group-footer":!0,"col-sm-10 offset-sm-2 col-form-control":this.isHorizontal})["form-group-footer-align-"+this.align]=!0,t)},t}();O.decorators=[{type:e.Component,args:[{selector:"thy-form-group-footer",template:'<div [ngClass]="footerClassMap">\n  <div class="btn-pair form-footer-actions">\n    <ng-content></ng-content>\n  </div>\n\n  <div class="form-footer-description" *ngIf="description">\n    <ng-container [ngTemplateOutlet]="description"></ng-container>\n  </div>\n</div>\n',encapsulation:e.ViewEncapsulation.None}]}],O.ctorParameters=function(){return[{type:_,decorators:[{type:e.Optional}]},{type:void 0,decorators:[{type:e.Inject,args:[h]}]}]},O.propDecorators={_isFormGroup:[{type:e.HostBinding,args:["class.form-group"]}],isHorizontal:[{type:e.HostBinding,args:["class.row"]}],description:[{type:e.ContentChild,args:["description"]}],thyAlign:[{type:e.Input}]};Object.create;Object.create;var x=function(){function t(t){this.thyParentForm=t,this.thyShowFirst=!0,this.isHorizontal=!0}return Object.defineProperty(t.prototype,"thyErrors",{get:function(){var t=this.errors||this.thyParentForm.validator.errors;return t&&t.length>0&&this.thyShowFirst?[t[0]]:t},set:function(t){this.errors=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isFormGroup",{get:function(){return this.thyErrors&&this.thyErrors.length>0},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.thyParentForm&&(this.isHorizontal=this.thyParentForm.isHorizontal)},t}();x.decorators=[{type:e.Component,args:[{selector:"thy-form-group-error",template:'<div [ngClass]="{ \'col-sm-10 offset-sm-2 col-form-control\': isHorizontal }">\n  <thy-alert *ngFor="let error of thyErrors" thyType="danger" [thyMessage]="error"></thy-alert>\n</div>\n',encapsulation:e.ViewEncapsulation.None}]}],x.ctorParameters=function(){return[{type:_,decorators:[{type:e.Optional}]}]},x.propDecorators={thyShowFirst:[{type:e.Input}],thyErrors:[{type:e.Input}],_isFormGroup:[{type:e.HostBinding,args:["class.form-group"]}],isHorizontal:[{type:e.HostBinding,args:["class.row"]}]},function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);i>3&&a&&Object.defineProperty(e,o,a)}([n.InputBoolean(),function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",Object)],x.prototype,"thyShowFirst",void 0);var P=function(){function t(t,e){this.elementRef=t,this.thyForm=e}return t.prototype.validate=function(t){var e=this;return this.thyUniqueCheck(t.value).pipe(l.map((function(t){return setTimeout((function(){t&&e.thyForm&&e.elementRef.nativeElement.name&&e.thyForm.validator.validateControl(e.elementRef.nativeElement.name)})),t?{thyUniqueCheck:t}:null})),l.catchError((function(){return s.of(null)})))},t}();P.decorators=[{type:e.Directive,args:[{selector:"[thyUniqueCheck]",providers:[{provide:r.NG_ASYNC_VALIDATORS,useExisting:P,multi:!0}]}]}],P.ctorParameters=function(){return[{type:e.ElementRef},{type:_,decorators:[{type:e.Optional}]}]},P.propDecorators={thyUniqueCheck:[{type:e.Input}]};var R=function(){function t(){}return Object.defineProperty(t.prototype,"min",{set:function(t){this._validator=r.Validators.min(parseFloat(t))},enumerable:!1,configurable:!0}),t.prototype.validate=function(t){return this._validator(t)},t}();R.decorators=[{type:e.Directive,args:[{selector:"[min][formControlName],[min][formControl],[min][ngModel]",providers:[{provide:r.NG_VALIDATORS,useExisting:e.forwardRef((function(){return R})),multi:!0}]}]}],R.propDecorators={min:[{type:e.Input}]};var V=function(){function t(){}return Object.defineProperty(t.prototype,"max",{set:function(t){this._validator=r.Validators.max(parseFloat(t))},enumerable:!1,configurable:!0}),t.prototype.validate=function(t){return this._validator(t)},t}();function w(t){return function(e){return t===e.value?null:{confirm:{value:t,actual:e.value}}}}V.decorators=[{type:e.Directive,args:[{selector:"[max][formControlName],[max][formControl],[max][ngModel]",providers:[{provide:r.NG_VALIDATORS,useExisting:e.forwardRef((function(){return V})),multi:!0}]}]}],V.propDecorators={max:[{type:e.Input}]};var j=function(){function t(){}return t.prototype.validate=function(t){return w(this.confirm)(t)},t}();j.decorators=[{type:e.Directive,args:[{selector:"[confirm]",providers:[{provide:r.NG_VALIDATORS,useExisting:j,multi:!0}]}]}],j.propDecorators={confirm:[{type:e.Input}]};var D=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:p,useValue:e}]}},t}();D.decorators=[{type:e.NgModule,args:[{imports:[o.CommonModule,r.FormsModule,a.ThyInputModule,c.ThyAlertModule,u.ThyIconModule],declarations:[_,C,I,M,O,P,x,R,V,j],exports:[_,C,I,M,O,P,x,R,V,j],providers:[v,f]}]}],t.ERROR_VALUE_REPLACE_REGEX=d,t.THY_FORM_CONFIG=h,t.THY_FORM_CONFIG_PROVIDER=f,t.THY_VALIDATOR_CONFIG=p,t.ThyConfirmValidatorDirective=j,t.ThyFormDirective=_,t.ThyFormGroupComponent=C,t.ThyFormGroupErrorComponent=x,t.ThyFormGroupFooterComponent=O,t.ThyFormGroupLabelDirective=I,t.ThyFormModule=D,t.ThyFormSubmitDirective=M,t.ThyFormValidatorLoader=v,t.ThyFormValidatorService=F,t.ThyMaxDirective=V,t.ThyMinDirective=R,t.ThyUniqueCheckValidator=P,t.confirmValidator=w,t.ɵ0=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-form.umd.min.js.map