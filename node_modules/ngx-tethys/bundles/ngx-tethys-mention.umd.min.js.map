{"version":3,"sources":["../../src/mention/suggestions/suggestions.component.ts","../../src/mention/caret-positioner.ts","../../node_modules/tslib/tslib.es6.js","../../src/mention/adapter/adapter.ts","../../src/mention/adapter/textarea.adapter.ts","../../src/mention/adapter/editable.adapter.ts","../../src/mention/mention.directive.ts","../../src/mention/adapter/index.ts","../../src/mention/mention.module.ts"],"names":["ThyMentionSuggestionsComponent","elementRef","ngZone","popoverRef","_this","this","suggestionSelect$","Subject","debounce","loadingDone","search$","suggestionsClass","pipe","switchMap","query","data","mention","search","term","Observable","debounceTime","of","catchError","subscribe","autoClose","length","close","onStable","take","updatePosition","prototype","ngOnInit","popoverClass","nativeElement","classList","add","next","select","item","event","selectionChange","value","ngOnDestroy","complete","Component","args","selector","template","ElementRef","NgZone","ThyPopoverRef","HostBinding","properties","isBrowser","window","isFirefox","CaretPositioner","getTextareaCaretCoordinates","element","position","options","Error","debug","el","document","querySelector","parentNode","removeChild","div","createElement","id","body","appendChild","style","computed","getComputedStyle","isInput","nodeName","whiteSpace","wordWrap","visibility","forEach","prop","boxSizing","height","parseInt","outerHeight","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","targetHeight","lineHeight","scrollHeight","overflowY","overflow","textContent","substring","replace","span","coordinates","top","offsetTop","left","offsetLeft","backgroundColor","getEditableCaretCoordinates","getSelection","rangeCount","range","getRangeAt","rect","getBoundingClientRect","startContainer","nodeType","isNaN","node","current","getAttribute","removeAttribute","editableRect","getCaretCoordinates","indexOf","getCaretPosition","elementOffset","getElementOffset","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","call","__extends","__","constructor","create","__values","o","s","Symbol","iterator","m","i","done","TypeError","MentionAdapter","inputor","lookup","mentions","matchedMention","mentions_1","mentions_1_1","seekQuery","TextareaMentionAdapter","_super","selectionStart","start","lastIndexOf","trigger","fistSpaceIndexFromStart","end","termWithTrigger","includes","insertMention","insertValue","getInsertValue","newValue","slice","join","focus","insertTransform","trim","caretPosition","setSelectionRange","isEditable","readOnly","disabled","EditableMentionAdapter","POPOVER_DEFAULT_CONFIG","backdropClass","placement","filter","name","toLowerCase","DEFAULT_MENTION_CONFIG","emptyText","ɵ0","ThyMentionDirective","thyPopover","ngControl","adapter","EventEmitter","isInputOrTextarea","contentEditable","bindEvents","defineProperty","_mentions","map","assign","addEventListener","onInput","onClick","matched","openSuggestions","closeSuggestions","openedSuggestionsRef","inputElement","fontSize","open","popoverConfig","origin","originPosition","x","y","width","initialState","afterClosed","componentInstance","control","setValue","emit","Directive","providers","ThyPopover","NgControl","decorators","type","Optional","Self","Input","Output","NgModule","declarations","imports","CommonModule","FormsModule","ThyPopoverModule","ThyListModule","ThyLoadingModule","exports","entryComponents"],"mappings":"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","sourcesContent":["import { Component, OnInit, OnDestroy, HostBinding, ElementRef, NgZone } from '@angular/core';\nimport { Subject, Observable, of } from 'rxjs';\nimport { ThySelectionListChange } from 'ngx-tethys/list';\nimport { MentionDefaultDataItem, Mention, MentionSuggestionSelectEvent } from '../interfaces';\nimport { debounceTime, switchMap, catchError, take } from 'rxjs/operators';\nimport { SeekQueryResult } from '../adapter/adapter';\nimport { ThyPopoverRef } from 'ngx-tethys/popover';\n\n@Component({\n    selector: 'thy-mention-suggestions',\n    templateUrl: './suggestions.component.html'\n})\nexport class ThyMentionSuggestionsComponent<TItem = MentionDefaultDataItem> implements OnInit, OnDestroy {\n    data: TItem[];\n\n    mention: Mention<TItem>;\n\n    suggestionSelect$ = new Subject<MentionSuggestionSelectEvent>();\n\n    debounce = 150;\n\n    loadingDone = true;\n\n    private search$ = new Subject<SeekQueryResult>();\n\n    @HostBinding('class.thy-mention-suggestions') suggestionsClass = true;\n\n    constructor(public elementRef: ElementRef<HTMLElement>, private ngZone: NgZone, private popoverRef: ThyPopoverRef<any>) {\n        this.search$\n            .pipe(\n                switchMap(query => {\n                    const data = this.mention.search(query.term, this.mention.data);\n                    if (data instanceof Observable) {\n                        this.loadingDone = false;\n                        return (data as Observable<TItem[]>).pipe(debounceTime(this.debounce));\n                    } else {\n                        return of(data as TItem[]);\n                    }\n                }),\n                catchError(() => {\n                    this.loadingDone = false;\n                    return [];\n                })\n            )\n            .subscribe(data => {\n                this.loadingDone = true;\n                this.data = data || [];\n\n                if (this.popoverRef) {\n                    if (this.mention.autoClose && this.data.length === 0) {\n                        this.popoverRef.close();\n                    }\n                    this.ngZone.onStable.pipe(take(1)).subscribe(() => {\n                        this.popoverRef.updatePosition();\n                    });\n                }\n            });\n    }\n\n    ngOnInit(): void {\n        if (this.mention.popoverClass) {\n            this.elementRef.nativeElement.classList.add(this.mention.popoverClass);\n        }\n    }\n\n    search(query: SeekQueryResult) {\n        this.search$.next(query);\n    }\n\n    select(item: TItem, event: Event) {\n        this.suggestionSelect$.next({\n            event,\n            item\n        });\n    }\n\n    selectionChange(event: ThySelectionListChange<TItem>) {\n        this.select(event.value, event.event);\n    }\n\n    ngOnDestroy() {\n        this.search$.next();\n        this.search$.complete();\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { getElementOffset } from 'ngx-tethys/util';\n\nexport interface CaretCoordinates {\n    top: number;\n    left: number;\n    height: number;\n}\n\nexport interface CaretOptions {\n    debug: boolean;\n}\n\n// We'll copy the properties below into the mirror div.\n// Note that some browsers, such as Firefox, do not concatenate properties\n// into their shorthand (e.g. padding-top, padding-bottom etc. -> padding),\n// so we have to list every single property explicitly.\nconst properties = [\n    'direction', // RTL support\n    'boxSizing',\n    'width', // on Chrome and IE, exclude the scrollbar, so the mirror div wraps exactly as the textarea does\n    'height',\n    'overflowX',\n    'overflowY', // copy the scrollbar for IE\n\n    'borderTopWidth',\n    'borderRightWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderStyle',\n\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft',\n\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/font\n    'fontStyle',\n    'fontVariant',\n    'fontWeight',\n    'fontStretch',\n    'fontSize',\n    'fontSizeAdjust',\n    'lineHeight',\n    'fontFamily',\n\n    'textAlign',\n    'textTransform',\n    'textIndent',\n    'textDecoration', // might not make a difference, but better be safe\n\n    'letterSpacing',\n    'wordSpacing',\n\n    'tabSize',\n    'MozTabSize'\n];\n\nconst isBrowser = typeof window !== 'undefined';\nconst isFirefox = isBrowser && window['mozInnerScreenX'] != null;\n\nexport type InputOrTextAreaElement = HTMLInputElement | HTMLTextAreaElement;\nexport type AllElement = InputOrTextAreaElement | HTMLElement;\n\nexport class CaretPositioner {\n    // get caret coordinates in input or textarea\n    // copy from repo: https://github.com/component/textarea-caret-position\n    static getTextareaCaretCoordinates(element: InputOrTextAreaElement, position: number, options?: CaretOptions): CaretCoordinates {\n        if (!isBrowser) {\n            throw new Error('textarea-caret-position#getCaretCoordinates should only be called in a browser');\n        }\n\n        const debug = (options && options.debug) || false;\n        if (debug) {\n            const el = document.querySelector('#input-textarea-caret-position-mirror-div');\n            if (el) {\n                el.parentNode.removeChild(el);\n            }\n        }\n\n        // The mirror div will replicate the textarea's style\n        const div = document.createElement('div');\n        div.id = 'input-textarea-caret-position-mirror-div';\n        document.body.appendChild(div);\n\n        const style = div.style;\n        const computed = window.getComputedStyle ? window.getComputedStyle(element) : element['currentStyle']; // currentStyle for IE < 9\n        const isInput = element.nodeName === 'INPUT';\n\n        // Default textarea styles\n        style.whiteSpace = 'pre-wrap';\n        if (!isInput) {\n            style.wordWrap = 'break-word'; // only for textarea-s\n        }\n\n        // Position off-screen\n        style.position = 'absolute'; // required to return coordinates properly\n        if (!debug) {\n            style.visibility = 'hidden'; // not 'display: none' because we want rendering\n        }\n        // Transfer the element's properties to the div\n        properties.forEach(function(prop) {\n            if (isInput && prop === 'lineHeight') {\n                // Special case for <input>s because text is rendered centered and line height may be != height\n                if (computed.boxSizing === 'border-box') {\n                    const height = parseInt(computed.height, 10);\n                    const outerHeight =\n                        parseInt(computed.paddingTop, 10) +\n                        parseInt(computed.paddingBottom, 10) +\n                        parseInt(computed.borderTopWidth, 10) +\n                        parseInt(computed.borderBottomWidth, 10);\n                    const targetHeight = outerHeight + parseInt(computed.lineHeight, 10);\n                    if (height > targetHeight) {\n                        style.lineHeight = height - outerHeight + 'px';\n                    } else if (height === targetHeight) {\n                        style.lineHeight = computed.lineHeight;\n                    } else {\n                        style.lineHeight = '0';\n                    }\n                } else {\n                    style.lineHeight = computed.height;\n                }\n            } else {\n                style[prop] = computed[prop];\n            }\n        });\n\n        if (isFirefox) {\n            // Firefox lies about the overflow property for textareas: https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n            if (element.scrollHeight > parseInt(computed.height, 10)) {\n                style.overflowY = 'scroll';\n            }\n        } else {\n            style.overflow = 'hidden'; // for Chrome to not render a scrollbar; IE keeps overflowY = 'scroll'\n        }\n\n        div.textContent = element.value.substring(0, position);\n        // The second special handling for input type=\"text\" vs textarea:\n        // spaces need to be replaced with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n        if (isInput) {\n            div.textContent = div.textContent.replace(/\\s/g, '\\u00a0');\n        }\n\n        const span = document.createElement('span');\n        // Wrapping must be replicated *exactly*, including when a long word gets\n        // onto the next line, with whitespace at the end of the line before (#7).\n        // The  *only* reliable way to do that is to copy the *entire* rest of the\n        // textarea's content into the <span> created at the caret position.\n        // For inputs, just '.' would be enough, but no need to bother.\n        span.textContent = element.value.substring(position) || '.'; // || because a completely empty faux span doesn't render at all\n        div.appendChild(span);\n\n        const coordinates = {\n            top: span.offsetTop + parseInt(computed['borderTopWidth'], 10),\n            left: span.offsetLeft + parseInt(computed['borderLeftWidth'], 10),\n            height: parseInt(computed['lineHeight'], 10)\n        };\n\n        if (debug) {\n            span.style.backgroundColor = '#aaa';\n        } else {\n            document.body.removeChild(div);\n        }\n\n        return coordinates;\n    }\n\n    static getEditableCaretCoordinates(element: HTMLElement): CaretCoordinates {\n        if (window.getSelection().rangeCount) {\n            const range = window.getSelection().getRangeAt(0);\n            const rect = range.getBoundingClientRect();\n            // using the start or endcontainer is... uhm yeah... difficult...? :D\n            let height: string | number =\n                range.startContainer.nodeType === 1\n                    ? getComputedStyle(range.startContainer as Element).lineHeight\n                    : getComputedStyle(range.startContainer.parentNode as Element).lineHeight;\n            if (isNaN(height as any)) {\n                let node = range.startContainer as HTMLElement;\n                if (range.startContainer.nodeType !== 1) {\n                    node = node.parentNode as HTMLElement;\n                }\n                const current = node.style.lineHeight;\n                node.style.lineHeight = '1em';\n                height = parseInt(getComputedStyle(node).lineHeight, 10);\n                node.style.lineHeight = current != null ? current : '';\n                if (!node.getAttribute('style').length) {\n                    // clean up if empty\n                    node.removeAttribute('style');\n                }\n            }\n            const editableRect = element.getBoundingClientRect();\n            return {\n                top: rect.top - editableRect.top,\n                left: rect.left - editableRect.left,\n                height: height as number\n            };\n        } else {\n            return {\n                top: 0,\n                left: 0,\n                height: 0\n            };\n        }\n    }\n\n    static getCaretCoordinates(element: AllElement, position: number, options?: CaretOptions) {\n        const isInput = ['INPUT', 'TEXTAREA'].indexOf(element.nodeName) >= 0;\n        if (isInput) {\n            return this.getTextareaCaretCoordinates(element as InputOrTextAreaElement, position, options);\n        } else {\n            return this.getEditableCaretCoordinates(element);\n        }\n    }\n\n    // get caret position in view window\n    static getCaretPosition(element: AllElement, position: number, options?: CaretOptions) {\n        const coordinates = CaretPositioner.getCaretCoordinates(element, position, options);\n        const elementOffset = getElementOffset(element);\n        return {\n            top: coordinates.top + elementOffset.top,\n            left: coordinates.left + elementOffset.left\n        };\n    }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { MentionDefaultDataItem, Mention } from '../interfaces';\n\nexport interface SeekQueryResult {\n    term: string;\n    start: number;\n    end: number;\n}\n\nexport interface MatchedMention<T = MentionDefaultDataItem> {\n    query: SeekQueryResult;\n    mention: Mention<T>;\n}\n\nexport type MentionInputorElement = HTMLTextAreaElement | HTMLInputElement;\nexport abstract class MentionAdapter {\n    inputor: MentionInputorElement;\n\n    matchedMention: MatchedMention;\n\n    constructor(inputor: MentionInputorElement) {\n        this.inputor = inputor;\n    }\n\n    abstract seekQuery(event: Event, mention: Mention): SeekQueryResult;\n\n    abstract insertMention(item: MentionDefaultDataItem): string;\n\n    lookup(event: Event, mentions: Mention[]) {\n        this.matchedMention = null;\n        for (const mention of mentions) {\n            const query = this.seekQuery(event, mention);\n            if (query) {\n                this.matchedMention = {\n                    query: query,\n                    mention: mention\n                };\n                break;\n            }\n        }\n        return this.matchedMention;\n    }\n}\n","import { MentionAdapter, MentionInputorElement, SeekQueryResult } from './adapter';\nimport { Mention, MentionDefaultDataItem } from '../interfaces';\n\nexport class TextareaMentionAdapter extends MentionAdapter {\n    inputor: MentionInputorElement;\n\n    constructor(inputor: MentionInputorElement) {\n        super(inputor);\n    }\n\n    public seekQuery(event: Event, mention: Mention): SeekQueryResult {\n        const selectionStart = this.inputor.selectionStart;\n        const value = this.inputor.value.replace(/[\\r\\n]/g, ' ');\n        // @123 | @456 => 0(start) => @123\n        // @123 @456 | => 5(start) => @456\n        const start = value.lastIndexOf(mention.trigger, selectionStart);\n        const fistSpaceIndexFromStart = value.indexOf(' ', selectionStart);\n        const end = fistSpaceIndexFromStart > -1 ? fistSpaceIndexFromStart : value.length;\n        const termWithTrigger = value.substring(start, end);\n        const startBeforeHasSpace = start > 0 && value[start - 1] === ' ';\n        if ((startBeforeHasSpace || start === 0) && !termWithTrigger.includes(' ') && !termWithTrigger.includes(mention.trigger, 1)) {\n            return {\n                start: start,\n                end: end,\n                term: termWithTrigger.substring(mention.trigger.length)\n            };\n        } else {\n            return null;\n        }\n    }\n\n    public insertMention(item: MentionDefaultDataItem): string {\n        if (!this.matchedMention) {\n            throw new Error(`matchedMention is null`);\n        }\n        const insertValue = this.getInsertValue(item);\n        const value: string = this.inputor.value;\n        const newValue = [\n            value.slice(0, this.matchedMention.query.start),\n            insertValue,\n            value.slice(this.matchedMention.query.end, value.length)\n        ].join('');\n        this.inputor.value = newValue;\n        this.focus(this.matchedMention.query.start + insertValue.length);\n        return newValue;\n    }\n\n    private getInsertValue(item: MentionDefaultDataItem) {\n        if (this.matchedMention.mention.insertTransform) {\n            return this.matchedMention.mention.insertTransform(item).trim() + ' ';\n        } else {\n            return `${this.matchedMention.mention.trigger}${item['name']}`.trim() + ' ';\n        }\n    }\n\n    private focus(caretPosition?: number): void {\n        this.inputor.focus();\n        this.inputor.setSelectionRange(caretPosition, caretPosition);\n    }\n\n    private isEditable() {\n        return !this.inputor.readOnly && !this.inputor.disabled;\n    }\n}\n","import { MentionAdapter, MentionInputorElement, SeekQueryResult } from './adapter';\nimport { Mention, MentionDefaultDataItem } from '../interfaces';\n\nexport class EditableMentionAdapter extends MentionAdapter {\n    inputor: MentionInputorElement;\n\n    constructor(inputor: MentionInputorElement) {\n        super(inputor);\n    }\n\n    seekQuery(event: Event, mention: Mention): SeekQueryResult {\n        return null;\n    }\n\n    insertMention(item: MentionDefaultDataItem): string {\n        throw new Error('Method not implemented.');\n    }\n}\n","import {\n    Directive,\n    ElementRef,\n    Input,\n    OnInit,\n    EventEmitter,\n    Output,\n    NgZone,\n    Optional,\n    ChangeDetectorRef,\n    forwardRef,\n    Self\n} from '@angular/core';\nimport { NgModel, NgControl, FormControl } from '@angular/forms';\nimport { Mention, MentionSuggestionSelectEvent, MentionDefaultDataItem } from './interfaces';\nimport { ThyPopover, ThyPopoverRef, ThyPopoverConfig } from 'ngx-tethys/popover';\nimport { ThyMentionSuggestionsComponent } from './suggestions/suggestions.component';\nimport { CaretPositioner } from './caret-positioner';\nimport { MentionAdapter, createMentionAdapter, MatchedMention, MentionInputorElement } from './adapter';\n\nconst SUGGESTION_BACKDROP_CLASS = 'thy-mention-suggestions-backdrop';\n\nconst POPOVER_DEFAULT_CONFIG = {\n    backdropClass: SUGGESTION_BACKDROP_CLASS,\n    placement: 'bottomLeft'\n};\n\nconst DEFAULT_MENTION_CONFIG: Partial<Mention> = {\n    autoClose: true,\n    emptyText: '无匹配数据，按空格完成输入',\n    search: (term: string, data: MentionDefaultDataItem[]) => {\n        return data.filter(item => {\n            return !item.name || item.name.toLowerCase().includes(term.toLowerCase());\n        });\n    }\n};\n\n@Directive({\n    selector: '[thyMention]',\n    providers: []\n})\nexport class ThyMentionDirective implements OnInit {\n    private adapter: MentionAdapter = null;\n\n    private openedSuggestionsRef: ThyPopoverRef<ThyMentionSuggestionsComponent>;\n\n    private _mentions: Mention<any>[];\n    get mentions() {\n        return this._mentions;\n    }\n\n    @Input('thyMention') set mentions(value: Mention<any>[]) {\n        this._mentions = value;\n        if (this._mentions) {\n            this._mentions = this._mentions.map(mention => {\n                if (!mention.trigger) {\n                    throw new Error(`mention trigger is required`);\n                }\n                return Object.assign({}, DEFAULT_MENTION_CONFIG, mention);\n            });\n        }\n    }\n\n    @Input('thyPopoverConfig') popoverConfig: ThyPopoverConfig;\n\n    @Output('thySelectSuggestion')\n    select = new EventEmitter<MentionSuggestionSelectEvent>();\n\n    constructor(\n        private elementRef: ElementRef<HTMLElement>,\n        private thyPopover: ThyPopover,\n        @Optional() @Self() private ngControl: NgControl\n    ) {\n        this.adapter = createMentionAdapter(elementRef.nativeElement as MentionInputorElement);\n        this.bindEvents();\n    }\n\n    ngOnInit() {}\n\n    bindEvents() {\n        this.elementRef.nativeElement.addEventListener('input', (event: Event) => {\n            this.onInput(event);\n        });\n        this.elementRef.nativeElement.addEventListener('click', (event: Event) => {\n            this.onClick(event);\n        });\n    }\n\n    onClick(event: Event) {\n        this.lookup(event);\n    }\n\n    onInput(event: Event) {\n        this.lookup(event);\n    }\n\n    private lookup(event: Event) {\n        const matched = this.adapter.lookup(event, this.mentions);\n        if (matched) {\n            this.openSuggestions(matched);\n        } else {\n            this.closeSuggestions();\n        }\n    }\n\n    private openSuggestions(matched: MatchedMention) {\n        if (!this.openedSuggestionsRef) {\n            const inputElement = this.elementRef.nativeElement as HTMLInputElement;\n            const position = CaretPositioner.getCaretPosition(inputElement, matched.query.start);\n            const fontSize = parseInt(getComputedStyle(this.elementRef.nativeElement).fontSize, 10);\n            this.openedSuggestionsRef = this.thyPopover.open(\n                ThyMentionSuggestionsComponent,\n                Object.assign({}, POPOVER_DEFAULT_CONFIG, this.popoverConfig, {\n                    origin: this.elementRef,\n                    originPosition: {\n                        x: position.left,\n                        y: position.top,\n                        width: fontSize,\n                        height: fontSize\n                    },\n                    initialState: {\n                        mention: matched.mention\n                    }\n                })\n            );\n            this.openedSuggestionsRef.afterClosed().subscribe(() => {\n                this.openedSuggestionsRef = null;\n            });\n            this.openedSuggestionsRef.componentInstance.suggestionSelect$.subscribe(event => {\n                const newValue = this.adapter.insertMention(event.item);\n                if (this.ngControl && this.ngControl.control) {\n                    this.ngControl.control.setValue(newValue);\n                }\n                this.openedSuggestionsRef.close();\n                this.select.emit(event);\n            });\n        }\n\n        if (this.openedSuggestionsRef) {\n            this.openedSuggestionsRef.componentInstance.search(matched.query);\n        }\n    }\n\n    private closeSuggestions() {\n        if (this.openedSuggestionsRef) {\n            this.openedSuggestionsRef.close();\n        }\n    }\n\n    private isEditable() {\n        const element = this.elementRef.nativeElement as HTMLInputElement | HTMLTextAreaElement;\n        return !element.readOnly && !element.disabled;\n    }\n}\n","import { isInputOrTextarea } from 'ngx-tethys/util';\nimport { Mention } from '../interfaces';\nimport { TextareaMentionAdapter } from './textarea.adapter';\nimport { EditableMentionAdapter } from './editable.adapter';\nimport { MentionInputorElement } from './adapter';\n\nexport function createMentionAdapter(element: MentionInputorElement) {\n    if (isInputOrTextarea(element)) {\n        return new TextareaMentionAdapter(element);\n    } else {\n        element.contentEditable = 'true';\n        return new EditableMentionAdapter(element);\n    }\n}\n\nexport * from './editable.adapter';\nexport * from './textarea.adapter';\nexport * from './adapter';\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ThyMentionDirective } from './mention.directive';\nimport { ThyMentionSuggestionsComponent } from './suggestions/suggestions.component';\nimport { ThyPopoverModule } from 'ngx-tethys/popover';\nimport { ThyListModule } from 'ngx-tethys/list';\nimport { ThyLoadingModule } from 'ngx-tethys/loading';\nimport { ThyEmptyModule } from 'ngx-tethys/empty';\n\n@NgModule({\n    declarations: [ThyMentionDirective, ThyMentionSuggestionsComponent],\n    imports: [CommonModule, FormsModule, ThyPopoverModule, ThyListModule, ThyLoadingModule],\n    exports: [ThyMentionDirective],\n    providers: [],\n    entryComponents: [ThyMentionSuggestionsComponent]\n})\nexport class ThyMentionModule {}\n"]}