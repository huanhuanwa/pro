!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("ngx-tethys/util"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-tethys/uploader",["exports","@angular/core","@angular/common","@angular/common/http","ngx-tethys/util","rxjs","rxjs/operators"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-tethys"]=e["ngx-tethys"]||{},e["ngx-tethys"].uploader={}),e.ng.core,e.ng.common,e.ng.common.http,e["ngx-tethys"].util,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r,o,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function p(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;Object.create;var l={".3gp":"video/3gpp",".apk":"application/vnd.android.package-archive",".asf":"video/x-ms-asf",".avi":"video/x-msvideo",".bin":"application/octet-stream",".bmp":"image/bmp",".c":"text/plain",".class":"application/octet-stream",".conf":"text/plain",".cpp":"text/plain",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel,.xls",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.xlsx",".xlsb":"application/vnd.ms-excel.sheet.binary.macroenabled.12",".xlsm":"application/vnd.ms-excel.sheet.macroenabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".exe":"application/octet-stream",".gif":"image/gif",".gtar":"application/x-gtar",".gz":"application/x-gzip",".h":"text/plain",".htm":"text/html",".html":"text/html",".jar":"application/java-archive",".java":"text/plain",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/x-javascript",".json":"application/json",".log":"text/plain",".m3u":"audio/x-mpegurl",".m4a":"audio/mp4a-latm",".m4b":"audio/mp4a-latm",".m4p":"audio/mp4a-latm",".m4u":"video/vnd.mpegurl",".m4v":"video/x-m4v",".mov":"video/quicktime",".mp2":"audio/x-mpeg",".mp3":"audio/x-mpeg",".mp4":"video/mp4",".mpc":"application/vnd.mpohun.certificate",".mpe":"video/mpeg",".mpeg":"video/mpeg",".mpg":"video/mpeg",".mpg4":"video/mp4",".mpga":"audio/mpeg",".msg":"application/vnd.ms-outlook",".ogg":"audio/ogg",".pdf":"application/pdf",".png":"image/png",".pps":"application/vnd.ms-powerpoint",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".prop":"text/plain",".rc":"text/plain",".rmvb":"audio/x-pn-realaudio",".rtf":"application/rtf",".sh":"text/plain",".tar":"application/x-tar",".tgz":"application/x-compressed",".txt":"text/plain",".wav":"audio/x-wav",".wma":"audio/x-ms-wma",".wmv":"audio/x-ms-wmv",".wps":"application/vnd.ms-works",".xml":"text/plain",".z":"application/x-compress",".zip":"application/x-zip-compressed","":"*/*"};function c(e){var t,n=[];return(t=o.isArray(e)?e:o.isString(e)?e.split(","):[]).length>0&&t.forEach((function(e){l[e]?n.push(l[e]):n.push(e)})),n.join(",")}var u=new t.InjectionToken("thy-uploader-default-options"),d={sizeThreshold:0,sizeExceedsHandler:f},m={provide:u,useValue:d};function f(e){var t=e.exceedsFiles.map((function(e){return"file: "+e.name+", size: "+e.size})).join(",");console.error("some files("+t+") size exceeds threshold "+e.sizeThreshold)}var h=function(){function e(e,t,n,r){this.elementRef=e,this.defaultConfig=t,this.renderer=n,this.ngZone=r,this.sizeThreshold=t.sizeThreshold,this.sizeExceedsHandler=t.sizeExceedsHandler}return Object.defineProperty(e.prototype,"thySizeThreshold",{set:function(e){var t=o.coerceNumberValue(e);o.isNumber(t)&&(this.sizeThreshold=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thySizeExceedsHandler",{set:function(e){e&&(this.sizeExceedsHandler=e)},enumerable:!1,configurable:!0}),e.prototype.handleSizeExceeds=function(e,t){var n=this,r=t.filter((function(e){return e.size/1024>n.sizeThreshold}));if(r.length>0){var o={files:t,exceedsFiles:r,nativeEvent:e,sizeThreshold:this.sizeThreshold};return this.sizeExceedsHandler(o)}return t},e.prototype.selectFiles=function(e,t,n){var r=t;this.sizeThreshold&&this.sizeThreshold>0&&(r=this.handleSizeExceeds(e,t)),r&&n.emit({files:r,nativeEvent:e})},e}();h.decorators=[{type:t.Component,args:[{template:""}]}],h.ctorParameters=function(){return[{type:t.ElementRef},{type:void 0,decorators:[{type:t.Inject,args:[u]}]},{type:t.Renderer2},{type:t.NgZone}]},h.propDecorators={thySizeThreshold:[{type:t.Input}],thySizeExceedsHandler:[{type:t.Input}]};var g=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.elementRef=n,o.defaultConfig=r,o.thyOnFileSelect=new t.EventEmitter,o}return p(n,e),Object.defineProperty(n.prototype,"thyMultiple",{set:function(e){this.multiple=o.coerceBooleanProperty(e),this.multiple?this.fileInput.nativeElement.setAttribute("multiple",""):this.fileInput.nativeElement.removeAttribute("multiple")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"thyAcceptFolder",{set:function(e){this.acceptFolder=o.coerceBooleanProperty(e),this.acceptFolder?this.fileInput.nativeElement.setAttribute("webkitdirectory",""):this.fileInput.nativeElement.removeAttribute("webkitdirectory")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"thyAcceptType",{set:function(e){this.acceptType=c(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"thySizeThreshold",{set:function(e){this.sizeThreshold=e},enumerable:!1,configurable:!0}),n.prototype.click=function(e){this.fileInput.nativeElement.click()},n.prototype.selectFile=function(e){var t=this.fileInput.nativeElement.files;t&&t.length>0&&(this.selectFiles(e,Array.from(t),this.thyOnFileSelect),this.fileInput.nativeElement.value="")},n.prototype.ngOnInit=function(){},n.prototype.ngOnDestroy=function(){},n}(h);g.decorators=[{type:t.Component,args:[{selector:"[thyFileSelect],thy-file-select",template:'<ng-content></ng-content>\n<input style="width: 0; height: 0" thyStopPropagation="true" [hidden]="\'true\'" #fileInput type="file" (change)="selectFile($event)"\n    [attr.accept]="acceptType">\n'}]}],g.ctorParameters=function(){return[{type:t.ElementRef},{type:void 0,decorators:[{type:t.Inject,args:[u]}]}]},g.propDecorators={thyOnFileSelect:[{type:t.Output}],fileInput:[{type:t.ViewChild,args:["fileInput",{static:!0}]}],thyMultiple:[{type:t.Input}],thyAcceptFolder:[{type:t.Input}],thyAcceptType:[{type:t.Input}],thySizeThreshold:[{type:t.Input}],click:[{type:t.HostListener,args:["click",["$event"]]}]};var y,v=function(e){function n(n,r,o,a){var s=e.call(this,n,a)||this;return s.elementRef=n,s.renderer=r,s.ngZone=o,s.defaultConfig=a,s.isDragOver=!1,s.thyOnDrop=new t.EventEmitter,s.ngUnsubscribe$=new i.Subject,s}return p(n,e),Object.defineProperty(n.prototype,"thyFileDropClassName",{set:function(e){this.dragOverCustomClass=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"thyAcceptType",{set:function(e){this.acceptType=c(e)},enumerable:!1,configurable:!0}),n.prototype.ngOnInit=function(){var e=this;this.ngZone.runOutsideAngular((function(){i.fromEvent(e.elementRef.nativeElement,"dragenter").pipe(a.takeUntil(e.ngUnsubscribe$),a.tap((function(e){e.preventDefault()})),a.filter((function(e){return e.dataTransfer.items&&e.dataTransfer.items.length>0}))).subscribe((function(t){if(e.checkRejectFolderAndHtmlElement(t)){var n=e.filterFilesOrItems(Array.from(t.dataTransfer.items));o.isEmpty(n)||e.ngZone.run((function(){e.isDragOver=!0,e.toggleDropOverClassName()}))}})),i.fromEvent(e.elementRef.nativeElement,"dragover").pipe(a.takeUntil(e.ngUnsubscribe$)).subscribe((function(e){e.preventDefault()})),i.fromEvent(e.elementRef.nativeElement,"dragleave").pipe(a.takeUntil(e.ngUnsubscribe$)).subscribe((function(t){e.ngZone.run((function(){e.elementRef.nativeElement.contains(t.fromElement)||(e.resetDragOver(),e.toggleDropOverClassName())}))})),i.fromEvent(e.elementRef.nativeElement,"drop").pipe(a.takeUntil(e.ngUnsubscribe$),a.tap((function(e){e.preventDefault()}))).subscribe((function(t){e.ngZone.run((function(){if(e.checkRejectFolderAndHtmlElement(t)){var n=e.filterFilesOrItems(t.dataTransfer?Array.from(t.dataTransfer.files):[]);o.isEmpty(n)||e.selectFiles(t,Array.from(t.dataTransfer.files),e.thyOnDrop)}e.resetDragOver(),e.toggleDropOverClassName()}))}))}))},n.prototype.checkRejectFolderAndHtmlElement=function(e){for(var t=e.dataTransfer?e.dataTransfer.items:[],n=!0,r=0;r<t.length;r++){var o=t[r],i=this.getAsEntry(o);("file"!==o.kind||i&&!i.isFile)&&(n=!1)}return n},n.prototype.getAsEntry=function(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t},n.prototype.filterFilesOrItems=function(e){var t=this;return this.acceptType&&"*/*"!=this.acceptType?e.filter((function(e){return t.acceptType.includes(e.type)})):Array.from(e)},n.prototype.toggleDropOverClassName=function(){this.dragOverCustomClass&&(this.isDragOver?this.renderer.addClass(this.elementRef.nativeElement,this.dragOverCustomClass):this.renderer.removeClass(this.elementRef.nativeElement,this.dragOverCustomClass))},n.prototype.setDragOverState=function(e){this.isDragOver=e},n.prototype.resetDragOver=function(){this.setDragOverState(!1)},n.prototype.ngOnDestroy=function(){this.ngUnsubscribe$.next(),this.ngUnsubscribe$.complete()},n}(h);v.decorators=[{type:t.Component,args:[{selector:"[thyFileDrop]",template:"\n        <ng-content></ng-content>\n    "}]}],v.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.NgZone},{type:void 0,decorators:[{type:t.Inject,args:[u]}]}]},v.propDecorators={isDragOver:[{type:t.HostBinding,args:["class.drop-over"]},{type:t.HostBinding,args:["class.thy-drop-over"]}],thyFileDropClassName:[{type:t.Input}],thyAcceptType:[{type:t.Input}],thyOnDrop:[{type:t.Output}]},e.ThyUploadStatus=void 0,(y=e.ThyUploadStatus||(e.ThyUploadStatus={})).pending="pending",y.started="started",y.uploading="uploading",y.done="done";var x=function(){function t(e,t){this.http=e,this.xhrFactory=t}return t.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},t.prototype.humanizeBytes=function(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]},t.prototype.normalizeUploadFiles=function(t){o.coerceArray(t).forEach((function(t){t.progress||(t.progress={status:e.ThyUploadStatus.pending,percentage:0,startTime:0})}))},t.prototype.uploadByXhr=function(t,n){var r=this,o=this.xhrFactory.build(),i=(new Date).getTime(),a=0,s=null;n.progress={status:e.ThyUploadStatus.started,percentage:0,startTime:i},o.upload.addEventListener("progress",(function(o){if(o.lengthComputable){var p=Math.round(100*o.loaded/o.total);100===p&&(p=99);var l=(new Date).getTime()-i;a=Math.round(o.loaded/l*1e3);var c=n.progress&&n.progress.startTime||(new Date).getTime();s=Math.ceil((o.total-o.loaded)/a),n.progress.status=e.ThyUploadStatus.uploading,n.progress.percentage=p,n.progress.speed=a,n.progress.speedHuman=r.humanizeBytes(a)+"/s",n.progress.startTime=c,n.progress.estimatedTime=s,n.progress.estimatedTimeHuman=r.secondsToHuman(s),t.next({status:e.ThyUploadStatus.uploading,uploadFile:n})}}),!1),o.upload.addEventListener("error",(function(e){t.error(e),t.complete()})),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var i=1e3*((new Date).getTime()-n.progress.startTime),p=Math.round(n.nativeFile.size/i);n.progress.status=e.ThyUploadStatus.done,n.progress.percentage=100,n.progress.speed=p,n.progress.speedHuman=r.humanizeBytes(a)+"/s",n.progress.estimatedTime=s,n.progress.estimatedTimeHuman=r.secondsToHuman(s||0),n.responseStatus=o.status;try{n.response=JSON.parse(o.response)}catch(e){n.response=o.response}t.next({status:e.ThyUploadStatus.done,uploadFile:n}),t.complete()}},o.open(n.method,n.url,!0),o.withCredentials=!!n.withCredentials;try{var p=new FormData;Object.keys(n.data||{}).forEach((function(e){return p.append(e,n.data[e])})),Object.keys(n.headers||{}).forEach((function(e){return o.setRequestHeader(e,n.headers[e])})),p.append(n.fileField||"file",n.nativeFile,n.fileName),t.next({status:e.ThyUploadStatus.started,uploadFile:n}),o.send(p)}catch(e){t.error(e),t.complete()}return o},t.prototype.ensureFileName=function(e){e.fileName=e.fileName||e.nativeFile.name},t.prototype.upload=function(e){var t=this;return this.ensureFileName(e),new i.Observable((function(n){var r=t.uploadByXhr(n,e);return function(){r.abort()}}))},t.prototype.uploadBulk=function(t,n,r){var o=this;return void 0===n&&(n=5),this.normalizeUploadFiles(t),i.from(t).pipe(a.mergeMap((function(t){return o.upload(t).pipe(a.tap((function(t){r&&r.onStarted&&t.status===e.ThyUploadStatus.started&&r.onStarted(t.uploadFile),r&&r.onDone&&t.status===e.ThyUploadStatus.done&&r.onDone(t.uploadFile)})))}),n),a.map((function(e){return e})))},t}();x.decorators=[{type:t.Injectable}],x.ctorParameters=function(){return[{type:r.HttpClient},{type:r.XhrFactory}]};var b=function(){};b.decorators=[{type:t.NgModule,args:[{declarations:[g,v,h],imports:[n.CommonModule,r.HttpClientModule],entryComponents:[v],providers:[x,m],exports:[g,v]}]}],e.THY_UPLOADER_DEFAULT_OPTIONS=u,e.THY_UPLOADER_DEFAULT_OPTIONS_PROVIDER=m,e.ThyFileDropComponent=v,e.ThyFileSelectComponent=g,e.ThyUploaderModule=b,e.ThyUploaderService=x,e.sizeExceedsHandler=f,e.ɵ0=d,e.ɵa=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-uploader.umd.min.js.map