!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/cdk/coercion"),require("rxjs"),require("rxjs/operators"),require("ngx-tethys/util"),require("@angular/common"),require("ngx-tethys/core")):"function"==typeof define&&define.amd?define("ngx-tethys/drag-drop",["exports","@angular/core","@angular/cdk/coercion","rxjs","rxjs/operators","ngx-tethys/util","@angular/common","ngx-tethys/core"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-tethys"]=e["ngx-tethys"]||{},e["ngx-tethys"]["drag-drop"]={}),e.ng.core,e.ng.cdk.coercion,e.rxjs,e.rxjs.operators,e["ngx-tethys"].util,e.ng.common,e["ngx-tethys"].core)}(this,(function(e,t,r,n,o,i,a,s){"use strict";function c(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var d=c(t),p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function g(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}Object.create;function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}var h,l;Object.create;e.ThyDropPosition=void 0,(h=e.ThyDropPosition||(e.ThyDropPosition={})).in="in",h.before="before",h.after="after";var f=((l={})[e.ThyDropPosition.in]="thy-drop-position-in",l[e.ThyDropPosition.before]="thy-drop-position-before",l[e.ThyDropPosition.after]="thy-drop-position-after",l),y=function(){function t(e,t,r,o,i,a){this.drag=t,this.container=r,this.dragDropService=o,this.document=i,this.ngZone=a,this.ngUnsubscribe$=new n.Subject,this.started=new n.Subject,this.ended=new n.Subject,this.overed=new n.Subject,this.dropped=new n.Subject,this.entered=new n.Subject,this.leaved=new n.Subject,this._disabled=!1,this.withRootElement(e)}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this.container&&this.container.disabled||this._disabled},set:function(e){this._disabled=e},enumerable:!1,configurable:!0}),t.prototype.withRootElement=function(e){var t=r.coerceElement(e);return this.rootElement=t,this.registerDragDropEvents(),this},t.prototype.withContentElement=function(e){return this.contentElement=r.coerceElement(e),this},t.prototype.withHandles=function(e){return this.handles=i.coerceArray(e),this},t.prototype.registerDragDropEvents=function(){var e=this,t={dragstart:this.dragStart,dragover:this.dragOver,dragend:this.dragEnd,drop:this.dragDrop,dragleave:this.dragLeave,dragenter:function(t){e.entered.next(t)},mouseover:function(t){e.target=t.target}};this.ngZone.runOutsideAngular((function(){for(var r in t)t.hasOwnProperty(r)&&n.fromEvent(e.rootElement,r).pipe(o.takeUntil(e.ngUnsubscribe$)).subscribe(t[r].bind(e))}))},t.prototype.dragStart=function(e){var t=this;e.stopPropagation();var r={event:e,item:this.drag.data,containerItems:this.container.data,currentIndex:this.container.data.indexOf(this.drag.data)};if(this.disabled||!this.isTriggerHandle()||this.container.beforeStart&&!this.container.beforeStart(r))return e.preventDefault(),!1;this.dragDropService.previousDrag=this.drag,this.ngZone.run((function(){t.started.next(r)}))},t.prototype.isTriggerHandle=function(){var e=this;return!(this.handles&&this.handles.length>0)||!!this.handles.find((function(t){return!t.disabled&&(t.element.nativeElement===e.target||t.element.nativeElement.contains(e.target))}))},t.prototype.getPreviousEventData=function(){var e=this.dragDropService.previousDrag.data,t=this.dragDropService.previousDrag.container.data;return{previousItem:e,previousContainerItems:this.dragDropService.previousDrag.container.data,previousIndex:t.indexOf(e)}},t.prototype.isContinueDragOver=function(t,r){return(t.item!==t.previousItem||t.position!==e.ThyDropPosition.in)&&(!r||!r.beforeOver||r.beforeOver(t))},t.prototype.dragOver=function(e){e.stopPropagation(),e.preventDefault();var t=this.calcDropPosition(e),r=Object.assign({event:e,item:this.drag.data,containerItems:this.drag.container.data,currentIndex:this.container.data.indexOf(this.drag.data),position:t},this.getPreviousEventData());this.isContinueDragOver(r,this.container)&&(this.dragOverHandler(t),this.overed.next(r))},t.prototype.dragOverHandler=function(e){var t=this.contentElement||this.rootElement;this.dragDropService.dropPosition!==e&&this.clearDragPositionClass(),t.classList.add(f[e]),this.dragDropService.dropPosition=e},t.prototype.dragDrop=function(e){var t=this;e.stopPropagation(),this.clearDragPositionClass();var r=Object.assign({event:e,item:this.drag.data,containerItems:this.drag.container.data,currentIndex:this.container.data.indexOf(this.drag.data),position:this.calcDropPosition(e)},this.getPreviousEventData());this.dragDropService.previousDrag===this.drag||this.container.beforeDrop&&!this.container.beforeDrop(r)?e.preventDefault():this.ngZone.run((function(){t.dropped.next(r)}))},t.prototype.dragEnd=function(e){var t=this;this.ngZone.run((function(){t.ended.next({event:e,item:t.drag.data,containerItems:t.container.data})}))},t.prototype.dragLeave=function(e){e.stopPropagation(),this.clearDragPositionClass(),this.leaved.next(e)},t.prototype.clearDragPositionClass=function(){var e=this.contentElement||this.rootElement;for(var t in f)f[t]&&e.classList.remove(f[t])},t.prototype.calcDropPosition=function(t){var r=t.clientY,n=t.srcElement?t.srcElement.getBoundingClientRect():t.target.getBoundingClientRect(),o=n.top,i=n.bottom,a=n.height,s=Math.max(.25*a,2);return r<=o+s?e.ThyDropPosition.before:r>=i-s?e.ThyDropPosition.after:e.ThyDropPosition.in},t.prototype.dispose=function(){this.ngUnsubscribe$.complete()},t}(),b=function(){};b.ɵprov=d.ɵɵdefineInjectable({factory:function(){return new b},token:b,providedIn:"root"}),b.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],b.ctorParameters=function(){return[]};var v=new t.InjectionToken("THY_DROP_CONTAINER_DIRECTIVE"),D=function(e){function t(t,r,n,o,i){var a=e.call(this)||this;return a.container=r,a.elementRef=o,a.isDraggable=!0,a._disabled=!1,a.dragRef=new y(o,a,r,i,t,n),a}return g(t,e),Object.defineProperty(t.prototype,"dragData",{set:function(e){this.data=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e,e&&(this.isDraggable=!1)},enumerable:!1,configurable:!0}),t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.dragRef.dispose()},t}(s.mixinUnsubscribe(s.MixinBase));D.decorators=[{type:t.Directive,args:[{selector:"thy-drag,[thyDrag]"}]}],D.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[a.DOCUMENT]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[v]}]},{type:t.NgZone},{type:t.ElementRef},{type:b}]},D.propDecorators={dragData:[{type:t.Input,args:["thyDrag"]}],data:[{type:t.Input,args:["thyDragData"]}],isDraggable:[{type:t.HostBinding,args:["attr.draggable"]}],disabled:[{type:t.Input,args:["thyDragDisabled"]}]};var m=function(){function e(e,t){this.element=e,this._disabled=!1,t&&t.dragRef.withHandles(this)}return Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=r.coerceBooleanProperty(e)},enumerable:!1,configurable:!0}),e}();m.decorators=[{type:t.Directive,args:[{selector:"thy-drag-handle,[thyDragHandle]"}]}],m.ctorParameters=function(){return[{type:t.ElementRef},{type:D,decorators:[{type:t.Optional}]}]},m.propDecorators={disabled:[{type:t.Input,args:["thyDisabled"]}]};var O=function(e,t){this.element=e,this.contentClass=!0,t&&t.dragRef.withContentElement(this.element)};O.decorators=[{type:t.Directive,args:[{selector:"thy-drag-content,[thyDragContent]"}]}],O.ctorParameters=function(){return[{type:t.ElementRef},{type:D,decorators:[{type:t.Optional}]}]},O.propDecorators={contentClass:[{type:t.HostBinding,args:["class.thy-drag-content"]}]};var E=function(e){function r(r){var n=e.call(this)||this;return n.ngZone=r,n.started=new t.EventEmitter,n.ended=new t.EventEmitter,n.overed=new t.EventEmitter,n.dropped=new t.EventEmitter,n}return g(r,e),Object.defineProperty(r.prototype,"dragContainer",{set:function(e){this.data=e},enumerable:!1,configurable:!0}),r.prototype.ngOnInit=function(){},r.prototype.ngAfterContentInit=function(){var e=this;this.draggables.changes.pipe(o.startWith(null),o.takeUntil(this.ngUnsubscribe$)).subscribe((function(){e.draggableChanges()}))},r.prototype.draggableChanges=function(){var e=this;this.resetDraggableChanges((function(e){return e.dragRef.started})).subscribe((function(t){e.started.emit(t)})),this.resetDraggableChanges((function(e){return e.dragRef.ended})).subscribe((function(t){e.ended.emit(t)})),this.resetDraggableChanges((function(e){return e.dragRef.overed})).subscribe((function(t){e.overed.emit(t)})),this.resetDraggableChanges((function(e){return e.dragRef.dropped})).subscribe((function(t){e.dropped.emit(t)}))},r.prototype.resetDraggableChanges=function(e){var t=this;return n.defer((function(){return t.draggables?n.merge.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}(t.draggables.map(e))):t.ngZone.onStable.asObservable().pipe(o.take(1),o.switchMap((function(){return t.resetDraggableChanges.bind(t,e)})))})).pipe(o.takeUntil(n.merge(this.ngUnsubscribe$,this.draggables.changes)))},r}(s.mixinUnsubscribe(s.MixinBase));E.decorators=[{type:t.Directive,args:[{selector:"thy-drop-container,[thyDropContainer]",providers:[{provide:v,useExisting:E}]}]}],E.ctorParameters=function(){return[{type:t.NgZone}]},E.propDecorators={dragContainer:[{type:t.Input,args:["thyDropContainer"]}],data:[{type:t.Input,args:["thyDropContainerData"]}],disabled:[{type:t.Input,args:["thyDropContainerDisabled"]}],beforeStart:[{type:t.Input,args:["thyBeforeDragStart"]}],beforeOver:[{type:t.Input,args:["thyBeforeDragOver"]}],beforeDrop:[{type:t.Input,args:["thyBeforeDragDrop"]}],started:[{type:t.Output,args:["thyDragStarted"]}],ended:[{type:t.Output,args:["thyDragEnded"]}],overed:[{type:t.Output,args:["thyDragOvered"]}],dropped:[{type:t.Output,args:["thyDragDropped"]}],draggables:[{type:t.ContentChildren,args:[D,{descendants:!1}]}]};var P=function(){};P.decorators=[{type:t.NgModule,args:[{imports:[],exports:[E,D,m,O],declarations:[E,D,m,O],providers:[]}]}],e.DragRef=y,e.THY_DROP_CONTAINER_DIRECTIVE=v,e.ThyDragContentDirective=O,e.ThyDragDirective=D,e.ThyDragDropModule=P,e.ThyDragDropService=b,e.ThyDragHandleDirective=m,e.ThyDropContainerDirective=E,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-drag-drop.umd.min.js.map