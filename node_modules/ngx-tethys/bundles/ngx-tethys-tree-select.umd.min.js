!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/overlay"),require("ngx-tethys/label"),require("ngx-tethys/core"),require("ngx-tethys/util"),require("rxjs"),require("rxjs/operators"),require("ngx-tethys/list"),require("ngx-tethys/icon"),require("ngx-tethys/empty"),require("ngx-tethys/shared")):"function"==typeof define&&define.amd?define("ngx-tethys/tree-select",["exports","@angular/core","@angular/common","@angular/forms","@angular/cdk/overlay","ngx-tethys/label","ngx-tethys/core","ngx-tethys/util","rxjs","rxjs/operators","ngx-tethys/list","ngx-tethys/icon","ngx-tethys/empty","ngx-tethys/shared"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-tethys"]=e["ngx-tethys"]||{},e["ngx-tethys"]["tree-select"]={}),e.ng.core,e.ng.common,e.ng.forms,e.ng.cdk.overlay,e["ngx-tethys"].label,e["ngx-tethys"].core,e["ngx-tethys"].util,e.rxjs,e.rxjs.operators,e["ngx-tethys"].list,e["ngx-tethys"].icon,e["ngx-tethys"].empty,e["ngx-tethys"].shared)}(this,(function(e,t,n,i,s,o,r,l,a,d,h,c,p,y){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,o=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return r}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}Object.create;function f(e,t,n){void 0===n&&(n="name");var i=function(e,s){if(e[n]&&-1!==e[n].indexOf(t))return s.push(e),s;if(Array.isArray(e.children)){var o=e.children.reduce((function(e,t){return i(t,e)}),[]);if(o.length){var r=Object.assign(Object.assign({},e),{children:o,expand:!0});s.push(r)}}return s};return e.reduce((function(e,t){return i(t,e)}),[])}var m=function(){function e(e,t,n){this.elementRef=e,this.renderer=t,this.ngZone=n,this.treeSelectClass=!0,this.isTreeSelect=!0,this.expandTreeSelectOptions=!1,this.isMulti=!1,this.selectedNodes=[],this.flattenTreeNodes=[],this.cdkConnectOverlayWidth=0,this.icons={expand:"angle-down",collapse:"angle-right",gap:15},this.initialled=!1,this.valueIsObject=!1,this.thyPrimaryKey="_id",this.thyShowKey="name",this.thyChildCountKey="childCount",this.thyMultiple=!1,this.thyDisable=!1,this.thyPlaceholder="请选择节点",this.thyEmptyOptionsText="暂时没有数据可选",this.thyHiddenNodeKey="hidden",this.thyDisableNodeKey="disabled",this.thyAsyncNode=!1,this.thyShowWholeName=!1,this.thyShowSearch=!1,this.thyHiddenNodeFn=function(e){return e.hidden},this.thyDisableNodeFn=function(e){return e.disabled},this.thyGetNodeChildren=function(e){return a.of([])},this.onModelChange=function(){},this.onModelTouch=function(){}}return Object.defineProperty(e.prototype,"thyTreeNodes",{set:function(e){this.treeNodes=e,this.originTreeNodes=e,this.initialled&&(this.flattenTreeNodes=this.flattenNodes(this.treeNodes,this.flattenTreeNodes,[]),this.setSelectedNodes())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"placeholder",{get:function(){return this.thyPlaceholder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thyIconType",{set:function(e){l.warnDeprecation("This parameter has been deprecation")},enumerable:!1,configurable:!0}),e.prototype._getNgModelType=function(){this.thyMultiple?this.valueIsObject=!this.selectedValue[0]||l.isObject(this.selectedValue[0]):this.valueIsObject=l.isObject(this.selectedValue)},e.prototype.writeValue=function(e){this.selectedValue=e,e&&this._getNgModelType(),this.setSelectedNodes()},e.prototype.registerOnChange=function(e){this.onModelChange=e},e.prototype.registerOnTouched=function(e){this.onModelTouch=e},e.prototype.onDocumentClick=function(e){e.stopPropagation(),!this.elementRef.nativeElement.contains(e.target)&&this.expandTreeSelectOptions&&(this.expandTreeSelectOptions=!1)},e.prototype.ngOnInit=function(){this.positions=r.getFlexiblePositions("bottom",4),this.isMulti=this.thyMultiple,this.flattenTreeNodes=this.flattenNodes(this.treeNodes,this.flattenTreeNodes,[]),this.setSelectedNodes(),this.initialled=!0,this.init()},Object.defineProperty(e.prototype,"selectedValueObject",{get:function(){return this.thyMultiple?this.selectedNodes:this.selectedNode},enumerable:!1,configurable:!0}),e.prototype.searchValue=function(e){this.treeNodes=f(this.originTreeNodes,e.trim(),this.thyShowKey)},e.prototype.setPosition=function(){var e=this;this.ngZone.onStable.asObservable().pipe(d.take(1)).subscribe((function(){e.cdkConnectedOverlay.overlayRef.updatePosition()}))},e.prototype.init=function(){this.cdkConnectOverlayWidth=this.cdkOverlayOrigin.elementRef.nativeElement.getBoundingClientRect().width},e.prototype.flattenNodes=function(e,t,n){var i=this;void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=[]),t=t.concat(e);var s=[];return(e||[]).forEach((function(e){if(e.parentValues=n,e.level=e.parentValues.length,e.children&&l.isArray(e.children)){var o=i.flattenNodes(e.children,t,g(n,[e[i.thyPrimaryKey]]));s=g(s,o)}})),g(e,s)},e.prototype._findTreeNode=function(e){var t=this;return(this.flattenTreeNodes||[]).find((function(n){return n[t.thyPrimaryKey]===e}))},e.prototype.getShowNodeName=function(){var e=this;if(this.thyShowWholeName){var t="";return(this.selectedNode.parentValues||[]).forEach((function(n,i){var s=e._findTreeNode(n);t=""+t+s[e.thyShowKey]+" > "})),""+t+this.selectedNode[this.thyShowKey]}return this.selectedNode[this.thyShowKey]},e.prototype.setSelectedNodes=function(){var e=this;this.selectedValue?this.thyMultiple?this.selectedValue.length>0&&(this.valueIsObject&&Object.keys(this.selectedValue[0]).indexOf(this.thyPrimaryKey)>=0?this.selectedNodes=this.selectedValue.map((function(t){return e._findTreeNode(t[e.thyPrimaryKey])})):this.selectedNodes=this.selectedValue.map((function(t){return e._findTreeNode(t)}))):this.valueIsObject?Object.keys(this.selectedValue).indexOf(this.thyPrimaryKey)>=0&&(this.selectedNode=this._findTreeNode(this.selectedValue[this.thyPrimaryKey])):this.selectedNode=this._findTreeNode(this.selectedValue):(this.selectedNodes=[],this.selectedNode=null)},e.prototype.openSelectPop=function(){this.thyDisable||(this.cdkConnectOverlayWidth=this.cdkOverlayOrigin.elementRef.nativeElement.getBoundingClientRect().width,this.expandTreeSelectOptions=!this.expandTreeSelectOptions)},e.prototype.close=function(){this.expandTreeSelectOptions=!1},e.prototype.clearSelectedValue=function(e){e.stopPropagation(),this.selectedValue=null,this.selectedNode=null,this.selectedNodes=[],this.onModelChange(this.selectedValue)},e.prototype._changeSelectValue=function(){var e=this;this.valueIsObject?this.selectedValue=this.thyMultiple?this.selectedNodes:this.selectedNode:this.selectedValue=this.thyMultiple?this.selectedNodes.map((function(t){return t[e.thyPrimaryKey]})):this.selectedNode[this.thyPrimaryKey],this.onModelChange(this.selectedValue)},e.prototype.removeMultipleSelectedNode=function(e){this.removeSelectedNode(e.item,e.$event)},e.prototype.removeSelectedNode=function(e,t){var n=this;t&&t.stopPropagation(),this.thyDisable||this.thyMultiple&&(this.selectedNodes=l.produce(this.selectedNodes).remove((function(t){return t[n.thyPrimaryKey]===e[n.thyPrimaryKey]})),this._changeSelectValue())},e.prototype.selectNode=function(e){var t=this;this.thyMultiple?this.selectedNodes.find((function(n){return n[t.thyPrimaryKey]===e[t.thyPrimaryKey]}))?this.removeSelectedNode(e):this.selectedNodes=l.produce(this.selectedNodes).add(e):(this.selectedNode=e,this.expandTreeSelectOptions=!1),this._changeSelectValue()},e.prototype.getNodeChildren=function(e){var t=this,n=this.thyGetNodeChildren(e);if(n&&n.subscribe)return n.pipe().subscribe((function(n){var i=t.flattenNodes(n,t.flattenTreeNodes,g(e.parentValues,[e[t.thyPrimaryKey]])).filter((function(e){return!t.flattenTreeNodes.find((function(n){return n[t.thyPrimaryKey]===e[t.thyPrimaryKey]}))}));t.flattenTreeNodes=g(t.flattenTreeNodes,i),e.children=n})),n},e}();m.decorators=[{type:t.Component,args:[{selector:"thy-tree-select",template:'<div\n  cdkOverlayOrigin\n  thySelectControl\n  (click)="openSelectPop()"\n  #origin="cdkOverlayOrigin"\n  [thyPanelOpened]="expandTreeSelectOptions"\n  [thySelectedOptions]="selectedValueObject"\n  [thyIsMultiple]="thyMultiple"\n  [thyAllowClear]="thyAllowClear"\n  [thySize]="thySize"\n  [thyPlaceholder]="placeholder"\n  [customDisplayTemplate]="customDisplayTemplate"\n  [thyShowSearch]="thyShowSearch"\n  [thyDisabled]="thyDisable"\n  (thyOnClear)="clearSelectedValue($event)"\n  (thyOnRemove)="removeMultipleSelectedNode($event)"\n  (thyOnSearch)="searchValue($event)"\n>\n  <ng-template #customDisplayTemplate let-node>\n    <ng-container *ngIf="thyTreeSelectTriggerDisplayRef; else noneTemplate">\n      <ng-template [ngTemplateOutlet]="thyTreeSelectTriggerDisplayRef" [ngTemplateOutletContext]="{ $implicit: node }"></ng-template>\n    </ng-container>\n    <ng-template #noneTemplate>\n      {{ node[thyShowKey] }}\n    </ng-template>\n  </ng-template>\n</div>\n\n<ng-template\n  cdkConnectedOverlay\n  [cdkConnectedOverlayHasBackdrop]="false"\n  [cdkConnectedOverlayPositions]="positions"\n  [cdkConnectedOverlayOrigin]="origin"\n  [cdkConnectedOverlayWidth]="cdkConnectOverlayWidth"\n  [cdkConnectedOverlayOpen]="expandTreeSelectOptions"\n  (detach)="close()"\n>\n  <thy-tree-select-nodes [treeNodes]="treeNodes"></thy-tree-select-nodes>\n</ng-template>\n',providers:[{provide:i.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return m})),multi:!0}]}]}],m.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.NgZone}]},m.propDecorators={treeSelectClass:[{type:t.HostBinding,args:["class.thy-select-custom"]}],isTreeSelect:[{type:t.HostBinding,args:["class.thy-select"]}],expandTreeSelectOptions:[{type:t.HostBinding,args:["class.menu-is-opened"]}],isMulti:[{type:t.HostBinding,args:["class.thy-select-custom--multiple"]}],thyTreeSelectTriggerDisplayRef:[{type:t.ContentChild,args:["thyTreeSelectTriggerDisplay"]}],treeNodeTemplateRef:[{type:t.ContentChild,args:["treeNodeTemplate"]}],cdkOverlayOrigin:[{type:t.ViewChild,args:[s.CdkOverlayOrigin,{static:!0}]}],cdkConnectedOverlay:[{type:t.ViewChild,args:[s.CdkConnectedOverlay,{static:!0}]}],customDisplayTemplate:[{type:t.ViewChild,args:["customDisplayTemplate",{static:!0}]}],thyTreeNodes:[{type:t.Input}],thyPrimaryKey:[{type:t.Input}],thyShowKey:[{type:t.Input}],thyChildCountKey:[{type:t.Input}],thyAllowClear:[{type:t.Input}],thyMultiple:[{type:t.Input}],thyDisable:[{type:t.Input}],thyPlaceholder:[{type:t.Input}],thySize:[{type:t.Input}],thyEmptyOptionsText:[{type:t.Input}],thyHiddenNodeKey:[{type:t.Input}],thyDisableNodeKey:[{type:t.Input}],thyAsyncNode:[{type:t.Input}],thyShowWholeName:[{type:t.Input}],thyShowSearch:[{type:t.Input}],thyIconType:[{type:t.Input}],thyHiddenNodeFn:[{type:t.Input}],thyDisableNodeFn:[{type:t.Input}],thyGetNodeChildren:[{type:t.Input}],onDocumentClick:[{type:t.HostListener,args:["document:click",["$event"]]}]};var N=function(){function e(e){this.parent=e,this.primaryKey=this.parent.thyPrimaryKey,this.showKey=this.parent.thyShowKey,this.isMultiple=this.parent.thyMultiple,this.valueIsObject=this.parent.valueIsObject,this.selectedValue=this.parent.selectedValue,this.childCountKey=this.parent.thyChildCountKey,this.treeNodeTemplateRef=this.parent.treeNodeTemplateRef}return e.prototype.ngOnInit=function(){this.class=this.isMultiple?"thy-tree-select-dropdown thy-tree-select-dropdown-multiple":"thy-tree-select-dropdown"},e.prototype.treeNodeIsSelected=function(e){var t=this;return this.parent.thyMultiple?(this.parent.selectedNodes||[]).find((function(n){return n[t.primaryKey]===e[t.primaryKey]})):this.parent.selectedNode&&this.parent.selectedNode[this.primaryKey]===e[this.primaryKey]},e.prototype.treeNodeIsHidden=function(e){return this.parent.thyHiddenNodeKey?e[this.parent.thyHiddenNodeKey]:!!this.parent.thyHiddenNodeFn&&this.parent.thyHiddenNodeFn(e)},e.prototype.treeNodeIsDisable=function(e){return this.parent.thyDisableNodeKey?e[this.parent.thyDisableNodeKey]:!!this.parent.thyDisableNodeFn&&this.parent.thyDisableNodeFn(e)},e.prototype.treeNodeIsExpand=function(e){var t=this,n=!1;n=this.parent.thyMultiple?!!(this.parent.selectedNodes||[]).find((function(n){return n.parentValues.indexOf(e[t.primaryKey])>-1})):!!this.parent.selectedNode&&this.parent.selectedNode.parentValues.indexOf(e[this.primaryKey])>-1;var i=e.expand||Object.keys(e).indexOf("expand")<0&&n;return e.expand=i,i},e.prototype.getNodeChildren=function(e){return this.parent.getNodeChildren(e)},e.prototype.selectTreeNode=function(e,t){e.stopPropagation(),this.treeNodeIsDisable(t)||this.parent.selectNode(t)},e.prototype.nodeExpandToggle=function(e,t){var n=this;e.stopPropagation(),Object.keys(t).indexOf("expand")>-1?t.expand=!t.expand:this.treeNodeIsExpand(t)?t.expand=!1:t.expand=!0,t.expand&&this.parent.thyAsyncNode&&this.getNodeChildren(t).subscribe((function(){n.parent.setPosition()})),this.parent.setPosition()},e}();N.decorators=[{type:t.Component,args:[{selector:"thy-tree-select-nodes",template:'<div class="thy-tree-select-options" *ngIf="treeNodes?.length > 0; else emptyPlaceholder">\n  <ng-container\n    *ngIf="treeNodes?.length > 0"\n    [ngTemplateOutlet]="treeSelectNode"\n    [ngTemplateOutletContext]="{ $implicit: treeNodes }"\n  ></ng-container>\n</div>\n<ng-template #emptyPlaceholder>\n  <thy-empty class="thy-select-empty-content" thySize="sm" [thyMessage]="parent.thyEmptyOptionsText"></thy-empty>\n</ng-template>\n<ng-template #treeSelectNode let-nodes>\n  <div class="thy-tree-select-node">\n    <ng-container *ngFor="let node of nodes">\n      <a\n        class="thy-option-item"\n        [ngClass]="{ active: treeNodeIsSelected(node) }"\n        [class.disabled]="treeNodeIsDisable(node)"\n        [ngStyle]="{ \'padding-left.px\': 20 * node.level + parent.icons.gap }"\n        (click)="selectTreeNode($event, node)"\n        *ngIf="!treeNodeIsHidden(node)"\n      >\n        <ng-template #treeSelectNode> </ng-template>\n        <span\n          class="thy-tree-select-option-icon"\n          [class.invisible]="!(node.children?.length > 0 || (node[childCountKey] && node[childCountKey] > 0))"\n          (click)="nodeExpandToggle($event, node)"\n        >\n          <thy-icon\n            class="node-expand-icon"\n            [thyIconName]="treeNodeIsExpand(node) ? parent.icons.expand : parent.icons.collapse"\n          ></thy-icon>\n        </span>\n        <span class="thy-tree-select-option-text">\n          <ng-template\n            *ngIf="treeNodeTemplateRef; else defaultNodeText"\n            [ngTemplateOutlet]="treeNodeTemplateRef"\n            [ngTemplateOutletContext]="{ $implicit: node }"\n          ></ng-template>\n          <ng-template #defaultNodeText>\n            {{ node[showKey] }}\n          </ng-template>\n        </span>\n        <span class="checked-icon" *ngIf="isMultiple">\n          <i class="wtf wtf-checked"></i>\n        </span>\n      </a>\n      <ng-container\n        *ngIf="treeNodeIsExpand(node) && node.children?.length > 0"\n        [ngTemplateOutlet]="treeSelectNode"\n        [ngTemplateOutletContext]="{ $implicit: node.children }"\n      ></ng-container>\n    </ng-container>\n  </div>\n</ng-template>\n'}]}],N.ctorParameters=function(){return[{type:m}]},N.propDecorators={class:[{type:t.HostBinding,args:["class"]}],treeNodes:[{type:t.Input}]};var v=function(){};v.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,i.FormsModule,s.OverlayModule,o.ThyLabelModule,h.ThyListModule,c.ThyIconModule,p.ThyEmptyModule,y.ThySelectCommonModule],declarations:[m,N],exports:[m,N]}]}],e.ThyTreeSelectComponent=m,e.ThyTreeSelectModule=v,e.ThyTreeSelectNodesComponent=N,e.filterTreeData=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-tree-select.umd.min.js.map