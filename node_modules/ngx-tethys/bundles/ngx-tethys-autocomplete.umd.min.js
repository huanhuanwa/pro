!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/overlay"),require("@angular/cdk/coercion"),require("@angular/cdk/portal"),require("ngx-tethys/core"),require("@angular/animations"),require("rxjs/operators"),require("@angular/cdk/bidi"),require("rxjs"),require("@angular/cdk/scrolling"),require("@angular/cdk/platform"),require("ngx-tethys/shared"),require("ngx-tethys/util"),require("ngx-tethys/input"),require("@angular/cdk/collections"),require("@angular/cdk/a11y"),require("ngx-tethys/label"),require("ngx-tethys/loading"),require("ngx-tethys/icon"),require("ngx-tethys/empty")):"function"==typeof define&&define.amd?define("ngx-tethys/autocomplete",["exports","@angular/core","@angular/common","@angular/forms","@angular/cdk/overlay","@angular/cdk/coercion","@angular/cdk/portal","ngx-tethys/core","@angular/animations","rxjs/operators","@angular/cdk/bidi","rxjs","@angular/cdk/scrolling","@angular/cdk/platform","ngx-tethys/shared","ngx-tethys/util","ngx-tethys/input","@angular/cdk/collections","@angular/cdk/a11y","ngx-tethys/label","ngx-tethys/loading","ngx-tethys/icon","ngx-tethys/empty"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-tethys"]=e["ngx-tethys"]||{},e["ngx-tethys"].autocomplete={}),e.ng.core,e.ng.common,e.ng.forms,e.ng.cdk.overlay,e.ng.cdk.coercion,e.ng.cdk.portal,e["ngx-tethys"].core,e.ng.animations,e.rxjs.operators,e.ng.cdk.bidi,e.rxjs,e.ng.cdk.scrolling,e.ng.cdk.platform,e["ngx-tethys"].shared,e["ngx-tethys"].util,e["ngx-tethys"].input,e.ng.cdk.collections,e.ng.cdk.a11y,e["ngx-tethys"].label,e["ngx-tethys"].loading,e["ngx-tethys"].icon,e["ngx-tethys"].empty)}(this,(function(e,t,n,o,i,r,a,s,c,p,l,u,h,y,m,d,g,f,v,C,O,b,A){"use strict";function E(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var R=E(t),k=E(n),S=E(i),w=E(h),M=E(y),T=function(e,t){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function x(e,t){function n(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;function P(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)a.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a}function I(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(P(arguments[t]));return e}Object.create;var j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return x(t,e),t}(s.ThyAbstractOverlayConfig),D=new t.InjectionToken("thy-autocomplete-default-config"),_={hasBackdrop:!1,panelClass:"",closeOnNavigation:!0,insideClosable:!0,manualClosure:!1,outsideClosable:!0,originActiveClass:"thy-autocomplete-origin-active"},U={provide:D,useValue:_},q=[c.state("void, exit",c.style({opacity:0,transform:"scale(0.1)"})),c.state("enter",c.style({transform:"none"}))],N={autocompleteContainer:c.trigger("autocompleteContainer",q)},V={name:"autocomplete",animationEnabled:!0,disposeWhenClose:!0},F=function(e){function n(n,o,i,r,a,s){var c=e.call(this,V,r)||this;return c.elementRef=n,c.document=o,c.config=i,c.thyClickDispatcher=a,c.ngZone=s,c.animationState="enter",c.animationStateChanged=new t.EventEmitter,c.animationOpeningDone=c.animationStateChanged.pipe(p.filter((function(e){return"done"===e.phaseName&&"enter"===e.toState}))),c.animationClosingDone=c.animationStateChanged.pipe(p.filter((function(e){return"done"===e.phaseName&&"exit"===e.toState}))),c}return x(n,e),n.prototype.beforeAttachPortal=function(){},n.prototype.ngAfterViewInit=function(){},n.prototype.onAnimationDone=function(e){this.animationStateChanged.emit(e)},n.prototype.onAnimationStart=function(e){this.animationStateChanged.emit(e)},n.prototype.startExitAnimation=function(){this.animationState="exit",this.changeDetectorRef.markForCheck()},n}(s.ThyAbstractOverlayContainer);F.decorators=[{type:t.Component,args:[{selector:"thy-autocomplete-container",template:"<ng-template cdkPortalOutlet></ng-template>\n",animations:[N.autocompleteContainer],host:{class:"thy-autocomplete-container",tabindex:"-1","[attr.role]":"'autocomplete'","[@autocompleteContainer]":"animationState","(@autocompleteContainer.start)":"onAnimationStart($event)","(@autocompleteContainer.done)":"onAnimationDone($event)"}}]}],F.ctorParameters=function(){return[{type:t.ElementRef},{type:void 0,decorators:[{type:t.Inject,args:[n.DOCUMENT]}]},{type:j},{type:t.ChangeDetectorRef},{type:s.ThyClickDispatcher},{type:t.NgZone}]},F.propDecorators={portalOutlet:[{type:t.ViewChild,args:[a.CdkPortalOutlet,{static:!0}]}]};var Z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return x(t,e),t}(s.ThyAbstractOverlayRef),K=function(e){function t(t,n,o){return e.call(this,V,t,n,o)||this}return x(t,e),t.prototype.updatePosition=function(){return this.overlayRef.updatePosition(),this},t}(s.ThyAbstractInternalOverlayRef),L=function(e){function n(t,n,o,i,r,a,s,c,p){var l=e.call(this,V,t,n,o)||this;return l.scrollDispatcher=i,l.ngZone=r,l._viewportRuler=a,l._document=s,l._platform=c,l._overlayContainer=p,l.ngUnsubscribe$=new u.Subject,l.originInstancesMap=new Map,l}return x(n,e),n.prototype.buildPositionStrategy=function(e){var t=this,n=new i.FlexibleConnectedPositionStrategy(e.origin,this._viewportRuler,this._document,this._platform,this._overlayContainer),o=s.getFlexiblePositions(e.placement,e.offset,"thy-autocomplete");return n.withPositions(o),n.withGrowAfterOpen(!0),n.positionChanges.pipe(p.takeUntil(this.ngUnsubscribe$)).subscribe((function(e){e.scrollableViewProperties.isOverlayClipped&&t.ngZone.run((function(){return t.close()}))})),n},n.prototype.buildOverlayConfig=function(e){var t=this.buildPositionStrategy(e),n=this.buildBaseOverlayConfig(e);return n.positionStrategy=t,n.scrollStrategy=e.scrollStrategy||this.overlay.scrollStrategies.block(),n.width=e.width,n},n.prototype.attachUpperOverlayContainer=function(e,n){var o=n&&n.viewContainerRef&&n.viewContainerRef.injector,i=t.Injector.create({parent:o||this.injector,providers:[{provide:j,useValue:n}]}),r=new a.ComponentPortal(F,n.viewContainerRef,i);return e.attach(r).instance},n.prototype.createUpperOverlayRef=function(e,t,n){return new K(e,t,n)},n.prototype.createInjector=function(e,n,o){var i=e&&e.viewContainerRef&&e.viewContainerRef.injector,r=[{provide:F,useValue:o},{provide:Z,useValue:n}];return!e.direction||i&&i.get(l.Directionality,null)||r.push({provide:l.Directionality,useValue:{value:e.direction,change:u.of()}}),t.Injector.create({parent:i||this.injector,providers:r})},n.prototype.originElementAddActiveClass=function(e){var t;e.originActiveClass&&(t=r.coerceElement(e.origin).classList).add.apply(t,I(r.coerceArray(e.originActiveClass)))},n.prototype.originElementRemoveActiveClass=function(e){var t;e.originActiveClass&&(t=r.coerceElement(e.origin).classList).remove.apply(t,I(r.coerceArray(e.originActiveClass)))},n.prototype.open=function(e,t){var n=this,o=r.coerceElement(t.origin),i=this.openUpperOverlay(e,t);return t=i.containerInstance.config,i.afterClosed().subscribe((function(){n.originElementRemoveActiveClass(t),n.originInstancesMap.delete(o)})),this.originElementAddActiveClass(t),this.originInstancesMap.set(o,{config:t,autocompleteRef:i}),i},n.prototype.ngOnDestroy=function(){this.dispose()},n}(s.ThyAbstractOverlayService);L.ɵprov=R.ɵɵdefineInjectable({factory:function(){return new L(R.ɵɵinject(S.Overlay),R.ɵɵinject(R.INJECTOR),R.ɵɵinject(D),R.ɵɵinject(w.ScrollDispatcher),R.ɵɵinject(R.NgZone),R.ɵɵinject(w.ViewportRuler),R.ɵɵinject(k.DOCUMENT),R.ɵɵinject(M.Platform),R.ɵɵinject(S.OverlayContainer))},token:L,providedIn:"root"}),L.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],L.ctorParameters=function(){return[{type:i.Overlay},{type:t.Injector},{type:j,decorators:[{type:t.Inject,args:[D]}]},{type:i.ScrollDispatcher},{type:t.NgZone},{type:h.ViewportRuler},{type:void 0,decorators:[{type:t.Inject,args:[n.DOCUMENT]}]},{type:y.Platform},{type:i.OverlayContainer}]};var W=function(){function e(e,t,n,o,i,r,a){this.elementRef=e,this.ngZone=t,this.overlay=n,this.autocompleteService=o,this.viewContainerRef=i,this.document=r,this.cdr=a,this.closeKeyEventStream=new u.Subject,this.panelOpened=!1,this.thyOffset=4,this.thyPlacement="bottomLeft"}return Object.defineProperty(e.prototype,"autocompleteComponent",{get:function(){return this._autocompleteComponent},set:function(e){this._autocompleteComponent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autocomplete",{set:function(e){d.warnDeprecation("The property thyAutocomplete will be deprecated, please use thyAutocompleteComponent instead."),this._autocompleteComponent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeOption",{get:function(){return this.autocompleteComponent&&this.autocompleteComponent.keyManager?this.autocompleteComponent.keyManager.activeItem:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panelClosingActions",{get:function(){var e=this;return u.merge(this.autocompleteComponent.thyOptionSelected,this.autocompleteComponent.keyManager.tabOut.pipe(p.filter((function(){return e.panelOpened}))),this.closeKeyEventStream,this.getOutsideClickStream(),this.overlayRef?this.overlayRef.detachments().pipe(p.filter((function(){return e.panelOpened}))):u.of()).pipe(p.map((function(e){return e instanceof m.ThyOptionSelectionChangeEvent?e:null})))},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.onFocus=function(){this.canOpen()&&this.openPanel()},e.prototype.onKeydown=function(e){var t=e.keyCode;if(t===d.ESCAPE&&e.preventDefault(),this.activeOption&&t===d.ENTER&&this.panelOpened)this.activeOption.selectViaInteraction(),this.resetActiveItem(),e.preventDefault();else if(this.autocompleteComponent){var n=this.autocompleteComponent.keyManager.activeItem,o=t===d.UP_ARROW||t===d.DOWN_ARROW;this.panelOpened||t===d.TAB?this.autocompleteComponent.keyManager.onKeydown(e):o&&this.canOpen()&&this.openPanel(),(o||this.autocompleteComponent.keyManager.activeItem!==n)&&this.autocompleteComponent.keyManager.activeItem&&s.ScrollToService.scrollToElement(this.autocompleteComponent.keyManager.activeItem.element.nativeElement,this.autocompleteComponent.optionsContainer.nativeElement)}},e.prototype.handleInput=function(e){this.canOpen()&&document.activeElement===e.target&&this.openPanel()},e.prototype.openPanel=function(){var e=this;if(!this.overlayRef||!this.overlayRef.hasAttached()){var t=this.createOverlay();this.overlayRef=t,t.keydownEvents().subscribe((function(t){(t.keyCode===d.ESCAPE||t.keyCode===d.UP_ARROW&&t.altKey)&&(e.resetActiveItem(),e.closeKeyEventStream.next(),t.stopPropagation(),t.preventDefault())})),this.panelOpened=!0,this.autocompleteComponent.open()}},e.prototype.closePanel=function(){this.autocompleteRef&&(this.autocompleteRef.close(),this.cdr.detectChanges(),this.closingActionsSubscription.unsubscribe())},e.prototype.createOverlay=function(){var e=this,t=Object.assign({origin:this.elementRef.nativeElement,viewContainerRef:this.viewContainerRef,placement:this.thyPlacement,offset:this.thyOffset,scrollStrategy:this.overlay.scrollStrategies.reposition(),width:this.thyAutocompleteWidth||this.elementRef.nativeElement.clientWidth});return this.autocompleteRef=this.autocompleteService.open(this.autocompleteComponent.contentTemplateRef,t),this.autocompleteRef.afterClosed().subscribe((function(){e.panelOpened=!1,e.autocompleteComponent.close()})),this.autocompleteRef.afterOpened().pipe(p.delay(200)).subscribe((function(){e.closingActionsSubscription=e.subscribeToClosingActions()})),this.autocompleteRef.getOverlayRef()},e.prototype.subscribeToClosingActions=function(){var e=this,t=this.ngZone.onStable.asObservable().pipe(p.take(1)),n=this.autocompleteComponent.options.changes.pipe(p.delay(0));return u.merge(t,n).pipe(p.switchMap((function(){return e.resetActiveItem(),e.panelOpened&&e.overlayRef.updatePosition(),e.panelClosingActions})),p.take(1)).subscribe((function(t){return e.setValueAndClose(t)}))},e.prototype.setValueAndClose=function(e){e&&e.option&&this.setValue(e.option.thyLabelText),this.closePanel()},e.prototype.getOutsideClickStream=function(){var e=this;return u.merge(u.fromEvent(this.document,"click"),u.fromEvent(this.document,"touchend")).pipe(p.filter((function(t){var n=t.target;return e.panelOpened&&n!==e.elementRef.nativeElement&&!!e.overlayRef&&!e.overlayRef.overlayElement.contains(n)})))},e.prototype.setValue=function(e){this.elementRef.nativeElement.value=e,this.elementRef.nativeElement.focus()},e.prototype.canOpen=function(){var e=this.elementRef.nativeElement;return!e.readOnly&&!e.disabled},e.prototype.resetActiveItem=function(){this.autocompleteComponent.keyManager.setActiveItem(this.autocompleteComponent.thyAutoActiveFirstOption?0:-1)},e.prototype.destroyPanel=function(){this.overlayRef&&(this.closePanel(),this.overlayRef.dispose(),this.overlayRef=null)},e.prototype.ngOnDestroy=function(){this.closeKeyEventStream.complete(),this.destroyPanel()},e}();W.decorators=[{type:t.Directive,args:[{selector:"input[thyAutocompleteTrigger], textarea[thyAutocompleteTrigger]",exportAs:"thyAutocompleteTrigger",host:{"(input)":"handleInput($event)","(focusin)":"onFocus()","(keydown)":"onKeydown($event)"}}]}],W.ctorParameters=function(){return[{type:t.ElementRef},{type:t.NgZone},{type:i.Overlay},{type:L},{type:t.ViewContainerRef},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[n.DOCUMENT]}]},{type:t.ChangeDetectorRef}]},W.propDecorators={panelOpened:[{type:t.HostBinding,args:["class.thy-autocomplete-opened"]}],autocompleteComponent:[{type:t.Input,args:["thyAutocompleteComponent"]}],autocomplete:[{type:t.Input,args:["thyAutocomplete"]}],thyOffset:[{type:t.Input}],thyAutocompleteWidth:[{type:t.Input}],thyPlacement:[{type:t.Input}]};var $=function(e){function n(n,o){var i=e.call(this)||this;return i.ngZone=n,i.changeDetectorRef=o,i.isMultiple=!1,i.mode="",i.isEmptyOptions=!1,i.isOpened=!1,i.optionSelectionChanges=u.defer((function(){return i.options?u.merge.apply(void 0,I(i.options.map((function(e){return e.selectionChange})))):i.ngZone.onStable.asObservable().pipe(p.take(1),p.switchMap((function(){return i.optionSelectionChanges})))})),i.thyEmptyText="没有任何数据",i.thyOptionSelected=new t.EventEmitter,i.thyOpened=new t.EventEmitter,i.thyClosed=new t.EventEmitter,i.thyOptionActivated=new t.EventEmitter,i}return x(n,e),Object.defineProperty(n.prototype,"thyAutoActiveFirstOption",{get:function(){return this._autoActiveFirstOption},set:function(e){this._autoActiveFirstOption=r.coerceBooleanProperty(e)},enumerable:!1,configurable:!0}),n.prototype.ngOnInit=function(){this.setDropDownClass(),this.instanceSelectionModel()},n.prototype.ngAfterContentInit=function(){var e=this;this.options.changes.pipe(p.startWith(null),p.takeUntil(this.ngUnsubscribe$)).subscribe((function(){e.resetOptions(),u.timer().subscribe((function(){e.isEmptyOptions=e.options.length<=0,e.changeDetectorRef.detectChanges()})),e.initKeyManager()}))},n.prototype.initKeyManager=function(){var e=this,t=u.merge(this.options.changes,this.ngUnsubscribe$);this.keyManager=new v.ActiveDescendantKeyManager(this.options).withWrap(),this.keyManager.change.pipe(p.takeUntil(t)).subscribe((function(t){e.thyOptionActivated.emit({source:e,option:e.options.toArray()[t]||null})}))},n.prototype.open=function(){this.isOpened=!0,this.changeDetectorRef.markForCheck(),this.thyOpened.emit()},n.prototype.close=function(){this.isOpened=!1,this.thyClosed.emit()},n.prototype.resetOptions=function(){var e=this,t=u.merge(this.options.changes,this.ngUnsubscribe$);this.optionSelectionChanges.pipe(p.takeUntil(t)).subscribe((function(t){e.onSelect(t.option,t.isUserInput)}))},n.prototype.instanceSelectionModel=function(){this.selectionModel&&this.selectionModel.clear(),this.selectionModel=new f.SelectionModel(this.isMultiple),this.selectionModel.changed.pipe(p.takeUntil(this.ngUnsubscribe$)).subscribe((function(e){e.added.forEach((function(e){return e.select()})),e.removed.forEach((function(e){return e.deselect()}))}))},n.prototype.onSelect=function(e,t){var n=this.selectionModel.isSelected(e);null!=e.thyValue||this.isMultiple?(n!==e.selected&&(e.selected?this.selectionModel.select(e):this.selectionModel.deselect(e)),t&&this.keyManager.setActiveItem(e)):(e.deselect(),this.selectionModel.clear()),n!==this.selectionModel.isSelected(e)&&this.thyOptionSelected.emit(new m.ThyOptionSelectionChangeEvent(e,!1)),this.changeDetectorRef.markForCheck()},n.prototype.setDropDownClass=function(){var e,t="";t=this.isMultiple?"thy-select-dropdown-"+this.mode:"thy-select-dropdown-single",this.dropDownClass=((e={})["thy-select-dropdown"]=!0,e[t]=!0,e)},n.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this)},n}(s.mixinUnsubscribe(s.MixinBase));$.decorators=[{type:t.Component,args:[{selector:"thy-autocomplete",template:'<ng-template #contentTemplate>\n  <div thyStopPropagation [ngClass]="dropDownClass">\n    <div #panel class="thy-select-dropdown-options">\n      <ng-content></ng-content>\n      <thy-empty *ngIf="isEmptyOptions" [thyMessage]="thyEmptyText"></thy-empty>\n    </div>\n  </div>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:m.THY_OPTION_PARENT_COMPONENT,useExisting:$}]}]}],$.ctorParameters=function(){return[{type:t.NgZone},{type:t.ChangeDetectorRef}]},$.propDecorators={contentTemplateRef:[{type:t.ViewChild,args:["contentTemplate",{static:!0}]}],optionsContainer:[{type:t.ViewChild,args:["panel"]}],options:[{type:t.ContentChildren,args:[m.ThyOptionComponent,{descendants:!0}]}],thyEmptyText:[{type:t.Input}],thyAutoActiveFirstOption:[{type:t.Input}],thyOptionSelected:[{type:t.Output}],thyOpened:[{type:t.Output}],thyClosed:[{type:t.Output}],thyOptionActivated:[{type:t.Output}]};var B=function(){};B.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,o.FormsModule,g.ThyInputModule,C.ThyLabelModule,i.OverlayModule,a.PortalModule,O.ThyLoadingModule,m.ThySharedModule,b.ThyIconModule,A.ThyEmptyModule,m.ThyOptionModule],declarations:[W,$,F],entryComponents:[F],exports:[W,$,F,m.ThyOptionModule],providers:[U]}]}],e.THY_AUTOCOMPLETE_DEFAULT_CONFIG=D,e.THY_AUTOCOMPLETE_DEFAULT_CONFIG_PROVIDER=U,e.ThyAutocompleteComponent=$,e.ThyAutocompleteConfig=j,e.ThyAutocompleteContainerComponent=F,e.ThyAutocompleteModule=B,e.ThyAutocompleteService=L,e.ThyAutocompleteTriggerDirective=W,e.thyAutocompleteAnimations=N,e.ɵ0=_,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-autocomplete.umd.min.js.map