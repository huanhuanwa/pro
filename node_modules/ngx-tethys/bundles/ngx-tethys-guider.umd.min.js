!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/router"),require("ngx-tethys/util"),require("@angular/common"),require("ngx-tethys/popover"),require("@angular/core"),require("rxjs"),require("@angular/cdk/overlay"),require("ngx-tethys/icon"),require("ngx-tethys/shared"),require("ngx-tethys/button"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-tethys/guider",["exports","@angular/router","ngx-tethys/util","@angular/common","ngx-tethys/popover","@angular/core","rxjs","@angular/cdk/overlay","ngx-tethys/icon","ngx-tethys/shared","ngx-tethys/button","rxjs/operators"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ngx-tethys"]=t["ngx-tethys"]||{},t["ngx-tethys"].guider={}),t.ng.router,t["ngx-tethys"].util,t.ng.common,t["ngx-tethys"].popover,t.ng.core,t.rxjs,t.ng.cdk.overlay,t["ngx-tethys"].icon,t["ngx-tethys"].shared,t["ngx-tethys"].button,t.rxjs.operators)}(this,(function(t,e,r,i,n,o,s,a,p,h,u,c){"use strict";function d(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var g=d(e),l=d(i),f=d(n),y=d(o),v=d(a),m=function(){function t(){this.targetListMap={}}return t.prototype.updateActive=function(t,e){this.activeStepKey=t,this.thyGuiderRef=e},t.prototype.addStepTarget=function(t,e){this.targetListMap[t]=e},t.prototype.removeStepTarget=function(t){delete this.targetListMap[t]},t.prototype.getActiveTarget=function(t){return this.targetListMap[t]},t.prototype.getActive=function(){return{key:this.activeStepKey,guiderRef:this.thyGuiderRef}},t}();m.ɵprov=y.ɵɵdefineInjectable({factory:function(){return new m},token:m,providedIn:"root"}),m.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],m.ctorParameters=function(){return[]};var R=function(){function t(t,e,r,i,n,o,s){this.step=t,this.stepIndex=e,this.rendererFactory=r,this.popover=i,this.guiderManager=n,this.overlay=o,this.document=s,this.renderer=this.rendererFactory.createRenderer(null,null)}return t.prototype.show=function(t){this.guiderRef=t,this.createPoint(this.step,t)},t.prototype.dispose=function(){this.removeLastPointContainer(),this.removeTip()},t.prototype.getTargetElement=function(t){return t.target?this.document.querySelector(t.target):this.guiderManager.getActiveTarget(t.key)},t.prototype.createPoint=function(t,e){var i;if(this.isTipHasTarget(t)){var n=this.getTargetElement(t);if(r.helpers.isNull(n))throw new Error("there is no target called "+t.target);this.targetElementObserver=s.fromEvent(n,"click").subscribe((function(){e.targetClicked().next(t)}));var o=null===(i=null==n?void 0:n.style)||void 0===i?void 0:i.position;o&&"static"!==o||this.renderer.setStyle(n,"position","relative"),this.setStyleForPointContainer(t,n)}else this.createTip(this.step)},t.prototype.setStyleForPointContainer=function(t,e){var r=this.getPointPosition(t,e),i=this.setPointPosition(r);this.renderPoint(e,i)},t.prototype.getPointPosition=function(t,e){var r=e.getBoundingClientRect(),i=r.width,n=r.height,o=t.pointOffset;return[i+o[0],n+o[1]]},t.prototype.setPointPosition=function(t){var e=this.renderer.createElement("div");return this.renderer.addClass(e,"thy-guider-highlight-container"),this.guiderRef.config.pointClass&&this.addPointClass(e,this.guiderRef.config.pointClass),this.renderer.setStyle(e,"position","absolute"),this.renderer.setStyle(e,"left",t[0]+"px"),this.renderer.setStyle(e,"top",t[1]+"px"),this.renderer.setStyle(e,"transform","translate(-100%,-100%)"),e},t.prototype.addPointClass=function(t,e){var i=this;r.helpers.isString(e)&&this.renderer.addClass(t,e),r.helpers.isArray(e)&&e.forEach((function(e){i.renderer.addClass(t,e)}))},t.prototype.renderPoint=function(t,e){this.renderer.appendChild(t,e),this.lastPointerContainer=e,this.lastTargetElement=t,this.createTip(this.step)},t.prototype.removeLastPointContainer=function(){this.lastPointerContainer&&(this.renderer.removeChild(this.document.body,this.lastPointerContainer),this.lastPointerContainer=void 0)},t.prototype.createTip=function(t){this.isTipHasTarget(t)?this.tipWithTarget(t):this.tipWithoutTarget(t)},t.prototype.tipWithoutTarget=function(t){var e=this.getTipPosition(t);this.lastPopoverRef=this.popover.open(this.guiderRef.config.hintComponent,{origin:null,originPosition:{x:e[0],y:e[1]},originActiveClass:"",panelClass:this.guiderRef.config.hintClass||"",backdropClosable:!1,hasBackdrop:!1,manualClosure:!0,initialState:{guiderRef:this.guiderRef,stepRef:this},scrollStrategy:this.overlay.scrollStrategies.block()})},t.prototype.getTipPosition=function(t){return Array.isArray(t.target)?t.target:this.guiderRef.config.defaultPosition},t.prototype.createTipContainer=function(){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"thy-guider-content-container"),this.renderer.setStyle(t,"position","absolute"),this.renderer.setStyle(t,"top","0px"),this.renderer.setStyle(t,"right","0px"),this.renderer.setStyle(t,"bottom","0px"),this.renderer.setStyle(t,"left","0px"),t},t.prototype.tipWithTarget=function(t){var e;e=t.target?this.document.querySelector(t.target):this.guiderManager.getActiveTarget(t.key);var r=this.createTipContainer();this.renderer.appendChild(e,r),this.lastTipContainer=r;var i={origin:r,placement:t.hintPlacement,panelClass:this.guiderRef.config.hintClass||"",backdropClosable:!1,hasBackdrop:!1,manualClosure:!0,initialState:{guiderRef:this.guiderRef,stepRef:this},scrollStrategy:this.overlay.scrollStrategies.block()},n=this.getPointPosition(t,e),o=this.getTipOffset(t,n,e);o&&(i.offset=o),this.lastPopoverRef=this.popover.open(this.guiderRef.config.hintComponent,i)},t.prototype.getTipOffset=function(t,e,r){var i=t.hintPlacement,n=r.getBoundingClientRect(),o=n.width,s=n.height,a=t.hintOffset||0,p=e[0],h=e[1];return i.startsWith("top")?h<28&&(a=a+Math.abs(h)+28):i.startsWith("bottom")?h>s&&(a=a+(h-s)+10):i.startsWith("left")?p<0&&(a=a+Math.abs(p)+28):i.startsWith("right")&&p>o&&(a=a+(p-o)+10),a},t.prototype.removeTip=function(){this.lastPopoverRef&&(this.lastPopoverRef.close(),this.lastPopoverRef=void 0),this.lastTipContainer&&(this.renderer.removeChild(this.document.body,this.lastTipContainer),this.lastTipContainer=void 0),this.lastTargetElement&&this.targetElementObserver&&(this.targetElementObserver.unsubscribe(),this.lastTargetElement=void 0,this.targetElementObserver=void 0)},t.prototype.isTipHasTarget=function(t){return t.target?!Array.isArray(t.target):!!this.guiderManager.getActiveTarget(t.key)},t}(),T=function(){},x={hintComponent:null,hintPlacement:"rightBottom",defaultPosition:[0,0],pointOffset:[0,0],hintOffset:4},C=function(){function t(t,e,r,i,n,o,a,p){var h=this;this.config=t,this.rendererFactory=e,this.popover=r,this.router=i,this.guiderManager=n,this.ngZone=o,this.overlay=a,this.document=p,this.stepChange$=new s.ReplaySubject,this.guiderEnded$=new s.Subject,this.closed$=new s.Subject,this.targetClicked$=new s.Subject,this.stepsRef=t.steps.map((function(t,e){return new R(t,e,h.rendererFactory,h.popover,h.guiderManager,h.overlay,h.document)})),this.steps=t.steps}return t.prototype.stepChange=function(){return this.stepChange$.asObservable()},t.prototype.ended=function(){return this.guiderEnded$},t.prototype.closed=function(){return this.closed$},t.prototype.targetClicked=function(){return this.targetClicked$},t.prototype.start=function(t){return this.to(t),this.stepChange()},t.prototype.next=function(){this.currentStepIndex+1>this.steps.length||this.to(this.currentStepIndex+1)},t.prototype.previous=function(){this.currentStepIndex-1<0||this.to(this.currentStepIndex-1)},t.prototype.active=function(t){if(r.helpers.isNumber(t))this.to(t);else if(r.helpers.isString(t)){var e=this.steps.findIndex((function(e){return e.key===t}));this.to(e)}else;},t.prototype.to=function(t){var e=this;this.removeExistedStep(),(!r.helpers.isNumber(t)||t>=this.steps.length||t<0||Number.isNaN(t))&&(t=0),this.currentStep=this.steps[t],this.currentStepIndex=t,this.guiderManager.updateActive(this.currentStep.key,this),this.currentStep.route&&this.currentStep.route!==this.router.url?this.ngZone.run((function(){e.router.navigateByUrl(e.currentStep.route)})):setTimeout((function(){e.drawStep(),e.notifyStepClicked()}),0)},t.prototype.close=function(){var t;this.removeManagerActiveKey(),null===(t=this.stepsRef[this.currentStepIndex])||void 0===t||t.dispose(),this.closed$.next(this.currentStep)},t.prototype.end=function(){this.close(),this.guiderEnded$.next(this.currentStep),this.notifyGuiderIsFinished()},t.prototype.removeManagerActiveKey=function(){var t=this.guiderManager.getActive().key;t&&this.steps.some((function(e){return e.key===t}))&&this.guiderManager.updateActive("",void 0)},t.prototype.notifyStepClicked=function(){this.stepChange$.next(this.currentStep)},t.prototype.drawStep=function(){this.removeExistedStep(),this.stepsRef[this.currentStepIndex].show(this)},t.prototype.notifyGuiderIsFinished=function(){this.stepChange$.complete(),this.currentStepIndex=0},t.prototype.removeExistedStep=function(){var t;null===(t=this.stepsRef[this.currentStepIndex])||void 0===t||t.dispose()},t}();C.ctorParameters=function(){return[{type:T},{type:o.RendererFactory2},{type:n.ThyPopover},{type:e.Router},{type:m},{type:o.NgZone},{type:a.Overlay},{type:void 0,decorators:[{type:o.Inject,args:[i.DOCUMENT]}]}]};var S=function(){function t(t,e,r,i,n,o,s){this.rendererFactory=t,this.popover=e,this.router=r,this.guiderManager=i,this.ngZone=n,this.overlay=o,this.document=s,this.guiderRefs=[]}return t.prototype.create=function(t){var e=this;if(!t||!(null==t?void 0:t.steps)||!r.helpers.isArray(null==t?void 0:t.steps))throw new Error("'config.steps' must be an array of length greater than 0");var i=this.normalizeConfig(t);return this.guiderRef=new C(i,this.rendererFactory,this.popover,this.router,this.guiderManager,this.ngZone,this.overlay,this.document),this.guiderRef.closed().subscribe((function(){var t=e.guiderRefs.findIndex((function(t){return t===e.guiderRef}));e.guiderRefs.splice(t,1)})),this.guiderRefs.push(this.guiderRef),this.guiderRef},t.prototype.normalizeConfig=function(t){var e=this,r=Object.assign({},x,t);return r.steps=r.steps.map((function(t){return e.normalizeStep(t,r)})),r},t.prototype.normalizeStep=function(t,e){return Object.assign({hintPlacement:e.hintPlacement,hintOffset:e.hintOffset,pointOffset:e.pointOffset},t)},t.prototype.close=function(){if(this.guiderRefs.length>0){var t=this.guiderRefs[this.guiderRefs.length-1];t&&(t.close(),this.guiderRefs.pop())}},t}();S.ɵprov=y.ɵɵdefineInjectable({factory:function(){return new S(y.ɵɵinject(y.RendererFactory2),y.ɵɵinject(f.ThyPopover),y.ɵɵinject(g.Router),y.ɵɵinject(m),y.ɵɵinject(y.NgZone),y.ɵɵinject(v.Overlay),y.ɵɵinject(l.DOCUMENT))},token:S,providedIn:"root"}),S.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],S.ctorParameters=function(){return[{type:o.RendererFactory2},{type:n.ThyPopover},{type:e.Router},{type:m},{type:o.NgZone},{type:a.Overlay},{type:void 0,decorators:[{type:o.Inject,args:[i.DOCUMENT]}]}]};var b=function(){function t(t,e,r){this.guiderManager=t,this.el=e,this.ngZone=r}return t.prototype.ngOnInit=function(){var t=this;this.guiderManager.addStepTarget(this.target,this.el.nativeElement),this.ngZone.onStable.pipe(c.take(1)).subscribe((function(){var e=t.guiderManager.getActive(),r=e.key,i=e.guiderRef;if(r===t.target){var n=i.steps.findIndex((function(e){return e.key===t.target}));t.ngZone.run((function(){i.active(n)}))}}))},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnDestroy=function(){var t=this.guiderManager.getActive().guiderRef;t&&t.close(),this.guiderManager.removeStepTarget(this.target)},t}();b.decorators=[{type:o.Directive,args:[{selector:"[thyGuiderTarget]",exportAs:"thyGuiderTarget"}]}],b.ctorParameters=function(){return[{type:m},{type:o.ElementRef},{type:o.NgZone}]},b.propDecorators={target:[{type:o.Input,args:["thyGuiderTarget"]}]};var P=function(){function t(){this.guiderHint=!0}return t.prototype.ngOnInit=function(){this.setDescription(this.stepRef.step.data.description)},t.prototype.setDescription=function(t){r.helpers.isString(t)?this.descriptionString=t:this.descriptionTemplateRef=t},t.prototype.jump=function(){this.guiderRef.end()},t.prototype.prev=function(){this.guiderRef.previous()},t.prototype.next=function(){this.guiderRef.next()},t.prototype.end=function(){this.guiderRef.end()},t.prototype.trackByFn=function(t,e){return e.key||t},t}();P.decorators=[{type:o.Component,args:[{selector:"thy-guider-hint",template:'<div class="thy-guider-tip-top">\n  <img [src]="stepRef.step.data.image" [alt]="stepRef.step.data.title" />\n  <a href="javascript:;" class="thy-guider-tip-top-btn" (click)="jump()">跳过</a>\n</div>\n<div class="thy-guider-tip-content bg-white">\n  <div class="thy-guider-tip-content-title">{{ stepRef.step.data.title }}</div>\n  <div class="thy-guider-tip-content-description">\n    <ng-container *ngIf="descriptionTemplateRef; else stringTemplateRef">\n      <ng-template [ngTemplateOutlet]="descriptionTemplateRef"></ng-template>\n    </ng-container>\n    <ng-template #stringTemplateRef>{{ descriptionString }}</ng-template>\n  </div>\n  <div class="thy-guider-tip-step">\n    <div class="thy-guider-tip-step-pagination">\n      <span\n        class="pagination-item"\n        *ngFor="let step of guiderRef.steps; let i = index; trackBy: trackByFn"\n        [ngClass]="{ active: i === stepRef.stepIndex }"\n      ></span>\n    </div>\n    <div class="thy-guider-tip-step-btn">\n      <ng-container *ngIf="stepRef.stepIndex !== 0">\n        <a href="javascript:;" (click)="prev()" class="thy-guider-tip-step-pre">上一步</a>\n      </ng-container>\n      <ng-container *ngIf="stepRef.stepIndex !== guiderRef.steps.length - 1; else finish">\n        <a href="javascript:;" (click)="next()" class="thy-guider-tip-step-next">下一步</a>\n      </ng-container>\n      <ng-template #finish>\n        <a href="javascript:;" (click)="end()" class="thy-guider-tip-step-next">完成</a>\n      </ng-template>\n    </div>\n  </div>\n</div>\n'}]}],P.ctorParameters=function(){return[]},P.propDecorators={guiderHint:[{type:o.HostBinding,args:["class.thy-guider-tip-container"]}]},x.hintComponent=P;var j=function(){};j.decorators=[{type:o.NgModule,args:[{imports:[i.CommonModule,h.ThySharedModule,p.ThyIconModule,u.ThyButtonModule,n.ThyPopoverModule],declarations:[P,b],exports:[P,b],entryComponents:[P],providers:[S]}]}],t.ThyGuider=S,t.ThyGuiderConfig=T,t.ThyGuiderHintComponent=P,t.ThyGuiderManager=m,t.ThyGuiderModule=j,t.ThyGuiderRef=C,t.ThyGuiderStepRef=R,t.ThyGuiderTargetDirective=b,t.defaultGuiderPositionConfig=x,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-tethys-guider.umd.min.js.map