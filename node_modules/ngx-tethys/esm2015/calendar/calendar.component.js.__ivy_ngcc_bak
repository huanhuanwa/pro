import { __decorate, __metadata } from "tslib";
import { InputBoolean } from 'ngx-tethys/core';
import { TinyDate } from 'ngx-tethys/util';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, EventEmitter, forwardRef, HostBinding, Input, Output, TemplateRef, ViewEncapsulation } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { ThyCalendarHeaderOperationDirective as HeaderOperation, ThyDateCellDirective as DateCell } from './calendar-cells';
export class ThyCalendarComponent {
    constructor(cdr) {
        this.cdr = cdr;
        this.className = true;
        this.className1 = true;
        // @HostBinding('class.thy-pick-calendar-mini') className2 = !thyFullscreen;
        this.thyMode = 'month';
        this.thyModeChange = new EventEmitter();
        this.thyPanelChange = new EventEmitter();
        this.thySelectChange = new EventEmitter();
        this.thyValueChange = new EventEmitter();
        this.thyDateRangeChange = new EventEmitter();
        this.thyFullscreen = true;
        this.currentDate = new TinyDate();
        this.prefixCls = 'thy-calendar-full';
        this.onChangeFn = () => { };
        this.onTouchFn = () => { };
    }
    get dateCell() {
        return (this.thyDateCell || this.thyDateCellChild);
    }
    get headerOperation() {
        return (this.thyCalendarHeaderOperation || this.thyCalendarHeaderOperationChild);
    }
    ngOnInit() { }
    // onModeChange(mode: CalendarMode): void {
    //     this.thyModeChange.emit(mode);
    //     this.thyPanelChange.emit({ date: this.currentDate.nativeDate, mode });
    // }
    onYearSelect(year) {
        const date = this.currentDate.setYear(year);
        this.updateDate(date);
    }
    onMonthSelect(month) {
        const date = this.currentDate.setMonth(month);
        this.updateDate(date);
    }
    onDateSelect(date) {
        // Only currentDate is enough in calendar
        // this.value = date;
        this.updateDate(date);
    }
    onDateRangeSelect(date) {
        this.thyDateRangeChange.emit(date);
    }
    writeValue(value) {
        this.updateDate(new TinyDate(value), false);
        this.cdr.markForCheck();
    }
    registerOnChange(fn) {
        this.onChangeFn = fn;
    }
    registerOnTouched(fn) {
        this.onTouchFn = fn;
    }
    updateDate(date, touched = true) {
        this.currentDate = date;
        if (touched) {
            this.onChangeFn(date.nativeDate);
            this.onTouchFn();
            this.thySelectChange.emit(date.nativeDate);
            this.thyValueChange.emit(date.nativeDate);
        }
    }
    ngOnChanges(changes) {
        if (changes.thyValue) {
            this.updateDate(new TinyDate(this.thyValue), false);
        }
    }
}
ThyCalendarComponent.decorators = [
    { type: Component, args: [{
                selector: 'thy-calendar',
                template: "<thy-calendar-header\n  [operationRender]=\"headerOperation\"\n  (monthChange)=\"onMonthSelect($event)\"\n  (yearChange)=\"onYearSelect($event)\"\n  (dateRangeChange)=\"onDateRangeSelect($event)\"\n  [currentDate]=\"currentDate\"\n></thy-calendar-header>\n\n<div class=\"thy-calendar-panel\">\n  <div class=\"thy-calendar-{{ thyMode === 'month' ? 'date' : 'month' }}-panel\">\n    <div class=\"thy-calendar-body\">\n      <ng-container *ngIf=\"thyMode === 'month'; then monthModeTable; else yearModeTable\"></ng-container>\n    </div>\n  </div>\n</div>\n<ng-template #monthModeTable>\n  <date-table\n    [prefixCls]=\"prefixCls\"\n    [value]=\"currentDate\"\n    [selectedValue]=\"currentDate\"\n    [dateCellRender]=\"dateCell\"\n    [disabledDate]=\"thyDisabledDate\"\n    (valueChange)=\"onDateSelect($event)\"\n  ></date-table>\n</ng-template>\n\n<ng-template #yearModeTable>\n  <month-table [value]=\"currentDate\" (valueChange)=\"onDateSelect($event)\"></month-table>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => ThyCalendarComponent), multi: true }]
            },] }
];
ThyCalendarComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ThyCalendarComponent.propDecorators = {
    className: [{ type: HostBinding, args: ['class.thy-calendar-container',] }],
    className1: [{ type: HostBinding, args: ['class.thy-calendar-full',] }],
    thyMode: [{ type: Input }],
    thyValue: [{ type: Input }],
    thyDisabledDate: [{ type: Input }],
    thyModeChange: [{ type: Output }],
    thyPanelChange: [{ type: Output }],
    thySelectChange: [{ type: Output }],
    thyValueChange: [{ type: Output }],
    thyDateRangeChange: [{ type: Output }],
    thyDateCell: [{ type: Input }],
    thyDateCellChild: [{ type: ContentChild, args: [DateCell, { read: TemplateRef },] }],
    thyCalendarHeaderOperation: [{ type: Input }],
    thyCalendarHeaderOperationChild: [{ type: ContentChild, args: [HeaderOperation, { read: TemplateRef },] }],
    thyFullscreen: [{ type: Input }]
};
__decorate([
    InputBoolean(),
    __metadata("design:type", Object)
], ThyCalendarComponent.prototype, "thyFullscreen", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NhbGVuZGFyL2NhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRS9DLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxPQUFPLEVBQ0gsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFHTCxNQUFNLEVBRU4sV0FBVyxFQUNYLGlCQUFpQixFQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuRCxPQUFPLEVBQUUsbUNBQW1DLElBQUksZUFBZSxFQUFFLG9CQUFvQixJQUFJLFFBQVEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBWTVILE1BQU0sT0FBTyxvQkFBb0I7SUErRDdCLFlBQW9CLEdBQXNCO1FBQXRCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBOURHLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFFdEIsZUFBVSxHQUFHLElBQUksQ0FBQztRQUUxRCw0RUFBNEU7UUFFbkUsWUFBTyxHQUFpQixPQUFPLENBQUM7UUFNL0Isa0JBQWEsR0FBK0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUvRCxtQkFBYyxHQUFxRCxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXRGLG9CQUFlLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFekQsbUJBQWMsR0FBdUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUV4RCx1QkFBa0IsR0FBb0MsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQWdDMUQsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFFdkMsZ0JBQVcsR0FBRyxJQUFJ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QkFBb0IsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQzthQUNoSDs7O1lBM0JHLGlCQUFpQjs7O3dCQTZCaEIsV0FBVyxTQUFDLDhCQUE4Qjt5QkFFMUMsV0FBVyxTQUFDLHlCQUF5QjtzQkFJckMsS0FBSzt1QkFFTCxLQUFLOzhCQUVMLEtBQUs7NEJBRUwsTUFBTTs2QkFFTixNQUFNOzhCQUVOLE1BQU07NkJBRU4sTUFBTTtpQ0FFTixNQUFNOzBCQUVOLEtBQUs7K0JBQ0wsWUFBWSxTQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUU7eUNBdUI1QyxLQUFLOzhDQUNMLFlBQVksU0FBQyxlQUFlLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFOzRCQUtuRCxLQUFLOztBQUFtQjtJQUFmLFlBQVksRUFBRTs7MkRBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXRCb29sZWFuIH0gZnJvbSAnbmd4LXRldGh5cy9jb3JlJztcbmltcG9ydCB7IERhdGVSYW5nZUl0ZW1JbmZvIH0gZnJvbSAnbmd4LXRldGh5cy9kYXRlLXJhbmdlJztcbmltcG9ydCB7IFRpbnlEYXRlIH0gZnJvbSAnbmd4LXRldGh5cy91dGlsJztcblxuaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBmb3J3YXJkUmVmLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIElucHV0LFxuICAgIE9uQ2hhbmdlcyxcbiAgICBPbkluaXQsXG4gICAgT3V0cHV0LFxuICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgVGVtcGxhdGVSZWYsXG4gICAgVmlld0VuY2Fwc3VsYXRpb25cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgVGh5Q2FsZW5kYXJIZWFkZXJPcGVyYXRpb25EaXJlY3RpdmUgYXMgSGVhZGVyT3BlcmF0aW9uLCBUaHlEYXRlQ2VsbERpcmVjdGl2ZSBhcyBEYXRlQ2VsbCB9IGZyb20gJy4vY2FsZW5kYXItY2VsbHMnO1xuXG5leHBvcnQgdHlwZSBDYWxlbmRhck1vZGUgPSAnbW9udGgnIHwgJ3llYXInO1xudHlwZSBDYWxlbmRhckRhdGVUZW1wbGF0ZSA9IFRlbXBsYXRlUmVmPHsgJGltcGxpY2l0OiBEYXRlIH0+O1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RoeS1jYWxlbmRhcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sJyxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFRoeUNhbGVuZGFyQ29tcG9uZW50KSwgbXVsdGk6IHRydWUgfV1cbn0pXG5leHBvcnQgY2xhc3MgVGh5Q2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy50aHktY2FsZW5kYXItY29udGFpbmVyJykgY2xhc3NOYW1lID0gdHJ1ZTtcblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MudGh5LWNhbGVuZGFyLWZ1bGwnKSBjbGFzc05hbWUxID0gdHJ1ZTtcblxuICAgIC8vIEBIb3N0QmluZGluZygnY2xhc3MudGh5LXBpY2stY2FsZW5kYXItbWluaScpIGNsYXNzTmFtZTIgPSAhdGh5RnVsbHNjcmVlbjtcblxuICAgIEBJbnB1dCgpIHRoeU1vZGU6IENhbGVuZGFyTW9kZSA9ICdtb250aCc7XG5cbiAgICBASW5wdXQoKSB0aHlWYWx1ZT86IERhdGU7XG5cbiAgICBASW5wdXQoKSB0aHlEaXNhYmxlZERhdGU/OiAoZGF0ZTogRGF0ZSkgPT4gYm9vbGVhbjtcblxuICAgIEBPdXRwdXQoKSB0aHlNb2RlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Q2FsZW5kYXJNb2RlPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKSB0aHlQYW5lbENoYW5nZTogRXZlbnRFbWl0dGVyPHsgZGF0ZTogRGF0ZTsgbW9kZTogQ2FsZW5kYXJNb2RlIH0+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpIHRoeVNlbGVjdENoYW5nZTogRXZlbnRFbWl0dGVyPERhdGU+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpIHRoeVZhbHVlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8RGF0ZT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5RGF0ZVJhbmdlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8RGF0ZVJhbmdlSXRlbUluZm8+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQElucHV0KCkgdGh5RGF0ZUNlbGw/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICBAQ29udGVudENoaWxkKERhdGVDZWxsLCB7IHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHRoeURhdGVDZWxsQ2hpbGQ/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICBnZXQgZGF0ZUNlbGwoKTogQ2FsZW5kYXJEYXRlVGVtcGxhdGUge1xuICAgICAgICByZXR1cm4gKHRoaXMudGh5RGF0ZUNlbGwgfHwgdGhpcy50aHlEYXRlQ2VsbENoaWxkKSE7XG4gICAgfVxuXG4gICAgLy8gQElucHV0KCkgdGh5RGF0ZUZ1bGxDZWxsPzogQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gICAgLy8gQENvbnRlbnRDaGlsZChEYXRlRnVsbENlbGwsIHsgcmVhZDogVGVtcGxhdGVSZWYgfSkgdGh5RGF0ZUZ1bGxDZWxsQ2hpbGQ/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICAvLyBnZXQgZGF0ZUZ1bGxDZWxsKCk6IENhbGVuZGFyRGF0ZVRlbXBsYXRlIHtcbiAgICAvLyAgICAgcmV0dXJuICh0aGlzLnRoeURhdGVGdWxsQ2VsbCB8fCB0aGlzLnRoeURhdGVGdWxsQ2VsbENoaWxkKSE7XG4gICAgLy8gfVxuXG4gICAgLy8gQElucHV0KCkgdGh5TW9udGhDZWxsPzogQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gICAgLy8gQENvbnRlbnRDaGlsZChNb250aENlbGwsIHsgcmVhZDogVGVtcGxhdGVSZWYgfSkgdGh5TW9udGhDZWxsQ2hpbGQ/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICAvLyBnZXQgbW9udGhDZWxsKCk6IENhbGVuZGFyRGF0ZVRlbXBsYXRlIHtcbiAgICAvLyAgICAgcmV0dXJuICh0aGlzLnRoeU1vbnRoQ2VsbCB8fCB0aGlzLnRoeU1vbnRoQ2VsbENoaWxkKSE7XG4gICAgLy8gfVxuXG4gICAgLy8gQElucHV0KCkgdGh5TW9udGhGdWxsQ2VsbD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIC8vIEBDb250ZW50Q2hpbGQoTW9udGhGdWxsQ2VsbCwgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KSB0aHlNb250aEZ1bGxDZWxsQ2hpbGQ/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICAvLyBnZXQgbW9udGhGdWxsQ2VsbCgpOiBDYWxlbmRhckRhdGVUZW1wbGF0ZSB7XG4gICAgLy8gICAgIHJldHVybiAodGhpcy50aHlNb250aEZ1bGxDZWxsIHx8IHRoaXMudGh5TW9udGhGdWxsQ2VsbENoaWxkKSE7XG4gICAgLy8gfVxuXG4gICAgQElucHV0KCkgdGh5Q2FsZW5kYXJIZWFkZXJPcGVyYXRpb24/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICBAQ29udGVudENoaWxkKEhlYWRlck9wZXJhdGlvbiwgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KSB0aHlDYWxlbmRhckhlYWRlck9wZXJhdGlvbkNoaWxkPzogQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gICAgZ2V0IGhlYWRlck9wZXJhdGlvbigpOiBDYWxlbmRhckRhdGVUZW1wbGF0ZSB7XG4gICAgICAgIHJldHVybiAodGhpcy50aHlDYWxlbmRhckhlYWRlck9wZXJhdGlvbiB8fCB0aGlzLnRoeUNhbGVuZGFySGVhZGVyT3BlcmF0aW9uQ2hpbGQpITtcbiAgICB9XG5cbiAgICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgdGh5RnVsbHNjcmVlbiA9IHRydWU7XG5cbiAgICBwdWJsaWMgY3VycmVudERhdGUgPSBuZXcgVGlueURhdGUoKTtcblxuICAgIHB1YmxpYyBwcmVmaXhDbHMgPSAndGh5LWNhbGVuZGFyLWZ1bGwnO1xuXG4gICAgcHJpdmF0ZSBvbkNoYW5nZUZuOiAoZGF0ZTogRGF0ZSkgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG4gICAgcHJpdmF0ZSBvblRvdWNoRm46ICgpID0+IHZvaWQgPSAoKSA9PiB7fTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge31cblxuICAgIC8vIG9uTW9kZUNoYW5nZShtb2RlOiBDYWxlbmRhck1vZGUpOiB2b2lkIHtcbiAgICAvLyAgICAgdGhpcy50aHlNb2RlQ2hhbmdlLmVtaXQobW9kZSk7XG4gICAgLy8gICAgIHRoaXMudGh5UGFuZWxDaGFuZ2UuZW1pdCh7IGRhdGU6IHRoaXMuY3VycmVudERhdGUubmF0aXZlRGF0ZSwgbW9kZSB9KTtcbiAgICAvLyB9XG5cbiAgICBvblllYXJTZWxlY3QoeWVhcjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLmN1cnJlbnREYXRlLnNldFllYXIoeWVhcik7XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZShkYXRlKTtcbiAgICB9XG5cbiAgICBvbk1vbnRoU2VsZWN0KG1vbnRoOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuY3VycmVudERhdGUuc2V0TW9udGgobW9udGgpO1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGUoZGF0ZSk7XG4gICAgfVxuXG4gICAgb25EYXRlU2VsZWN0KGRhdGU6IFRpbnlEYXRlKTogdm9pZCB7XG4gICAgICAgIC8vIE9ubHkgY3VycmVudERhdGUgaXMgZW5vdWdoIGluIGNhbGVuZGFyXG4gICAgICAgIC8vIHRoaXMudmFsdWUgPSBkYXRlO1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGUoZGF0ZSk7XG4gICAgfVxuXG4gICAgb25EYXRlUmFuZ2VTZWxlY3QoZGF0ZTogRGF0ZVJhbmdlSXRlbUluZm8pIHtcbiAgICAgICAgdGhpcy50aHlEYXRlUmFuZ2VDaGFuZ2UuZW1pdChkYXRlKTtcbiAgICB9XG5cbiAgICB3cml0ZVZhbHVlKHZhbHVlOiBEYXRlIHwgbnVsbCk6IHZvaWQge1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGUobmV3IFRpbnlEYXRlKHZhbHVlIGFzIERhdGUpLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cblxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChkYXRlOiBEYXRlKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHRoaXMub25DaGFuZ2VGbiA9IGZuO1xuICAgIH1cblxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHRoaXMub25Ub3VjaEZuID0gZm47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVEYXRlKGRhdGU6IFRpbnlEYXRlLCB0b3VjaGVkOiBib29sZWFuID0gdHJ1ZSk6IHZvaWQge1xuICAgICAgICB0aGlzLmN1cnJlbnREYXRlID0gZGF0ZTtcblxuICAgICAgICBpZiAodG91Y2hlZCkge1xuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZUZuKGRhdGUubmF0aXZlRGF0ZSk7XG4gICAgICAgICAgICB0aGlzLm9uVG91Y2hGbigpO1xuICAgICAgICAgICAgdGhpcy50aHlTZWxlY3RDaGFuZ2UuZW1pdChkYXRlLm5hdGl2ZURhdGUpO1xuICAgICAgICAgICAgdGhpcy50aHlWYWx1ZUNoYW5nZS5lbWl0KGRhdGUubmF0aXZlRGF0ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgICAgIGlmIChjaGFuZ2VzLnRoeVZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGUobmV3IFRpbnlEYXRlKHRoaXMudGh5VmFsdWUpLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=