import { __decorate, __metadata } from "tslib";
import { InputBoolean } from 'ngx-tethys/core';
import { TinyDate } from 'ngx-tethys/util';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, EventEmitter, forwardRef, HostBinding, Input, Output, TemplateRef, ViewEncapsulation } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { ThyCalendarHeaderOperationDirective as HeaderOperation, ThyDateCellDirective as DateCell } from './calendar-cells';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './calendar-header.component';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from 'ngx-tethys/date-picker';

function ThyCalendarComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function ThyCalendarComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "date-table", 6);
    ɵngcc0.ɵɵlistener("valueChange", function ThyCalendarComponent_ng_template_5_Template_date_table_valueChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.onDateSelect($event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("prefixCls", ctx_r2.prefixCls)("value", ctx_r2.currentDate)("selectedValue", ctx_r2.currentDate)("dateCellRender", ctx_r2.dateCell)("disabledDate", ctx_r2.thyDisabledDate);
} }
function ThyCalendarComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "month-table", 7);
    ɵngcc0.ɵɵlistener("valueChange", function ThyCalendarComponent_ng_template_7_Template_month_table_valueChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.onDateSelect($event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("value", ctx_r4.currentDate);
} }
export class ThyCalendarComponent {
    constructor(cdr) {
        this.cdr = cdr;
        this.className = true;
        this.className1 = true;
        // @HostBinding('class.thy-pick-calendar-mini') className2 = !thyFullscreen;
        this.thyMode = 'month';
        this.thyModeChange = new EventEmitter();
        this.thyPanelChange = new EventEmitter();
        this.thySelectChange = new EventEmitter();
        this.thyValueChange = new EventEmitter();
        this.thyDateRangeChange = new EventEmitter();
        this.thyFullscreen = true;
        this.currentDate = new TinyDate();
        this.prefixCls = 'thy-calendar-full';
        this.onChangeFn = () => { };
        this.onTouchFn = () => { };
    }
    get dateCell() {
        return (this.thyDateCell || this.thyDateCellChild);
    }
    get headerOperation() {
        return (this.thyCalendarHeaderOperation || this.thyCalendarHeaderOperationChild);
    }
    ngOnInit() { }
    // onModeChange(mode: CalendarMode): void {
    //     this.thyModeChange.emit(mode);
    //     this.thyPanelChange.emit({ date: this.currentDate.nativeDate, mode });
    // }
    onYearSelect(year) {
        const date = this.currentDate.setYear(year);
        this.updateDate(date);
    }
    onMonthSelect(month) {
        const date = this.currentDate.setMonth(month);
        this.updateDate(date);
    }
    onDateSelect(date) {
        // Only currentDate is enough in calendar
        // this.value = date;
        this.updateDate(date);
    }
    onDateRangeSelect(date) {
        this.thyDateRangeChange.emit(date);
    }
    writeValue(value) {
        this.updateDate(new TinyDate(value), false);
        this.cdr.markForCheck();
    }
    registerOnChange(fn) {
        this.onChangeFn = fn;
    }
    registerOnTouched(fn) {
        this.onTouchFn = fn;
    }
    updateDate(date, touched = true) {
        this.currentDate = date;
        if (touched) {
            this.onChangeFn(date.nativeDate);
            this.onTouchFn();
            this.thySelectChange.emit(date.nativeDate);
            this.thyValueChange.emit(date.nativeDate);
        }
    }
    ngOnChanges(changes) {
        if (changes.thyValue) {
            this.updateDate(new TinyDate(this.thyValue), false);
        }
    }
}
ThyCalendarComponent.ɵfac = function ThyCalendarComponent_Factory(t) { return new (t || ThyCalendarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
ThyCalendarComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThyCalendarComponent, selectors: [["thy-calendar"]], contentQueries: function ThyCalendarComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, DateCell, true, TemplateRef);
        ɵngcc0.ɵɵcontentQuery(dirIndex, HeaderOperation, true, TemplateRef);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.thyDateCellChild = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.thyCalendarHeaderOperationChild = _t.first);
    } }, hostVars: 4, hostBindings: function ThyCalendarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("thy-calendar-container", ctx.className)("thy-calendar-full", ctx.className1);
    } }, inputs: { thyMode: "thyMode", thyFullscreen: "thyFullscreen", thyValue: "thyValue", thyDisabledDate: "thyDisabledDate", thyDateCell: "thyDateCell", thyCalendarHeaderOperation: "thyCalendarHeaderOperation" }, outputs: { thyModeChange: "thyModeChange", thyPanelChange: "thyPanelChange", thySelectChange: "thySelectChange", thyValueChange: "thyValueChange", thyDateRangeChange: "thyDateRangeChange" }, features: [ɵngcc0.ɵɵProvidersFeature([{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => ThyCalendarComponent), multi: true }]), ɵngcc0.ɵɵNgOnChangesFeature], decls: 9, vars: 8, consts: [[3, "operationRender", "currentDate", "monthChange", "yearChange", "dateRangeChange"], [1, "thy-calendar-panel"], [1, "thy-calendar-body"], [4, "ngIf", "ngIfThen", "ngIfElse"], ["monthModeTable", ""], ["yearModeTable", ""], [3, "prefixCls", "value", "selectedValue", "dateCellRender", "disabledDate", "valueChange"], [3, "value", "valueChange"]], template: function ThyCalendarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "thy-calendar-header", 0);
        ɵngcc0.ɵɵlistener("monthChange", function ThyCalendarComponent_Template_thy_calendar_header_monthChange_0_listener($event) { return ctx.onMonthSelect($event); })("yearChange", function ThyCalendarComponent_Template_thy_calendar_header_yearChange_0_listener($event) { return ctx.onYearSelect($event); })("dateRangeChange", function ThyCalendarComponent_Template_thy_calendar_header_dateRangeChange_0_listener($event) { return ctx.onDateRangeSelect($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div");
        ɵngcc0.ɵɵelementStart(3, "div", 2);
        ɵngcc0.ɵɵtemplate(4, ThyCalendarComponent_ng_container_4_Template, 1, 0, "ng-container", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, ThyCalendarComponent_ng_template_5_Template, 1, 5, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵtemplate(7, ThyCalendarComponent_ng_template_7_Template, 1, 1, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(6);
        const _r3 = ɵngcc0.ɵɵreference(8);
        ɵngcc0.ɵɵproperty("operationRender", ctx.headerOperation)("currentDate", ctx.currentDate);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵclassMapInterpolate1("thy-calendar-", ctx.thyMode === "month" ? "date" : "month", "-panel");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.thyMode === "month")("ngIfThen", _r1)("ngIfElse", _r3);
    } }, directives: [ɵngcc1.ThyCalendarHeaderComponent, ɵngcc2.NgIf, ɵngcc3.DateTableComponent, ɵngcc3.MonthTableComponent], encapsulation: 2, changeDetection: 0 });
ThyCalendarComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ThyCalendarComponent.propDecorators = {
    className: [{ type: HostBinding, args: ['class.thy-calendar-container',] }],
    className1: [{ type: HostBinding, args: ['class.thy-calendar-full',] }],
    thyMode: [{ type: Input }],
    thyValue: [{ type: Input }],
    thyDisabledDate: [{ type: Input }],
    thyModeChange: [{ type: Output }],
    thyPanelChange: [{ type: Output }],
    thySelectChange: [{ type: Output }],
    thyValueChange: [{ type: Output }],
    thyDateRangeChange: [{ type: Output }],
    thyDateCell: [{ type: Input }],
    thyDateCellChild: [{ type: ContentChild, args: [DateCell, { read: TemplateRef },] }],
    thyCalendarHeaderOperation: [{ type: Input }],
    thyCalendarHeaderOperationChild: [{ type: ContentChild, args: [HeaderOperation, { read: TemplateRef },] }],
    thyFullscreen: [{ type: Input }]
};
__decorate([
    InputBoolean(),
    __metadata("design:type", Object)
], ThyCalendarComponent.prototype, "thyFullscreen", void 0);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyCalendarComponent, [{
        type: Component,
        args: [{
                selector: 'thy-calendar',
                template: "<thy-calendar-header\n  [operationRender]=\"headerOperation\"\n  (monthChange)=\"onMonthSelect($event)\"\n  (yearChange)=\"onYearSelect($event)\"\n  (dateRangeChange)=\"onDateRangeSelect($event)\"\n  [currentDate]=\"currentDate\"\n></thy-calendar-header>\n\n<div class=\"thy-calendar-panel\">\n  <div class=\"thy-calendar-{{ thyMode === 'month' ? 'date' : 'month' }}-panel\">\n    <div class=\"thy-calendar-body\">\n      <ng-container *ngIf=\"thyMode === 'month'; then monthModeTable; else yearModeTable\"></ng-container>\n    </div>\n  </div>\n</div>\n<ng-template #monthModeTable>\n  <date-table\n    [prefixCls]=\"prefixCls\"\n    [value]=\"currentDate\"\n    [selectedValue]=\"currentDate\"\n    [dateCellRender]=\"dateCell\"\n    [disabledDate]=\"thyDisabledDate\"\n    (valueChange)=\"onDateSelect($event)\"\n  ></date-table>\n</ng-template>\n\n<ng-template #yearModeTable>\n  <month-table [value]=\"currentDate\" (valueChange)=\"onDateSelect($event)\"></month-table>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => ThyCalendarComponent), multi: true }]
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }]; }, { className: [{
            type: HostBinding,
            args: ['class.thy-calendar-container']
        }], className1: [{
            type: HostBinding,
            args: ['class.thy-calendar-full']
        }], thyMode: [{
            type: Input
        }], thyModeChange: [{
            type: Output
        }], thyPanelChange: [{
            type: Output
        }], thySelectChange: [{
            type: Output
        }], thyValueChange: [{
            type: Output
        }], thyDateRangeChange: [{
            type: Output
        }], thyFullscreen: [{
            type: Input
        }], thyValue: [{
            type: Input
        }], thyDisabledDate: [{
            type: Input
        }], thyDateCell: [{
            type: Input
        }], thyDateCellChild: [{
            type: ContentChild,
            args: [DateCell, { read: TemplateRef }]
        }], thyCalendarHeaderOperation: [{
            type: Input
        }], thyCalendarHeaderOperationChild: [{
            type: ContentChild,
            args: [HeaderOperation, { read: TemplateRef }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2FsZW5kYXIvY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFL0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFDSCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osWUFBWSxFQUNaLFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUdMLE1BQU0sRUFFTixXQUFXLEVBQ1gsaUJBQWlCLEVBQ3BCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5ELE9BQU8sRUFBRSxtQ0FBbUMsSUFBSSxlQUFlLEVBQUUsb0JBQW9CLElBQUksUUFBUSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVk1SCxNQUFNLE9BQU8sb0JBQW9CO0FBQUcsSUErRGhDLFlBQW9CLEdBQXNCO0FBQUksUUFBMUIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7QUFBQyxRQTlERSxjQUFTLEdBQUcsSUFBSSxDQUFDO0FBQ2xFLFFBQzRDLGVBQVUsR0FBRyxJQUFJLENBQUM7QUFDOUQsUUFDSSw0RUFBNEU7QUFDaEYsUUFDYSxZQUFPLEdBQWlCLE9BQU8sQ0FBQztBQUM3QyxRQUtjLGtCQUFhLEdBQStCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDN0UsUUFDYyxtQkFBYyxHQUFxRCxJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ3BHLFFBQ2Msb0JBQWUsR0FBdUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUN2RSxRQUNjLG1CQUFjLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDdEUsUUFDYyx1QkFBa0IsR0FBb0MsSUFB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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQ2xEO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICduZ3gtdGV0aHlzL2NvcmUnO1xuaW1wb3J0IHsgRGF0ZVJhbmdlSXRlbUluZm8gfSBmcm9tICduZ3gtdGV0aHlzL2RhdGUtcmFuZ2UnO1xuaW1wb3J0IHsgVGlueURhdGUgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuXG5pbXBvcnQge1xuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBDb250ZW50Q2hpbGQsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIGZvcndhcmRSZWYsXG4gICAgSG9zdEJpbmRpbmcsXG4gICAgSW5wdXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE9uSW5pdCxcbiAgICBPdXRwdXQsXG4gICAgU2ltcGxlQ2hhbmdlcyxcbiAgICBUZW1wbGF0ZVJlZixcbiAgICBWaWV3RW5jYXBzdWxhdGlvblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBUaHlDYWxlbmRhckhlYWRlck9wZXJhdGlvbkRpcmVjdGl2ZSBhcyBIZWFkZXJPcGVyYXRpb24sIFRoeURhdGVDZWxsRGlyZWN0aXZlIGFzIERhdGVDZWxsIH0gZnJvbSAnLi9jYWxlbmRhci1jZWxscyc7XG5cbmV4cG9ydCB0eXBlIENhbGVuZGFyTW9kZSA9ICdtb250aCcgfCAneWVhcic7XG50eXBlIENhbGVuZGFyRGF0ZVRlbXBsYXRlID0gVGVtcGxhdGVSZWY8eyAkaW1wbGljaXQ6IERhdGUgfT47XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGh5LWNhbGVuZGFyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgcHJvdmlkZXJzOiBbeyBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVGh5Q2FsZW5kYXJDb21wb25lbnQpLCBtdWx0aTogdHJ1ZSB9XVxufSlcbmV4cG9ydCBjbGFzcyBUaHlDYWxlbmRhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLnRoeS1jYWxlbmRhci1jb250YWluZXInKSBjbGFzc05hbWUgPSB0cnVlO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy50aHktY2FsZW5kYXItZnVsbCcpIGNsYXNzTmFtZTEgPSB0cnVlO1xuXG4gICAgLy8gQEhvc3RCaW5kaW5nKCdjbGFzcy50aHktcGljay1jYWxlbmRhci1taW5pJykgY2xhc3NOYW1lMiA9ICF0aHlGdWxsc2NyZWVuO1xuXG4gICAgQElucHV0KCkgdGh5TW9kZTogQ2FsZW5kYXJNb2RlID0gJ21vbnRoJztcblxuICAgIEBJbnB1dCgpIHRoeVZhbHVlPzogRGF0ZTtcblxuICAgIEBJbnB1dCgpIHRoeURpc2FibGVkRGF0ZT86IChkYXRlOiBEYXRlKSA9PiBib29sZWFuO1xuXG4gICAgQE91dHB1dCgpIHRoeU1vZGVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxDYWxlbmRhck1vZGU+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpIHRoeVBhbmVsQ2hhbmdlOiBFdmVudEVtaXR0ZXI8eyBkYXRlOiBEYXRlOyBtb2RlOiBDYWxlbmRhck1vZGUgfT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5U2VsZWN0Q2hhbmdlOiBFdmVudEVtaXR0ZXI8RGF0ZT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5VmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxEYXRlPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKSB0aHlEYXRlUmFuZ2VDaGFuZ2U6IEV2ZW50RW1pdHRlcjxEYXRlUmFuZ2VJdGVtSW5mbz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBASW5wdXQoKSB0aHlEYXRlQ2VsbD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIEBDb250ZW50Q2hpbGQoRGF0ZUNlbGwsIHsgcmVhZDogVGVtcGxhdGVSZWYgfSkgdGh5RGF0ZUNlbGxDaGlsZD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIGdldCBkYXRlQ2VsbCgpOiBDYWxlbmRhckRhdGVUZW1wbGF0ZSB7XG4gICAgICAgIHJldHVybiAodGhpcy50aHlEYXRlQ2VsbCB8fCB0aGlzLnRoeURhdGVDZWxsQ2hpbGQpITtcbiAgICB9XG5cbiAgICAvLyBASW5wdXQoKSB0aHlEYXRlRnVsbENlbGw/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICAvLyBAQ29udGVudENoaWxkKERhdGVGdWxsQ2VsbCwgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KSB0aHlEYXRlRnVsbENlbGxDaGlsZD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIC8vIGdldCBkYXRlRnVsbENlbGwoKTogQ2FsZW5kYXJEYXRlVGVtcGxhdGUge1xuICAgIC8vICAgICByZXR1cm4gKHRoaXMudGh5RGF0ZUZ1bGxDZWxsIHx8IHRoaXMudGh5RGF0ZUZ1bGxDZWxsQ2hpbGQpITtcbiAgICAvLyB9XG5cbiAgICAvLyBASW5wdXQoKSB0aHlNb250aENlbGw/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICAvLyBAQ29udGVudENoaWxkKE1vbnRoQ2VsbCwgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KSB0aHlNb250aENlbGxDaGlsZD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIC8vIGdldCBtb250aENlbGwoKTogQ2FsZW5kYXJEYXRlVGVtcGxhdGUge1xuICAgIC8vICAgICByZXR1cm4gKHRoaXMudGh5TW9udGhDZWxsIHx8IHRoaXMudGh5TW9udGhDZWxsQ2hpbGQpITtcbiAgICAvLyB9XG5cbiAgICAvLyBASW5wdXQoKSB0aHlNb250aEZ1bGxDZWxsPzogQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gICAgLy8gQENvbnRlbnRDaGlsZChNb250aEZ1bGxDZWxsLCB7IHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHRoeU1vbnRoRnVsbENlbGxDaGlsZD86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIC8vIGdldCBtb250aEZ1bGxDZWxsKCk6IENhbGVuZGFyRGF0ZVRlbXBsYXRlIHtcbiAgICAvLyAgICAgcmV0dXJuICh0aGlzLnRoeU1vbnRoRnVsbENlbGwgfHwgdGhpcy50aHlNb250aEZ1bGxDZWxsQ2hpbGQpITtcbiAgICAvLyB9XG5cbiAgICBASW5wdXQoKSB0aHlDYWxlbmRhckhlYWRlck9wZXJhdGlvbj86IENhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICAgIEBDb250ZW50Q2hpbGQoSGVhZGVyT3BlcmF0aW9uLCB7IHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHRoeUNhbGVuZGFySGVhZGVyT3BlcmF0aW9uQ2hpbGQ/OiBDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgICBnZXQgaGVhZGVyT3BlcmF0aW9uKCk6IENhbGVuZGFyRGF0ZVRlbXBsYXRlIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnRoeUNhbGVuZGFySGVhZGVyT3BlcmF0aW9uIHx8IHRoaXMudGh5Q2FsZW5kYXJIZWFkZXJPcGVyYXRpb25DaGlsZCkhO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSB0aHlGdWxsc2NyZWVuID0gdHJ1ZTtcblxuICAgIHB1YmxpYyBjdXJyZW50RGF0ZSA9IG5ldyBUaW55RGF0ZSgpO1xuXG4gICAgcHVibGljIHByZWZpeENscyA9ICd0aHktY2FsZW5kYXItZnVsbCc7XG5cbiAgICBwcml2YXRlIG9uQ2hhbmdlRm46IChkYXRlOiBEYXRlKSA9PiB2b2lkID0gKCkgPT4ge307XG5cbiAgICBwcml2YXRlIG9uVG91Y2hGbjogKCkgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7fVxuXG4gICAgLy8gb25Nb2RlQ2hhbmdlKG1vZGU6IENhbGVuZGFyTW9kZSk6IHZvaWQge1xuICAgIC8vICAgICB0aGlzLnRoeU1vZGVDaGFuZ2UuZW1pdChtb2RlKTtcbiAgICAvLyAgICAgdGhpcy50aHlQYW5lbENoYW5nZS5lbWl0KHsgZGF0ZTogdGhpcy5jdXJyZW50RGF0ZS5uYXRpdmVEYXRlLCBtb2RlIH0pO1xuICAgIC8vIH1cblxuICAgIG9uWWVhclNlbGVjdCh5ZWFyOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuY3VycmVudERhdGUuc2V0WWVhcih5ZWFyKTtcbiAgICAgICAgdGhpcy51cGRhdGVEYXRlKGRhdGUpO1xuICAgIH1cblxuICAgIG9uTW9udGhTZWxlY3QobW9udGg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5jdXJyZW50RGF0ZS5zZXRNb250aChtb250aCk7XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZShkYXRlKTtcbiAgICB9XG5cbiAgICBvbkRhdGVTZWxlY3QoZGF0ZTogVGlueURhdGUpOiB2b2lkIHtcbiAgICAgICAgLy8gT25seSBjdXJyZW50RGF0ZSBpcyBlbm91Z2ggaW4gY2FsZW5kYXJcbiAgICAgICAgLy8gdGhpcy52YWx1ZSA9IGRhdGU7XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZShkYXRlKTtcbiAgICB9XG5cbiAgICBvbkRhdGVSYW5nZVNlbGVjdChkYXRlOiBEYXRlUmFuZ2VJdGVtSW5mbykge1xuICAgICAgICB0aGlzLnRoeURhdGVSYW5nZUNoYW5nZS5lbWl0KGRhdGUpO1xuICAgIH1cblxuICAgIHdyaXRlVmFsdWUodmFsdWU6IERhdGUgfCBudWxsKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZShuZXcgVGlueURhdGUodmFsdWUgYXMgRGF0ZSksIGZhbHNlKTtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKGRhdGU6IERhdGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vbkNoYW5nZUZuID0gZm47XG4gICAgfVxuXG4gICAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vblRvdWNoRm4gPSBmbjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZURhdGUoZGF0ZTogVGlueURhdGUsIHRvdWNoZWQ6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY3VycmVudERhdGUgPSBkYXRlO1xuXG4gICAgICAgIGlmICh0b3VjaGVkKSB7XG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlRm4oZGF0ZS5uYXRpdmVEYXRlKTtcbiAgICAgICAgICAgIHRoaXMub25Ub3VjaEZuKCk7XG4gICAgICAgICAgICB0aGlzLnRoeVNlbGVjdENoYW5nZS5lbWl0KGRhdGUubmF0aXZlRGF0ZSk7XG4gICAgICAgICAgICB0aGlzLnRoeVZhbHVlQ2hhbmdlLmVtaXQoZGF0ZS5uYXRpdmVEYXRlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgICAgaWYgKGNoYW5nZXMudGh5VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRGF0ZShuZXcgVGlueURhdGUodGhpcy50aHlWYWx1ZSksIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==