import { Directive, Output, EventEmitter, ContentChildren, QueryList, NgZone, Input } from '@angular/core';
import { ThyDragDirective } from './drag.directive';
import { merge, defer } from 'rxjs';
import { mixinUnsubscribe, MixinBase } from 'ngx-tethys/core';
import { takeUntil, startWith, take, switchMap } from 'rxjs/operators';
import { THY_DROP_CONTAINER_DIRECTIVE } from './drop-container.class';
import * as ɵngcc0 from '@angular/core';
const _MixinBase = mixinUnsubscribe(MixinBase);
export class ThyDropContainerDirective extends _MixinBase {
    constructor(ngZone) {
        super();
        this.ngZone = ngZone;
        this.started = new EventEmitter();
        this.ended = new EventEmitter();
        this.overed = new EventEmitter();
        this.dropped = new EventEmitter();
    }
    set dragContainer(data) {
        this.data = data;
    }
    ngOnInit() { }
    ngAfterContentInit() {
        this.draggables.changes.pipe(startWith(null), takeUntil(this.ngUnsubscribe$)).subscribe(() => {
            this.draggableChanges();
        });
    }
    draggableChanges() {
        this.resetDraggableChanges(item => item.dragRef.started).subscribe(event => {
            this.started.emit(event);
        });
        this.resetDraggableChanges(item => item.dragRef.ended).subscribe(event => {
            this.ended.emit(event);
        });
        this.resetDraggableChanges(item => item.dragRef.overed).subscribe(event => {
            this.overed.emit(event);
        });
        this.resetDraggableChanges(item => item.dragRef.dropped).subscribe(event => {
            this.dropped.emit(event);
        });
    }
    resetDraggableChanges(fn) {
        return defer(() => {
            if (this.draggables) {
                return merge(...this.draggables.map(fn));
            }
            return this.ngZone.onStable.asObservable().pipe(take(1), switchMap(() => this.resetDraggableChanges.bind(this, fn)));
        }).pipe(takeUntil(merge(this.ngUnsubscribe$, this.draggables.changes)));
    }
}
ThyDropContainerDirective.ɵfac = function ThyDropContainerDirective_Factory(t) { return new (t || ThyDropContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
ThyDropContainerDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ThyDropContainerDirective, selectors: [["thy-drop-container"], ["", "thyDropContainer", ""]], contentQueries: function ThyDropContainerDirective_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, ThyDragDirective, false);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.draggables = _t);
    } }, inputs: { dragContainer: ["thyDropContainer", "dragContainer"], data: ["thyDropContainerData", "data"], disabled: ["thyDropContainerDisabled", "disabled"], beforeStart: ["thyBeforeDragStart", "beforeStart"], beforeOver: ["thyBeforeDragOver", "beforeOver"], beforeDrop: ["thyBeforeDragDrop", "beforeDrop"] }, outputs: { started: "thyDragStarted", ended: "thyDragEnded", overed: "thyDragOvered", dropped: "thyDragDropped" }, features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: THY_DROP_CONTAINER_DIRECTIVE,
                useExisting: ThyDropContainerDirective
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
ThyDropContainerDirective.ctorParameters = () => [
    { type: NgZone }
];
ThyDropContainerDirective.propDecorators = {
    dragContainer: [{ type: Input, args: ['thyDropContainer',] }],
    data: [{ type: Input, args: ['thyDropContainerData',] }],
    disabled: [{ type: Input, args: ['thyDropContainerDisabled',] }],
    beforeStart: [{ type: Input, args: ['thyBeforeDragStart',] }],
    beforeOver: [{ type: Input, args: ['thyBeforeDragOver',] }],
    beforeDrop: [{ type: Input, args: ['thyBeforeDragDrop',] }],
    started: [{ type: Output, args: ['thyDragStarted',] }],
    ended: [{ type: Output, args: ['thyDragEnded',] }],
    overed: [{ type: Output, args: ['thyDragOvered',] }],
    dropped: [{ type: Output, args: ['thyDragDropped',] }],
    draggables: [{ type: ContentChildren, args: [ThyDragDirective, {
                    descendants: false
                },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyDropContainerDirective, [{
        type: Directive,
        args: [{
                selector: 'thy-drop-container,[thyDropContainer]',
                providers: [
                    {
                        provide: THY_DROP_CONTAINER_DIRECTIVE,
                        useExisting: ThyDropContainerDirective
                    }
                ]
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, { started: [{
            type: Output,
            args: ['thyDragStarted']
        }], ended: [{
            type: Output,
            args: ['thyDragEnded']
        }], overed: [{
            type: Output,
            args: ['thyDragOvered']
        }], dropped: [{
            type: Output,
            args: ['thyDragDropped']
        }], dragContainer: [{
            type: Input,
            args: ['thyDropContainer']
        }], data: [{
            type: Input,
            args: ['thyDropContainerData']
        }], disabled: [{
            type: Input,
            args: ['thyDropContainerDisabled']
        }], beforeStart: [{
            type: Input,
            args: ['thyBeforeDragStart']
        }], beforeOver: [{
            type: Input,
            args: ['thyBeforeDragOver']
        }], beforeDrop: [{
            type: Input,
            args: ['thyBeforeDragDrop']
        }], draggables: [{
            type: ContentChildren,
            args: [ThyDragDirective, {
                    descendants: false
                }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcC1jb250YWluZXIuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZHJhZy1kcm9wL2Ryb3AtY29udGFpbmVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQVUsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBb0IsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNySSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsS0FBSyxFQUFjLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUErQixNQUFNLGlCQUFpQixDQUFDO0FBQzNGLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2RSxPQUFPLEVBQUUsNEJBQTRCLEVBQThCLE1BQU0sd0JBQXdCLENBQUM7O0FBRWxHLE1BQU0sVUFBVSxHQUFtRCxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQVcvRixNQUFNLE9BQU8seUJBQW1DLFNBQVEsVUFBVTtBQUFHLElBNkJqRSxZQUFvQixNQUFjO0FBQ3RDLFFBQVEsS0FBSyxFQUFFLENBQUM7QUFDaEIsUUFGd0IsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUFDLFFBYlQsWUFBTyxHQUFHLElBQUksWUFBWSxFQUF1QyxDQUFDO0FBQ2hHLFFBQzRCLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBcUMsQ0FBQztBQUMxRixRQUM2QixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQXNDLENBQUM7QUFDN0YsUUFDOEIsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFzQyxDQUFDO0FBQy9GLElBUUksQ0FBQztBQUNMLElBL0JJLElBQ0ksYUFBYSxDQUFDLElBQVM7QUFDL0IsUUFB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QyxNQUFNO0FBQUc7QUFBRztBQUN6Riw0QkFtQmQsS0FBSyxTQUFDLGtCQUFrQjtBQUN4QixtQkFJQSxLQUFLLFNBQUMsc0JBQXNCO0FBQU8sdUJBRW5DLEtBQUssU0FBQywwQkFBMEI7QUFBTywwQkFFdkMsS0FBSyxTQUFDLG9CQUFvQjtBQUFPLHlCQUVqQyxLQUFLLFNBQUMsbUJBQW1CO0FBQU8seUJBRWhDLEtBQUssU0FBQyxtQkFBbUI7QUFBTyxzQkFFaEMsTUFBTSxTQUFDLGdCQUFnQjtBQUFPLG9CQUU5QixNQUFNLFNBQUMsY0FBYztBQUFPLHFCQUU1QixNQUFNLFNBQUMsZUFBZTtBQUFPLHNCQUU3QixNQUFNLFNBQUMsZ0JBQWdCO0FBQU8seUJBRTlCLGVBQWUsU0FBQyxnQkFBZ0IsRUFBRTtBQUN2QyxvQkFBUSxXQUFXLEVBQUUsS0FBSztBQUMxQixpQkFBSztBQUNEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT25Jbml0LCBEaXJlY3RpdmUsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgQWZ0ZXJDb250ZW50SW5pdCwgTmdab25lLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGh5RHJhZ0RpcmVjdGl2ZSB9IGZyb20gJy4vZHJhZy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgbWVyZ2UsIE9ic2VydmFibGUsIGRlZmVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtaXhpblVuc3Vic2NyaWJlLCBNaXhpbkJhc2UsIENvbnN0cnVjdG9yLCBUaHlVbnN1YnNjcmliZSB9IGZyb20gJ25neC10ZXRoeXMvY29yZSc7XG5pbXBvcnQgeyB0YWtlVW50aWwsIHN0YXJ0V2l0aCwgdGFrZSwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgVGh5RHJhZ0Ryb3BFdmVudCwgVGh5RHJhZ1N0YXJ0RXZlbnQsIFRoeURyYWdFbmRFdmVudCwgVGh5RHJhZ092ZXJFdmVudCB9IGZyb20gJy4vZHJhZy1kcm9wLmNsYXNzJztcbmltcG9ydCB7IFRIWV9EUk9QX0NPTlRBSU5FUl9ESVJFQ1RJVkUsIElUaHlEcm9wQ29udGFpbmVyRGlyZWN0aXZlIH0gZnJvbSAnLi9kcm9wLWNvbnRhaW5lci5jbGFzcyc7XG5cbmNvbnN0IF9NaXhpbkJhc2U6IENvbnN0cnVjdG9yPFRoeVVuc3Vic2NyaWJlPiAmIHR5cGVvZiBNaXhpbkJhc2UgPSBtaXhpblVuc3Vic2NyaWJlKE1peGluQmFzZSk7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAndGh5LWRyb3AtY29udGFpbmVyLFt0aHlEcm9wQ29udGFpbmVyXScsXG4gICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGU6IFRIWV9EUk9QX0NPTlRBSU5FUl9ESVJFQ1RJVkUsXG4gICAgICAgICAgICB1c2VFeGlzdGluZzogVGh5RHJvcENvbnRhaW5lckRpcmVjdGl2ZVxuICAgICAgICB9XG4gICAgXVxufSlcbmV4cG9ydCBjbGFzcyBUaHlEcm9wQ29udGFpbmVyRGlyZWN0aXZlPFQgPSBhbnk+IGV4dGVuZHMgX01peGluQmFzZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgSVRoeURyb3BDb250YWluZXJEaXJlY3RpdmUge1xuICAgIEBJbnB1dCgndGh5RHJvcENvbnRhaW5lcicpXG4gICAgc2V0IGRyYWdDb250YWluZXIoZGF0YTogVFtdKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgfVxuXG4gICAgQElucHV0KCd0aHlEcm9wQ29udGFpbmVyRGF0YScpIGRhdGE6IFRbXTtcblxuICAgIEBJbnB1dCgndGh5RHJvcENvbnRhaW5lckRpc2FibGVkJykgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgICBASW5wdXQoJ3RoeUJlZm9yZURyYWdTdGFydCcpIGJlZm9yZVN0YXJ0OiAoZTogVGh5RHJhZ1N0YXJ0RXZlbnQ8VD4pID0+IGJvb2xlYW47XG5cbiAgICBASW5wdXQoJ3RoeUJlZm9yZURyYWdPdmVyJykgYmVmb3JlT3ZlcjogKGU6IFRoeURyYWdPdmVyRXZlbnQ8VD4pID0+IGJvb2xlYW47XG5cbiAgICBASW5wdXQoJ3RoeUJlZm9yZURyYWdEcm9wJykgYmVmb3JlRHJvcDogKGU6IFRoeURyYWdEcm9wRXZlbnQ8VD4pID0+IGJvb2xlYW47XG5cbiAgICBAT3V0cHV0KCd0aHlEcmFnU3RhcnRlZCcpIHN0YXJ0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFRoeURyYWdTdGFydEV2ZW50PFRoeURyYWdEaXJlY3RpdmU+PigpO1xuXG4gICAgQE91dHB1dCgndGh5RHJhZ0VuZGVkJykgZW5kZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFRoeURyYWdFbmRFdmVudDxUaHlEcmFnRGlyZWN0aXZlPj4oKTtcblxuICAgIEBPdXRwdXQoJ3RoeURyYWdPdmVyZWQnKSBvdmVyZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFRoeURyYWdPdmVyRXZlbnQ8VGh5RHJhZ0RpcmVjdGl2ZT4+KCk7XG5cbiAgICBAT3V0cHV0KCd0aHlEcmFnRHJvcHBlZCcpIGRyb3BwZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFRoeURyYWdEcm9wRXZlbnQ8VGh5RHJhZ0RpcmVjdGl2ZT4+KCk7XG5cbiAgICBAQ29udGVudENoaWxkcmVuKFRoeURyYWdEaXJlY3RpdmUsIHtcbiAgICAgICAgZGVzY2VuZGFudHM6IGZhbHNlXG4gICAgfSlcbiAgICBkcmFnZ2FibGVzOiBRdWVyeUxpc3Q8VGh5RHJhZ0RpcmVjdGl2ZT47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5nWm9uZTogTmdab25lKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7fVxuXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICB0aGlzLmRyYWdnYWJsZXMuY2hhbmdlcy5waXBlKHN0YXJ0V2l0aChudWxsKSwgdGFrZVVudGlsKHRoaXMubmdVbnN1YnNjcmliZSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kcmFnZ2FibGVDaGFuZ2VzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZHJhZ2dhYmxlQ2hhbmdlcygpIHtcbiAgICAgICAgdGhpcy5yZXNldERyYWdnYWJsZUNoYW5nZXMoaXRlbSA9PiBpdGVtLmRyYWdSZWYuc3RhcnRlZCkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZC5lbWl0KGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXREcmFnZ2FibGVDaGFuZ2VzKGl0ZW0gPT4gaXRlbS5kcmFnUmVmLmVuZGVkKS5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICAgICAgdGhpcy5lbmRlZC5lbWl0KGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXREcmFnZ2FibGVDaGFuZ2VzKGl0ZW0gPT4gaXRlbS5kcmFnUmVmLm92ZXJlZCkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIHRoaXMub3ZlcmVkLmVtaXQoZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZXNldERyYWdnYWJsZUNoYW5nZXMoaXRlbSA9PiBpdGVtLmRyYWdSZWYuZHJvcHBlZCkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIHRoaXMuZHJvcHBlZC5lbWl0KGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldERyYWdnYWJsZUNoYW5nZXMoZm46IChpdGVtOiBUaHlEcmFnRGlyZWN0aXZlKSA9PiBPYnNlcnZhYmxlPGFueT4pIHtcbiAgICAgICAgcmV0dXJuIGRlZmVyKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYWdnYWJsZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVyZ2UoLi4udGhpcy5kcmFnZ2FibGVzLm1hcChmbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubmdab25lLm9uU3RhYmxlLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXG4gICAgICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5yZXNldERyYWdnYWJsZUNoYW5nZXMuYmluZCh0aGlzLCBmbikpXG4gICAgICAgICAgICApO1xuICAgICAgICB9KS5waXBlKHRha2VVbnRpbChtZXJnZSh0aGlzLm5nVW5zdWJzY3JpYmUkLCB0aGlzLmRyYWdnYWJsZXMuY2hhbmdlcykpKSBhcyBPYnNlcnZhYmxlPGFueT47XG4gICAgfVxufVxuIl19