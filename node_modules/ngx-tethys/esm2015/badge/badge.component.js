import { coerceBooleanProperty } from 'ngx-tethys/util';
import { Component, ElementRef, HostBinding, Input } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';

function ThyBadgeComponent_span_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMapInterpolate1("thy-badge ", ctx_r0.badgeClassName, "");
    ɵngcc0.ɵɵstyleProp("color", ctx_r0.textColor)("background-color", ctx_r0.backgroundColor);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.displayContent);
} }
const _c0 = ["*"];
const BadgeMutexType = ['thy-badge-count', 'thy-badge-dot', 'thy-badge-hollow'];
const BadgeMutexTheme = ['thy-badge-primary', 'thy-badge-warning', 'thy-badge-danger', 'thy-badge-secondary'];
const BadgeMutexSize = ['thy-badge-lg', 'thy-badge-sm'];
export class ThyBadgeComponent {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.displayContent = '';
        this.badgeClassName = '';
        this._initialized = false;
        this.badgeClassNameMap = {
            'thy-badge-count': true,
            'thy-badge-dot': false,
            'thy-badge-hollow': false,
            'thy-badge-lg': false,
            'thy-badge-sm': false,
            'thy-badge-danger': true,
            'thy-badge-primary': false,
            'thy-badge-warning': false,
            'thy-badge-secondary': false,
            'thy-badge-sup': true,
            'thy-badge-multiple-words': false
        };
        this.st = {
            value: '',
            isValueOfString: false,
            isSetValue: false,
            isValueKeepShow: false,
            max: {
                is: false,
                value: null
            },
            isElement: false,
            isSup: false,
            isShowBadge: true
        };
        this.containerClassName = true;
        this.nativeElement = this.elementRef.nativeElement;
        this.st.isElement = this.nativeElement.localName === 'thy-badge';
    }
    set thyType(value) {
        this.resetBadgeClassNameMap(BadgeMutexTheme);
        switch (value) {
            case 'danger':
                this.badgeClassNameMap['thy-badge-danger'] = true;
                break;
            case 'primary':
                this.badgeClassNameMap['thy-badge-primary'] = true;
                break;
            case 'warning':
                this.badgeClassNameMap['thy-badge-warning'] = true;
                break;
            case 'secondary':
                this.badgeClassNameMap['thy-badge-secondary'] = true;
                break;
            default:
                this.badgeClassNameMap['thy-badge-danger'] = true;
                break;
        }
        if (this._initialized) {
            this.combineBadgeClassName();
        }
    }
    set thyCount(value) {
        this.st.value = value;
        this.st.isSetValue = true;
        if (this._initialized) {
            this.combineBadgeDisplayContent();
            this.combineBadgeClassName();
        }
    }
    set thyContext(value) {
        this.st.value = value;
        this.st.isValueOfString = true;
        this.st.isSetValue = true;
        if (this._initialized) {
            this.combineBadgeDisplayContent();
            this.combineBadgeClassName();
        }
    }
    set thyMaxCount(value) {
        this.st.max.is = true;
        this.st.max.value = value;
        if (this._initialized) {
            this.combineBadgeDisplayContent();
            this.combineBadgeClassName();
        }
    }
    set thySize(value) {
        this.resetBadgeClassNameMap(BadgeMutexSize);
        switch (value) {
            case 'lg':
                this.badgeClassNameMap['thy-badge-lg'] = true;
                break;
            case 'sm':
                this.badgeClassNameMap['thy-badge-sm'] = true;
                break;
        }
        if (this._initialized) {
            this.combineBadgeClassName();
        }
    }
    set thyIsDot(value) {
        this.resetBadgeClassNameMap(BadgeMutexType);
        this.badgeClassNameMap['thy-badge-dot'] = coerceBooleanProperty(value);
        if (this._initialized) {
            this.combineBadgeClassName();
        }
    }
    set thyIsHollow(value) {
        this.resetBadgeClassNameMap(BadgeMutexType);
        this.badgeClassNameMap['thy-badge-hollow'] = coerceBooleanProperty(value);
        if (this._initialized) {
            this.combineBadgeClassName();
        }
    }
    set thyKeepShow(value) {
        this.st.isValueKeepShow = coerceBooleanProperty(value);
        if (this._initialized) {
            this.combineBadgeDisplayContent();
        }
    }
    set thyTextColor(value) {
        this.textColor = value;
    }
    set thyBackgroundColor(value) {
        this.backgroundColor = value;
        this.resetBadgeClassNameMap(BadgeMutexTheme);
    }
    ngOnInit() {
        let childNodeCount = 0;
        this.nativeElement.childNodes.forEach((n) => {
            if (['#comment'].indexOf(n.nodeName) < 0) {
                childNodeCount++;
            }
        });
        this.st.isSup = childNodeCount > 0;
        this.combineBadgeClassName();
        if (this.st.isSetValue) {
            this.combineBadgeDisplayContent();
        }
        this._initialized = true;
    }
    combineBadgeClassName() {
        this.badgeClassNameMap['thy-badge-sup'] = this.st.isSup;
        this.explorationValueLength();
        const _badgeClassNames = [];
        for (const key in this.badgeClassNameMap) {
            if (this.badgeClassNameMap.hasOwnProperty(key)) {
                if (this.badgeClassNameMap[key]) {
                    _badgeClassNames.push(key);
                }
            }
        }
        this.badgeClassName = _badgeClassNames.join(' ');
    }
    combineBadgeDisplayContent() {
        this.displayContent = this.st.value;
        if (this.st.value && this.st.max.is && this.st.value > this.st.max.value) {
            this.displayContent = `${this.st.max.value}+`;
        }
        if (!this.st.value && !this.st.isValueKeepShow) {
            this.st.isShowBadge = false;
        }
        else {
            this.st.isShowBadge = true;
        }
    }
    explorationValueLength() {
        if (this.st.value && this.st.value.toString().length > 1 && this.st.isSup) {
            this.badgeClassNameMap['thy-badge-multiple-words'] = true;
        }
    }
    resetBadgeClassNameMap(mutexArray) {
        for (const key in this.badgeClassNameMap) {
            if (this.badgeClassNameMap.hasOwnProperty(key)) {
                if (mutexArray.includes(key)) {
                    this.badgeClassNameMap[key] = false;
                }
            }
        }
    }
}
ThyBadgeComponent.ɵfac = function ThyBadgeComponent_Factory(t) { return new (t || ThyBadgeComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
ThyBadgeComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThyBadgeComponent, selectors: [["thy-badge"], ["", "thyBadge", ""]], hostVars: 2, hostBindings: function ThyBadgeComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("thy-badge-container", ctx.containerClassName);
    } }, inputs: { thyType: "thyType", thyCount: "thyCount", thyContext: "thyContext", thyMaxCount: "thyMaxCount", thySize: "thySize", thyIsDot: "thyIsDot", thyIsHollow: "thyIsHollow", thyKeepShow: "thyKeepShow", thyTextColor: "thyTextColor", thyBackgroundColor: "thyBackgroundColor" }, ngContentSelectors: _c0, decls: 3, vars: 1, consts: [[3, "class", "color", "backgroundColor", 4, "ngIf"]], template: function ThyBadgeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementContainerStart(0);
        ɵngcc0.ɵɵtemplate(1, ThyBadgeComponent_span_1_Template, 2, 8, "span", 0);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵprojection(2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.st.isShowBadge);
    } }, directives: [ɵngcc1.NgIf], encapsulation: 2 });
ThyBadgeComponent.ctorParameters = () => [
    { type: ElementRef }
];
ThyBadgeComponent.propDecorators = {
    containerClassName: [{ type: HostBinding, args: ['class.thy-badge-container',] }],
    thyType: [{ type: Input }],
    thyCount: [{ type: Input }],
    thyContext: [{ type: Input }],
    thyMaxCount: [{ type: Input }],
    thySize: [{ type: Input }],
    thyIsDot: [{ type: Input }],
    thyIsHollow: [{ type: Input }],
    thyKeepShow: [{ type: Input }],
    thyTextColor: [{ type: Input }],
    thyBackgroundColor: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyBadgeComponent, [{
        type: Component,
        args: [{
                selector: 'thy-badge,[thyBadge]',
                template: "<ng-container>\n  <span\n    *ngIf=\"st.isShowBadge\"\n    class=\"thy-badge {{ badgeClassName }}\"\n    [style.color]=\"textColor\"\n    [style.backgroundColor]=\"backgroundColor\"\n    >{{ displayContent }}</span\n  >\n</ng-container>\n<ng-content></ng-content>\n"
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { containerClassName: [{
            type: HostBinding,
            args: ['class.thy-badge-container']
        }], thyType: [{
            type: Input
        }], thyCount: [{
            type: Input
        }], thyContext: [{
            type: Input
        }], thyMaxCount: [{
            type: Input
        }], thySize: [{
            type: Input
        }], thyIsDot: [{
            type: Input
        }], thyIsHollow: [{
            type: Input
        }], thyKeepShow: [{
            type: Input
        }], thyTextColor: [{
            type: Input
        }], thyBackgroundColor: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkZ2UuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYmFkZ2UvYmFkZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXhELE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFbEYsTUFBTSxjQUFjLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztBQUNoRixNQUFNLGVBQWUsR0FBRyxDQUFDLG1CQUFtQixFQUFFLG1CQUFtQixFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixDQUFDLENBQUM7QUFDOUcsTUFBTSxjQUFjLEdBQUcsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLENBQUM7QUFNeEQsTUFBTSxPQUFPLGlCQUFpQjtBQUFHLElBcUQ3QixZQUFvQixVQUFzQjtBQUM5QyxRQUR3QixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFwRDNDLG1CQUFjLEdBQUcsRUFBRSxDQUFDO0FBQ3hCLFFBQ0ksbUJBQWMsR0FBRyxFQUFFLENBQUM7QUFDeEIsUUFHWSxpQkFBWSxHQUFHLEtBQUssQ0FBQztBQUNqQyxRQUNZLHNCQUFpQixHQUFHO0FBQ2hDLFlBQVEsaUJBQWlCLEVBQUUsSUFBSTtBQUMvQixZQUFRLGVBQWUsRUFBRSxLQUFLO0FBQzlCLFlBQVEsa0JBQWtCLEVBQUUsS0FBSztBQUNqQyxZQUFRLGNBQWMsRUFBRSxLQUFLO0FBQzdCLFlBQVEsY0FBYyxFQUFFLEtBQUs7QUFDN0IsWUFBUSxrQkFBa0IsRUFBRSxJQUFJO0FBQ2hDLFlBQVEsbUJBQW1CLEVBQUUsS0FBSztBQUNsQyxZQUFRLG1CQUFtQixFQUFFLEtBQUs7QUFDbEMsWUFBUSxxQkFBcUIsRUFBRSxLQUFLO0FBQ3BDLFlBQVEsZUFB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SSxJQUFJLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQzVELGdCQUFnQixJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7QUFDOUMsb0JBQW9CLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7QUFDeEQsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0w7NkNBMU9DLFNBQVMsU0FBQyxrQkFDUCxRQUFRLEVBQUUsc0JBQXNCLGtCQUNoQzs7dUNBQXFDLGNBQ3hDOzs7Ozs7Ozs7O3dEQUNJO0FBQUM7QUFBMkMsWUFWN0IsVUFBVTtBQUFHO0FBQUc7QUFBcUMsaUNBb0VwRSxXQUFXLFNBQUMsMkJBQTJCO0FBQU8sc0JBRTlDLEtBQUs7QUFDUix1QkF3QkcsS0FBSztBQUNSLHlCQVNHLEtBQUs7QUFDUiwwQkFVRyxLQUFLO0FBQ1Isc0JBU0csS0FBSztBQUNSLHVCQWVHLEtBQUs7QUFDUiwwQkFRRyxLQUFLO0FBQ1IsMEJBUUcsS0FBSztBQUNSLDJCQU9HLEtBQUs7QUFDUixpQ0FJRyxLQUFLO0FBQ1Q7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnbmd4LXRldGh5cy91dGlsJztcblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBIb3N0QmluZGluZywgSW5wdXQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5jb25zdCBCYWRnZU11dGV4VHlwZSA9IFsndGh5LWJhZGdlLWNvdW50JywgJ3RoeS1iYWRnZS1kb3QnLCAndGh5LWJhZGdlLWhvbGxvdyddO1xuY29uc3QgQmFkZ2VNdXRleFRoZW1lID0gWyd0aHktYmFkZ2UtcHJpbWFyeScsICd0aHktYmFkZ2Utd2FybmluZycsICd0aHktYmFkZ2UtZGFuZ2VyJywgJ3RoeS1iYWRnZS1zZWNvbmRhcnknXTtcbmNvbnN0IEJhZGdlTXV0ZXhTaXplID0gWyd0aHktYmFkZ2UtbGcnLCAndGh5LWJhZGdlLXNtJ107XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGh5LWJhZGdlLFt0aHlCYWRnZV0nLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9iYWRnZS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgVGh5QmFkZ2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIGRpc3BsYXlDb250ZW50ID0gJyc7XG5cbiAgICBiYWRnZUNsYXNzTmFtZSA9ICcnO1xuXG4gICAgcHJpdmF0ZSBuYXRpdmVFbGVtZW50OiBhbnk7XG5cbiAgICBwcml2YXRlIF9pbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBiYWRnZUNsYXNzTmFtZU1hcCA9IHtcbiAgICAgICAgJ3RoeS1iYWRnZS1jb3VudCc6IHRydWUsXG4gICAgICAgICd0aHktYmFkZ2UtZG90JzogZmFsc2UsXG4gICAgICAgICd0aHktYmFkZ2UtaG9sbG93JzogZmFsc2UsXG4gICAgICAgICd0aHktYmFkZ2UtbGcnOiBmYWxzZSxcbiAgICAgICAgJ3RoeS1iYWRnZS1zbSc6IGZhbHNlLFxuICAgICAgICAndGh5LWJhZGdlLWRhbmdlcic6IHRydWUsXG4gICAgICAgICd0aHktYmFkZ2UtcHJpbWFyeSc6IGZhbHNlLFxuICAgICAgICAndGh5LWJhZGdlLXdhcm5pbmcnOiBmYWxzZSxcbiAgICAgICAgJ3RoeS1iYWRnZS1zZWNvbmRhcnknOiBmYWxzZSxcbiAgICAgICAgJ3RoeS1iYWRnZS1zdXAnOiB0cnVlLFxuICAgICAgICAndGh5LWJhZGdlLW11bHRpcGxlLXdvcmRzJzogZmFsc2VcbiAgICB9O1xuXG4gICAgc3Q6IHtcbiAgICAgICAgdmFsdWU6IG51bWJlciB8IHN0cmluZyB8IGFueTtcbiAgICAgICAgaXNWYWx1ZU9mU3RyaW5nOiBib29sZWFuO1xuICAgICAgICBpc1NldFZhbHVlOiBib29sZWFuO1xuICAgICAgICBpc1ZhbHVlS2VlcFNob3c6IGJvb2xlYW47XG4gICAgICAgIG1heDoge1xuICAgICAgICAgICAgaXM6IGJvb2xlYW47XG4gICAgICAgICAgICB2YWx1ZTogbnVtYmVyO1xuICAgICAgICB9O1xuICAgICAgICBpc0VsZW1lbnQ6IGJvb2xlYW47XG4gICAgICAgIGlzU3VwOiBib29sZWFuO1xuICAgICAgICBpc1Nob3dCYWRnZTogYm9vbGVhbjtcbiAgICB9ID0ge1xuICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgIGlzVmFsdWVPZlN0cmluZzogZmFsc2UsXG4gICAgICAgIGlzU2V0VmFsdWU6IGZhbHNlLFxuICAgICAgICBpc1ZhbHVlS2VlcFNob3c6IGZhbHNlLFxuICAgICAgICBtYXg6IHtcbiAgICAgICAgICAgIGlzOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlOiBudWxsXG4gICAgICAgIH0sXG4gICAgICAgIGlzRWxlbWVudDogZmFsc2UsXG4gICAgICAgIGlzU3VwOiBmYWxzZSxcbiAgICAgICAgaXNTaG93QmFkZ2U6IHRydWVcbiAgICB9O1xuXG4gICAgcHVibGljIHRleHRDb2xvcjogc3RyaW5nO1xuXG4gICAgcHVibGljIGJhY2tncm91bmRDb2xvcjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XG4gICAgICAgIHRoaXMubmF0aXZlRWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgICB0aGlzLnN0LmlzRWxlbWVudCA9IHRoaXMubmF0aXZlRWxlbWVudC5sb2NhbE5hbWUgPT09ICd0aHktYmFkZ2UnO1xuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MudGh5LWJhZGdlLWNvbnRhaW5lcicpIGNvbnRhaW5lckNsYXNzTmFtZSA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlUeXBlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5yZXNldEJhZGdlQ2xhc3NOYW1lTWFwKEJhZGdlTXV0ZXhUaGVtZSk7XG4gICAgICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2Rhbmdlcic6XG4gICAgICAgICAgICAgICAgdGhpcy5iYWRnZUNsYXNzTmFtZU1hcFsndGh5LWJhZGdlLWRhbmdlciddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3ByaW1hcnknOlxuICAgICAgICAgICAgICAgIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBbJ3RoeS1iYWRnZS1wcmltYXJ5J10gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnd2FybmluZyc6XG4gICAgICAgICAgICAgICAgdGhpcy5iYWRnZUNsYXNzTmFtZU1hcFsndGh5LWJhZGdlLXdhcm5pbmcnXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzZWNvbmRhcnknOlxuICAgICAgICAgICAgICAgIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBbJ3RoeS1iYWRnZS1zZWNvbmRhcnknXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBbJ3RoeS1iYWRnZS1kYW5nZXInXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbWJpbmVCYWRnZUNsYXNzTmFtZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5Q291bnQodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLnN0LnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3QuaXNTZXRWYWx1ZSA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLl9pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdGhpcy5jb21iaW5lQmFkZ2VEaXNwbGF5Q29udGVudCgpO1xuICAgICAgICAgICAgdGhpcy5jb21iaW5lQmFkZ2VDbGFzc05hbWUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeUNvbnRleHQodmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLnN0LnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3QuaXNWYWx1ZU9mU3RyaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdC5pc1NldFZhbHVlID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbWJpbmVCYWRnZURpc3BsYXlDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLmNvbWJpbmVCYWRnZUNsYXNzTmFtZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5TWF4Q291bnQodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLnN0Lm1heC5pcyA9IHRydWU7XG4gICAgICAgIHRoaXMuc3QubWF4LnZhbHVlID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLl9pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdGhpcy5jb21iaW5lQmFkZ2VEaXNwbGF5Q29udGVudCgpO1xuICAgICAgICAgICAgdGhpcy5jb21iaW5lQmFkZ2VDbGFzc05hbWUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeVNpemUodmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLnJlc2V0QmFkZ2VDbGFzc05hbWVNYXAoQmFkZ2VNdXRleFNpemUpO1xuICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgICAgICBjYXNlICdsZyc6XG4gICAgICAgICAgICAgICAgdGhpcy5iYWRnZUNsYXNzTmFtZU1hcFsndGh5LWJhZGdlLWxnJ10gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc20nOlxuICAgICAgICAgICAgICAgIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBbJ3RoeS1iYWRnZS1zbSddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYmluZUJhZGdlQ2xhc3NOYW1lKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlJc0RvdCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnJlc2V0QmFkZ2VDbGFzc05hbWVNYXAoQmFkZ2VNdXRleFR5cGUpO1xuICAgICAgICB0aGlzLmJhZGdlQ2xhc3NOYW1lTWFwWyd0aHktYmFkZ2UtZG90J10gPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYmluZUJhZGdlQ2xhc3NOYW1lKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlJc0hvbGxvdyh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnJlc2V0QmFkZ2VDbGFzc05hbWVNYXAoQmFkZ2VNdXRleFR5cGUpO1xuICAgICAgICB0aGlzLmJhZGdlQ2xhc3NOYW1lTWFwWyd0aHktYmFkZ2UtaG9sbG93J10gPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYmluZUJhZGdlQ2xhc3NOYW1lKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlLZWVwU2hvdyh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnN0LmlzVmFsdWVLZWVwU2hvdyA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gICAgICAgIGlmICh0aGlzLl9pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdGhpcy5jb21iaW5lQmFkZ2VEaXNwbGF5Q29udGVudCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5VGV4dENvbG9yKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy50ZXh0Q29sb3IgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlCYWNrZ3JvdW5kQ29sb3IodmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IHZhbHVlO1xuICAgICAgICB0aGlzLnJlc2V0QmFkZ2VDbGFzc05hbWVNYXAoQmFkZ2VNdXRleFRoZW1lKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgbGV0IGNoaWxkTm9kZUNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXMuZm9yRWFjaCgobjogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChbJyNjb21tZW50J10uaW5kZXhPZihuLm5vZGVOYW1lKSA8IDApIHtcbiAgICAgICAgICAgICAgICBjaGlsZE5vZGVDb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdC5pc1N1cCA9IGNoaWxkTm9kZUNvdW50ID4gMDtcblxuICAgICAgICB0aGlzLmNvbWJpbmVCYWRnZUNsYXNzTmFtZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnN0LmlzU2V0VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYmluZUJhZGdlRGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbWJpbmVCYWRnZUNsYXNzTmFtZSgpIHtcbiAgICAgICAgdGhpcy5iYWRnZUNsYXNzTmFtZU1hcFsndGh5LWJhZGdlLXN1cCddID0gdGhpcy5zdC5pc1N1cDtcbiAgICAgICAgdGhpcy5leHBsb3JhdGlvblZhbHVlTGVuZ3RoKCk7XG5cbiAgICAgICAgY29uc3QgX2JhZGdlQ2xhc3NOYW1lcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmJhZGdlQ2xhc3NOYW1lTWFwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWRnZUNsYXNzTmFtZU1hcC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBfYmFkZ2VDbGFzc05hbWVzLnB1c2goa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYWRnZUNsYXNzTmFtZSA9IF9iYWRnZUNsYXNzTmFtZXMuam9pbignICcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29tYmluZUJhZGdlRGlzcGxheUNvbnRlbnQoKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheUNvbnRlbnQgPSB0aGlzLnN0LnZhbHVlO1xuICAgICAgICBpZiAodGhpcy5zdC52YWx1ZSAmJiB0aGlzLnN0Lm1heC5pcyAmJiB0aGlzLnN0LnZhbHVlID4gdGhpcy5zdC5tYXgudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRlbnQgPSBgJHt0aGlzLnN0Lm1heC52YWx1ZX0rYDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5zdC52YWx1ZSAmJiAhdGhpcy5zdC5pc1ZhbHVlS2VlcFNob3cpIHtcbiAgICAgICAgICAgIHRoaXMuc3QuaXNTaG93QmFkZ2UgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3QuaXNTaG93QmFkZ2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBleHBsb3JhdGlvblZhbHVlTGVuZ3RoKCkge1xuICAgICAgICBpZiAodGhpcy5zdC52YWx1ZSAmJiB0aGlzLnN0LnZhbHVlLnRvU3RyaW5nKCkubGVuZ3RoID4gMSAmJiB0aGlzLnN0LmlzU3VwKSB7XG4gICAgICAgICAgICB0aGlzLmJhZGdlQ2xhc3NOYW1lTWFwWyd0aHktYmFkZ2UtbXVsdGlwbGUtd29yZHMnXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0QmFkZ2VDbGFzc05hbWVNYXAobXV0ZXhBcnJheTogYW55KSB7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhZGdlQ2xhc3NOYW1lTWFwLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICBpZiAobXV0ZXhBcnJheS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmFkZ2VDbGFzc05hbWVNYXBba2V5XSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==