import { Component, Input, HostBinding, HostListener, NgZone } from '@angular/core';
import { trigger, state, style, animate, transition } from '@angular/animations';
import { UpdateHostClassService } from 'ngx-tethys/core';
import { NotifyQueueStore } from './notify-queue.store';
import { helpers } from 'ngx-tethys/util';
const ANIMATION_IN_DURATION = 100;
const ANIMATION_OUT_DURATION = 150;
const HIDE_STYLE = { transform: 'translateX(0)', opacity: 0, height: 0, paddingTop: 0, paddingBottom: 0, margin: 0 };
export class ThyNotifyComponent {
    constructor(_queueStore, _ngZone) {
        this._queueStore = _queueStore;
        this._ngZone = _ngZone;
        this.className = '';
        this.notifyIconName = '';
        this.extendContentClass = false;
        this.isShowDetail = false;
    }
    set thyOption(value) {
        this.option = value;
        const type = value.type;
        this.placement = value.placement || 'topRight';
        if (this.placement === 'topLeft' || this.placement === 'bottomLeft') {
            this.flyInOut = 'flyInOutLeft';
        }
        else {
            this.flyInOut = 'flyInOutRight';
        }
        this.className = `thy-notify thy-notify-${type}`;
    }
    ngOnInit() {
        const iconName = {
            success: 'check-circle-fill',
            info: 'info-circle-fill',
            warning: 'waring-fill',
            error: 'close-circle-fill'
        };
        this.notifyIconName = iconName[this.option.type];
        this._creatCloseTimer();
    }
    ngOnDestroy() {
        this._clearCloseTimer();
    }
    extendContent() {
        this.extendContentClass = true;
    }
    showDetailToggle() {
        this.isShowDetail = !this.isShowDetail;
    }
    closeNotify() {
        this._ngZone.runOutsideAngular(() => {
            this.flyInOut = 'componentHide';
            setTimeout(() => {
                this._queueStore.removeNotify(this.option.id, this.placement);
            }, ANIMATION_OUT_DURATION);
        });
    }
    triggerDetail() {
        if (helpers.isFunction(this.option.detail.action)) {
            this.option.detail.action();
        }
        if (this.option.detail.content) {
            this.showDetailToggle();
        }
    }
    mouseenter() {
        if (this.option.pauseOnHover) {
            this._clearCloseTimer();
        }
    }
    mouseleave() {
        if (this.option.pauseOnHover) {
            this._creatCloseTimer();
        }
    }
    _creatCloseTimer() {
        if (this.option.duration) {
            this.closeTimer = setInterval(() => {
                clearInterval(this.closeTimer);
                this.closeNotify();
            }, this.option.duration);
        }
    }
    _clearCloseTimer() {
        clearInterval(this.closeTimer);
    }
}
ThyNotifyComponent.decorators = [
    { type: Component, args: [{
                selector: 'thy-notify',
                template: "<ng-container *ngIf=\"!option.html\">\n  <a href=\"javascript:;\" class=\"thy-notify-close\" (click)=\"closeNotify()\">\n    <thy-icon thyIconName=\"close\"></thy-icon>\n  </a>\n  <div class=\"thy-notify-icon-container\">\n    <thy-icon [thyIconName]=\"notifyIconName\"></thy-icon>\n  </div>\n  <div class=\"thy-notify-main\">\n    <div class=\"thy-notify-title\">{{ option?.title }}</div>\n    <div\n      *ngIf=\"option?.detail || option?.content\"\n      class=\"thy-notify-content\"\n      [ngClass]=\"{ 'thy-notify-content--extend': extendContentClass === true }\"\n      (click)=\"extendContent()\"\n    >\n      {{ option?.content }}\n      <a href=\"javascript:;\" *ngIf=\"option?.detail\" class=\"link-secondary\" (click)=\"triggerDetail()\">{{ (option?.detail)['link'] }}</a>\n    </div>\n    <div class=\"thy-notify-detail\" *ngIf=\"isShowDetail\">{{ (option?.detail)['content'] }}</div>\n  </div>\n</ng-container>\n<ng-container *ngIf=\"option?.html\">\n  <a href=\"javascript:;\" class=\"thy-notify-close\" (click)=\"closeNotify()\">\n    <thy-icon thyIconName=\"close\"></thy-icon>\n  </a>\n  <div class=\"thy-notify-main\">\n    <template [ngTemplateOutlet]=\"option?.html\"></template>\n  </div>\n</ng-container>\n",
                providers: [UpdateHostClassService],
                animations: [
                    trigger('flyInOut', [
                        state('flyInOutRight', style({ transform: 'translateX(0)', opacity: 1, height: '*' })),
                        transition('void => flyInOutRight', [
                            style({ transform: 'translateX(100%)', opacity: 0, height: '*' }),
                            animate(ANIMATION_IN_DURATION)
                        ]),
                        transition('flyInOutRight => componentHide', [animate(ANIMATION_OUT_DURATION, style(HIDE_STYLE))]),
                        transition('flyInOutRight => void', [animate(ANIMATION_IN_DURATION, style(HIDE_STYLE))]),
                        state('flyInOutLeft', style({ transform: 'translateX(0)', opacity: 1, height: '*' })),
                        transition('void => flyInOutLeft', [
                            style({ transform: 'translateX(-100%)', opacity: 0, height: '*' }),
                            animate(ANIMATION_IN_DURATION)
                        ]),
                        transition('flyInOutLeft => componentHide', [animate(ANIMATION_OUT_DURATION, style(HIDE_STYLE))]),
                        transition('flyInOutLeft => void', [animate(ANIMATION_IN_DURATION, style(HIDE_STYLE))]),
                        state('componentHide', style(HIDE_STYLE))
                    ])
                ]
            },] }
];
ThyNotifyComponent.ctorParameters = () => [
    { type: NotifyQueueStore },
    { type: NgZone }
];
ThyNotifyComponent.propDecorators = {
    flyInOut: [{ type: HostBinding, args: ['@flyInOut',] }],
    className: [{ type: HostBinding, args: ['class',] }],
    thyOption: [{ type: Input }],
    mouseenter: [{ type: HostListener, args: ['mouseenter',] }],
    mouseleave: [{ type: HostListener, args: ['mouseleave',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZ5LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ub3RpZnkvbm90aWZ5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQVUsWUFBWSxFQUFhLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUxQyxNQUFNLHFCQUFxQixHQUFHLEdBQUcsQ0FBQztBQUNsQyxNQUFNLHNCQUFzQixHQUFHLEdBQUcsQ0FBQztBQUNuQyxNQUFNLFVBQVUsR0FBRyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUM7QUE0QnJILE1BQU0sT0FBTyxrQkFBa0I7SUE4QjNCLFlBQW9CLFdBQTZCLEVBQVUsT0FBZTtRQUF0RCxnQkFBVyxHQUFYLFdBQVcsQ0FBa0I7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFRO1FBM0JwRCxjQUFTLEdBQUcsRUFBRSxDQUFDO1FBSXJDLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBRXBCLHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUkzQixpQkFBWSxHQUFHLEtBQUssQ0FBQztJQWlCd0QsQ0FBQztJQWI5RSxJQUNJLFNBQVMsQ0FBQyxLQUF1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LHNCQUFzQixFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2pHLFVBQVUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUV2RixLQUFLLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztxQkFDNUMsQ0FBQztpQkFDTDthQUNKOzs7WUFoQ1EsZ0JBQWdCO1lBSmdELE1BQU07Ozt1QkFzQzFFLFdBQVcsU0FBQyxXQUFXO3dCQUV2QixXQUFXLFNBQUMsT0FBTzt3QkFjbkIsS0FBSzt5QkF5REwsWUFBWSxTQUFDLFlBQVk7eUJBTXpCLFlBQVksU0FBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgSG9zdEJpbmRpbmcsIE9uSW5pdCwgSG9zdExpc3RlbmVyLCBPbkRlc3Ryb3ksIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGh5Tm90aWZ5RGV0YWlsLCBOb3RpZnlQbGFjZW1lbnQsIFRoeU5vdGlmeU9wdGlvbnMgfSBmcm9tICcuL25vdGlmeS1vcHRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IHRyaWdnZXIsIHN0YXRlLCBzdHlsZSwgYW5pbWF0ZSwgdHJhbnNpdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgVXBkYXRlSG9zdENsYXNzU2VydmljZSB9IGZyb20gJ25neC10ZXRoeXMvY29yZSc7XG5pbXBvcnQgeyBOb3RpZnlRdWV1ZVN0b3JlIH0gZnJvbSAnLi9ub3RpZnktcXVldWUuc3RvcmUnO1xuaW1wb3J0IHsgaGVscGVycyB9IGZyb20gJ25neC10ZXRoeXMvdXRpbCc7XG5cbmNvbnN0IEFOSU1BVElPTl9JTl9EVVJBVElPTiA9IDEwMDtcbmNvbnN0IEFOSU1BVElPTl9PVVRfRFVSQVRJT04gPSAxNTA7XG5jb25zdCBISURFX1NUWUxFID0geyB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDApJywgb3BhY2l0eTogMCwgaGVpZ2h0OiAwLCBwYWRkaW5nVG9wOiAwLCBwYWRkaW5nQm90dG9tOiAwLCBtYXJnaW46IDAgfTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0aHktbm90aWZ5JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbm90aWZ5LmNvbXBvbmVudC5odG1sJyxcbiAgICBwcm92aWRlcnM6IFtVcGRhdGVIb3N0Q2xhc3NTZXJ2aWNlXSxcbiAgICBhbmltYXRpb25zOiBbXG4gICAgICAgIHRyaWdnZXIoJ2ZseUluT3V0JywgW1xuICAgICAgICAgICAgc3RhdGUoJ2ZseUluT3V0UmlnaHQnLCBzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMCknLCBvcGFjaXR5OiAxLCBoZWlnaHQ6ICcqJyB9KSksXG4gICAgICAgICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IGZseUluT3V0UmlnaHQnLCBbXG4gICAgICAgICAgICAgICAgc3R5bGUoeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDEwMCUpJywgb3BhY2l0eTogMCwgaGVpZ2h0OiAnKicgfSksXG4gICAgICAgICAgICAgICAgYW5pbWF0ZShBTklNQVRJT05fSU5fRFVSQVRJT04pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2ZseUluT3V0UmlnaHQgPT4gY29tcG9uZW50SGlkZScsIFthbmltYXRlKEFOSU1BVElPTl9PVVRfRFVSQVRJT04sIHN0eWxlKEhJREVfU1RZTEUpKV0pLFxuICAgICAgICAgICAgdHJhbnNpdGlvbignZmx5SW5PdXRSaWdodCA9PiB2b2lkJywgW2FuaW1hdGUoQU5JTUFUSU9OX0lOX0RVUkFUSU9OLCBzdHlsZShISURFX1NUWUxFKSldKSxcblxuICAgICAgICAgICAgc3RhdGUoJ2ZseUluT3V0TGVmdCcsIHN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwKScsIG9wYWNpdHk6IDEsIGhlaWdodDogJyonIH0pKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ3ZvaWQgPT4gZmx5SW5PdXRMZWZ0JywgW1xuICAgICAgICAgICAgICAgIHN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgtMTAwJSknLCBvcGFjaXR5OiAwLCBoZWlnaHQ6ICcqJyB9KSxcbiAgICAgICAgICAgICAgICBhbmltYXRlKEFOSU1BVElPTl9JTl9EVVJBVElPTilcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdHJhbnNpdGlvbignZmx5SW5PdXRMZWZ0ID0+IGNvbXBvbmVudEhpZGUnLCBbYW5pbWF0ZShBTklNQVRJT05fT1VUX0RVUkFUSU9OLCBzdHlsZShISURFX1NUWUxFKSldKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2ZseUluT3V0TGVmdCA9PiB2b2lkJywgW2FuaW1hdGUoQU5JTUFUSU9OX0lOX0RVUkFUSU9OLCBzdHlsZShISURFX1NUWUxFKSldKSxcblxuICAgICAgICAgICAgc3RhdGUoJ2NvbXBvbmVudEhpZGUnLCBzdHlsZShISURFX1NUWUxFKSlcbiAgICAgICAgXSlcbiAgICBdXG59KVxuZXhwb3J0IGNsYXNzIFRoeU5vdGlmeUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBASG9zdEJpbmRpbmcoJ0BmbHlJbk91dCcpIGZseUluT3V0OiBzdHJpbmc7XG5cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgY2xhc3NOYW1lID0gJyc7XG5cbiAgICBvcHRpb246IFRoeU5vdGlmeU9wdGlvbnM7XG5cbiAgICBub3RpZnlJY29uTmFtZSA9ICcnO1xuXG4gICAgZXh0ZW5kQ29udGVudENsYXNzID0gZmFsc2U7XG5cbiAgICBjbG9zZVRpbWVyOiBhbnk7XG5cbiAgICBpc1Nob3dEZXRhaWwgPSBmYWxzZTtcblxuICAgIHBsYWNlbWVudDogTm90aWZ5UGxhY2VtZW50O1xuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5T3B0aW9uKHZhbHVlOiBUaHlOb3RpZnlPcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9uID0gdmFsdWU7XG4gICAgICAgIGNvbnN0IHR5cGUgPSB2YWx1ZS50eXBlO1xuICAgICAgICB0aGlzLnBsYWNlbWVudCA9IHZhbHVlLnBsYWNlbWVudCB8fCAndG9wUmlnaHQnO1xuICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbUxlZnQnKSB7XG4gICAgICAgICAgICB0aGlzLmZseUluT3V0ID0gJ2ZseUluT3V0TGVmdCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZseUluT3V0ID0gJ2ZseUluT3V0UmlnaHQnO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gYHRoeS1ub3RpZnkgdGh5LW5vdGlmeS0ke3R5cGV9YDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9xdWV1ZVN0b3JlOiBOb3RpZnlRdWV1ZVN0b3JlLCBwcml2YXRlIF9uZ1pvbmU6IE5nWm9uZSkge31cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBjb25zdCBpY29uTmFtZSA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6ICdjaGVjay1jaXJjbGUtZmlsbCcsXG4gICAgICAgICAgICBpbmZvOiAnaW5mby1jaXJjbGUtZmlsbCcsXG4gICAgICAgICAgICB3YXJuaW5nOiAnd2FyaW5nLWZpbGwnLFxuICAgICAgICAgICAgZXJyb3I6ICdjbG9zZS1jaXJjbGUtZmlsbCdcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm5vdGlmeUljb25OYW1lID0gaWNvbk5hbWVbdGhpcy5vcHRpb24udHlwZV07XG4gICAgICAgIHRoaXMuX2NyZWF0Q2xvc2VUaW1lcigpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9jbGVhckNsb3NlVGltZXIoKTtcbiAgICB9XG5cbiAgICBleHRlbmRDb250ZW50KCkge1xuICAgICAgICB0aGlzLmV4dGVuZENvbnRlbnRDbGFzcyA9IHRydWU7XG4gICAgfVxuXG4gICAgc2hvd0RldGFpbFRvZ2dsZSgpIHtcbiAgICAgICAgdGhpcy5pc1Nob3dEZXRhaWwgPSAhdGhpcy5pc1Nob3dEZXRhaWw7XG4gICAgfVxuXG4gICAgY2xvc2VOb3RpZnkoKSB7XG4gICAgICAgIHRoaXMuX25nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZseUluT3V0ID0gJ2NvbXBvbmVudEhpZGUnO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcXVldWVTdG9yZS5yZW1vdmVOb3RpZnkodGhpcy5vcHRpb24uaWQsIHRoaXMucGxhY2VtZW50KTtcbiAgICAgICAgICAgIH0sIEFOSU1BVElPTl9PVVRfRFVSQVRJT04pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB0cmlnZ2VyRGV0YWlsKCkge1xuICAgICAgICBpZiAoaGVscGVycy5pc0Z1bmN0aW9uKCh0aGlzLm9wdGlvbi5kZXRhaWwgYXMgVGh5Tm90aWZ5RGV0YWlsKS5hY3Rpb24pKSB7XG4gICAgICAgICAgICAodGhpcy5vcHRpb24uZGV0YWlsIGFzIFRoeU5vdGlmeURldGFpbCkuYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh0aGlzLm9wdGlvbi5kZXRhaWwgYXMgVGh5Tm90aWZ5RGV0YWlsKS5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnNob3dEZXRhaWxUb2dnbGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKSBtb3VzZWVudGVyKCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb24ucGF1c2VPbkhvdmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhckNsb3NlVGltZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKSBtb3VzZWxlYXZlKCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb24ucGF1c2VPbkhvdmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdENsb3NlVGltZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX2NyZWF0Q2xvc2VUaW1lcigpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsb3NlVGltZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VOb3RpZnkoKTtcbiAgICAgICAgICAgIH0sIHRoaXMub3B0aW9uLmR1cmF0aW9uKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX2NsZWFyQ2xvc2VUaW1lcigpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsb3NlVGltZXIpO1xuICAgIH1cbn1cbiJdfQ==