import { isDevMode, Injectable } from '@angular/core';
import { Subscription, combineLatest } from 'rxjs';
import { map, switchMap, tap } from 'rxjs/operators';
import { BehaviorSubject } from 'rxjs';
import getReduxDevToolsPlugin from './plugins/redux_devtools';
import { ActionState } from './action-state';
import * as ɵngcc0 from '@angular/core';
let rootStore;
/**
 * @internal
 */
export class RootStore {
    constructor() {
        this.connectSuccessed = false;
        /**
         * 数据流 数据是一个Map，k,v键值对，关键字->状态数据
         */
        this._containers = new BehaviorSubject(new Map());
        this._plugin = getReduxDevToolsPlugin();
        this._combinedStateSubscription = new Subscription();
        if (this._plugin.isConnectSuccessed()) {
            this.connectSuccessed = true;
            this._assignCombinedState(); // 最终调用handleNewState
            console.log(`是否在Angular开发环境：${isDevMode()}, 初始化root-store`);
        }
    }
    _assignCombinedState() {
        this._combinedStateSubscription = this._containers
            .pipe(switchMap(containers => this._getCombinedState(containers)))
            .pipe(map(states => {
            const actionName = ActionState.getActionName();
            const state = states.reduce((acc, curr) => {
                acc[curr.containerName] = curr.state;
                return acc;
            }, {});
            return { state: state, actionName: actionName };
        }))
            .subscribe(c => {
            this._plugin.handleNewState(c.actionName, c.state);
        });
    }
    /**
     * 合并数据流
     * 合并状态数据，把状态数据转换为这样的数据：{ containerName: string, state: any }，并且
     * 通过combineLatest合并成一个数据数据流，这样状态数据只有涉及更新，那么这边就会得到通知
     * @param containers 状态数据的Map
     */
    _getCombinedState(containers) {
        return combineLatest(...Array.from(containers.entries()).map(([containerName, container]) => {
            return container.state$.pipe(map(state => ({ containerName, state })), tap(data => { }));
        }));
    }
    /**
     * @internal
     */
    ngOnDestroy() {
        this._combinedStateSubscription.unsubscribe();
    }
    /**
     * @internal
     */
    registerStore(store) {
        if (!this.connectSuccessed) {
            return;
        }
        const containers = new Map(this._containers.value);
        if (containers.has(store.getStoreInstanceId())) {
            throw new Error(`Store: Store with duplicate instance ID found! ${store.getStoreInstanceId()}` +
                ` is already registered. Please check your getStoreInstanceId() methods!`);
        }
        containers.set(store.getStoreInstanceId(), store);
        this._containers.next(containers);
    }
    existStoreInstanceId(instanceId) {
        const containers = new Map(this._containers.value);
        if (containers.has(instanceId)) {
            return true;
        }
        return false;
    }
    /**
     * @internal
     */
    unregisterStore(store) {
        if (!this.connectSuccessed) {
            return;
        }
        const containers = new Map(this._containers.value);
        containers.delete(store.getStoreInstanceId());
        this._containers.next(containers);
    }
}
RootStore.ɵfac = function RootStore_Factory(t) { return new (t || RootStore)(); };
RootStore.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: RootStore, factory: RootStore.ɵfac });
RootStore.ctorParameters = () => [];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(RootStore, [{
        type: Injectable
    }], function () { return []; }, null); })();
export function getSingletonRootStore() {
    if (!rootStore) {
        rootStore = new RootStore();
    }
    return rootStore;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm9vdC1zdG9yZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3N0b3JlL3Jvb3Qtc3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUF5QyxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdGLE9BQU8sRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxzQkFBdUMsTUFBTSwwQkFBMEIsQ0FBQztBQUMvRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7O0FBSTdDLElBQUksU0FBb0IsQ0FBQztBQUN6QjtBQUNBO0FBQ0EsR0FBRztBQUVILE1BQU0sT0FBTyxTQUFTO0FBQ3RCLElBUUk7QUFDSixRQVRZLHFCQUFnQixHQUFHLEtBQUssQ0FBQztBQUNyQyxRQUFJO0FBQ0o7QUFDSSxXQUFHO0FBQ1AsUUFBcUIsZ0JBQVcsR0FBRyxJQUFJLGVBQWUsQ0FBbUIsSUFBSSxHQUFHLEVBQXNCLENBQUMsQ0FBQztBQUN4RyxRQUFZLFlBQU8sR0FBZ0Isc0JBQXNCLEVBQUUsQ0FBQztBQUM1RCxRQUFZLCtCQUEwQixHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQzFFLFFBRVEsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGtCQUFrQixFQUFFLEVBQUU7QUFDL0MsWUFBWSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO0FBQ3pDLFlBQVksSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxxQkFBcUI7QUFDOUQsWUFBWSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztBQUN4RSxTQUFTO0FBQ1QsSUFB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SSxRQUN2QyxNQUFNLFVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzNELFFBQVEsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ3hDLFlBQVksT0FBTyxJQUFJLENBQUM7QUFDeEIsU0FBUztBQUNULFFBQVEsT0FBTyxLQUFLLENBQUM7QUFDckIsSUFBSSxDQUFDO0FBQ0wsSUFDSTtBQUNKO0FBQ0EsT0FBTztBQUNQLElBQUksZUFBZSxDQUFDLEtBQWlCO0FBQ3JDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtBQUNwQyxZQUFZLE9BQU87QUFDbkIsU0FBUztBQUNULFFBQVEsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMzRCxRQUFRLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztBQUN0RCxRQUFRLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzFDLElBQUksQ0FBQztBQUNMO3FDQWpHQyxVQUFVOzJGQUNUO0FBQUM7OztnREFDVztBQWlHZCxNQUFNLFVBQVUscUJBQXFCO0FBQ3JDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtBQUNwQixRQUFRLFNBQVMsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO0FBQ3BDLEtBQUs7QUFDTCxJQUFJLE9BQU8sU0FBUyxDQUFDO0FBQ3JCLENBQUM7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0b3JlIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBJbmplY3QsIFNraXBTZWxmLCBPcHRpb25hbCwgT25EZXN0cm95LCBpc0Rldk1vZGUsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgY29tYmluZUxhdGVzdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IGdldFJlZHV4RGV2VG9vbHNQbHVnaW4sIHsgU3RvcmVQbHVnaW4gfSBmcm9tICcuL3BsdWdpbnMvcmVkdXhfZGV2dG9vbHMnO1xuaW1wb3J0IHsgQWN0aW9uU3RhdGUgfSBmcm9tICcuL2FjdGlvbi1zdGF0ZSc7XG5cbmV4cG9ydCB0eXBlIFN0b3JlSW5zdGFuY2VNYXAgPSBNYXA8c3RyaW5nLCBTdG9yZTxhbnk+PjsgLy8gTWFwIGtlee+8mnN0cmluZ++8jHZhbHVl77ya54q25oCB5pWw5o2uXG5cbmxldCByb290U3RvcmU6IFJvb3RTdG9yZTtcbi8qKlxuICogQGludGVybmFsXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSb290U3RvcmUge1xuICAgIHByaXZhdGUgY29ubmVjdFN1Y2Nlc3NlZCA9IGZhbHNlO1xuICAgIC8qKlxuICAgICAqIOaVsOaNrua1gSDmlbDmja7mmK/kuIDkuKpNYXDvvIxrLHbplK7lgLzlr7nvvIzlhbPplK7lrZctPueKtuaAgeaVsOaNrlxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2NvbnRhaW5lcnMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFN0b3JlSW5zdGFuY2VNYXA+KG5ldyBNYXA8c3RyaW5nLCBTdG9yZTxhbnk+PigpKTtcbiAgICBwcml2YXRlIF9wbHVnaW46IFN0b3JlUGx1Z2luID0gZ2V0UmVkdXhEZXZUb29sc1BsdWdpbigpO1xuICAgIHByaXZhdGUgX2NvbWJpbmVkU3RhdGVTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBpZiAodGhpcy5fcGx1Z2luLmlzQ29ubmVjdFN1Y2Nlc3NlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3RTdWNjZXNzZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fYXNzaWduQ29tYmluZWRTdGF0ZSgpOyAvLyDmnIDnu4josIPnlKhoYW5kbGVOZXdTdGF0ZVxuICAgICAgICAgICAgY29uc29sZS5sb2coYOaYr+WQpuWcqEFuZ3VsYXLlvIDlj5Hnjq/looPvvJoke2lzRGV2TW9kZSgpfSwg5Yid5aeL5YyWcm9vdC1zdG9yZWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfYXNzaWduQ29tYmluZWRTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5fY29tYmluZWRTdGF0ZVN1YnNjcmlwdGlvbiA9IHRoaXMuX2NvbnRhaW5lcnNcbiAgICAgICAgICAgIC5waXBlKHN3aXRjaE1hcChjb250YWluZXJzID0+IHRoaXMuX2dldENvbWJpbmVkU3RhdGUoY29udGFpbmVycykpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHN0YXRlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbk5hbWUgPSBBY3Rpb25TdGF0ZS5nZXRBY3Rpb25OYW1lKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gc3RhdGVzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY2NbY3Vyci5jb250YWluZXJOYW1lXSA9IGN1cnIuc3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgICAgICAgICB9LCA8eyBba2V5OiBzdHJpbmddOiBhbnkgfT57fSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHN0YXRlOiBzdGF0ZSwgYWN0aW9uTmFtZTogYWN0aW9uTmFtZSB9O1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGMgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BsdWdpbi5oYW5kbGVOZXdTdGF0ZShjLmFjdGlvbk5hbWUsIGMuc3RhdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5ZCI5bm25pWw5o2u5rWBXG4gICAgICog5ZCI5bm254q25oCB5pWw5o2u77yM5oqK54q25oCB5pWw5o2u6L2s5o2i5Li66L+Z5qC355qE5pWw5o2u77yaeyBjb250YWluZXJOYW1lOiBzdHJpbmcsIHN0YXRlOiBhbnkgfe+8jOW5tuS4lFxuICAgICAqIOmAmui/h2NvbWJpbmVMYXRlc3TlkIjlubbmiJDkuIDkuKrmlbDmja7mlbDmja7mtYHvvIzov5nmoLfnirbmgIHmlbDmja7lj6rmnInmtonlj4rmm7TmlrDvvIzpgqPkuYjov5novrnlsLHkvJrlvpfliLDpgJrnn6VcbiAgICAgKiBAcGFyYW0gY29udGFpbmVycyDnirbmgIHmlbDmja7nmoRNYXBcbiAgICAgKi9cbiAgICBwcml2YXRlIF9nZXRDb21iaW5lZFN0YXRlKGNvbnRhaW5lcnM6IFN0b3JlSW5zdGFuY2VNYXApIHtcbiAgICAgICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoXG4gICAgICAgICAgICAuLi5BcnJheS5mcm9tKGNvbnRhaW5lcnMuZW50cmllcygpKS5tYXAoKFtjb250YWluZXJOYW1lLCBjb250YWluZXJdKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5zdGF0ZSQucGlwZShcbiAgICAgICAgICAgICAgICAgICAgbWFwKHN0YXRlID0+ICh7IGNvbnRhaW5lck5hbWUsIHN0YXRlIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgdGFwKGRhdGEgPT4ge30pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2NvbWJpbmVkU3RhdGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICByZWdpc3RlclN0b3JlKHN0b3JlOiBTdG9yZTxhbnk+KSB7XG4gICAgICAgIGlmICghdGhpcy5jb25uZWN0U3VjY2Vzc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFpbmVycyA9IG5ldyBNYXAodGhpcy5fY29udGFpbmVycy52YWx1ZSk7XG4gICAgICAgIGlmIChjb250YWluZXJzLmhhcyhzdG9yZS5nZXRTdG9yZUluc3RhbmNlSWQoKSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgU3RvcmU6IFN0b3JlIHdpdGggZHVwbGljYXRlIGluc3RhbmNlIElEIGZvdW5kISAke3N0b3JlLmdldFN0b3JlSW5zdGFuY2VJZCgpfWAgK1xuICAgICAgICAgICAgICAgICAgICBgIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4gUGxlYXNlIGNoZWNrIHlvdXIgZ2V0U3RvcmVJbnN0YW5jZUlkKCkgbWV0aG9kcyFgXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lcnMuc2V0KHN0b3JlLmdldFN0b3JlSW5zdGFuY2VJZCgpLCBzdG9yZSk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lcnMubmV4dChjb250YWluZXJzKTtcbiAgICB9XG5cbiAgICBleGlzdFN0b3JlSW5zdGFuY2VJZChpbnN0YW5jZUlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVycyA9IG5ldyBNYXAodGhpcy5fY29udGFpbmVycy52YWx1ZSk7XG4gICAgICAgIGlmIChjb250YWluZXJzLmhhcyhpbnN0YW5jZUlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVucmVnaXN0ZXJTdG9yZShzdG9yZTogU3RvcmU8YW55Pikge1xuICAgICAgICBpZiAoIXRoaXMuY29ubmVjdFN1Y2Nlc3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcnMgPSBuZXcgTWFwKHRoaXMuX2NvbnRhaW5lcnMudmFsdWUpO1xuICAgICAgICBjb250YWluZXJzLmRlbGV0ZShzdG9yZS5nZXRTdG9yZUluc3RhbmNlSWQoKSk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lcnMubmV4dChjb250YWluZXJzKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTaW5nbGV0b25Sb290U3RvcmUoKSB7XG4gICAgaWYgKCFyb290U3RvcmUpIHtcbiAgICAgICAgcm9vdFN0b3JlID0gbmV3IFJvb3RTdG9yZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcm9vdFN0b3JlO1xufVxuIl19