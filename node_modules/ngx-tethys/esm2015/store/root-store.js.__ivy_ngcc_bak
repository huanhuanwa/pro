import { isDevMode, Injectable } from '@angular/core';
import { Subscription, combineLatest } from 'rxjs';
import { map, switchMap, tap } from 'rxjs/operators';
import { BehaviorSubject } from 'rxjs';
import getReduxDevToolsPlugin from './plugins/redux_devtools';
import { ActionState } from './action-state';
let rootStore;
/**
 * @internal
 */
export class RootStore {
    constructor() {
        this.connectSuccessed = false;
        /**
         * 数据流 数据是一个Map，k,v键值对，关键字->状态数据
         */
        this._containers = new BehaviorSubject(new Map());
        this._plugin = getReduxDevToolsPlugin();
        this._combinedStateSubscription = new Subscription();
        if (this._plugin.isConnectSuccessed()) {
            this.connectSuccessed = true;
            this._assignCombinedState(); // 最终调用handleNewState
            console.log(`是否在Angular开发环境：${isDevMode()}, 初始化root-store`);
        }
    }
    _assignCombinedState() {
        this._combinedStateSubscription = this._containers
            .pipe(switchMap(containers => this._getCombinedState(containers)))
            .pipe(map(states => {
            const actionName = ActionState.getActionName();
            const state = states.reduce((acc, curr) => {
                acc[curr.containerName] = curr.state;
                return acc;
            }, {});
            return { state: state, actionName: actionName };
        }))
            .subscribe(c => {
            this._plugin.handleNewState(c.actionName, c.state);
        });
    }
    /**
     * 合并数据流
     * 合并状态数据，把状态数据转换为这样的数据：{ containerName: string, state: any }，并且
     * 通过combineLatest合并成一个数据数据流，这样状态数据只有涉及更新，那么这边就会得到通知
     * @param containers 状态数据的Map
     */
    _getCombinedState(containers) {
        return combineLatest(...Array.from(containers.entries()).map(([containerName, container]) => {
            return container.state$.pipe(map(state => ({ containerName, state })), tap(data => { }));
        }));
    }
    /**
     * @internal
     */
    ngOnDestroy() {
        this._combinedStateSubscription.unsubscribe();
    }
    /**
     * @internal
     */
    registerStore(store) {
        if (!this.connectSuccessed) {
            return;
        }
        const containers = new Map(this._containers.value);
        if (containers.has(store.getStoreInstanceId())) {
            throw new Error(`Store: Store with duplicate instance ID found! ${store.getStoreInstanceId()}` +
                ` is already registered. Please check your getStoreInstanceId() methods!`);
        }
        containers.set(store.getStoreInstanceId(), store);
        this._containers.next(containers);
    }
    existStoreInstanceId(instanceId) {
        const containers = new Map(this._containers.value);
        if (containers.has(instanceId)) {
            return true;
        }
        return false;
    }
    /**
     * @internal
     */
    unregisterStore(store) {
        if (!this.connectSuccessed) {
            return;
        }
        const containers = new Map(this._containers.value);
        containers.delete(store.getStoreInstanceId());
        this._containers.next(containers);
    }
}
RootStore.decorators = [
    { type: Injectable }
];
RootStore.ctorParameters = () => [];
export function getSingletonRootStore() {
    if (!rootStore) {
        rootStore = new RootStore();
    }
    return rootStore;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm9vdC1zdG9yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zdG9yZS9yb290LXN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBeUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RixPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZDLE9BQU8sc0JBQXVDLE1BQU0sMEJBQTBCLENBQUM7QUFDL0UsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSTdDLElBQUksU0FBb0IsQ0FBQztBQUN6Qjs7R0FFRztBQUVILE1BQU0sT0FBTyxTQUFTO0lBU2xCO1FBUlEscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ2pDOztXQUVHO1FBQ2MsZ0JBQVcsR0FBRyxJQUFJLGVBQWUsQ0FBbUIsSUFBSSxHQUFHLEVBQXNCLENBQUMsQ0FBQztRQUM1RixZQUFPLEdBQWdCLHNCQUFzQixFQUFFLENBQUM7UUFDaEQsK0JBQTBCLEdBQWlCLElBQUksWUFBWSxFQUFFLENBQUM7UUFHbEUsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGtCQUFrQixFQUFFLEVBQUU7WUFDbkMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztZQUM3QixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDLHFCQUFxQjtZQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztTQUMvRDtJQUNMLENBQUM7SUFFTyxvQkFBb0I7UUFDeEIsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyxXQUFXO2FB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QUFLLENBQUMsQ0FBQztRQUNuRCxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdEMsQ0FBQzs7O1lBaEdKLFVBQVU7OztBQW1HWCxNQUFNLFVBQVUscUJBQXFCO0lBQ2pDLElBQUksQ0FBQyxTQUFTLEVBQUU7UUFDWixTQUFTLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQztLQUMvQjtJQUNELE9BQU8sU0FBUyxDQUFDO0FBQ3JCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdG9yZSB9IGZyb20gJy4vc3RvcmUnO1xuaW1wb3J0IHsgSW5qZWN0LCBTa2lwU2VsZiwgT3B0aW9uYWwsIE9uRGVzdHJveSwgaXNEZXZNb2RlLCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIGNvbWJpbmVMYXRlc3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCBnZXRSZWR1eERldlRvb2xzUGx1Z2luLCB7IFN0b3JlUGx1Z2luIH0gZnJvbSAnLi9wbHVnaW5zL3JlZHV4X2RldnRvb2xzJztcbmltcG9ydCB7IEFjdGlvblN0YXRlIH0gZnJvbSAnLi9hY3Rpb24tc3RhdGUnO1xuXG5leHBvcnQgdHlwZSBTdG9yZUluc3RhbmNlTWFwID0gTWFwPHN0cmluZywgU3RvcmU8YW55Pj47IC8vIE1hcCBrZXnvvJpzdHJpbmfvvIx2YWx1Ze+8mueKtuaAgeaVsOaNrlxuXG5sZXQgcm9vdFN0b3JlOiBSb290U3RvcmU7XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUm9vdFN0b3JlIHtcbiAgICBwcml2YXRlIGNvbm5lY3RTdWNjZXNzZWQgPSBmYWxzZTtcbiAgICAvKipcbiAgICAgKiDmlbDmja7mtYEg5pWw5o2u5piv5LiA5LiqTWFw77yMayx26ZSu5YC85a+577yM5YWz6ZSu5a2XLT7nirbmgIHmlbDmja5cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IF9jb250YWluZXJzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxTdG9yZUluc3RhbmNlTWFwPihuZXcgTWFwPHN0cmluZywgU3RvcmU8YW55Pj4oKSk7XG4gICAgcHJpdmF0ZSBfcGx1Z2luOiBTdG9yZVBsdWdpbiA9IGdldFJlZHV4RGV2VG9vbHNQbHVnaW4oKTtcbiAgICBwcml2YXRlIF9jb21iaW5lZFN0YXRlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BsdWdpbi5pc0Nvbm5lY3RTdWNjZXNzZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0U3VjY2Vzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkNvbWJpbmVkU3RhdGUoKTsgLy8g5pyA57uI6LCD55SoaGFuZGxlTmV3U3RhdGVcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDmmK/lkKblnKhBbmd1bGFy5byA5Y+R546v5aKD77yaJHtpc0Rldk1vZGUoKX0sIOWIneWni+WMlnJvb3Qtc3RvcmVgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX2Fzc2lnbkNvbWJpbmVkU3RhdGUoKSB7XG4gICAgICAgIHRoaXMuX2NvbWJpbmVkU3RhdGVTdWJzY3JpcHRpb24gPSB0aGlzLl9jb250YWluZXJzXG4gICAgICAgICAgICAucGlwZShzd2l0Y2hNYXAoY29udGFpbmVycyA9PiB0aGlzLl9nZXRDb21iaW5lZFN0YXRlKGNvbnRhaW5lcnMpKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcChzdGF0ZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb25OYW1lID0gQWN0aW9uU3RhdGUuZ2V0QWN0aW9uTmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHN0YXRlcy5yZWR1Y2UoKGFjYywgY3VycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjW2N1cnIuY29udGFpbmVyTmFtZV0gPSBjdXJyLnN0YXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgICAgICAgICAgfSwgPHsgW2tleTogc3RyaW5nXTogYW55IH0+e30pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBzdGF0ZTogc3RhdGUsIGFjdGlvbk5hbWU6IGFjdGlvbk5hbWUgfTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShjID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wbHVnaW4uaGFuZGxlTmV3U3RhdGUoYy5hY3Rpb25OYW1lLCBjLnN0YXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWQiOW5tuaVsOaNrua1gVxuICAgICAqIOWQiOW5tueKtuaAgeaVsOaNru+8jOaKiueKtuaAgeaVsOaNrui9rOaNouS4uui/meagt+eahOaVsOaNru+8mnsgY29udGFpbmVyTmFtZTogc3RyaW5nLCBzdGF0ZTogYW55IH3vvIzlubbkuJRcbiAgICAgKiDpgJrov4djb21iaW5lTGF0ZXN05ZCI5bm25oiQ5LiA5Liq5pWw5o2u5pWw5o2u5rWB77yM6L+Z5qC354q25oCB5pWw5o2u5Y+q5pyJ5raJ5Y+K5pu05paw77yM6YKj5LmI6L+Z6L655bCx5Lya5b6X5Yiw6YCa55+lXG4gICAgICogQHBhcmFtIGNvbnRhaW5lcnMg54q25oCB5pWw5o2u55qETWFwXG4gICAgICovXG4gICAgcHJpdmF0ZSBfZ2V0Q29tYmluZWRTdGF0ZShjb250YWluZXJzOiBTdG9yZUluc3RhbmNlTWFwKSB7XG4gICAgICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KFxuICAgICAgICAgICAgLi4uQXJyYXkuZnJvbShjb250YWluZXJzLmVudHJpZXMoKSkubWFwKChbY29udGFpbmVyTmFtZSwgY29udGFpbmVyXSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXIuc3RhdGUkLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgIG1hcChzdGF0ZSA9PiAoeyBjb250YWluZXJOYW1lLCBzdGF0ZSB9KSksXG4gICAgICAgICAgICAgICAgICAgIHRhcChkYXRhID0+IHt9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9jb21iaW5lZFN0YXRlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgcmVnaXN0ZXJTdG9yZShzdG9yZTogU3RvcmU8YW55Pikge1xuICAgICAgICBpZiAoIXRoaXMuY29ubmVjdFN1Y2Nlc3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcnMgPSBuZXcgTWFwKHRoaXMuX2NvbnRhaW5lcnMudmFsdWUpO1xuICAgICAgICBpZiAoY29udGFpbmVycy5oYXMoc3RvcmUuZ2V0U3RvcmVJbnN0YW5jZUlkKCkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgYFN0b3JlOiBTdG9yZSB3aXRoIGR1cGxpY2F0ZSBpbnN0YW5jZSBJRCBmb3VuZCEgJHtzdG9yZS5nZXRTdG9yZUluc3RhbmNlSWQoKX1gICtcbiAgICAgICAgICAgICAgICAgICAgYCBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQuIFBsZWFzZSBjaGVjayB5b3VyIGdldFN0b3JlSW5zdGFuY2VJZCgpIG1ldGhvZHMhYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb250YWluZXJzLnNldChzdG9yZS5nZXRTdG9yZUluc3RhbmNlSWQoKSwgc3RvcmUpO1xuICAgICAgICB0aGlzLl9jb250YWluZXJzLm5leHQoY29udGFpbmVycyk7XG4gICAgfVxuXG4gICAgZXhpc3RTdG9yZUluc3RhbmNlSWQoaW5zdGFuY2VJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcnMgPSBuZXcgTWFwKHRoaXMuX2NvbnRhaW5lcnMudmFsdWUpO1xuICAgICAgICBpZiAoY29udGFpbmVycy5oYXMoaW5zdGFuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICB1bnJlZ2lzdGVyU3RvcmUoc3RvcmU6IFN0b3JlPGFueT4pIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbm5lY3RTdWNjZXNzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWluZXJzID0gbmV3IE1hcCh0aGlzLl9jb250YWluZXJzLnZhbHVlKTtcbiAgICAgICAgY29udGFpbmVycy5kZWxldGUoc3RvcmUuZ2V0U3RvcmVJbnN0YW5jZUlkKCkpO1xuICAgICAgICB0aGlzLl9jb250YWluZXJzLm5leHQoY29udGFpbmVycyk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2luZ2xldG9uUm9vdFN0b3JlKCkge1xuICAgIGlmICghcm9vdFN0b3JlKSB7XG4gICAgICAgIHJvb3RTdG9yZSA9IG5ldyBSb290U3RvcmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvb3RTdG9yZTtcbn1cbiJdfQ==