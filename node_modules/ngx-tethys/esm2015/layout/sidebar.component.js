import { Component, HostBinding, Host, Optional, Input, ViewChild, Renderer2, ElementRef, NgZone } from '@angular/core';
import { ThyLayoutComponent } from './layout.component';
import { coerceBooleanProperty } from 'ngx-tethys/util';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './layout.component';
import * as ɵngcc2 from '@angular/cdk/drag-drop';

const _c0 = ["dragRef"];
const _c1 = ["*"];
const LG_WIDTH = 300;
export class ThySidebarComponent {
    constructor(thyLayoutComponent, renderer, elementRef, ngZone) {
        this.thyLayoutComponent = thyLayoutComponent;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        this.thyLayoutSidebarClass = true;
        this.thyLayoutSidebarClearBorderRightClass = false;
        this.sidebarIsolated = false;
    }
    set thyWidth(value) {
        if (value === 'lg') {
            value = LG_WIDTH;
        }
        this.thyLayoutSidebarWidth = value;
        this.widthPassive = value;
    }
    set thyHasBorderRight(value) {
        this.thyLayoutSidebarClearBorderRightClass = !coerceBooleanProperty(value);
    }
    set thyIsolated(value) {
        this.sidebarIsolated = coerceBooleanProperty(value);
    }
    set thyIsDraggableWidth(value) {
        if (coerceBooleanProperty(value)) {
            this.thyLayoutSidebarPointerEvents = 'all';
        }
    }
    ngOnInit() {
        if (this.thyLayoutComponent) {
            this.thyLayoutComponent.hasSidebar = true;
        }
        this.ngZone.runOutsideAngular(() => {
            setTimeout(() => {
                this.widthPassive = this.elementRef.nativeElement.clientWidth;
                this.renderer.setStyle(this.dragRef.nativeElement, 'left', this.numberConvertToFloor(this.widthPassive) + 'px');
            }, 0);
        });
    }
    dragStartedHandler() {
        this.dragStartedX = this.dragRef.nativeElement.getBoundingClientRect().x;
    }
    dragEndedHandler() {
        const x = this.dragRef.nativeElement.getBoundingClientRect().x;
        this.widthPassive = this.numberConvertToFloor(this.widthPassive * 1 + (x - this.dragStartedX));
        this.thyLayoutSidebarWidth = this.widthPassive;
    }
    numberConvertToFloor(value) {
        let result = Math.floor(value * 1);
        if (result < 1) {
            result = 1;
        }
        return result;
    }
}
ThySidebarComponent.ɵfac = function ThySidebarComponent_Factory(t) { return new (t || ThySidebarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ThyLayoutComponent, 9), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
ThySidebarComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThySidebarComponent, selectors: [["thy-sidebar"]], viewQuery: function ThySidebarComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dragRef = _t.first);
    } }, hostVars: 10, hostBindings: function ThySidebarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("width", ctx.thyLayoutSidebarWidth, "px")("pointer-events", ctx.thyLayoutSidebarPointerEvents);
        ɵngcc0.ɵɵclassProp("thy-layout-sidebar", ctx.thyLayoutSidebarClass)("thy-layout-sidebar--clear-border-right", ctx.thyLayoutSidebarClearBorderRightClass)("thy-layout-sidebar-isolated", ctx.sidebarIsolated);
    } }, inputs: { thyWidth: "thyWidth", thyHasBorderRight: "thyHasBorderRight", thyIsolated: "thyIsolated", thyIsDraggableWidth: "thyIsDraggableWidth" }, ngContentSelectors: _c1, decls: 3, vars: 0, consts: [["cdkDrag", "", "cdkDragLockAxis", "x", "cdkDragBoundary", ".thy-layout", 1, "sidebar-drag", 3, "cdkDragStarted", "cdkDragEnded"], ["dragRef", ""]], template: function ThySidebarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
        ɵngcc0.ɵɵelementStart(1, "div", 0, 1);
        ɵngcc0.ɵɵlistener("cdkDragStarted", function ThySidebarComponent_Template_div_cdkDragStarted_1_listener() { return ctx.dragStartedHandler(); })("cdkDragEnded", function ThySidebarComponent_Template_div_cdkDragEnded_1_listener() { return ctx.dragEndedHandler(); });
        ɵngcc0.ɵɵelementEnd();
    } }, directives: [ɵngcc2.CdkDrag], encapsulation: 2 });
ThySidebarComponent.ctorParameters = () => [
    { type: ThyLayoutComponent, decorators: [{ type: Optional }, { type: Host }] },
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
ThySidebarComponent.propDecorators = {
    thyLayoutSidebarClass: [{ type: HostBinding, args: ['class.thy-layout-sidebar',] }],
    thyLayoutSidebarClearBorderRightClass: [{ type: HostBinding, args: ['class.thy-layout-sidebar--clear-border-right',] }],
    thyLayoutSidebarWidth: [{ type: HostBinding, args: ['style.width.px',] }],
    thyLayoutSidebarPointerEvents: [{ type: HostBinding, args: ['style.pointer-events',] }],
    sidebarIsolated: [{ type: HostBinding, args: ['class.thy-layout-sidebar-isolated',] }],
    thyWidth: [{ type: Input, args: ['thyWidth',] }],
    thyHasBorderRight: [{ type: Input, args: ['thyHasBorderRight',] }],
    thyIsolated: [{ type: Input, args: ['thyIsolated',] }],
    thyIsDraggableWidth: [{ type: Input, args: ['thyIsDraggableWidth',] }],
    dragRef: [{ type: ViewChild, args: ['dragRef', { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThySidebarComponent, [{
        type: Component,
        args: [{
                selector: 'thy-sidebar',
                preserveWhitespaces: false,
                template: `
        <ng-content></ng-content>
        <div
            class="sidebar-drag"
            #dragRef
            cdkDrag
            cdkDragLockAxis="x"
            cdkDragBoundary=".thy-layout"
            (cdkDragStarted)="dragStartedHandler()"
            (cdkDragEnded)="dragEndedHandler()"
        ></div>
    `
            }]
    }], function () { return [{ type: ɵngcc1.ThyLayoutComponent, decorators: [{
                type: Optional
            }, {
                type: Host
            }] }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }]; }, { thyLayoutSidebarClass: [{
            type: HostBinding,
            args: ['class.thy-layout-sidebar']
        }], thyLayoutSidebarClearBorderRightClass: [{
            type: HostBinding,
            args: ['class.thy-layout-sidebar--clear-border-right']
        }], sidebarIsolated: [{
            type: HostBinding,
            args: ['class.thy-layout-sidebar-isolated']
        }], thyWidth: [{
            type: Input,
            args: ['thyWidth']
        }], thyLayoutSidebarWidth: [{
            type: HostBinding,
            args: ['style.width.px']
        }], thyHasBorderRight: [{
            type: Input,
            args: ['thyHasBorderRight']
        }], thyIsolated: [{
            type: Input,
            args: ['thyIsolated']
        }], thyIsDraggableWidth: [{
            type: Input,
            args: ['thyIsDraggableWidth']
        }], thyLayoutSidebarPointerEvents: [{
            type: HostBinding,
            args: ['style.pointer-events']
        }], dragRef: [{
            type: ViewChild,
            args: ['dragRef', { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9sYXlvdXQvc2lkZWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hJLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7O0FBRXhELE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQztBQWlCckIsTUFBTSxPQUFPLG1CQUFtQjtBQUFHLElBMEMvQixZQUNnQyxrQkFBc0MsRUFDMUQsUUFBbUIsRUFDbkIsVUFBc0IsRUFDdEIsTUFBYztBQUMzQixRQUppQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0FBQUMsUUFDM0QsYUFBUSxHQUFSLFFBQVEsQ0FBVztBQUFDLFFBQ3BCLGVBQVUsR0FBVixVQUFVLENBQVk7QUFBQyxRQUN2QixXQUFNLEdBQU4sTUFBTSxDQUFRO0FBQzlCLFFBOUM2QywwQkFBcUIsR0FBRyxJQUFJLENBQUM7QUFDMUUsUUFDaUUsMENBQXFDLEdBQUcsS0FBSyxDQUFDO0FBQy9HLFFBSXNELG9CQUFlLEdBQUcsS0FBSyxDQUFDO0FBQzlFLElBc0NPLENBQUM7QUFDUixJQXRDSSxJQUNJLFFBQVEsQ0FBQyxLQUFVO0FBQzNCLFFBQVEsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO0FBQzVCLFlBQVksS0FBSyxHQUFHLFFBQVEsQ0FBQztBQUM3QixTQUFTO0FBQ1QsUUFBUSxJQUFJLENBQUMscUJBQXFCLEdBQUcsS0FBSyxDQUFDO0FBQzNDLFFBQVEsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7QUFDbEMs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LGdCQUFnQjtBQUFPLDRDQUNuQyxXQUFXLFNBQUMsc0JBQXNCO0FBQU8sOEJBRXpDLFdBQVcsU0FBQyxtQ0FBbUM7QUFBTyx1QkFFdEQsS0FBSyxTQUFDLFVBQVU7QUFDaEIsZ0NBUUEsS0FBSyxTQUFDLG1CQUFtQjtBQUN6QiwwQkFJQSxLQUFLLFNBQUMsYUFBYTtBQUNuQixrQ0FJQSxLQUFLLFNBQUMscUJBQXFCO0FBQzNCLHNCQU1BLFNBQVMsU0FBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO0FBQU07Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEhvc3RCaW5kaW5nLCBIb3N0LCBPcHRpb25hbCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGh5TGF5b3V0Q29tcG9uZW50IH0gZnJvbSAnLi9sYXlvdXQuY29tcG9uZW50JztcbmltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ25neC10ZXRoeXMvdXRpbCc7XG5cbmNvbnN0IExHX1dJRFRIID0gMzAwO1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0aHktc2lkZWJhcicsXG4gICAgcHJlc2VydmVXaGl0ZXNwYWNlczogZmFsc2UsXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzcz1cInNpZGViYXItZHJhZ1wiXG4gICAgICAgICAgICAjZHJhZ1JlZlxuICAgICAgICAgICAgY2RrRHJhZ1xuICAgICAgICAgICAgY2RrRHJhZ0xvY2tBeGlzPVwieFwiXG4gICAgICAgICAgICBjZGtEcmFnQm91bmRhcnk9XCIudGh5LWxheW91dFwiXG4gICAgICAgICAgICAoY2RrRHJhZ1N0YXJ0ZWQpPVwiZHJhZ1N0YXJ0ZWRIYW5kbGVyKClcIlxuICAgICAgICAgICAgKGNka0RyYWdFbmRlZCk9XCJkcmFnRW5kZWRIYW5kbGVyKClcIlxuICAgICAgICA+PC9kaXY+XG4gICAgYFxufSlcbmV4cG9ydCBjbGFzcyBUaHlTaWRlYmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLnRoeS1sYXlvdXQtc2lkZWJhcicpIHRoeUxheW91dFNpZGViYXJDbGFzcyA9IHRydWU7XG5cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLnRoeS1sYXlvdXQtc2lkZWJhci0tY2xlYXItYm9yZGVyLXJpZ2h0JykgdGh5TGF5b3V0U2lkZWJhckNsZWFyQm9yZGVyUmlnaHRDbGFzcyA9IGZhbHNlO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aC5weCcpIHRoeUxheW91dFNpZGViYXJXaWR0aDogbnVtYmVyO1xuICAgIEBIb3N0QmluZGluZygnc3R5bGUucG9pbnRlci1ldmVudHMnKSB0aHlMYXlvdXRTaWRlYmFyUG9pbnRlckV2ZW50czogc3RyaW5nO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy50aHktbGF5b3V0LXNpZGViYXItaXNvbGF0ZWQnKSBzaWRlYmFySXNvbGF0ZWQgPSBmYWxzZTtcblxuICAgIEBJbnB1dCgndGh5V2lkdGgnKVxuICAgIHNldCB0aHlXaWR0aCh2YWx1ZTogYW55KSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gJ2xnJykge1xuICAgICAgICAgICAgdmFsdWUgPSBMR19XSURUSDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRoeUxheW91dFNpZGViYXJXaWR0aCA9IHZhbHVlO1xuICAgICAgICB0aGlzLndpZHRoUGFzc2l2ZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgndGh5SGFzQm9yZGVyUmlnaHQnKVxuICAgIHNldCB0aHlIYXNCb3JkZXJSaWdodCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudGh5TGF5b3V0U2lkZWJhckNsZWFyQm9yZGVyUmlnaHRDbGFzcyA9ICFjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgIH1cblxuICAgIEBJbnB1dCgndGh5SXNvbGF0ZWQnKVxuICAgIHNldCB0aHlJc29sYXRlZCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2lkZWJhcklzb2xhdGVkID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ3RoeUlzRHJhZ2dhYmxlV2lkdGgnKVxuICAgIHNldCB0aHlJc0RyYWdnYWJsZVdpZHRoKHZhbHVlOiBhbnkpIHtcbiAgICAgICAgaWYgKGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudGh5TGF5b3V0U2lkZWJhclBvaW50ZXJFdmVudHMgPSAnYWxsJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBWaWV3Q2hpbGQoJ2RyYWdSZWYnLCB7IHN0YXRpYzogdHJ1ZSB9KSBkcmFnUmVmOiBhbnk7XG5cbiAgICBkcmFnU3RhcnRlZFg6IG51bWJlcjtcblxuICAgIHdpZHRoUGFzc2l2ZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBPcHRpb25hbCgpIEBIb3N0KCkgcHJpdmF0ZSB0aHlMYXlvdXRDb21wb25lbnQ6IFRoeUxheW91dENvbXBvbmVudCxcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmVcbiAgICApIHt9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMudGh5TGF5b3V0Q29tcG9uZW50KSB7XG4gICAgICAgICAgICB0aGlzLnRoeUxheW91dENvbXBvbmVudC5oYXNTaWRlYmFyID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndpZHRoUGFzc2l2ZSA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5kcmFnUmVmLm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgdGhpcy5udW1iZXJDb252ZXJ0VG9GbG9vcih0aGlzLndpZHRoUGFzc2l2ZSkgKyAncHgnKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBkcmFnU3RhcnRlZEhhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMuZHJhZ1N0YXJ0ZWRYID0gdGhpcy5kcmFnUmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueDtcbiAgICB9XG5cbiAgICBkcmFnRW5kZWRIYW5kbGVyKCkge1xuICAgICAgICBjb25zdCB4ID0gdGhpcy5kcmFnUmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueDtcbiAgICAgICAgdGhpcy53aWR0aFBhc3NpdmUgPSB0aGlzLm51bWJlckNvbnZlcnRUb0Zsb29yKHRoaXMud2lkdGhQYXNzaXZlICogMSArICh4IC0gdGhpcy5kcmFnU3RhcnRlZFgpKTtcbiAgICAgICAgdGhpcy50aHlMYXlvdXRTaWRlYmFyV2lkdGggPSB0aGlzLndpZHRoUGFzc2l2ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG51bWJlckNvbnZlcnRUb0Zsb29yKHZhbHVlOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IE1hdGguZmxvb3IoKHZhbHVlIGFzIGFueSkgKiAxKTtcbiAgICAgICAgaWYgKHJlc3VsdCA8IDEpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG4iXX0=