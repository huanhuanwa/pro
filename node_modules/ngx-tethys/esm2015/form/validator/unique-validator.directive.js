import { NG_ASYNC_VALIDATORS } from '@angular/forms';
import { Directive, Input, Optional, ElementRef } from '@angular/core';
import { of } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { ThyFormDirective } from '../form.directive';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../form.directive';
export class ThyUniqueCheckValidator {
    constructor(elementRef, thyForm) {
        this.elementRef = elementRef;
        this.thyForm = thyForm;
    }
    validate(ctrl) {
        return this.thyUniqueCheck(ctrl.value).pipe(map((failed) => {
            setTimeout(() => {
                if (failed && this.thyForm && this.elementRef.nativeElement.name) {
                    this.thyForm.validator.validateControl(this.elementRef.nativeElement.name);
                }
            });
            return failed ? { thyUniqueCheck: failed } : null;
        }), catchError(() => of(null)));
    }
}
ThyUniqueCheckValidator.ɵfac = function ThyUniqueCheckValidator_Factory(t) { return new (t || ThyUniqueCheckValidator)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ThyFormDirective, 8)); };
ThyUniqueCheckValidator.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ThyUniqueCheckValidator, selectors: [["", "thyUniqueCheck", ""]], inputs: { thyUniqueCheck: "thyUniqueCheck" }, features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: NG_ASYNC_VALIDATORS,
                useExisting: ThyUniqueCheckValidator,
                multi: true
            }
        ])] });
ThyUniqueCheckValidator.ctorParameters = () => [
    { type: ElementRef },
    { type: ThyFormDirective, decorators: [{ type: Optional }] }
];
ThyUniqueCheckValidator.propDecorators = {
    thyUniqueCheck: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyUniqueCheckValidator, [{
        type: Directive,
        args: [{
                selector: '[thyUniqueCheck]',
                providers: [
                    {
                        provide: NG_ASYNC_VALIDATORS,
                        useExisting: ThyUniqueCheckValidator,
                        multi: true
                    }
                ]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.ThyFormDirective, decorators: [{
                type: Optional
            }] }]; }, { thyUniqueCheck: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLXZhbGlkYXRvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mb3JtL3ZhbGlkYXRvci91bmlxdWUtdmFsaWRhdG9yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQXFELG1CQUFtQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEcsT0FBTyxFQUFjLFNBQVMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRixPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFPLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7OztBQVlyRCxNQUFNLE9BQU8sdUJBQXVCO0FBQUcsSUFHbkMsWUFBb0IsVUFBc0IsRUFBc0IsT0FBeUI7QUFBSSxRQUF6RSxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFBcUIsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7QUFBQyxJQUFFLENBQUM7QUFDakcsSUFDSSxRQUFRLENBQUMsSUFBcUI7QUFBSSxRQUM5QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FDdkMsR0FBRyxDQUFDLENBQUMsTUFBZSxFQUFFLEVBQUU7QUFDcEMsWUFBZ0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtBQUNoQyxnQkFBb0IsSUFBSSxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUU7QUFDdEYsb0JBQXdCLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNuRyxpQkFBcUI7QUFDckIsWUFBZ0IsQ0FBQyxDQUFDLENBQUM7QUFDbkIsWUFBZ0IsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDbEUsUUFBWSxDQUFDLENBQUMsRUFDRixVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQzdCLENBQUM7QUFDVixJQUFJLENBQUM7QUFDTDttREE1QkMsU0FBUyxTQUFDLGtCQUNQLFFBQVEsRUFBRSxrQkFBa0Isa0JBQzVCLFNBQVMsRUFBRSxzQkFDUCwwQkFDSSxPQUFPLEVBQUUsbUJBQW1CO3dCQUM1QixXQUFXLEVBQUUsdUJBQXVCLDBCQUNwQyxLQUFLLEVBQUUsSUFBSSxzQkFDZCxrQkFDSixjQUNKOzs7Ozs7ZUFDSTtBQUFDO0FBQWlELFlBZk4sVUFBVTtBQUFJLFlBR3RELGdCQUFnQix1QkFld0IsUUFBUTtBQUFNO0FBQUc7QUFFeEQsNkJBSkwsS0FBSztBQUFJOzs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNWYWxpZGF0b3IsIEFic3RyYWN0Q29udHJvbCwgVmFsaWRhdGlvbkVycm9ycywgTkdfQVNZTkNfVkFMSURBVE9SUyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEluamVjdGFibGUsIERpcmVjdGl2ZSwgSW5wdXQsIE9wdGlvbmFsLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBUaHlGb3JtRGlyZWN0aXZlIH0gZnJvbSAnLi4vZm9ybS5kaXJlY3RpdmUnO1xuXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvcjogJ1t0aHlVbmlxdWVDaGVja10nLFxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBOR19BU1lOQ19WQUxJREFUT1JTLFxuICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IFRoeVVuaXF1ZUNoZWNrVmFsaWRhdG9yLFxuICAgICAgICAgICAgbXVsdGk6IHRydWVcbiAgICAgICAgfVxuICAgIF1cbn0pXG5leHBvcnQgY2xhc3MgVGh5VW5pcXVlQ2hlY2tWYWxpZGF0b3IgaW1wbGVtZW50cyBBc3luY1ZhbGlkYXRvciB7XG4gICAgQElucHV0KCkgdGh5VW5pcXVlQ2hlY2s6ICh2YWx1ZTogYW55KSA9PiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIHRoeUZvcm06IFRoeUZvcm1EaXJlY3RpdmUpIHt9XG5cbiAgICB2YWxpZGF0ZShjdHJsOiBBYnN0cmFjdENvbnRyb2wpOiBQcm9taXNlPFZhbGlkYXRpb25FcnJvcnMgfCBudWxsPiB8IE9ic2VydmFibGU8VmFsaWRhdGlvbkVycm9ycyB8IG51bGw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGh5VW5pcXVlQ2hlY2soY3RybC52YWx1ZSkucGlwZShcbiAgICAgICAgICAgIG1hcCgoZmFpbGVkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgJiYgdGhpcy50aHlGb3JtICYmIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGh5Rm9ybS52YWxpZGF0b3IudmFsaWRhdGVDb250cm9sKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWxlZCA/IHsgdGh5VW5pcXVlQ2hlY2s6IGZhaWxlZCB9IDogbnVsbDtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiBvZihudWxsKSlcbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=