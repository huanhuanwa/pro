import { Injectable, ElementRef, NgZone } from '@angular/core';
import { isNumber } from 'ngx-tethys/util';
import * as i0 from "@angular/core";
export var PlacementTypes;
(function (PlacementTypes) {
    PlacementTypes["left"] = "left";
    PlacementTypes["right"] = "right";
    PlacementTypes["center"] = "center";
    PlacementTypes["top"] = "top";
    PlacementTypes["bottom"] = "bottom";
})(PlacementTypes || (PlacementTypes = {}));
export const defaultPositioningOptions = {
    offset: 10,
    appendToBody: true,
    placement: 'bottom center'
};
export class ThyPositioningService {
    constructor(ngZone) {
        this.ngZone = ngZone;
    }
    static getHTMLElement(element) {
        // it means that we got a selector
        if (typeof element === 'string') {
            return document.querySelector(element);
        }
        if (element instanceof ElementRef) {
            return element.nativeElement;
        }
        return element;
    }
    autoPosition(targetElPosition, hostElPosition, targetElement, preferredPosition) {
        if ((!preferredPosition || preferredPosition === 'right') &&
            targetElPosition.left + hostElPosition.left - targetElement.offsetWidth < 0) {
            return 'right';
        }
        else if ((!preferredPosition || preferredPosition === 'top') &&
            targetElPosition.bottom + hostElPosition.bottom + targetElement.offsetHeight > window.innerHeight) {
            return 'top';
        }
        else if ((!preferredPosition || preferredPosition === 'bottom') &&
            targetElPosition.top + hostElPosition.top - targetElement.offsetHeight < 0) {
            return 'bottom';
        }
        else if ((!preferredPosition || preferredPosition === 'left') &&
            targetElPosition.right + hostElPosition.right + targetElement.offsetWidth > window.innerWidth) {
            return 'left';
        }
        return null;
    }
    getAllStyles(element) {
        return window.getComputedStyle(element);
    }
    getStyle(element, prop) {
        return this.getAllStyles(element)[prop];
    }
    isStaticPositioned(element) {
        return (this.getStyle(element, 'position') || 'static') === 'static';
    }
    offsetParent(element) {
        let offsetParentEl = element.offsetParent || document.documentElement;
        while (offsetParentEl && offsetParentEl !== document.documentElement && this.isStaticPositioned(offsetParentEl)) {
            offsetParentEl = offsetParentEl.offsetParent;
        }
        return offsetParentEl || document.documentElement;
    }
    calculateTopBottomPosition(placementSecondary, attachElPosition, targetElPosition, offset) {
        const documentClientHeight = document.documentElement.clientHeight;
        if (placementSecondary === PlacementTypes.top) {
            targetElPosition.top = attachElPosition.top;
            targetElPosition.bottom = null;
            // Top 对齐时，下面的内容超过了整个屏幕的高度, 为了可以看见全部内容，牺牲 Top 对齐
            if (targetElPosition.top + targetElPosition.height > documentClientHeight) {
                targetElPosition.top = documentClientHeight - targetElPosition.height;
            }
        }
        else if (placementSecondary === PlacementTypes.bottom) {
            targetElPosition.bottom = documentClientHeight - attachElPosition.top - attachElPosition.height;
            targetElPosition.top = null;
            // Bottom 对齐时，上面的内容超过了整个屏幕的高度，为了可以看见全部内容，牺牲 Bottom 对齐
            if (targetElPosition.bottom + targetElPosition.height > documentClientHeight) {
                targetElPosition.bottom = documentClientHeight - targetElPosition.height;
            }
        }
        else {
            targetElPosition.top = attachElPosition.top + attachElPosition.height / 2 - targetElPosition.height / 2;
            // 顶部的内容被遮挡，牺牲居中，让顶部侧内容可见
            if (targetElPosition.top < 0) {
                targetElPosition.top = offset;
            }
            else if (targetElPosition.top + targetElPosition.height > documentClientHeight) {
                // 下面的内容被遮挡，牺牲居中，让下方的内容可见
                targetElPosition.top = documentClientHeight - targetElPosition.height + offset;
            }
            targetElPosition.bottom = null;
        }
        return targetElPosition;
    }
    calculateLeftRightPosition(placementSecondary, attachElPosition, targetElPosition, offset) {
        const documentClientWidth = document.documentElement.clientWidth;
        if (placementSecondary === PlacementTypes.right) {
            targetElPosition.right = document.documentElement.clientWidth - attachElPosition.left - attachElPosition.width;
            targetElPosition.left = null;
            // 右对齐时，左侧的内容超过了整个屏幕的宽度, 为了可以看见全部内容，牺牲右对齐
            if (targetElPosition.right + targetElPosition.width > documentClientWidth) {
                targetElPosition.right = documentClientWidth - targetElPosition.width - offset;
            }
        }
        else if (placementSecondary === PlacementTypes.left) {
            targetElPosition.left = attachElPosition.left;
            // 左对齐时，右侧的内容超过了整个屏幕的宽度, 为了可以看见全部内容，牺牲左对齐
            if (targetElPosition.left + targetElPosition.width > documentClientWidth) {
                targetElPosition.left = documentClientWidth - targetElPosition.width - offset;
            }
        }
        else {
            targetElPosition.left = attachElPosition.left + attachElPosition.width / 2 - targetElPosition.width / 2;
            // 左侧的内容被遮挡，牺牲居中，让左侧内容可见
            if (targetElPosition.left < 0) {
                targetElPosition.left = offset;
            }
            else if (targetElPosition.left + targetElPosition.width > documentClientWidth) {
                // 右侧的内容被遮挡，牺牲居中，让右侧内容可见
                targetElPosition.left = documentClientWidth - targetElPosition.width - offset;
            }
        }
        return targetElPosition;
    }
    autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt = true) {
        if (!autoAdapt) {
            return;
        }
        const documentClientHeight = document.documentElement.clientHeight;
        if (placementPrimary === 'top') {
            // 如果 Top 空间不够，则自动适应 Bottom Top 和 Bottom 空间都不够，默认为可视区域Top
            if (hostElPosition.originBottom - hostElPosition.height - targetElPosition.height < 0) {
                if (documentClientHeight - hostElPosition.originBottom >= targetElPosition.height) {
                    targetElPosition.bottom = targetElPosition.bottom - targetElPosition.height - hostElPosition.height - offset;
                }
                else {
                    targetElPosition.bottom = null;
                    targetElPosition.top = hostElPosition.top - hostElPosition.originTop;
                }
            }
        }
        if (placementPrimary === 'bottom') {
            // 如果 Bottom 空间不够，则自动适应 Top，如果 Bottom 和 Top 空间都不够，默认为可视区域Top
            if (hostElPosition.originBottom + targetElPosition.height > documentClientHeight) {
                const newTop = hostElPosition.top - targetElPosition.height - offset;
                if (newTop > hostElPosition.top - hostElPosition.originTop) {
                    targetElPosition.top = newTop;
                }
                else {
                    targetElPosition.top = hostElPosition.top - hostElPosition.originTop;
                }
            }
        }
    }
    position(element, round = true) {
        let elPosition;
        let parentOffset = {
            width: 0,
            height: 0,
            top: 0,
            bottom: 0,
            left: 0,
            right: 0
        };
        if (this.getStyle(element, 'position') === 'fixed') {
            const bcRect = element.getBoundingClientRect();
            elPosition = {
                width: bcRect.width,
                height: bcRect.height,
                top: bcRect.top,
                bottom: bcRect.bottom,
                left: bcRect.left,
                right: bcRect.right,
                originTop: bcRect.top,
                originBottom: bcRect.bottom,
                originLeft: bcRect.left,
                originRight: bcRect.right
            };
        }
        else {
            const offsetParentEl = this.offsetParent(element);
            elPosition = this.offset(element, false);
            if (offsetParentEl !== document.documentElement) {
                parentOffset = this.offset(offsetParentEl, false);
            }
            parentOffset.top += offsetParentEl.clientTop;
            parentOffset.left += offsetParentEl.clientLeft;
        }
        elPosition.top -= parentOffset.top;
        elPosition.bottom -= parentOffset.top;
        elPosition.left -= parentOffset.left;
        elPosition.right -= parentOffset.left;
        if (round) {
            elPosition.top = Math.round(elPosition.top);
            elPosition.bottom = Math.round(elPosition.bottom);
            elPosition.left = Math.round(elPosition.left);
            elPosition.right = Math.round(elPosition.right);
        }
        return elPosition;
    }
    offset(element, round = true) {
        const elBcr = element.getBoundingClientRect();
        const viewportOffset = {
            top: window.pageYOffset - document.documentElement.clientTop,
            left: window.pageXOffset - document.documentElement.clientLeft
        };
        const elOffset = {
            height: elBcr.height || element.offsetHeight,
            width: elBcr.width || element.offsetWidth,
            top: elBcr.top + viewportOffset.top,
            bottom: elBcr.bottom + viewportOffset.top,
            left: elBcr.left + viewportOffset.left,
            right: elBcr.right + viewportOffset.left,
            originTop: elBcr.top,
            originBottom: elBcr.bottom,
            originLeft: elBcr.left,
            originRight: elBcr.right
        };
        if (round) {
            elOffset.height = Math.round(elOffset.height);
            elOffset.width = Math.round(elOffset.width);
            elOffset.top = Math.round(elOffset.top);
            elOffset.bottom = Math.round(elOffset.bottom);
            elOffset.left = Math.round(elOffset.left);
            elOffset.right = Math.round(elOffset.right);
        }
        return elOffset;
    }
    /**
     * 计算弹出层的位置
     * @param hostElement 被追加的元素
     * @param targetElement 弹出层内元素
     * @param options 参数
     */
    calculatePosition(hostElement, targetElement, options) {
        const { placement, appendToBody, offset, position, autoAdapt } = options;
        let hostElPosition = null;
        // 外部传入已经算好的位置, 需要设置 hostElPosition 宽度和高度为 0，不计算位置，主要使用于右击弹出位置计算
        if (position) {
            hostElPosition = {
                top: position.top || 0,
                left: position.left || 0,
                bottom: 0,
                right: 0,
                width: 0,
                height: 0
            };
        }
        else {
            hostElPosition = appendToBody ? this.offset(hostElement, false) : this.position(hostElement, false);
        }
        const targetElStyles = this.getAllStyles(targetElement);
        const documentClientWidth = document.documentElement.clientWidth;
        const documentClientHeight = document.documentElement.clientHeight;
        let placementPrimary = placement.split(' ')[0] || 'top';
        const placementSecondary = placement.split(' ')[1] || 'center';
        const targetElBCR = targetElement.getBoundingClientRect();
        const targetElPosition = {
            height: targetElBCR.height || targetElement.offsetHeight,
            width: targetElBCR.width || targetElement.offsetWidth,
            top: null,
            bottom: null,
            left: null,
            right: null,
            originTop: targetElBCR.top,
            originBottom: targetElBCR.bottom,
            originLeft: targetElBCR.left,
            originRight: targetElBCR.right
        };
        if (placementPrimary === 'auto') {
            let newPlacementPrimary = this.autoPosition(targetElPosition, hostElPosition, targetElement, placementSecondary);
            if (!newPlacementPrimary) {
                newPlacementPrimary = this.autoPosition(targetElPosition, hostElPosition, targetElement);
            }
            if (newPlacementPrimary) {
                placementPrimary = newPlacementPrimary;
            }
            targetElement.classList.add(placementPrimary);
        }
        switch (placementPrimary) {
            case 'top':
                targetElPosition.bottom = documentClientHeight - hostElPosition.top + offset;
                targetElPosition.top = null;
                this.autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt);
                this.calculateLeftRightPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'bottom':
                targetElPosition.top = hostElPosition.top + hostElPosition.height + offset;
                this.autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt);
                this.calculateLeftRightPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'left':
                targetElPosition.right = documentClientWidth - hostElPosition.left + offset;
                targetElPosition.left = null;
                this.calculateTopBottomPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'right':
                targetElPosition.left = hostElPosition.left + hostElPosition.width + offset;
                targetElPosition.right = null;
                this.calculateTopBottomPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
        }
        // targetElPosition.top = Math.round(targetElPosition.top);
        // targetElPosition.bottom = Math.round(targetElPosition.bottom);
        // targetElPosition.left = Math.round(targetElPosition.left);
        // targetElPosition.right = Math.round(targetElPosition.right);
        return targetElPosition;
    }
    setPosition(options) {
        const { attach, target } = options;
        const attachElement = ThyPositioningService.getHTMLElement(attach);
        const targetElement = ThyPositioningService.getHTMLElement(target);
        setTimeout(() => {
            this.ngZone.runOutsideAngular(() => {
                const pos = this.calculatePosition(attachElement, targetElement, options);
                if (isNumber(pos.top)) {
                    targetElement.style.top = `${pos.top}px`;
                }
                else if (isNumber(pos.bottom)) {
                    targetElement.style.bottom = `${pos.bottom}px`;
                }
                if (isNumber(pos.left)) {
                    targetElement.style.left = `${pos.left}px`;
                }
                else if (isNumber(pos.right)) {
                    targetElement.style.right = `${pos.right}px`;
                }
            });
        });
    }
}
ThyPositioningService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ThyPositioningService_Factory() { return new ThyPositioningService(i0.ɵɵinject(i0.NgZone)); }, token: ThyPositioningService, providedIn: "root" });
ThyPositioningService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
ThyPositioningService.ctorParameters = () => [
    { type: NgZone }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb25pbmcuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3NpdGlvbmluZy9wb3NpdGlvbmluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7O0FBRzNDLE1BQU0sQ0FBTixJQUFZLGNBTVg7QUFORCxXQUFZLGNBQWM7SUFDdEIsK0JBQWEsQ0FBQTtJQUNiLGlDQUFlLENBQUE7SUFDZixtQ0FBaUIsQ0FBQTtJQUNqQiw2QkFBVyxDQUFBO0lBQ1gsbUNBQWlCLENBQUE7QUFDckIsQ0FBQyxFQU5XLGNBQWMsS0FBZCxjQUFjLFFBTXpCO0FBb0NELE1BQU0sQ0FBQyxNQUFNLHlCQUF5QixHQUF1QjtJQUN6RCxNQUFNLEVBQUUsRUFBRTtJQUNWLFlBQVksRUFBRSxJQUFJO0lBQ2xCLFNBQVMsRUFBRSxlQUFlO0NBQzdCLENBQUM7QUFLRixNQUFNLE9BQU8scUJBQXFCO0lBQzlCLFlBQW9CLE1BQWM7UUFBZCxXQUFNLEdBQU4sTUFBTSxDQUFRO0lBQUcsQ0FBQztJQUV0QyxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQTBDO1FBQzVELGtDQUFrQztRQUNsQyxJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsRUFBRTtZQUM3QixPQUFPLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFnQixDQUFDO1NBQ3pEO1FBRUQsSUFBSSxPQUFPLFlBQVksVUFBVSxFQUFFO1lBQy9CLE9BQU8sT0FBTyxDQUFDLGFBQWEsQ0FBQztTQUNoQztRQUVELE9BQU8sT0FBc0IsQ0FBQztJQUNsQyxDQUFDO0lBRU8sWUFBWSxDQUFDLGdCQUE0QixFQUFFLGNBQTBCLEVBQUUsYUFBMEIsRUFBRSxpQkFBMEI7UUFDakksSUFDSSxDQUFDLENB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QUFLLElBQUksQ0FBQztpQkFDaEQ7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7OztZQXpXSixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7OztZQXREZ0MsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEVsZW1lbnRSZWYsIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNOdW1iZXIgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuaW1wb3J0IHsgTmV3Q2xpZW50UmVjdCB9IGZyb20gJy4vY2xpZW50LXJlY3QnO1xuXG5leHBvcnQgZW51bSBQbGFjZW1lbnRUeXBlcyB7XG4gICAgbGVmdCA9ICdsZWZ0JyxcbiAgICByaWdodCA9ICdyaWdodCcsXG4gICAgY2VudGVyID0gJ2NlbnRlcicsXG4gICAgdG9wID0gJ3RvcCcsXG4gICAgYm90dG9tID0gJ2JvdHRvbSdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb3NpdGlvbmluZ09wdGlvbnMge1xuICAgIC8qKiBUaGUgRE9NIGVsZW1lbnQsIEVsZW1lbnRSZWYsIG9yIGEgc2VsZWN0b3Igc3RyaW5nIG9mIGFuIGVsZW1lbnQgd2hpY2ggd2lsbCBiZSBtb3ZlZCAqL1xuICAgIGF0dGFjaD86IEhUTUxFbGVtZW50IHwgRWxlbWVudFJlZiB8IHN0cmluZztcblxuICAgIC8qKiBUaGUgRE9NIGVsZW1lbnQsIEVsZW1lbnRSZWYsIG9yIGEgc2VsZWN0b3Igc3RyaW5nIG9mIGFuIGVsZW1lbnQgd2hpY2ggdGhlIGVsZW1lbnQgd2lsbCBiZSBhdHRhY2hlZCB0byAgKi9cbiAgICB0YXJnZXQ/OiBIVE1MRWxlbWVudCB8IEVsZW1lbnRSZWYgfCBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBBIHN0cmluZyBvZiB0aGUgZm9ybSAndmVydC1hdHRhY2htZW50IGhvcml6LWF0dGFjaG1lbnQnIG9yICdwbGFjZW1lbnQnXG4gICAgICogLSBwbGFjZW1lbnQgY2FuIGJlIFwidG9wXCIsIFwiYm90dG9tXCIsIFwibGVmdFwiLCBcInJpZ2h0XCJcbiAgICAgKiBub3QgeWV0IHN1cHBvcnRlZDpcbiAgICAgKiAtIHZlcnQtYXR0YWNobWVudCBjYW4gYmUgYW55IG9mICd0b3AnLCAnbWlkZGxlJywgJ2JvdHRvbSdcbiAgICAgKiAtIGhvcml6LWF0dGFjaG1lbnQgY2FuIGJlIGFueSBvZiAnbGVmdCcsICdjZW50ZXInLCAncmlnaHQnXG4gICAgICovXG4gICAgcGxhY2VtZW50Pzogc3RyaW5nO1xuXG4gICAgLy8g55u05o6l5Lyg5YWl5L2N572u77yM5LiN55So5qC55o2uIGF0dGFjaG1lbnQgdGFyZ2V0IOiuoeeul++8jOWPs+WHu+iPnOWNleS9v+eUqFxuICAgIHBvc2l0aW9uPzoge1xuICAgICAgICB0b3A6IG51bWJlcjtcbiAgICAgICAgbGVmdDogbnVtYmVyO1xuICAgIH07XG5cbiAgICAvKiogQSBzdHJpbmcgb2YgdGhlIGZvcm0gJ3ZlcnQtb2Zmc2V0IGhvcml6LW9mZnNldCdcbiAgICAgKiAtIHZlcnQtb2Zmc2V0IGFuZCBob3Jpei1vZmZzZXQgY2FuIGJlIG9mIHRoZSBmb3JtIFwiMjBweFwiIG9yIFwiNTUlXCJcbiAgICAgKi9cbiAgICBvZmZzZXQ/OiBudW1iZXI7XG5cbiAgICAvKiogSWYgdHJ1ZSBjb21wb25lbnQgd2lsbCBiZSBhdHRhY2hlZCB0byBib2R5ICovXG4gICAgYXBwZW5kVG9Cb2R5PzogYm9vbGVhbjtcblxuICAgIC8qKiBJZiB0cnVlIGNvbXBvbmVudCBhdXRvIGFkYXB0IHRvcCBvciBib3R0b20gKi9cbiAgICBhdXRvQWRhcHQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgZGVmYXVsdFBvc2l0aW9uaW5nT3B0aW9uczogUG9zaXRpb25pbmdPcHRpb25zID0ge1xuICAgIG9mZnNldDogMTAsXG4gICAgYXBwZW5kVG9Cb2R5OiB0cnVlLFxuICAgIHBsYWNlbWVudDogJ2JvdHRvbSBjZW50ZXInXG59O1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFRoeVBvc2l0aW9uaW5nU2VydmljZSB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge31cblxuICAgIHN0YXRpYyBnZXRIVE1MRWxlbWVudChlbGVtZW50OiBIVE1MRWxlbWVudCB8IEVsZW1lbnRSZWYgfCBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgIC8vIGl0IG1lYW5zIHRoYXQgd2UgZ290IGEgc2VsZWN0b3JcbiAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGF1dG9Qb3NpdGlvbih0YXJnZXRFbFBvc2l0aW9uOiBDbGllbnRSZWN0LCBob3N0RWxQb3NpdGlvbjogQ2xpZW50UmVjdCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsIHByZWZlcnJlZFBvc2l0aW9uPzogc3RyaW5nKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgICghcHJlZmVycmVkUG9zaXRpb24gfHwgcHJlZmVycmVkUG9zaXRpb24gPT09ICdyaWdodCcpICYmXG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgKyBob3N0RWxQb3NpdGlvbi5sZWZ0IC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCA8IDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3JpZ2h0JztcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICghcHJlZmVycmVkUG9zaXRpb24gfHwgcHJlZmVycmVkUG9zaXRpb24gPT09ICd0b3AnKSAmJlxuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gKyBob3N0RWxQb3NpdGlvbi5ib3R0b20gKyB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA+IHdpbmRvdy5pbm5lckhlaWdodFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiAndG9wJztcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICghcHJlZmVycmVkUG9zaXRpb24gfHwgcHJlZmVycmVkUG9zaXRpb24gPT09ICdib3R0b20nKSAmJlxuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgKyBob3N0RWxQb3NpdGlvbi50b3AgLSB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA8IDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2JvdHRvbSc7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAoIXByZWZlcnJlZFBvc2l0aW9uIHx8IHByZWZlcnJlZFBvc2l0aW9uID09PSAnbGVmdCcpICYmXG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ICsgaG9zdEVsUG9zaXRpb24ucmlnaHQgKyB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoID4gd2luZG93LmlubmVyV2lkdGhcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2xlZnQnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QWxsU3R5bGVzKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFN0eWxlKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBwcm9wOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gKHRoaXMuZ2V0QWxsU3R5bGVzKGVsZW1lbnQpIGFzIGFueSlbcHJvcF07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1N0YXRpY1Bvc2l0aW9uZWQoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpIHx8ICdzdGF0aWMnKSA9PT0gJ3N0YXRpYyc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvZmZzZXRQYXJlbnQoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgIGxldCBvZmZzZXRQYXJlbnRFbCA9IDxIVE1MRWxlbWVudD5lbGVtZW50Lm9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICAgICAgd2hpbGUgKG9mZnNldFBhcmVudEVsICYmIG9mZnNldFBhcmVudEVsICE9PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgdGhpcy5pc1N0YXRpY1Bvc2l0aW9uZWQob2Zmc2V0UGFyZW50RWwpKSB7XG4gICAgICAgICAgICBvZmZzZXRQYXJlbnRFbCA9IDxIVE1MRWxlbWVudD5vZmZzZXRQYXJlbnRFbC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb2Zmc2V0UGFyZW50RWwgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY3VsYXRlVG9wQm90dG9tUG9zaXRpb24oXG4gICAgICAgIHBsYWNlbWVudFNlY29uZGFyeTogc3RyaW5nLFxuICAgICAgICBhdHRhY2hFbFBvc2l0aW9uOiBDbGllbnRSZWN0LFxuICAgICAgICB0YXJnZXRFbFBvc2l0aW9uOiBDbGllbnRSZWN0LFxuICAgICAgICBvZmZzZXQ6IG51bWJlclxuICAgICk6IENsaWVudFJlY3Qge1xuICAgICAgICBjb25zdCBkb2N1bWVudENsaWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgIGlmIChwbGFjZW1lbnRTZWNvbmRhcnkgPT09IFBsYWNlbWVudFR5cGVzLnRvcCkge1xuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBhdHRhY2hFbFBvc2l0aW9uLnRvcDtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gbnVsbDtcbiAgICAgICAgICAgIC8vIFRvcCDlr7npvZDml7bvvIzkuIvpnaLnmoTlhoXlrrnotoXov4fkuobmlbTkuKrlsY/luZXnmoTpq5jluqYsIOS4uuS6huWPr+S7peeci+ingeWFqOmDqOWGheWuue+8jOeJuueJsiBUb3Ag5a+56b2QXG4gICAgICAgICAgICBpZiAodGFyZ2V0RWxQb3NpdGlvbi50b3AgKyB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCA+IGRvY3VtZW50Q2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBkb2N1bWVudENsaWVudEhlaWdodCAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBsYWNlbWVudFNlY29uZGFyeSA9PT0gUGxhY2VtZW50VHlwZXMuYm90dG9tKSB7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSA9IGRvY3VtZW50Q2xpZW50SGVpZ2h0IC0gYXR0YWNoRWxQb3NpdGlvbi50b3AgLSBhdHRhY2hFbFBvc2l0aW9uLmhlaWdodDtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24udG9wID0gbnVsbDtcbiAgICAgICAgICAgIC8vIEJvdHRvbSDlr7npvZDml7bvvIzkuIrpnaLnmoTlhoXlrrnotoXov4fkuobmlbTkuKrlsY/luZXnmoTpq5jluqbvvIzkuLrkuoblj6/ku6XnnIvop4Hlhajpg6jlhoXlrrnvvIznibrnibIgQm90dG9tIOWvuem9kFxuICAgICAgICAgICAgaWYgKHRhcmdldEVsUG9zaXRpb24uYm90dG9tICsgdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgPiBkb2N1bWVudENsaWVudEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gZG9jdW1lbnRDbGllbnRIZWlnaHQgLSB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24udG9wID0gYXR0YWNoRWxQb3NpdGlvbi50b3AgKyBhdHRhY2hFbFBvc2l0aW9uLmhlaWdodCAvIDIgLSB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCAvIDI7XG4gICAgICAgICAgICAvLyDpobbpg6jnmoTlhoXlrrnooqvpga7mjKHvvIznibrnibLlsYXkuK3vvIzorqnpobbpg6jkvqflhoXlrrnlj6/op4FcbiAgICAgICAgICAgIGlmICh0YXJnZXRFbFBvc2l0aW9uLnRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IG9mZnNldDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0RWxQb3NpdGlvbi50b3AgKyB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCA+IGRvY3VtZW50Q2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgLy8g5LiL6Z2i55qE5YaF5a656KKr6YGu5oyh77yM54m654my5bGF5Lit77yM6K6p5LiL5pa555qE5YaF5a655Y+v6KeBXG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBkb2N1bWVudENsaWVudEhlaWdodCAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0ICsgb2Zmc2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YXJnZXRFbFBvc2l0aW9uO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY3VsYXRlTGVmdFJpZ2h0UG9zaXRpb24oXG4gICAgICAgIHBsYWNlbWVudFNlY29uZGFyeTogc3RyaW5nLFxuICAgICAgICBhdHRhY2hFbFBvc2l0aW9uOiBDbGllbnRSZWN0LFxuICAgICAgICB0YXJnZXRFbFBvc2l0aW9uOiBDbGllbnRSZWN0LFxuICAgICAgICBvZmZzZXQ6IG51bWJlclxuICAgICk6IENsaWVudFJlY3Qge1xuICAgICAgICBjb25zdCBkb2N1bWVudENsaWVudFdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgICBpZiAocGxhY2VtZW50U2Vjb25kYXJ5ID09PSBQbGFjZW1lbnRUeXBlcy5yaWdodCkge1xuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5yaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIGF0dGFjaEVsUG9zaXRpb24ubGVmdCAtIGF0dGFjaEVsUG9zaXRpb24ud2lkdGg7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBudWxsO1xuICAgICAgICAgICAgLy8g5Y+z5a+56b2Q5pe277yM5bem5L6n55qE5YaF5a656LaF6L+H5LqG5pW05Liq5bGP5bmV55qE5a695bqmLCDkuLrkuoblj6/ku6XnnIvop4Hlhajpg6jlhoXlrrnvvIznibrnibLlj7Plr7npvZBcbiAgICAgICAgICAgIGlmICh0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ICsgdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCA+IGRvY3VtZW50Q2xpZW50V2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ID0gZG9jdW1lbnRDbGllbnRXaWR0aCAtIHRhcmdldEVsUG9zaXRpb24ud2lkdGggLSBvZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocGxhY2VtZW50U2Vjb25kYXJ5ID09PSBQbGFjZW1lbnRUeXBlcy5sZWZ0KSB7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBhdHRhY2hFbFBvc2l0aW9uLmxlZnQ7XG4gICAgICAgICAgICAvLyDlt6blr7npvZDml7bvvIzlj7PkvqfnmoTlhoXlrrnotoXov4fkuobmlbTkuKrlsY/luZXnmoTlrr3luqYsIOS4uuS6huWPr+S7peeci+ingeWFqOmDqOWGheWuue+8jOeJuueJsuW3puWvuem9kFxuICAgICAgICAgICAgaWYgKHRhcmdldEVsUG9zaXRpb24ubGVmdCArIHRhcmdldEVsUG9zaXRpb24ud2lkdGggPiBkb2N1bWVudENsaWVudFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ID0gZG9jdW1lbnRDbGllbnRXaWR0aCAtIHRhcmdldEVsUG9zaXRpb24ud2lkdGggLSBvZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBhdHRhY2hFbFBvc2l0aW9uLmxlZnQgKyBhdHRhY2hFbFBvc2l0aW9uLndpZHRoIC8gMiAtIHRhcmdldEVsUG9zaXRpb24ud2lkdGggLyAyO1xuICAgICAgICAgICAgLy8g5bem5L6n55qE5YaF5a656KKr6YGu5oyh77yM54m654my5bGF5Lit77yM6K6p5bem5L6n5YaF5a655Y+v6KeBXG4gICAgICAgICAgICBpZiAodGFyZ2V0RWxQb3NpdGlvbi5sZWZ0IDwgMCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IG9mZnNldDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ICsgdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCA+IGRvY3VtZW50Q2xpZW50V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAvLyDlj7PkvqfnmoTlhoXlrrnooqvpga7mjKHvvIznibrnibLlsYXkuK3vvIzorqnlj7PkvqflhoXlrrnlj6/op4FcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBkb2N1bWVudENsaWVudFdpZHRoIC0gdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCAtIG9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0RWxQb3NpdGlvbjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGF1dG9BZGFwdFRvcEJvdHRvbShcbiAgICAgICAgcGxhY2VtZW50UHJpbWFyeTogc3RyaW5nLFxuICAgICAgICBob3N0RWxQb3NpdGlvbjogTmV3Q2xpZW50UmVjdCxcbiAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbjogTmV3Q2xpZW50UmVjdCxcbiAgICAgICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgICAgIGF1dG9BZGFwdCA9IHRydWVcbiAgICApIHtcbiAgICAgICAgaWYgKCFhdXRvQWRhcHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkb2N1bWVudENsaWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgIGlmIChwbGFjZW1lbnRQcmltYXJ5ID09PSAndG9wJykge1xuICAgICAgICAgICAgLy8g5aaC5p6cIFRvcCDnqbrpl7TkuI3lpJ/vvIzliJnoh6rliqjpgILlupQgQm90dG9tIFRvcCDlkowgQm90dG9tIOepuumXtOmDveS4jeWkn++8jOm7mOiupOS4uuWPr+inhuWMuuWfn1RvcFxuICAgICAgICAgICAgaWYgKGhvc3RFbFBvc2l0aW9uLm9yaWdpbkJvdHRvbSAtIGhvc3RFbFBvc2l0aW9uLmhlaWdodCAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudENsaWVudEhlaWdodCAtIGhvc3RFbFBvc2l0aW9uLm9yaWdpbkJvdHRvbSA+PSB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSA9IHRhcmdldEVsUG9zaXRpb24uYm90dG9tIC0gdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgLSBob3N0RWxQb3NpdGlvbi5oZWlnaHQgLSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGhvc3RFbFBvc2l0aW9uLnRvcCAtIGhvc3RFbFBvc2l0aW9uLm9yaWdpblRvcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBsYWNlbWVudFByaW1hcnkgPT09ICdib3R0b20nKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpwgQm90dG9tIOepuumXtOS4jeWkn++8jOWImeiHquWKqOmAguW6lCBUb3DvvIzlpoLmnpwgQm90dG9tIOWSjCBUb3Ag56m66Ze06YO95LiN5aSf77yM6buY6K6k5Li65Y+v6KeG5Yy65Z+fVG9wXG4gICAgICAgICAgICBpZiAoaG9zdEVsUG9zaXRpb24ub3JpZ2luQm90dG9tICsgdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgPiBkb2N1bWVudENsaWVudEhlaWdodCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RvcCA9IGhvc3RFbFBvc2l0aW9uLnRvcCAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0IC0gb2Zmc2V0O1xuICAgICAgICAgICAgICAgIGlmIChuZXdUb3AgPiBob3N0RWxQb3NpdGlvbi50b3AgLSBob3N0RWxQb3NpdGlvbi5vcmlnaW5Ub3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBuZXdUb3A7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBob3N0RWxQb3NpdGlvbi50b3AgLSBob3N0RWxQb3NpdGlvbi5vcmlnaW5Ub3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHBvc2l0aW9uKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCByb3VuZCA9IHRydWUpOiBOZXdDbGllbnRSZWN0IHtcbiAgICAgICAgbGV0IGVsUG9zaXRpb246IE5ld0NsaWVudFJlY3Q7XG4gICAgICAgIGxldCBwYXJlbnRPZmZzZXQ6IE5ld0NsaWVudFJlY3QgPSB7XG4gICAgICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgICAgIGhlaWdodDogMCxcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIGJvdHRvbTogMCxcbiAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICByaWdodDogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09PSAnZml4ZWQnKSB7XG4gICAgICAgICAgICBjb25zdCBiY1JlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgZWxQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogYmNSZWN0LndpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogYmNSZWN0LmhlaWdodCxcbiAgICAgICAgICAgICAgICB0b3A6IGJjUmVjdC50b3AsXG4gICAgICAgICAgICAgICAgYm90dG9tOiBiY1JlY3QuYm90dG9tLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGJjUmVjdC5sZWZ0LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiBiY1JlY3QucmlnaHQsXG4gICAgICAgICAgICAgICAgb3JpZ2luVG9wOiBiY1JlY3QudG9wLFxuICAgICAgICAgICAgICAgIG9yaWdpbkJvdHRvbTogYmNSZWN0LmJvdHRvbSxcbiAgICAgICAgICAgICAgICBvcmlnaW5MZWZ0OiBiY1JlY3QubGVmdCxcbiAgICAgICAgICAgICAgICBvcmlnaW5SaWdodDogYmNSZWN0LnJpZ2h0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0UGFyZW50RWwgPSB0aGlzLm9mZnNldFBhcmVudChlbGVtZW50KTtcblxuICAgICAgICAgICAgZWxQb3NpdGlvbiA9IHRoaXMub2Zmc2V0KGVsZW1lbnQsIGZhbHNlKTtcblxuICAgICAgICAgICAgaWYgKG9mZnNldFBhcmVudEVsICE9PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnRPZmZzZXQgPSB0aGlzLm9mZnNldChvZmZzZXRQYXJlbnRFbCwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYXJlbnRPZmZzZXQudG9wICs9IG9mZnNldFBhcmVudEVsLmNsaWVudFRvcDtcbiAgICAgICAgICAgIHBhcmVudE9mZnNldC5sZWZ0ICs9IG9mZnNldFBhcmVudEVsLmNsaWVudExlZnQ7XG4gICAgICAgIH1cblxuICAgICAgICBlbFBvc2l0aW9uLnRvcCAtPSBwYXJlbnRPZmZzZXQudG9wO1xuICAgICAgICBlbFBvc2l0aW9uLmJvdHRvbSAtPSBwYXJlbnRPZmZzZXQudG9wO1xuICAgICAgICBlbFBvc2l0aW9uLmxlZnQgLT0gcGFyZW50T2Zmc2V0LmxlZnQ7XG4gICAgICAgIGVsUG9zaXRpb24ucmlnaHQgLT0gcGFyZW50T2Zmc2V0LmxlZnQ7XG5cbiAgICAgICAgaWYgKHJvdW5kKSB7XG4gICAgICAgICAgICBlbFBvc2l0aW9uLnRvcCA9IE1hdGgucm91bmQoZWxQb3NpdGlvbi50b3ApO1xuICAgICAgICAgICAgZWxQb3NpdGlvbi5ib3R0b20gPSBNYXRoLnJvdW5kKGVsUG9zaXRpb24uYm90dG9tKTtcbiAgICAgICAgICAgIGVsUG9zaXRpb24ubGVmdCA9IE1hdGgucm91bmQoZWxQb3NpdGlvbi5sZWZ0KTtcbiAgICAgICAgICAgIGVsUG9zaXRpb24ucmlnaHQgPSBNYXRoLnJvdW5kKGVsUG9zaXRpb24ucmlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVsUG9zaXRpb247XG4gICAgfVxuXG4gICAgcHVibGljIG9mZnNldChlbGVtZW50OiBIVE1MRWxlbWVudCwgcm91bmQgPSB0cnVlKTogTmV3Q2xpZW50UmVjdCB7XG4gICAgICAgIGNvbnN0IGVsQmNyID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3Qgdmlld3BvcnRPZmZzZXQgPSB7XG4gICAgICAgICAgICB0b3A6IHdpbmRvdy5wYWdlWU9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AsXG4gICAgICAgICAgICBsZWZ0OiB3aW5kb3cucGFnZVhPZmZzZXQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGVsT2Zmc2V0ID0ge1xuICAgICAgICAgICAgaGVpZ2h0OiBlbEJjci5oZWlnaHQgfHwgZWxlbWVudC5vZmZzZXRIZWlnaHQsXG4gICAgICAgICAgICB3aWR0aDogZWxCY3Iud2lkdGggfHwgZWxlbWVudC5vZmZzZXRXaWR0aCxcbiAgICAgICAgICAgIHRvcDogZWxCY3IudG9wICsgdmlld3BvcnRPZmZzZXQudG9wLFxuICAgICAgICAgICAgYm90dG9tOiBlbEJjci5ib3R0b20gKyB2aWV3cG9ydE9mZnNldC50b3AsXG4gICAgICAgICAgICBsZWZ0OiBlbEJjci5sZWZ0ICsgdmlld3BvcnRPZmZzZXQubGVmdCxcbiAgICAgICAgICAgIHJpZ2h0OiBlbEJjci5yaWdodCArIHZpZXdwb3J0T2Zmc2V0LmxlZnQsXG4gICAgICAgICAgICBvcmlnaW5Ub3A6IGVsQmNyLnRvcCxcbiAgICAgICAgICAgIG9yaWdpbkJvdHRvbTogZWxCY3IuYm90dG9tLFxuICAgICAgICAgICAgb3JpZ2luTGVmdDogZWxCY3IubGVmdCxcbiAgICAgICAgICAgIG9yaWdpblJpZ2h0OiBlbEJjci5yaWdodFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChyb3VuZCkge1xuICAgICAgICAgICAgZWxPZmZzZXQuaGVpZ2h0ID0gTWF0aC5yb3VuZChlbE9mZnNldC5oZWlnaHQpO1xuICAgICAgICAgICAgZWxPZmZzZXQud2lkdGggPSBNYXRoLnJvdW5kKGVsT2Zmc2V0LndpZHRoKTtcbiAgICAgICAgICAgIGVsT2Zmc2V0LnRvcCA9IE1hdGgucm91bmQoZWxPZmZzZXQudG9wKTtcbiAgICAgICAgICAgIGVsT2Zmc2V0LmJvdHRvbSA9IE1hdGgucm91bmQoZWxPZmZzZXQuYm90dG9tKTtcbiAgICAgICAgICAgIGVsT2Zmc2V0LmxlZnQgPSBNYXRoLnJvdW5kKGVsT2Zmc2V0LmxlZnQpO1xuICAgICAgICAgICAgZWxPZmZzZXQucmlnaHQgPSBNYXRoLnJvdW5kKGVsT2Zmc2V0LnJpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbE9mZnNldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDorqHnrpflvLnlh7rlsYLnmoTkvY3nva5cbiAgICAgKiBAcGFyYW0gaG9zdEVsZW1lbnQg6KKr6L+95Yqg55qE5YWD57SgXG4gICAgICogQHBhcmFtIHRhcmdldEVsZW1lbnQg5by55Ye65bGC5YaF5YWD57SgXG4gICAgICogQHBhcmFtIG9wdGlvbnMg5Y+C5pWwXG4gICAgICovXG4gICAgcHVibGljIGNhbGN1bGF0ZVBvc2l0aW9uKGhvc3RFbGVtZW50OiBIVE1MRWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsIG9wdGlvbnM6IFBvc2l0aW9uaW5nT3B0aW9ucyk6IENsaWVudFJlY3Qge1xuICAgICAgICBjb25zdCB7IHBsYWNlbWVudCwgYXBwZW5kVG9Cb2R5LCBvZmZzZXQsIHBvc2l0aW9uLCBhdXRvQWRhcHQgfSA9IG9wdGlvbnM7XG4gICAgICAgIGxldCBob3N0RWxQb3NpdGlvbjogTmV3Q2xpZW50UmVjdCA9IG51bGw7XG4gICAgICAgIC8vIOWklumDqOS8oOWFpeW3sue7j+eul+WlveeahOS9jee9riwg6ZyA6KaB6K6+572uIGhvc3RFbFBvc2l0aW9uIOWuveW6puWSjOmrmOW6puS4uiAw77yM5LiN6K6h566X5L2N572u77yM5Li76KaB5L2/55So5LqO5Y+z5Ye75by55Ye65L2N572u6K6h566XXG4gICAgICAgIGlmIChwb3NpdGlvbikge1xuICAgICAgICAgICAgaG9zdEVsUG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgdG9wOiBwb3NpdGlvbi50b3AgfHwgMCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBwb3NpdGlvbi5sZWZ0IHx8IDAsXG4gICAgICAgICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAwLFxuICAgICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhvc3RFbFBvc2l0aW9uID0gYXBwZW5kVG9Cb2R5ID8gdGhpcy5vZmZzZXQoaG9zdEVsZW1lbnQsIGZhbHNlKSA6IHRoaXMucG9zaXRpb24oaG9zdEVsZW1lbnQsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldEVsU3R5bGVzID0gdGhpcy5nZXRBbGxTdHlsZXModGFyZ2V0RWxlbWVudCk7XG5cbiAgICAgICAgY29uc3QgZG9jdW1lbnRDbGllbnRXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRDbGllbnRIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIGxldCBwbGFjZW1lbnRQcmltYXJ5ID0gcGxhY2VtZW50LnNwbGl0KCcgJylbMF0gfHwgJ3RvcCc7XG4gICAgICAgIGNvbnN0IHBsYWNlbWVudFNlY29uZGFyeSA9IHBsYWNlbWVudC5zcGxpdCgnICcpWzFdIHx8ICdjZW50ZXInO1xuXG4gICAgICAgIGNvbnN0IHRhcmdldEVsQkNSID0gdGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWxQb3NpdGlvbjogTmV3Q2xpZW50UmVjdCA9IHtcbiAgICAgICAgICAgIGhlaWdodDogdGFyZ2V0RWxCQ1IuaGVpZ2h0IHx8IHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0LFxuICAgICAgICAgICAgd2lkdGg6IHRhcmdldEVsQkNSLndpZHRoIHx8IHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICB0b3A6IG51bGwsXG4gICAgICAgICAgICBib3R0b206IG51bGwsXG4gICAgICAgICAgICBsZWZ0OiBudWxsLFxuICAgICAgICAgICAgcmlnaHQ6IG51bGwsXG4gICAgICAgICAgICBvcmlnaW5Ub3A6IHRhcmdldEVsQkNSLnRvcCxcbiAgICAgICAgICAgIG9yaWdpbkJvdHRvbTogdGFyZ2V0RWxCQ1IuYm90dG9tLFxuICAgICAgICAgICAgb3JpZ2luTGVmdDogdGFyZ2V0RWxCQ1IubGVmdCxcbiAgICAgICAgICAgIG9yaWdpblJpZ2h0OiB0YXJnZXRFbEJDUi5yaWdodFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChwbGFjZW1lbnRQcmltYXJ5ID09PSAnYXV0bycpIHtcbiAgICAgICAgICAgIGxldCBuZXdQbGFjZW1lbnRQcmltYXJ5ID0gdGhpcy5hdXRvUG9zaXRpb24odGFyZ2V0RWxQb3NpdGlvbiwgaG9zdEVsUG9zaXRpb24sIHRhcmdldEVsZW1lbnQsIHBsYWNlbWVudFNlY29uZGFyeSk7XG4gICAgICAgICAgICBpZiAoIW5ld1BsYWNlbWVudFByaW1hcnkpIHtcbiAgICAgICAgICAgICAgICBuZXdQbGFjZW1lbnRQcmltYXJ5ID0gdGhpcy5hdXRvUG9zaXRpb24odGFyZ2V0RWxQb3NpdGlvbiwgaG9zdEVsUG9zaXRpb24sIHRhcmdldEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5ld1BsYWNlbWVudFByaW1hcnkpIHtcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnRQcmltYXJ5ID0gbmV3UGxhY2VtZW50UHJpbWFyeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmFkZChwbGFjZW1lbnRQcmltYXJ5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAocGxhY2VtZW50UHJpbWFyeSkge1xuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSA9IGRvY3VtZW50Q2xpZW50SGVpZ2h0IC0gaG9zdEVsUG9zaXRpb24udG9wICsgb2Zmc2V0O1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24udG9wID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9BZGFwdFRvcEJvdHRvbShwbGFjZW1lbnRQcmltYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0LCBhdXRvQWRhcHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlTGVmdFJpZ2h0UG9zaXRpb24ocGxhY2VtZW50U2Vjb25kYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBob3N0RWxQb3NpdGlvbi50b3AgKyBob3N0RWxQb3NpdGlvbi5oZWlnaHQgKyBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRvQWRhcHRUb3BCb3R0b20ocGxhY2VtZW50UHJpbWFyeSwgaG9zdEVsUG9zaXRpb24sIHRhcmdldEVsUG9zaXRpb24sIG9mZnNldCwgYXV0b0FkYXB0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZUxlZnRSaWdodFBvc2l0aW9uKHBsYWNlbWVudFNlY29uZGFyeSwgaG9zdEVsUG9zaXRpb24sIHRhcmdldEVsUG9zaXRpb24sIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ID0gZG9jdW1lbnRDbGllbnRXaWR0aCAtIGhvc3RFbFBvc2l0aW9uLmxlZnQgKyBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVRvcEJvdHRvbVBvc2l0aW9uKHBsYWNlbWVudFNlY29uZGFyeSwgaG9zdEVsUG9zaXRpb24sIHRhcmdldEVsUG9zaXRpb24sIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ID0gaG9zdEVsUG9zaXRpb24ubGVmdCArIGhvc3RFbFBvc2l0aW9uLndpZHRoICsgb2Zmc2V0O1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ucmlnaHQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlVG9wQm90dG9tUG9zaXRpb24ocGxhY2VtZW50U2Vjb25kYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRhcmdldEVsUG9zaXRpb24udG9wID0gTWF0aC5yb3VuZCh0YXJnZXRFbFBvc2l0aW9uLnRvcCk7XG4gICAgICAgIC8vIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gTWF0aC5yb3VuZCh0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSk7XG4gICAgICAgIC8vIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0RWxQb3NpdGlvbi5sZWZ0KTtcbiAgICAgICAgLy8gdGFyZ2V0RWxQb3NpdGlvbi5yaWdodCA9IE1hdGgucm91bmQodGFyZ2V0RWxQb3NpdGlvbi5yaWdodCk7XG5cbiAgICAgICAgcmV0dXJuIHRhcmdldEVsUG9zaXRpb247XG4gICAgfVxuXG4gICAgc2V0UG9zaXRpb24ob3B0aW9uczogUG9zaXRpb25pbmdPcHRpb25zKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgYXR0YWNoLCB0YXJnZXQgfSA9IG9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGF0dGFjaEVsZW1lbnQgPSBUaHlQb3NpdGlvbmluZ1NlcnZpY2UuZ2V0SFRNTEVsZW1lbnQoYXR0YWNoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IFRoeVBvc2l0aW9uaW5nU2VydmljZS5nZXRIVE1MRWxlbWVudCh0YXJnZXQpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLmNhbGN1bGF0ZVBvc2l0aW9uKGF0dGFjaEVsZW1lbnQsIHRhcmdldEVsZW1lbnQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGlmIChpc051bWJlcihwb3MudG9wKSkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLnRvcCA9IGAke3Bvcy50b3B9cHhgO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOdW1iZXIocG9zLmJvdHRvbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5ib3R0b20gPSBgJHtwb3MuYm90dG9tfXB4YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyKHBvcy5sZWZ0KSkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLmxlZnQgPSBgJHtwb3MubGVmdH1weGA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc051bWJlcihwb3MucmlnaHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUucmlnaHQgPSBgJHtwb3MucmlnaHR9cHhgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=