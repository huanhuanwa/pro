import { Injectable, ElementRef, NgZone } from '@angular/core';
import { isNumber } from 'ngx-tethys/util';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export var PlacementTypes;
(function (PlacementTypes) {
    PlacementTypes["left"] = "left";
    PlacementTypes["right"] = "right";
    PlacementTypes["center"] = "center";
    PlacementTypes["top"] = "top";
    PlacementTypes["bottom"] = "bottom";
})(PlacementTypes || (PlacementTypes = {}));
export const defaultPositioningOptions = {
    offset: 10,
    appendToBody: true,
    placement: 'bottom center'
};
export class ThyPositioningService {
    constructor(ngZone) {
        this.ngZone = ngZone;
    }
    static getHTMLElement(element) {
        // it means that we got a selector
        if (typeof element === 'string') {
            return document.querySelector(element);
        }
        if (element instanceof ElementRef) {
            return element.nativeElement;
        }
        return element;
    }
    autoPosition(targetElPosition, hostElPosition, targetElement, preferredPosition) {
        if ((!preferredPosition || preferredPosition === 'right') &&
            targetElPosition.left + hostElPosition.left - targetElement.offsetWidth < 0) {
            return 'right';
        }
        else if ((!preferredPosition || preferredPosition === 'top') &&
            targetElPosition.bottom + hostElPosition.bottom + targetElement.offsetHeight > window.innerHeight) {
            return 'top';
        }
        else if ((!preferredPosition || preferredPosition === 'bottom') &&
            targetElPosition.top + hostElPosition.top - targetElement.offsetHeight < 0) {
            return 'bottom';
        }
        else if ((!preferredPosition || preferredPosition === 'left') &&
            targetElPosition.right + hostElPosition.right + targetElement.offsetWidth > window.innerWidth) {
            return 'left';
        }
        return null;
    }
    getAllStyles(element) {
        return window.getComputedStyle(element);
    }
    getStyle(element, prop) {
        return this.getAllStyles(element)[prop];
    }
    isStaticPositioned(element) {
        return (this.getStyle(element, 'position') || 'static') === 'static';
    }
    offsetParent(element) {
        let offsetParentEl = element.offsetParent || document.documentElement;
        while (offsetParentEl && offsetParentEl !== document.documentElement && this.isStaticPositioned(offsetParentEl)) {
            offsetParentEl = offsetParentEl.offsetParent;
        }
        return offsetParentEl || document.documentElement;
    }
    calculateTopBottomPosition(placementSecondary, attachElPosition, targetElPosition, offset) {
        const documentClientHeight = document.documentElement.clientHeight;
        if (placementSecondary === PlacementTypes.top) {
            targetElPosition.top = attachElPosition.top;
            targetElPosition.bottom = null;
            // Top 对齐时，下面的内容超过了整个屏幕的高度, 为了可以看见全部内容，牺牲 Top 对齐
            if (targetElPosition.top + targetElPosition.height > documentClientHeight) {
                targetElPosition.top = documentClientHeight - targetElPosition.height;
            }
        }
        else if (placementSecondary === PlacementTypes.bottom) {
            targetElPosition.bottom = documentClientHeight - attachElPosition.top - attachElPosition.height;
            targetElPosition.top = null;
            // Bottom 对齐时，上面的内容超过了整个屏幕的高度，为了可以看见全部内容，牺牲 Bottom 对齐
            if (targetElPosition.bottom + targetElPosition.height > documentClientHeight) {
                targetElPosition.bottom = documentClientHeight - targetElPosition.height;
            }
        }
        else {
            targetElPosition.top = attachElPosition.top + attachElPosition.height / 2 - targetElPosition.height / 2;
            // 顶部的内容被遮挡，牺牲居中，让顶部侧内容可见
            if (targetElPosition.top < 0) {
                targetElPosition.top = offset;
            }
            else if (targetElPosition.top + targetElPosition.height > documentClientHeight) {
                // 下面的内容被遮挡，牺牲居中，让下方的内容可见
                targetElPosition.top = documentClientHeight - targetElPosition.height + offset;
            }
            targetElPosition.bottom = null;
        }
        return targetElPosition;
    }
    calculateLeftRightPosition(placementSecondary, attachElPosition, targetElPosition, offset) {
        const documentClientWidth = document.documentElement.clientWidth;
        if (placementSecondary === PlacementTypes.right) {
            targetElPosition.right = document.documentElement.clientWidth - attachElPosition.left - attachElPosition.width;
            targetElPosition.left = null;
            // 右对齐时，左侧的内容超过了整个屏幕的宽度, 为了可以看见全部内容，牺牲右对齐
            if (targetElPosition.right + targetElPosition.width > documentClientWidth) {
                targetElPosition.right = documentClientWidth - targetElPosition.width - offset;
            }
        }
        else if (placementSecondary === PlacementTypes.left) {
            targetElPosition.left = attachElPosition.left;
            // 左对齐时，右侧的内容超过了整个屏幕的宽度, 为了可以看见全部内容，牺牲左对齐
            if (targetElPosition.left + targetElPosition.width > documentClientWidth) {
                targetElPosition.left = documentClientWidth - targetElPosition.width - offset;
            }
        }
        else {
            targetElPosition.left = attachElPosition.left + attachElPosition.width / 2 - targetElPosition.width / 2;
            // 左侧的内容被遮挡，牺牲居中，让左侧内容可见
            if (targetElPosition.left < 0) {
                targetElPosition.left = offset;
            }
            else if (targetElPosition.left + targetElPosition.width > documentClientWidth) {
                // 右侧的内容被遮挡，牺牲居中，让右侧内容可见
                targetElPosition.left = documentClientWidth - targetElPosition.width - offset;
            }
        }
        return targetElPosition;
    }
    autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt = true) {
        if (!autoAdapt) {
            return;
        }
        const documentClientHeight = document.documentElement.clientHeight;
        if (placementPrimary === 'top') {
            // 如果 Top 空间不够，则自动适应 Bottom Top 和 Bottom 空间都不够，默认为可视区域Top
            if (hostElPosition.originBottom - hostElPosition.height - targetElPosition.height < 0) {
                if (documentClientHeight - hostElPosition.originBottom >= targetElPosition.height) {
                    targetElPosition.bottom = targetElPosition.bottom - targetElPosition.height - hostElPosition.height - offset;
                }
                else {
                    targetElPosition.bottom = null;
                    targetElPosition.top = hostElPosition.top - hostElPosition.originTop;
                }
            }
        }
        if (placementPrimary === 'bottom') {
            // 如果 Bottom 空间不够，则自动适应 Top，如果 Bottom 和 Top 空间都不够，默认为可视区域Top
            if (hostElPosition.originBottom + targetElPosition.height > documentClientHeight) {
                const newTop = hostElPosition.top - targetElPosition.height - offset;
                if (newTop > hostElPosition.top - hostElPosition.originTop) {
                    targetElPosition.top = newTop;
                }
                else {
                    targetElPosition.top = hostElPosition.top - hostElPosition.originTop;
                }
            }
        }
    }
    position(element, round = true) {
        let elPosition;
        let parentOffset = {
            width: 0,
            height: 0,
            top: 0,
            bottom: 0,
            left: 0,
            right: 0
        };
        if (this.getStyle(element, 'position') === 'fixed') {
            const bcRect = element.getBoundingClientRect();
            elPosition = {
                width: bcRect.width,
                height: bcRect.height,
                top: bcRect.top,
                bottom: bcRect.bottom,
                left: bcRect.left,
                right: bcRect.right,
                originTop: bcRect.top,
                originBottom: bcRect.bottom,
                originLeft: bcRect.left,
                originRight: bcRect.right
            };
        }
        else {
            const offsetParentEl = this.offsetParent(element);
            elPosition = this.offset(element, false);
            if (offsetParentEl !== document.documentElement) {
                parentOffset = this.offset(offsetParentEl, false);
            }
            parentOffset.top += offsetParentEl.clientTop;
            parentOffset.left += offsetParentEl.clientLeft;
        }
        elPosition.top -= parentOffset.top;
        elPosition.bottom -= parentOffset.top;
        elPosition.left -= parentOffset.left;
        elPosition.right -= parentOffset.left;
        if (round) {
            elPosition.top = Math.round(elPosition.top);
            elPosition.bottom = Math.round(elPosition.bottom);
            elPosition.left = Math.round(elPosition.left);
            elPosition.right = Math.round(elPosition.right);
        }
        return elPosition;
    }
    offset(element, round = true) {
        const elBcr = element.getBoundingClientRect();
        const viewportOffset = {
            top: window.pageYOffset - document.documentElement.clientTop,
            left: window.pageXOffset - document.documentElement.clientLeft
        };
        const elOffset = {
            height: elBcr.height || element.offsetHeight,
            width: elBcr.width || element.offsetWidth,
            top: elBcr.top + viewportOffset.top,
            bottom: elBcr.bottom + viewportOffset.top,
            left: elBcr.left + viewportOffset.left,
            right: elBcr.right + viewportOffset.left,
            originTop: elBcr.top,
            originBottom: elBcr.bottom,
            originLeft: elBcr.left,
            originRight: elBcr.right
        };
        if (round) {
            elOffset.height = Math.round(elOffset.height);
            elOffset.width = Math.round(elOffset.width);
            elOffset.top = Math.round(elOffset.top);
            elOffset.bottom = Math.round(elOffset.bottom);
            elOffset.left = Math.round(elOffset.left);
            elOffset.right = Math.round(elOffset.right);
        }
        return elOffset;
    }
    /**
     * 计算弹出层的位置
     * @param hostElement 被追加的元素
     * @param targetElement 弹出层内元素
     * @param options 参数
     */
    calculatePosition(hostElement, targetElement, options) {
        const { placement, appendToBody, offset, position, autoAdapt } = options;
        let hostElPosition = null;
        // 外部传入已经算好的位置, 需要设置 hostElPosition 宽度和高度为 0，不计算位置，主要使用于右击弹出位置计算
        if (position) {
            hostElPosition = {
                top: position.top || 0,
                left: position.left || 0,
                bottom: 0,
                right: 0,
                width: 0,
                height: 0
            };
        }
        else {
            hostElPosition = appendToBody ? this.offset(hostElement, false) : this.position(hostElement, false);
        }
        const targetElStyles = this.getAllStyles(targetElement);
        const documentClientWidth = document.documentElement.clientWidth;
        const documentClientHeight = document.documentElement.clientHeight;
        let placementPrimary = placement.split(' ')[0] || 'top';
        const placementSecondary = placement.split(' ')[1] || 'center';
        const targetElBCR = targetElement.getBoundingClientRect();
        const targetElPosition = {
            height: targetElBCR.height || targetElement.offsetHeight,
            width: targetElBCR.width || targetElement.offsetWidth,
            top: null,
            bottom: null,
            left: null,
            right: null,
            originTop: targetElBCR.top,
            originBottom: targetElBCR.bottom,
            originLeft: targetElBCR.left,
            originRight: targetElBCR.right
        };
        if (placementPrimary === 'auto') {
            let newPlacementPrimary = this.autoPosition(targetElPosition, hostElPosition, targetElement, placementSecondary);
            if (!newPlacementPrimary) {
                newPlacementPrimary = this.autoPosition(targetElPosition, hostElPosition, targetElement);
            }
            if (newPlacementPrimary) {
                placementPrimary = newPlacementPrimary;
            }
            targetElement.classList.add(placementPrimary);
        }
        switch (placementPrimary) {
            case 'top':
                targetElPosition.bottom = documentClientHeight - hostElPosition.top + offset;
                targetElPosition.top = null;
                this.autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt);
                this.calculateLeftRightPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'bottom':
                targetElPosition.top = hostElPosition.top + hostElPosition.height + offset;
                this.autoAdaptTopBottom(placementPrimary, hostElPosition, targetElPosition, offset, autoAdapt);
                this.calculateLeftRightPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'left':
                targetElPosition.right = documentClientWidth - hostElPosition.left + offset;
                targetElPosition.left = null;
                this.calculateTopBottomPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
            case 'right':
                targetElPosition.left = hostElPosition.left + hostElPosition.width + offset;
                targetElPosition.right = null;
                this.calculateTopBottomPosition(placementSecondary, hostElPosition, targetElPosition, offset);
                break;
        }
        // targetElPosition.top = Math.round(targetElPosition.top);
        // targetElPosition.bottom = Math.round(targetElPosition.bottom);
        // targetElPosition.left = Math.round(targetElPosition.left);
        // targetElPosition.right = Math.round(targetElPosition.right);
        return targetElPosition;
    }
    setPosition(options) {
        const { attach, target } = options;
        const attachElement = ThyPositioningService.getHTMLElement(attach);
        const targetElement = ThyPositioningService.getHTMLElement(target);
        setTimeout(() => {
            this.ngZone.runOutsideAngular(() => {
                const pos = this.calculatePosition(attachElement, targetElement, options);
                if (isNumber(pos.top)) {
                    targetElement.style.top = `${pos.top}px`;
                }
                else if (isNumber(pos.bottom)) {
                    targetElement.style.bottom = `${pos.bottom}px`;
                }
                if (isNumber(pos.left)) {
                    targetElement.style.left = `${pos.left}px`;
                }
                else if (isNumber(pos.right)) {
                    targetElement.style.right = `${pos.right}px`;
                }
            });
        });
    }
}
ThyPositioningService.ɵfac = function ThyPositioningService_Factory(t) { return new (t || ThyPositioningService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
ThyPositioningService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ThyPositioningService_Factory() { return new ThyPositioningService(i0.ɵɵinject(i0.NgZone)); }, token: ThyPositioningService, providedIn: "root" });
ThyPositioningService.ctorParameters = () => [
    { type: NgZone }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyPositioningService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb25pbmcuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Bvc2l0aW9uaW5nL3Bvc2l0aW9uaW5nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQzs7QUFFQSxNQUFNLENBQU4sSUFBWSxjQU1YO0FBTkQsV0FBWSxjQUFjO0FBQ3pCLElBQUcsK0JBQWEsQ0FBQTtBQUFDLElBQ2QsaUNBQWUsQ0FBQTtBQUFDLElBQ2hCLG1DQUFpQixDQUFBO0FBQUMsSUFDbEIsNkJBQVcsQ0FBQTtBQUFDLElBQ1osbUNBQWlCLENBQUE7QUFDckIsQ0FBQyxFQU5XLGNBQWMsS0FBZCxjQUFjLFFBTXpCO0FBb0NELE1BQU0sQ0FBQyxNQUFNLHlCQUF5QixHQUF1QjtBQUM3RCxJQUFJLE1BQU0sRUFBRSxFQUFFO0FBQ2QsSUFBSSxZQUFZLEVBQUUsSUFBSTtBQUN0QixJQUFJLFNBQVMsRUFBRSxlQUFlO0FBQzlCLENBQUMsQ0FBQztBQUtGLE1BQU0sT0FBTyxxQkFBcUI7QUFDbEMsSUFBSSxZQUFvQixNQUFjO0FBQUksUUFBbEIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUFDLElBQUUsQ0FBQztBQUMxQyxJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBMEM7QUFBSSxRQUNoRSxrQ0FBa0M7QUFDMUMsUUFBUSxJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsRUFBRTtBQUN6QyxZQUFZLE9BQU8sUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQWdCLENBQUM7QUFDbEUsU0FBUztBQUNULFFBQ1EsSUFBSSxPQUFPLFlBQVksVUFBVSxFQUFFO0FBQzNDLFlBQVksT0FBTyxPQUFPLENBQUMsYUFBYSxDQUFDO0FBQ3pDLFNBQVM7QUFDVCxRQUNRLE9BQU8s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QUM7QUFDRCwyTkF4V0s7QUFBQztFQUhMLFVBQVUsWkFJSyxZQXhEaUIsTUFBTTtBQW9EM0IsQUFwRDhCO2VBcUR0QyxVQUFVLEVBQUUsTUFBTSxjQUNyQjs7Ozs7dUVBdEQyQztBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgRWxlbWVudFJlZiwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc051bWJlciB9IGZyb20gJ25neC10ZXRoeXMvdXRpbCc7XG5pbXBvcnQgeyBOZXdDbGllbnRSZWN0IH0gZnJvbSAnLi9jbGllbnQtcmVjdCc7XG5cbmV4cG9ydCBlbnVtIFBsYWNlbWVudFR5cGVzIHtcbiAgICBsZWZ0ID0gJ2xlZnQnLFxuICAgIHJpZ2h0ID0gJ3JpZ2h0JyxcbiAgICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgICB0b3AgPSAndG9wJyxcbiAgICBib3R0b20gPSAnYm90dG9tJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvc2l0aW9uaW5nT3B0aW9ucyB7XG4gICAgLyoqIFRoZSBET00gZWxlbWVudCwgRWxlbWVudFJlZiwgb3IgYSBzZWxlY3RvciBzdHJpbmcgb2YgYW4gZWxlbWVudCB3aGljaCB3aWxsIGJlIG1vdmVkICovXG4gICAgYXR0YWNoPzogSFRNTEVsZW1lbnQgfCBFbGVtZW50UmVmIHwgc3RyaW5nO1xuXG4gICAgLyoqIFRoZSBET00gZWxlbWVudCwgRWxlbWVudFJlZiwgb3IgYSBzZWxlY3RvciBzdHJpbmcgb2YgYW4gZWxlbWVudCB3aGljaCB0aGUgZWxlbWVudCB3aWxsIGJlIGF0dGFjaGVkIHRvICAqL1xuICAgIHRhcmdldD86IEhUTUxFbGVtZW50IHwgRWxlbWVudFJlZiB8IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEEgc3RyaW5nIG9mIHRoZSBmb3JtICd2ZXJ0LWF0dGFjaG1lbnQgaG9yaXotYXR0YWNobWVudCcgb3IgJ3BsYWNlbWVudCdcbiAgICAgKiAtIHBsYWNlbWVudCBjYW4gYmUgXCJ0b3BcIiwgXCJib3R0b21cIiwgXCJsZWZ0XCIsIFwicmlnaHRcIlxuICAgICAqIG5vdCB5ZXQgc3VwcG9ydGVkOlxuICAgICAqIC0gdmVydC1hdHRhY2htZW50IGNhbiBiZSBhbnkgb2YgJ3RvcCcsICdtaWRkbGUnLCAnYm90dG9tJ1xuICAgICAqIC0gaG9yaXotYXR0YWNobWVudCBjYW4gYmUgYW55IG9mICdsZWZ0JywgJ2NlbnRlcicsICdyaWdodCdcbiAgICAgKi9cbiAgICBwbGFjZW1lbnQ/OiBzdHJpbmc7XG5cbiAgICAvLyDnm7TmjqXkvKDlhaXkvY3nva7vvIzkuI3nlKjmoLnmja4gYXR0YWNobWVudCB0YXJnZXQg6K6h566X77yM5Y+z5Ye76I+c5Y2V5L2/55SoXG4gICAgcG9zaXRpb24/OiB7XG4gICAgICAgIHRvcDogbnVtYmVyO1xuICAgICAgICBsZWZ0OiBudW1iZXI7XG4gICAgfTtcblxuICAgIC8qKiBBIHN0cmluZyBvZiB0aGUgZm9ybSAndmVydC1vZmZzZXQgaG9yaXotb2Zmc2V0J1xuICAgICAqIC0gdmVydC1vZmZzZXQgYW5kIGhvcml6LW9mZnNldCBjYW4gYmUgb2YgdGhlIGZvcm0gXCIyMHB4XCIgb3IgXCI1NSVcIlxuICAgICAqL1xuICAgIG9mZnNldD86IG51bWJlcjtcblxuICAgIC8qKiBJZiB0cnVlIGNvbXBvbmVudCB3aWxsIGJlIGF0dGFjaGVkIHRvIGJvZHkgKi9cbiAgICBhcHBlbmRUb0JvZHk/OiBib29sZWFuO1xuXG4gICAgLyoqIElmIHRydWUgY29tcG9uZW50IGF1dG8gYWRhcHQgdG9wIG9yIGJvdHRvbSAqL1xuICAgIGF1dG9BZGFwdD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0UG9zaXRpb25pbmdPcHRpb25zOiBQb3NpdGlvbmluZ09wdGlvbnMgPSB7XG4gICAgb2Zmc2V0OiAxMCxcbiAgICBhcHBlbmRUb0JvZHk6IHRydWUsXG4gICAgcGxhY2VtZW50OiAnYm90dG9tIGNlbnRlcidcbn07XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgVGh5UG9zaXRpb25pbmdTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5nWm9uZTogTmdab25lKSB7fVxuXG4gICAgc3RhdGljIGdldEhUTUxFbGVtZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgRWxlbWVudFJlZiB8IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgLy8gaXQgbWVhbnMgdGhhdCB3ZSBnb3QgYSBzZWxlY3RvclxuICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KSBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudFJlZikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgIH1cblxuICAgIHByaXZhdGUgYXV0b1Bvc2l0aW9uKHRhcmdldEVsUG9zaXRpb246IENsaWVudFJlY3QsIGhvc3RFbFBvc2l0aW9uOiBDbGllbnRSZWN0LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCwgcHJlZmVycmVkUG9zaXRpb24/OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgKCFwcmVmZXJyZWRQb3NpdGlvbiB8fCBwcmVmZXJyZWRQb3NpdGlvbiA9PT0gJ3JpZ2h0JykgJiZcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCArIGhvc3RFbFBvc2l0aW9uLmxlZnQgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIDwgMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiAncmlnaHQnO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgKCFwcmVmZXJyZWRQb3NpdGlvbiB8fCBwcmVmZXJyZWRQb3NpdGlvbiA9PT0gJ3RvcCcpICYmXG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSArIGhvc3RFbFBvc2l0aW9uLmJvdHRvbSArIHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0ID4gd2luZG93LmlubmVySGVpZ2h0XG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuICd0b3AnO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgKCFwcmVmZXJyZWRQb3NpdGlvbiB8fCBwcmVmZXJyZWRQb3NpdGlvbiA9PT0gJ2JvdHRvbScpICYmXG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCArIGhvc3RFbFBvc2l0aW9uLnRvcCAtIHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0IDwgMFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiAnYm90dG9tJztcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICghcHJlZmVycmVkUG9zaXRpb24gfHwgcHJlZmVycmVkUG9zaXRpb24gPT09ICdsZWZ0JykgJiZcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ucmlnaHQgKyBob3N0RWxQb3NpdGlvbi5yaWdodCArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiAnbGVmdCc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRBbGxTdHlsZXMoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0U3R5bGUoZWxlbWVudDogSFRNTEVsZW1lbnQsIHByb3A6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAodGhpcy5nZXRBbGxTdHlsZXMoZWxlbWVudCkgYXMgYW55KVtwcm9wXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU3RhdGljUG9zaXRpb25lZChlbGVtZW50OiBIVE1MRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKHRoaXMuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgfHwgJ3N0YXRpYycpID09PSAnc3RhdGljJztcbiAgICB9XG5cbiAgICBwcml2YXRlIG9mZnNldFBhcmVudChlbGVtZW50OiBIVE1MRWxlbWVudCk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgbGV0IG9mZnNldFBhcmVudEVsID0gPEhUTUxFbGVtZW50PmVsZW1lbnQub2Zmc2V0UGFyZW50IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblxuICAgICAgICB3aGlsZSAob2Zmc2V0UGFyZW50RWwgJiYgb2Zmc2V0UGFyZW50RWwgIT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiB0aGlzLmlzU3RhdGljUG9zaXRpb25lZChvZmZzZXRQYXJlbnRFbCkpIHtcbiAgICAgICAgICAgIG9mZnNldFBhcmVudEVsID0gPEhUTUxFbGVtZW50Pm9mZnNldFBhcmVudEVsLm9mZnNldFBhcmVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvZmZzZXRQYXJlbnRFbCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVUb3BCb3R0b21Qb3NpdGlvbihcbiAgICAgICAgcGxhY2VtZW50U2Vjb25kYXJ5OiBzdHJpbmcsXG4gICAgICAgIGF0dGFjaEVsUG9zaXRpb246IENsaWVudFJlY3QsXG4gICAgICAgIHRhcmdldEVsUG9zaXRpb246IENsaWVudFJlY3QsXG4gICAgICAgIG9mZnNldDogbnVtYmVyXG4gICAgKTogQ2xpZW50UmVjdCB7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50Q2xpZW50SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICAgICAgaWYgKHBsYWNlbWVudFNlY29uZGFyeSA9PT0gUGxhY2VtZW50VHlwZXMudG9wKSB7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGF0dGFjaEVsUG9zaXRpb24udG9wO1xuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gPSBudWxsO1xuICAgICAgICAgICAgLy8gVG9wIOWvuem9kOaXtu+8jOS4i+mdoueahOWGheWuuei2hei/h+S6huaVtOS4quWxj+W5leeahOmrmOW6piwg5Li65LqG5Y+v5Lul55yL6KeB5YWo6YOo5YaF5a6577yM54m654myIFRvcCDlr7npvZBcbiAgICAgICAgICAgIGlmICh0YXJnZXRFbFBvc2l0aW9uLnRvcCArIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0ID4gZG9jdW1lbnRDbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGRvY3VtZW50Q2xpZW50SGVpZ2h0IC0gdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocGxhY2VtZW50U2Vjb25kYXJ5ID09PSBQbGFjZW1lbnRUeXBlcy5ib3R0b20pIHtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gZG9jdW1lbnRDbGllbnRIZWlnaHQgLSBhdHRhY2hFbFBvc2l0aW9uLnRvcCAtIGF0dGFjaEVsUG9zaXRpb24uaGVpZ2h0O1xuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBudWxsO1xuICAgICAgICAgICAgLy8gQm90dG9tIOWvuem9kOaXtu+8jOS4iumdoueahOWGheWuuei2hei/h+S6huaVtOS4quWxj+W5leeahOmrmOW6pu+8jOS4uuS6huWPr+S7peeci+ingeWFqOmDqOWGheWuue+8jOeJuueJsiBCb3R0b20g5a+56b2QXG4gICAgICAgICAgICBpZiAodGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gKyB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCA+IGRvY3VtZW50Q2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gPSBkb2N1bWVudENsaWVudEhlaWdodCAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBhdHRhY2hFbFBvc2l0aW9uLnRvcCArIGF0dGFjaEVsUG9zaXRpb24uaGVpZ2h0IC8gMiAtIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIC8vIOmhtumDqOeahOWGheWuueiiq+mBruaMoe+8jOeJuueJsuWxheS4re+8jOiuqemhtumDqOS+p+WGheWuueWPr+ingVxuICAgICAgICAgICAgaWYgKHRhcmdldEVsUG9zaXRpb24udG9wIDwgMCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24udG9wID0gb2Zmc2V0O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRFbFBvc2l0aW9uLnRvcCArIHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0ID4gZG9jdW1lbnRDbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAvLyDkuIvpnaLnmoTlhoXlrrnooqvpga7mjKHvvIznibrnibLlsYXkuK3vvIzorqnkuIvmlrnnmoTlhoXlrrnlj6/op4FcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGRvY3VtZW50Q2xpZW50SGVpZ2h0IC0gdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgKyBvZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldEVsUG9zaXRpb247XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVMZWZ0UmlnaHRQb3NpdGlvbihcbiAgICAgICAgcGxhY2VtZW50U2Vjb25kYXJ5OiBzdHJpbmcsXG4gICAgICAgIGF0dGFjaEVsUG9zaXRpb246IENsaWVudFJlY3QsXG4gICAgICAgIHRhcmdldEVsUG9zaXRpb246IENsaWVudFJlY3QsXG4gICAgICAgIG9mZnNldDogbnVtYmVyXG4gICAgKTogQ2xpZW50UmVjdCB7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50Q2xpZW50V2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICAgIGlmIChwbGFjZW1lbnRTZWNvbmRhcnkgPT09IFBsYWNlbWVudFR5cGVzLnJpZ2h0KSB7XG4gICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gYXR0YWNoRWxQb3NpdGlvbi5sZWZ0IC0gYXR0YWNoRWxQb3NpdGlvbi53aWR0aDtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IG51bGw7XG4gICAgICAgICAgICAvLyDlj7Plr7npvZDml7bvvIzlt6bkvqfnmoTlhoXlrrnotoXov4fkuobmlbTkuKrlsY/luZXnmoTlrr3luqYsIOS4uuS6huWPr+S7peeci+ingeWFqOmDqOWGheWuue+8jOeJuueJsuWPs+Wvuem9kFxuICAgICAgICAgICAgaWYgKHRhcmdldEVsUG9zaXRpb24ucmlnaHQgKyB0YXJnZXRFbFBvc2l0aW9uLndpZHRoID4gZG9jdW1lbnRDbGllbnRXaWR0aCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ucmlnaHQgPSBkb2N1bWVudENsaWVudFdpZHRoIC0gdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCAtIG9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChwbGFjZW1lbnRTZWNvbmRhcnkgPT09IFBsYWNlbWVudFR5cGVzLmxlZnQpIHtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IGF0dGFjaEVsUG9zaXRpb24ubGVmdDtcbiAgICAgICAgICAgIC8vIOW3puWvuem9kOaXtu+8jOWPs+S+p+eahOWGheWuuei2hei/h+S6huaVtOS4quWxj+W5leeahOWuveW6piwg5Li65LqG5Y+v5Lul55yL6KeB5YWo6YOo5YaF5a6577yM54m654my5bem5a+56b2QXG4gICAgICAgICAgICBpZiAodGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ICsgdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCA+IGRvY3VtZW50Q2xpZW50V2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBkb2N1bWVudENsaWVudFdpZHRoIC0gdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCAtIG9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IGF0dGFjaEVsUG9zaXRpb24ubGVmdCArIGF0dGFjaEVsUG9zaXRpb24ud2lkdGggLyAyIC0gdGFyZ2V0RWxQb3NpdGlvbi53aWR0aCAvIDI7XG4gICAgICAgICAgICAvLyDlt6bkvqfnmoTlhoXlrrnooqvpga7mjKHvvIznibrnibLlsYXkuK3vvIzorqnlt6bkvqflhoXlrrnlj6/op4FcbiAgICAgICAgICAgIGlmICh0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ID0gb2Zmc2V0O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRFbFBvc2l0aW9uLmxlZnQgKyB0YXJnZXRFbFBvc2l0aW9uLndpZHRoID4gZG9jdW1lbnRDbGllbnRXaWR0aCkge1xuICAgICAgICAgICAgICAgIC8vIOWPs+S+p+eahOWGheWuueiiq+mBruaMoe+8jOeJuueJsuWxheS4re+8jOiuqeWPs+S+p+WGheWuueWPr+ingVxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ubGVmdCA9IGRvY3VtZW50Q2xpZW50V2lkdGggLSB0YXJnZXRFbFBvc2l0aW9uLndpZHRoIC0gb2Zmc2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YXJnZXRFbFBvc2l0aW9uO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXV0b0FkYXB0VG9wQm90dG9tKFxuICAgICAgICBwbGFjZW1lbnRQcmltYXJ5OiBzdHJpbmcsXG4gICAgICAgIGhvc3RFbFBvc2l0aW9uOiBOZXdDbGllbnRSZWN0LFxuICAgICAgICB0YXJnZXRFbFBvc2l0aW9uOiBOZXdDbGllbnRSZWN0LFxuICAgICAgICBvZmZzZXQ6IG51bWJlcixcbiAgICAgICAgYXV0b0FkYXB0ID0gdHJ1ZVxuICAgICkge1xuICAgICAgICBpZiAoIWF1dG9BZGFwdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRvY3VtZW50Q2xpZW50SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICAgICAgaWYgKHBsYWNlbWVudFByaW1hcnkgPT09ICd0b3AnKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpwgVG9wIOepuumXtOS4jeWkn++8jOWImeiHquWKqOmAguW6lCBCb3R0b20gVG9wIOWSjCBCb3R0b20g56m66Ze06YO95LiN5aSf77yM6buY6K6k5Li65Y+v6KeG5Yy65Z+fVG9wXG4gICAgICAgICAgICBpZiAoaG9zdEVsUG9zaXRpb24ub3JpZ2luQm90dG9tIC0gaG9zdEVsUG9zaXRpb24uaGVpZ2h0IC0gdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50Q2xpZW50SGVpZ2h0IC0gaG9zdEVsUG9zaXRpb24ub3JpZ2luQm90dG9tID49IHRhcmdldEVsUG9zaXRpb24uaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gLSB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCAtIGhvc3RFbFBvc2l0aW9uLmhlaWdodCAtIG9mZnNldDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmJvdHRvbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24udG9wID0gaG9zdEVsUG9zaXRpb24udG9wIC0gaG9zdEVsUG9zaXRpb24ub3JpZ2luVG9wO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocGxhY2VtZW50UHJpbWFyeSA9PT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgIC8vIOWmguaenCBCb3R0b20g56m66Ze05LiN5aSf77yM5YiZ6Ieq5Yqo6YCC5bqUIFRvcO+8jOWmguaenCBCb3R0b20g5ZKMIFRvcCDnqbrpl7Tpg73kuI3lpJ/vvIzpu5jorqTkuLrlj6/op4bljLrln59Ub3BcbiAgICAgICAgICAgIGlmIChob3N0RWxQb3NpdGlvbi5vcmlnaW5Cb3R0b20gKyB0YXJnZXRFbFBvc2l0aW9uLmhlaWdodCA+IGRvY3VtZW50Q2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VG9wID0gaG9zdEVsUG9zaXRpb24udG9wIC0gdGFyZ2V0RWxQb3NpdGlvbi5oZWlnaHQgLSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1RvcCA+IGhvc3RFbFBvc2l0aW9uLnRvcCAtIGhvc3RFbFBvc2l0aW9uLm9yaWdpblRvcCkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IG5ld1RvcDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGhvc3RFbFBvc2l0aW9uLnRvcCAtIGhvc3RFbFBvc2l0aW9uLm9yaWdpblRvcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcG9zaXRpb24oZWxlbWVudDogSFRNTEVsZW1lbnQsIHJvdW5kID0gdHJ1ZSk6IE5ld0NsaWVudFJlY3Qge1xuICAgICAgICBsZXQgZWxQb3NpdGlvbjogTmV3Q2xpZW50UmVjdDtcbiAgICAgICAgbGV0IHBhcmVudE9mZnNldDogTmV3Q2xpZW50UmVjdCA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAwLFxuICAgICAgICAgICAgaGVpZ2h0OiAwLFxuICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgIHJpZ2h0OiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT09ICdmaXhlZCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGJjUmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICBlbFBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBiY1JlY3Qud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBiY1JlY3QuaGVpZ2h0LFxuICAgICAgICAgICAgICAgIHRvcDogYmNSZWN0LnRvcCxcbiAgICAgICAgICAgICAgICBib3R0b206IGJjUmVjdC5ib3R0b20sXG4gICAgICAgICAgICAgICAgbGVmdDogYmNSZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGJjUmVjdC5yaWdodCxcbiAgICAgICAgICAgICAgICBvcmlnaW5Ub3A6IGJjUmVjdC50b3AsXG4gICAgICAgICAgICAgICAgb3JpZ2luQm90dG9tOiBiY1JlY3QuYm90dG9tLFxuICAgICAgICAgICAgICAgIG9yaWdpbkxlZnQ6IGJjUmVjdC5sZWZ0LFxuICAgICAgICAgICAgICAgIG9yaWdpblJpZ2h0OiBiY1JlY3QucmlnaHRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvZmZzZXRQYXJlbnRFbCA9IHRoaXMub2Zmc2V0UGFyZW50KGVsZW1lbnQpO1xuXG4gICAgICAgICAgICBlbFBvc2l0aW9uID0gdGhpcy5vZmZzZXQoZWxlbWVudCwgZmFsc2UpO1xuXG4gICAgICAgICAgICBpZiAob2Zmc2V0UGFyZW50RWwgIT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHBhcmVudE9mZnNldCA9IHRoaXMub2Zmc2V0KG9mZnNldFBhcmVudEVsLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcmVudE9mZnNldC50b3AgKz0gb2Zmc2V0UGFyZW50RWwuY2xpZW50VG9wO1xuICAgICAgICAgICAgcGFyZW50T2Zmc2V0LmxlZnQgKz0gb2Zmc2V0UGFyZW50RWwuY2xpZW50TGVmdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsUG9zaXRpb24udG9wIC09IHBhcmVudE9mZnNldC50b3A7XG4gICAgICAgIGVsUG9zaXRpb24uYm90dG9tIC09IHBhcmVudE9mZnNldC50b3A7XG4gICAgICAgIGVsUG9zaXRpb24ubGVmdCAtPSBwYXJlbnRPZmZzZXQubGVmdDtcbiAgICAgICAgZWxQb3NpdGlvbi5yaWdodCAtPSBwYXJlbnRPZmZzZXQubGVmdDtcblxuICAgICAgICBpZiAocm91bmQpIHtcbiAgICAgICAgICAgIGVsUG9zaXRpb24udG9wID0gTWF0aC5yb3VuZChlbFBvc2l0aW9uLnRvcCk7XG4gICAgICAgICAgICBlbFBvc2l0aW9uLmJvdHRvbSA9IE1hdGgucm91bmQoZWxQb3NpdGlvbi5ib3R0b20pO1xuICAgICAgICAgICAgZWxQb3NpdGlvbi5sZWZ0ID0gTWF0aC5yb3VuZChlbFBvc2l0aW9uLmxlZnQpO1xuICAgICAgICAgICAgZWxQb3NpdGlvbi5yaWdodCA9IE1hdGgucm91bmQoZWxQb3NpdGlvbi5yaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWxQb3NpdGlvbjtcbiAgICB9XG5cbiAgICBwdWJsaWMgb2Zmc2V0KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCByb3VuZCA9IHRydWUpOiBOZXdDbGllbnRSZWN0IHtcbiAgICAgICAgY29uc3QgZWxCY3IgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCB2aWV3cG9ydE9mZnNldCA9IHtcbiAgICAgICAgICAgIHRvcDogd2luZG93LnBhZ2VZT2Zmc2V0IC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcCxcbiAgICAgICAgICAgIGxlZnQ6IHdpbmRvdy5wYWdlWE9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRMZWZ0XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZWxPZmZzZXQgPSB7XG4gICAgICAgICAgICBoZWlnaHQ6IGVsQmNyLmhlaWdodCB8fCBlbGVtZW50Lm9mZnNldEhlaWdodCxcbiAgICAgICAgICAgIHdpZHRoOiBlbEJjci53aWR0aCB8fCBlbGVtZW50Lm9mZnNldFdpZHRoLFxuICAgICAgICAgICAgdG9wOiBlbEJjci50b3AgKyB2aWV3cG9ydE9mZnNldC50b3AsXG4gICAgICAgICAgICBib3R0b206IGVsQmNyLmJvdHRvbSArIHZpZXdwb3J0T2Zmc2V0LnRvcCxcbiAgICAgICAgICAgIGxlZnQ6IGVsQmNyLmxlZnQgKyB2aWV3cG9ydE9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgcmlnaHQ6IGVsQmNyLnJpZ2h0ICsgdmlld3BvcnRPZmZzZXQubGVmdCxcbiAgICAgICAgICAgIG9yaWdpblRvcDogZWxCY3IudG9wLFxuICAgICAgICAgICAgb3JpZ2luQm90dG9tOiBlbEJjci5ib3R0b20sXG4gICAgICAgICAgICBvcmlnaW5MZWZ0OiBlbEJjci5sZWZ0LFxuICAgICAgICAgICAgb3JpZ2luUmlnaHQ6IGVsQmNyLnJpZ2h0XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHJvdW5kKSB7XG4gICAgICAgICAgICBlbE9mZnNldC5oZWlnaHQgPSBNYXRoLnJvdW5kKGVsT2Zmc2V0LmhlaWdodCk7XG4gICAgICAgICAgICBlbE9mZnNldC53aWR0aCA9IE1hdGgucm91bmQoZWxPZmZzZXQud2lkdGgpO1xuICAgICAgICAgICAgZWxPZmZzZXQudG9wID0gTWF0aC5yb3VuZChlbE9mZnNldC50b3ApO1xuICAgICAgICAgICAgZWxPZmZzZXQuYm90dG9tID0gTWF0aC5yb3VuZChlbE9mZnNldC5ib3R0b20pO1xuICAgICAgICAgICAgZWxPZmZzZXQubGVmdCA9IE1hdGgucm91bmQoZWxPZmZzZXQubGVmdCk7XG4gICAgICAgICAgICBlbE9mZnNldC5yaWdodCA9IE1hdGgucm91bmQoZWxPZmZzZXQucmlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVsT2Zmc2V0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiuoeeul+W8ueWHuuWxgueahOS9jee9rlxuICAgICAqIEBwYXJhbSBob3N0RWxlbWVudCDooqvov73liqDnmoTlhYPntKBcbiAgICAgKiBAcGFyYW0gdGFyZ2V0RWxlbWVudCDlvLnlh7rlsYLlhoXlhYPntKBcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyDlj4LmlbBcbiAgICAgKi9cbiAgICBwdWJsaWMgY2FsY3VsYXRlUG9zaXRpb24oaG9zdEVsZW1lbnQ6IEhUTUxFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCwgb3B0aW9uczogUG9zaXRpb25pbmdPcHRpb25zKTogQ2xpZW50UmVjdCB7XG4gICAgICAgIGNvbnN0IHsgcGxhY2VtZW50LCBhcHBlbmRUb0JvZHksIG9mZnNldCwgcG9zaXRpb24sIGF1dG9BZGFwdCB9ID0gb3B0aW9ucztcbiAgICAgICAgbGV0IGhvc3RFbFBvc2l0aW9uOiBOZXdDbGllbnRSZWN0ID0gbnVsbDtcbiAgICAgICAgLy8g5aSW6YOo5Lyg5YWl5bey57uP566X5aW955qE5L2N572uLCDpnIDopoHorr7nva4gaG9zdEVsUG9zaXRpb24g5a695bqm5ZKM6auY5bqm5Li6IDDvvIzkuI3orqHnrpfkvY3nva7vvIzkuLvopoHkvb/nlKjkuo7lj7Plh7vlvLnlh7rkvY3nva7orqHnrpdcbiAgICAgICAgaWYgKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBob3N0RWxQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICB0b3A6IHBvc2l0aW9uLnRvcCB8fCAwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IHBvc2l0aW9uLmxlZnQgfHwgMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaG9zdEVsUG9zaXRpb24gPSBhcHBlbmRUb0JvZHkgPyB0aGlzLm9mZnNldChob3N0RWxlbWVudCwgZmFsc2UpIDogdGhpcy5wb3NpdGlvbihob3N0RWxlbWVudCwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0RWxTdHlsZXMgPSB0aGlzLmdldEFsbFN0eWxlcyh0YXJnZXRFbGVtZW50KTtcblxuICAgICAgICBjb25zdCBkb2N1bWVudENsaWVudFdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgICBjb25zdCBkb2N1bWVudENsaWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG5cbiAgICAgICAgbGV0IHBsYWNlbWVudFByaW1hcnkgPSBwbGFjZW1lbnQuc3BsaXQoJyAnKVswXSB8fCAndG9wJztcbiAgICAgICAgY29uc3QgcGxhY2VtZW50U2Vjb25kYXJ5ID0gcGxhY2VtZW50LnNwbGl0KCcgJylbMV0gfHwgJ2NlbnRlcic7XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0RWxCQ1IgPSB0YXJnZXRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCB0YXJnZXRFbFBvc2l0aW9uOiBOZXdDbGllbnRSZWN0ID0ge1xuICAgICAgICAgICAgaGVpZ2h0OiB0YXJnZXRFbEJDUi5oZWlnaHQgfHwgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQsXG4gICAgICAgICAgICB3aWR0aDogdGFyZ2V0RWxCQ1Iud2lkdGggfHwgdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCxcbiAgICAgICAgICAgIHRvcDogbnVsbCxcbiAgICAgICAgICAgIGJvdHRvbTogbnVsbCxcbiAgICAgICAgICAgIGxlZnQ6IG51bGwsXG4gICAgICAgICAgICByaWdodDogbnVsbCxcbiAgICAgICAgICAgIG9yaWdpblRvcDogdGFyZ2V0RWxCQ1IudG9wLFxuICAgICAgICAgICAgb3JpZ2luQm90dG9tOiB0YXJnZXRFbEJDUi5ib3R0b20sXG4gICAgICAgICAgICBvcmlnaW5MZWZ0OiB0YXJnZXRFbEJDUi5sZWZ0LFxuICAgICAgICAgICAgb3JpZ2luUmlnaHQ6IHRhcmdldEVsQkNSLnJpZ2h0XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHBsYWNlbWVudFByaW1hcnkgPT09ICdhdXRvJykge1xuICAgICAgICAgICAgbGV0IG5ld1BsYWNlbWVudFByaW1hcnkgPSB0aGlzLmF1dG9Qb3NpdGlvbih0YXJnZXRFbFBvc2l0aW9uLCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxlbWVudCwgcGxhY2VtZW50U2Vjb25kYXJ5KTtcbiAgICAgICAgICAgIGlmICghbmV3UGxhY2VtZW50UHJpbWFyeSkge1xuICAgICAgICAgICAgICAgIG5ld1BsYWNlbWVudFByaW1hcnkgPSB0aGlzLmF1dG9Qb3NpdGlvbih0YXJnZXRFbFBvc2l0aW9uLCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmV3UGxhY2VtZW50UHJpbWFyeSkge1xuICAgICAgICAgICAgICAgIHBsYWNlbWVudFByaW1hcnkgPSBuZXdQbGFjZW1lbnRQcmltYXJ5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHBsYWNlbWVudFByaW1hcnkpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChwbGFjZW1lbnRQcmltYXJ5KSB7XG4gICAgICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24uYm90dG9tID0gZG9jdW1lbnRDbGllbnRIZWlnaHQgLSBob3N0RWxQb3NpdGlvbi50b3AgKyBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuYXV0b0FkYXB0VG9wQm90dG9tKHBsYWNlbWVudFByaW1hcnksIGhvc3RFbFBvc2l0aW9uLCB0YXJnZXRFbFBvc2l0aW9uLCBvZmZzZXQsIGF1dG9BZGFwdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVMZWZ0UmlnaHRQb3NpdGlvbihwbGFjZW1lbnRTZWNvbmRhcnksIGhvc3RFbFBvc2l0aW9uLCB0YXJnZXRFbFBvc2l0aW9uLCBvZmZzZXQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLnRvcCA9IGhvc3RFbFBvc2l0aW9uLnRvcCArIGhvc3RFbFBvc2l0aW9uLmhlaWdodCArIG9mZnNldDtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9BZGFwdFRvcEJvdHRvbShwbGFjZW1lbnRQcmltYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0LCBhdXRvQWRhcHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlTGVmdFJpZ2h0UG9zaXRpb24ocGxhY2VtZW50U2Vjb25kYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zaXRpb24ucmlnaHQgPSBkb2N1bWVudENsaWVudFdpZHRoIC0gaG9zdEVsUG9zaXRpb24ubGVmdCArIG9mZnNldDtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlVG9wQm90dG9tUG9zaXRpb24ocGxhY2VtZW50U2Vjb25kYXJ5LCBob3N0RWxQb3NpdGlvbiwgdGFyZ2V0RWxQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvc2l0aW9uLmxlZnQgPSBob3N0RWxQb3NpdGlvbi5sZWZ0ICsgaG9zdEVsUG9zaXRpb24ud2lkdGggKyBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3NpdGlvbi5yaWdodCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVUb3BCb3R0b21Qb3NpdGlvbihwbGFjZW1lbnRTZWNvbmRhcnksIGhvc3RFbFBvc2l0aW9uLCB0YXJnZXRFbFBvc2l0aW9uLCBvZmZzZXQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGFyZ2V0RWxQb3NpdGlvbi50b3AgPSBNYXRoLnJvdW5kKHRhcmdldEVsUG9zaXRpb24udG9wKTtcbiAgICAgICAgLy8gdGFyZ2V0RWxQb3NpdGlvbi5ib3R0b20gPSBNYXRoLnJvdW5kKHRhcmdldEVsUG9zaXRpb24uYm90dG9tKTtcbiAgICAgICAgLy8gdGFyZ2V0RWxQb3NpdGlvbi5sZWZ0ID0gTWF0aC5yb3VuZCh0YXJnZXRFbFBvc2l0aW9uLmxlZnQpO1xuICAgICAgICAvLyB0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0ID0gTWF0aC5yb3VuZCh0YXJnZXRFbFBvc2l0aW9uLnJpZ2h0KTtcblxuICAgICAgICByZXR1cm4gdGFyZ2V0RWxQb3NpdGlvbjtcbiAgICB9XG5cbiAgICBzZXRQb3NpdGlvbihvcHRpb25zOiBQb3NpdGlvbmluZ09wdGlvbnMpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBhdHRhY2gsIHRhcmdldCB9ID0gb3B0aW9ucztcbiAgICAgICAgY29uc3QgYXR0YWNoRWxlbWVudCA9IFRoeVBvc2l0aW9uaW5nU2VydmljZS5nZXRIVE1MRWxlbWVudChhdHRhY2gpO1xuICAgICAgICBjb25zdCB0YXJnZXRFbGVtZW50ID0gVGh5UG9zaXRpb25pbmdTZXJ2aWNlLmdldEhUTUxFbGVtZW50KHRhcmdldCk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHRoaXMuY2FsY3VsYXRlUG9zaXRpb24oYXR0YWNoRWxlbWVudCwgdGFyZ2V0RWxlbWVudCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyKHBvcy50b3ApKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUudG9wID0gYCR7cG9zLnRvcH1weGA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc051bWJlcihwb3MuYm90dG9tKSkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLmJvdHRvbSA9IGAke3Bvcy5ib3R0b219cHhgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXIocG9zLmxlZnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3Bvcy5sZWZ0fXB4YDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKHBvcy5yaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5yaWdodCA9IGAke3Bvcy5yaWdodH1weGA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==