import { Component, Input, Output, ViewEncapsulation, HostBinding, EventEmitter, ContentChild, TemplateRef } from '@angular/core';
import { TransferDirection } from './transfer.interface';
import * as ɵngcc0 from '@angular/core';

const _c0 = ["renderTemplate"];
const _c1 = ["renderLeftTemplate"];
const _c2 = ["renderRightTemplate"];
function ThyTransferComponent_ng_template_1_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "thy-icon", 14);
    ɵngcc0.ɵɵelementContainerEnd();
} }
function ThyTransferComponent_ng_template_1_ng_template_3_Template(rf, ctx) { }
function ThyTransferComponent_ng_template_1_thy_icon_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "thy-icon", 15);
} }
const _c3 = function (a0) { return { "un-select-item": a0 }; };
const _c4 = function (a0) { return { $implicit: a0 }; };
function ThyTransferComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    const _r11 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵlistener("click", function ThyTransferComponent_ng_template_1_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r11); const item_r6 = ctx.$implicit; const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.onSelect(item_r6.direction === "left" ? "left" : "right", { item: item_r6 }); });
    ɵngcc0.ɵɵtemplate(1, ThyTransferComponent_ng_template_1_ng_container_1_Template, 2, 0, "ng-container", 10);
    ɵngcc0.ɵɵelementStart(2, "div", 11);
    ɵngcc0.ɵɵtemplate(3, ThyTransferComponent_ng_template_1_ng_template_3_Template, 0, 0, "ng-template", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, ThyTransferComponent_ng_template_1_thy_icon_4_Template, 1, 0, "thy-icon", 13);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r6 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    const _r4 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.thyLeftDraggable);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(5, _c3, item_r6.direction !== "right"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r4)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(7, _c4, item_r6));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", item_r6.direction === "right");
} }
function ThyTransferComponent_ng_template_9_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "thy-icon", 14);
    ɵngcc0.ɵɵelementContainerEnd();
} }
function ThyTransferComponent_ng_template_9_ng_template_2_Template(rf, ctx) { }
function ThyTransferComponent_ng_template_9_a_3_Template(rf, ctx) { if (rf & 1) {
    const _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "a", 18);
    ɵngcc0.ɵɵlistener("click", function ThyTransferComponent_ng_template_9_a_3_Template_a_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r18); const item_r12 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r16 = ɵngcc0.ɵɵnextContext(); return ctx_r16.onSelect("right", { item: item_r12 }); });
    ɵngcc0.ɵɵelement(1, "thy-icon", 19);
    ɵngcc0.ɵɵelementEnd();
} }
function ThyTransferComponent_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ThyTransferComponent_ng_template_9_ng_container_0_Template, 2, 0, "ng-container", 10);
    ɵngcc0.ɵɵelementStart(1, "div", 16);
    ɵngcc0.ɵɵtemplate(2, ThyTransferComponent_ng_template_9_ng_template_2_Template, 0, 0, "ng-template", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(3, ThyTransferComponent_ng_template_9_a_3_Template, 2, 0, "a", 17);
} if (rf & 2) {
    const item_r12 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    const _r4 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.thyRightDraggable);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r4)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(4, _c4, item_r12));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", item_r12.direction === "right" && !item_r12.isFixed);
} }
function ThyTransferComponent_ng_template_11_0_ng_template_0_Template(rf, ctx) { }
function ThyTransferComponent_ng_template_11_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ThyTransferComponent_ng_template_11_0_ng_template_0_Template, 0, 0, "ng-template", 12);
} if (rf & 2) {
    const item_r19 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r20 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r20.templateRef)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(2, _c4, item_r19));
} }
function ThyTransferComponent_ng_template_11_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "thy-flexible-text", 20);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const item_r19 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("thyTooltipContent", item_r19.title);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", item_r19.title, " ");
} }
function ThyTransferComponent_ng_template_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ThyTransferComponent_ng_template_11_0_Template, 1, 4, undefined, 10);
    ɵngcc0.ɵɵtemplate(1, ThyTransferComponent_ng_template_11_ng_container_1_Template, 3, 2, "ng-container", 10);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.templateRef);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r5.templateRef);
} }
export class ThyTransferComponent {
    constructor() {
        this.hostClass = 'thy-transfer';
        this.leftDataSource = [];
        this.rightDataSource = [];
        this.allDataSource = [];
        this.rightDraggable = false;
        this._autoMove = true;
        this.thyDraggableUpdate = new EventEmitter();
        this.thyChange = new EventEmitter();
    }
    set thyData(value) {
        if (value) {
            this.initializeTransferData(value);
        }
    }
    // @Input() transferToRight
    set thyTitles(value) {
        this.leftTitle = value[0] || '';
        this.rightTitle = value[1] || '';
    }
    // Currently not implemented, in order to support the selections move
    set thyAutoMove(value) {
        this._autoMove = value;
    }
    ngOnInit() { }
    initializeTransferData(data = []) {
        this.allDataSource = [];
        this.leftDataSource = [];
        this.rightDataSource = [];
        data.forEach(item => {
            this.allDataSource.push(item);
            if (item.direction === TransferDirection.left) {
                this.leftDataSource.push(item);
            }
            if (item.direction === TransferDirection.right) {
                this.rightDataSource.push(item);
            }
        });
    }
    onSelect(from, event) {
        if (event.item.isFixed) {
            return;
        }
        const to = from === TransferDirection.left ? TransferDirection.right : TransferDirection.left;
        event.item.checked = !event.item.checked;
        if (this._autoMove) {
            this.onMove(to);
        }
    }
    selectItem(event) {
        this.onSelect(TransferDirection.left, event);
    }
    unselectItem(event) {
        this.onSelect(TransferDirection.right, event);
    }
    groupListByIsLock(list = []) {
        const lock = [], unlock = [];
        list.forEach(item => {
            if (item.isLock) {
                lock.push(item);
            }
            else {
                unlock.push(item);
            }
        });
        return { lock: lock, unlock: unlock };
    }
    onMove(to) {
        const fromDataSource = to === TransferDirection.right ? this.leftDataSource : this.rightDataSource;
        const toDataSource = to === TransferDirection.right ? this.rightDataSource : this.leftDataSource;
        const selections = fromDataSource.filter(item => item.checked);
        const changeEvent = {
            from: to === TransferDirection.right ? TransferDirection.left : TransferDirection.right,
            to: to,
            items: [...selections]
        };
        selections.forEach(item => {
            const index = fromDataSource.indexOf(item);
            const removed = fromDataSource.splice(index, 1)[0];
            removed.checked = !removed.checked;
            removed.direction = to;
            toDataSource.push(removed);
        });
        this.thyChange.emit(Object.assign(Object.assign({}, changeEvent), { left: this.groupListByIsLock(this.leftDataSource), right: this.groupListByIsLock(this.rightDataSource) }));
    }
    onDragUpdate(direction, event) {
        const otherDirectionData = direction === TransferDirection.left ? this.rightDataSource : this.leftDataSource;
        const otherListData = this.groupListByIsLock(otherDirectionData);
        this.thyDraggableUpdate.emit(Object.assign(Object.assign({}, event.dragEvent), { left: direction === TransferDirection.left ? event.listData : otherListData, right: direction === TransferDirection.right ? event.listData : otherListData }));
    }
}
ThyTransferComponent.ɵfac = function ThyTransferComponent_Factory(t) { return new (t || ThyTransferComponent)(); };
ThyTransferComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThyTransferComponent, selectors: [["thy-transfer"]], contentQueries: function ThyTransferComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, _c0, true);
        ɵngcc0.ɵɵcontentQuery(dirIndex, _c1, true);
        ɵngcc0.ɵɵcontentQuery(dirIndex, _c2, true);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.templateRef = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.leftContentRef = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.rightContentRef = _t.first);
    } }, hostVars: 2, hostBindings: function ThyTransferComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassMap(ctx.hostClass);
    } }, inputs: { thyData: "thyData", thyTitles: "thyTitles", thyAutoMove: "thyAutoMove", thyrenderLeftTemplateRef: "thyrenderLeftTemplateRef", thyrenderRightTemplateRef: "thyrenderRightTemplateRef", thyRightCanLock: "thyRightCanLock", thyRightLockMax: "thyRightLockMax", thyLeftDraggable: "thyLeftDraggable", thyRightDraggable: "thyRightDraggable" }, outputs: { thyDraggableUpdate: "thyDraggableUpdate", thyChange: "thyChange" }, decls: 13, vars: 12, consts: [[3, "items", "title", "draggable", "renderContentRef", "template", "draggableUpdate", "selectItem", "unselectItem"], ["leftTemplateRef", ""], [1, "thy-transfer-operation"], [1, "thy-transfer-operation-body"], ["thyIconName", "angle-right", 1, "operation-link"], ["thyIconName", "angle-left", 1, "operation-link"], [3, "items", "title", "draggable", "canLock", "maxLock", "template", "renderContentRef", "draggableUpdate", "selectItem", "unselectItem"], ["rightTemplateRef", ""], ["thyTransferListItem", ""], [1, "list-item-content", 3, "click"], [4, "ngIf"], [1, "item-name", 3, "ngClass"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"], ["class", "text-primary item-status", "thyIconName", "check", 4, "ngIf"], ["thyIconName", "drag", 1, "drag-handle"], ["thyIconName", "check", 1, "text-primary", "item-status"], [1, "item-name"], ["class", "link-secondary", 3, "click", 4, "ngIf"], [1, "link-secondary", 3, "click"], ["thyIconName", "close", 1, "item-status"], [3, "thyTooltipContent"]], template: function ThyTransferComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "thy-transfer-list", 0);
        ɵngcc0.ɵɵlistener("draggableUpdate", function ThyTransferComponent_Template_thy_transfer_list_draggableUpdate_0_listener($event) { return ctx.onDragUpdate("left", $event); })("selectItem", function ThyTransferComponent_Template_thy_transfer_list_selectItem_0_listener($event) { return ctx.selectItem($event); })("unselectItem", function ThyTransferComponent_Template_thy_transfer_list_unselectItem_0_listener($event) { return ctx.unselectItem($event); });
        ɵngcc0.ɵɵtemplate(1, ThyTransferComponent_ng_template_1_Template, 5, 9, "ng-template", null, 1, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "div", 2);
        ɵngcc0.ɵɵelementStart(4, "div", 3);
        ɵngcc0.ɵɵelement(5, "thy-icon", 4);
        ɵngcc0.ɵɵelement(6, "br");
        ɵngcc0.ɵɵelement(7, "thy-icon", 5);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "thy-transfer-list", 6);
        ɵngcc0.ɵɵlistener("draggableUpdate", function ThyTransferComponent_Template_thy_transfer_list_draggableUpdate_8_listener($event) { return ctx.onDragUpdate("right", $event); })("selectItem", function ThyTransferComponent_Template_thy_transfer_list_selectItem_8_listener($event) { return ctx.selectItem($event); })("unselectItem", function ThyTransferComponent_Template_thy_transfer_list_unselectItem_8_listener($event) { return ctx.unselectItem($event); });
        ɵngcc0.ɵɵtemplate(9, ThyTransferComponent_ng_template_9_Template, 4, 6, "ng-template", null, 7, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(11, ThyTransferComponent_ng_template_11_Template, 2, 2, "ng-template", null, 8, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r0 = ɵngcc0.ɵɵreference(2);
        const _r2 = ɵngcc0.ɵɵreference(10);
        ɵngcc0.ɵɵproperty("items", ctx.allDataSource)("title", ctx.leftTitle)("draggable", ctx.thyLeftDraggable)("renderContentRef", ctx.leftContentRef)("template", _r0);
        ɵngcc0.ɵɵadvance(8);
        ɵngcc0.ɵɵproperty("items", ctx.rightDataSource)("title", ctx.rightTitle)("draggable", ctx.thyRightDraggable)("canLock", ctx.thyRightCanLock)("maxLock", ctx.thyRightLockMax)("template", _r2)("renderContentRef", ctx.rightContentRef);
    } }, encapsulation: 2 });
ThyTransferComponent.propDecorators = {
    hostClass: [{ type: HostBinding, args: ['class',] }],
    thyData: [{ type: Input }],
    thyrenderLeftTemplateRef: [{ type: Input }],
    thyrenderRightTemplateRef: [{ type: Input }],
    thyTitles: [{ type: Input }],
    thyRightCanLock: [{ type: Input }],
    thyRightLockMax: [{ type: Input }],
    thyAutoMove: [{ type: Input }],
    thyLeftDraggable: [{ type: Input }],
    thyRightDraggable: [{ type: Input }],
    thyDraggableUpdate: [{ type: Output }],
    thyChange: [{ type: Output }],
    templateRef: [{ type: ContentChild, args: ['renderTemplate',] }],
    leftContentRef: [{ type: ContentChild, args: ['renderLeftTemplate',] }],
    rightContentRef: [{ type: ContentChild, args: ['renderRightTemplate',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyTransferComponent, [{
        type: Component,
        args: [{
                selector: 'thy-transfer',
                template: "<thy-transfer-list\n  [items]=\"allDataSource\"\n  [title]=\"leftTitle\"\n  [draggable]=\"thyLeftDraggable\"\n  [renderContentRef]=\"leftContentRef\"\n  (draggableUpdate)=\"onDragUpdate('left', $event)\"\n  [template]=\"leftTemplateRef\"\n  (selectItem)=\"selectItem($event)\"\n  (unselectItem)=\"unselectItem($event)\"\n>\n  <ng-template #leftTemplateRef let-item>\n    <div (click)=\"onSelect(item.direction === 'left' ? 'left' : 'right', { item: item })\" class=\"list-item-content\">\n      <ng-container *ngIf=\"thyLeftDraggable\">\n        <thy-icon thyIconName=\"drag\" class=\"drag-handle\"></thy-icon>\n      </ng-container>\n      <div class=\"item-name\" [ngClass]=\"{ 'un-select-item': item.direction !== 'right' }\">\n        <ng-template [ngTemplateOutlet]=\"thyTransferListItem\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n      </div>\n      <thy-icon *ngIf=\"item.direction === 'right'\" class=\"text-primary item-status\" thyIconName=\"check\"></thy-icon>\n    </div>\n  </ng-template>\n</thy-transfer-list>\n\n<div class=\"thy-transfer-operation\">\n  <div class=\"thy-transfer-operation-body\">\n    <thy-icon thyIconName=\"angle-right\" class=\"operation-link\"></thy-icon>\n    <br />\n    <thy-icon thyIconName=\"angle-left\" class=\"operation-link\"></thy-icon>\n  </div>\n</div>\n\n<thy-transfer-list\n  [items]=\"rightDataSource\"\n  [title]=\"rightTitle\"\n  [draggable]=\"thyRightDraggable\"\n  (draggableUpdate)=\"onDragUpdate('right', $event)\"\n  [canLock]=\"thyRightCanLock\"\n  [maxLock]=\"thyRightLockMax\"\n  [template]=\"rightTemplateRef\"\n  [renderContentRef]=\"rightContentRef\"\n  (selectItem)=\"selectItem($event)\"\n  (unselectItem)=\"unselectItem($event)\"\n>\n  <ng-template #rightTemplateRef let-item>\n    <ng-container *ngIf=\"thyRightDraggable\">\n      <thy-icon thyIconName=\"drag\" class=\"drag-handle\"></thy-icon>\n    </ng-container>\n    <div class=\"item-name\">\n      <ng-template [ngTemplateOutlet]=\"thyTransferListItem\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n    </div>\n    <a class=\"link-secondary\" *ngIf=\"item.direction === 'right' && !item.isFixed\" (click)=\"onSelect('right', { item: item })\">\n      <thy-icon class=\"item-status\" thyIconName=\"close\"></thy-icon>\n    </a>\n  </ng-template>\n</thy-transfer-list>\n\n<ng-template #thyTransferListItem let-item>\n  <ng-template *ngIf=\"templateRef\" [ngTemplateOutlet]=\"templateRef\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n  <ng-container *ngIf=\"!templateRef\">\n    <thy-flexible-text [thyTooltipContent]=\"item.title\">\n      {{ item.title }}\n    </thy-flexible-text>\n  </ng-container>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None
            }]
    }], function () { return []; }, { hostClass: [{
            type: HostBinding,
            args: ['class']
        }], thyDraggableUpdate: [{
            type: Output
        }], thyChange: [{
            type: Output
        }], thyData: [{
            type: Input
        }], thyTitles: [{
            type: Input
        }], thyAutoMove: [{
            type: Input
        }], thyrenderLeftTemplateRef: [{
            type: Input
        }], thyrenderRightTemplateRef: [{
            type: Input
        }], thyRightCanLock: [{
            type: Input
        }], thyRightLockMax: [{
            type: Input
        }], thyLeftDraggable: [{
            type: Input
        }], thyRightDraggable: [{
            type: Input
        }], templateRef: [{
            type: ContentChild,
            args: ['renderTemplate']
        }], leftContentRef: [{
            type: ContentChild,
            args: ['renderLeftTemplate']
        }], rightContentRef: [{
            type: ContentChild,
            args: ['renderRightTemplate']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdHJhbnNmZXIvdHJhbnNmZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFFMUksT0FBTyxFQU9ILGlCQUFpQixFQUNwQixNQUFNLHNCQUFzQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPOUIsTUFBTSxPQUFPLG9CQUFvQjtBQUFHLElBTHBDO0FBQ0csUUFLdUIsY0FBUyxHQUFHLGNBQWMsQ0FBQztBQUNyRCxRQUNXLG1CQUFjLEdBQXNCLEVBQUUsQ0FBQztBQUNsRCxRQUNXLG9CQUFlLEdBQXNCLEVBQUUsQ0FBQztBQUNuRCxRQUNXLGtCQUFhLEdBQXNCLEVBQUUsQ0FBQztBQUNqRCxRQUtXLG1CQUFjLEdBQUcsS0FBSyxDQUFDO0FBQ2xDLFFBQ1ksY0FBUyxHQUFHLElBQUksQ0FBQztBQUM3QixRQWtDYyx1QkFBa0IsR0FBdUMsSUFBSSxZQUFZLEVBQXdCLENBQUM7QUFDaEgsUUFDYyxjQUFTLEdBQXlDLElBQUksWUFBWSxFQUEwQixDQUFDO0FBQzNHLElBd0ZBLENBQUM7QUFDRCxJQTdISSxJQUNJLE9BQU8sQ0FBQyxLQUF3QjtBQUN4QyxRQUFRLElBQUksS0FBSyxFQUFFO0FBQ25CLFlBQVksSUFBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQy9DLFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDTCxJQUtJLDJCQUEyQjtBQUMvQixJQUNJLElBQ0ksU0FBUyxDQUFDLEtBQWU7QUFDakMs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Ozs7Ozs7Ozs7Ozs2QkFDSTtBQUFDO0FBQXdDLHdCQUN6QyxXQUFXLFNBQUMsT0FBTztBQUFPLHNCQWdCMUIsS0FBSztBQUNSLHVDQU1HLEtBQUs7QUFBSyx3Q0FFVixLQUFLO0FBQUssd0JBSVYsS0FBSztBQUNSLDhCQUtHLEtBQUs7QUFBSyw4QkFFVixLQUFLO0FBQUssMEJBR1YsS0FBSztBQUNSLCtCQUlHLEtBQUs7QUFBSyxnQ0FFVixLQUFLO0FBQUssaUNBRVYsTUFBTTtBQUFLLHdCQUVYLE1BQU07QUFBSywwQkFFWCxZQUFZLFNBQUMsZ0JBQWdCO0FBQU8sNkJBRXBDLFlBQVksU0FBQyxvQkFBb0I7QUFBTyw4QkFFeEMsWUFBWSxTQUFDLHFCQUFxQjtBQUFNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIGlzT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBWaWV3RW5jYXBzdWxhdGlvbiwgSG9zdEJpbmRpbmcsIEV2ZW50RW1pdHRlciwgQ29udGVudENoaWxkLCBUZW1wbGF0ZVJlZiwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gICAgVGh5VHJhbnNmZXJJdGVtLFxuICAgIFRoeVRyYW5zZmVyQ2hhbmdlRXZlbnQsXG4gICAgVGh5VHJhbnNmZXJTZWxlY3RFdmVudCxcbiAgICBUaHlUcmFuc2ZlckRyYWdFdmVudCxcbiAgICBJbm5lclRyYW5zZmVyRHJhZ0V2ZW50LFxuICAgIERpcmVjdGlvbixcbiAgICBUcmFuc2ZlckRpcmVjdGlvblxufSBmcm9tICcuL3RyYW5zZmVyLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGh5LXRyYW5zZmVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdHJhbnNmZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgVGh5VHJhbnNmZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIEBIb3N0QmluZGluZygnY2xhc3MnKSBob3N0Q2xhc3MgPSAndGh5LXRyYW5zZmVyJztcblxuICAgIHB1YmxpYyBsZWZ0RGF0YVNvdXJjZTogVGh5VHJhbnNmZXJJdGVtW10gPSBbXTtcblxuICAgIHB1YmxpYyByaWdodERhdGFTb3VyY2U6IFRoeVRyYW5zZmVySXRlbVtdID0gW107XG5cbiAgICBwdWJsaWMgYWxsRGF0YVNvdXJjZTogVGh5VHJhbnNmZXJJdGVtW10gPSBbXTtcblxuICAgIHB1YmxpYyBsZWZ0VGl0bGU6IHN0cmluZztcblxuICAgIHB1YmxpYyByaWdodFRpdGxlOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgcmlnaHREcmFnZ2FibGUgPSBmYWxzZTtcblxuICAgIHByaXZhdGUgX2F1dG9Nb3ZlID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeURhdGEodmFsdWU6IFRoeVRyYW5zZmVySXRlbVtdKSB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplVHJhbnNmZXJEYXRhKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBJbnB1dCgpIHRoeXJlbmRlckxlZnRUZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIEBJbnB1dCgpIHRoeXJlbmRlclJpZ2h0VGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICAvLyBASW5wdXQoKSB0cmFuc2ZlclRvUmlnaHRcblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeVRpdGxlcyh2YWx1ZTogc3RyaW5nW10pIHtcbiAgICAgICAgdGhpcy5sZWZ0VGl0bGUgPSB2YWx1ZVswXSB8fCAnJztcbiAgICAgICAgdGhpcy5yaWdodFRpdGxlID0gdmFsdWVbMV0gfHwgJyc7XG4gICAgfVxuXG4gICAgQElucHV0KCkgdGh5UmlnaHRDYW5Mb2NrOiBib29sZWFuO1xuXG4gICAgQElucHV0KCkgdGh5UmlnaHRMb2NrTWF4OiBudW1iZXI7XG5cbiAgICAvLyBDdXJyZW50bHkgbm90IGltcGxlbWVudGVkLCBpbiBvcmRlciB0byBzdXBwb3J0IHRoZSBzZWxlY3Rpb25zIG1vdmVcbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlBdXRvTW92ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLl9hdXRvTW92ZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIHRoeUxlZnREcmFnZ2FibGU6IGJvb2xlYW47XG5cbiAgICBASW5wdXQoKSB0aHlSaWdodERyYWdnYWJsZTogYm9vbGVhbjtcblxuICAgIEBPdXRwdXQoKSB0aHlEcmFnZ2FibGVVcGRhdGU6IEV2ZW50RW1pdHRlcjxUaHlUcmFuc2ZlckRyYWdFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFRoeVRyYW5zZmVyRHJhZ0V2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpIHRoeUNoYW5nZTogRXZlbnRFbWl0dGVyPFRoeVRyYW5zZmVyQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUaHlUcmFuc2ZlckNoYW5nZUV2ZW50PigpO1xuXG4gICAgQENvbnRlbnRDaGlsZCgncmVuZGVyVGVtcGxhdGUnKSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIEBDb250ZW50Q2hpbGQoJ3JlbmRlckxlZnRUZW1wbGF0ZScpIGxlZnRDb250ZW50UmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gICAgQENvbnRlbnRDaGlsZCgncmVuZGVyUmlnaHRUZW1wbGF0ZScpIHJpZ2h0Q29udGVudFJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIG5nT25Jbml0KCkge31cblxuICAgIGluaXRpYWxpemVUcmFuc2ZlckRhdGEoZGF0YTogVGh5VHJhbnNmZXJJdGVtW10gPSBbXSkge1xuICAgICAgICB0aGlzLmFsbERhdGFTb3VyY2UgPSBbXTtcbiAgICAgICAgdGhpcy5sZWZ0RGF0YVNvdXJjZSA9IFtdO1xuICAgICAgICB0aGlzLnJpZ2h0RGF0YVNvdXJjZSA9IFtdO1xuICAgICAgICBkYXRhLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFsbERhdGFTb3VyY2UucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGlmIChpdGVtLmRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGVmdERhdGFTb3VyY2UucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0RGF0YVNvdXJjZS5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvblNlbGVjdChmcm9tOiBEaXJlY3Rpb24sIGV2ZW50OiBUaHlUcmFuc2ZlclNlbGVjdEV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5pdGVtLmlzRml4ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0byA9IGZyb20gPT09IFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQgPyBUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCA6IFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQ7XG4gICAgICAgIGV2ZW50Lml0ZW0uY2hlY2tlZCA9ICFldmVudC5pdGVtLmNoZWNrZWQ7XG4gICAgICAgIGlmICh0aGlzLl9hdXRvTW92ZSkge1xuICAgICAgICAgICAgdGhpcy5vbk1vdmUodG8pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZWN0SXRlbShldmVudDogVGh5VHJhbnNmZXJTZWxlY3RFdmVudCkge1xuICAgICAgICB0aGlzLm9uU2VsZWN0KFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQsIGV2ZW50KTtcbiAgICB9XG5cbiAgICB1bnNlbGVjdEl0ZW0oZXZlbnQ6IFRoeVRyYW5zZmVyU2VsZWN0RXZlbnQpIHtcbiAgICAgICAgdGhpcy5vblNlbGVjdChUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCwgZXZlbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ3JvdXBMaXN0QnlJc0xvY2sobGlzdDogVGh5VHJhbnNmZXJJdGVtW10gPSBbXSkge1xuICAgICAgICBjb25zdCBsb2NrOiBUaHlUcmFuc2Zlckl0ZW1bXSA9IFtdLFxuICAgICAgICAgICAgdW5sb2NrOiBUaHlUcmFuc2Zlckl0ZW1bXSA9IFtdO1xuICAgICAgICBsaXN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS5pc0xvY2spIHtcbiAgICAgICAgICAgICAgICBsb2NrLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVubG9jay5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgbG9jazogbG9jaywgdW5sb2NrOiB1bmxvY2sgfTtcbiAgICB9XG5cbiAgICBvbk1vdmUodG86IERpcmVjdGlvbikge1xuICAgICAgICBjb25zdCBmcm9tRGF0YVNvdXJjZSA9IHRvID09PSBUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCA/IHRoaXMubGVmdERhdGFTb3VyY2UgOiB0aGlzLnJpZ2h0RGF0YVNvdXJjZTtcbiAgICAgICAgY29uc3QgdG9EYXRhU291cmNlID0gdG8gPT09IFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0ID8gdGhpcy5yaWdodERhdGFTb3VyY2UgOiB0aGlzLmxlZnREYXRhU291cmNlO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25zID0gZnJvbURhdGFTb3VyY2UuZmlsdGVyKGl0ZW0gPT4gaXRlbS5jaGVja2VkKTtcbiAgICAgICAgY29uc3QgY2hhbmdlRXZlbnQ6IFRoeVRyYW5zZmVyQ2hhbmdlRXZlbnQgPSB7XG4gICAgICAgICAgICBmcm9tOiB0byA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQgPyBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0IDogVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQsXG4gICAgICAgICAgICB0bzogdG8sXG4gICAgICAgICAgICBpdGVtczogWy4uLnNlbGVjdGlvbnNdXG4gICAgICAgIH07XG4gICAgICAgIHNlbGVjdGlvbnMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZnJvbURhdGFTb3VyY2UuaW5kZXhPZihpdGVtKTtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZWQgPSBmcm9tRGF0YVNvdXJjZS5zcGxpY2UoaW5kZXgsIDEpWzBdO1xuICAgICAgICAgICAgcmVtb3ZlZC5jaGVja2VkID0gIXJlbW92ZWQuY2hlY2tlZDtcbiAgICAgICAgICAgIHJlbW92ZWQuZGlyZWN0aW9uID0gdG87XG4gICAgICAgICAgICB0b0RhdGFTb3VyY2UucHVzaChyZW1vdmVkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudGh5Q2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgLi4uY2hhbmdlRXZlbnQsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmdyb3VwTGlzdEJ5SXNMb2NrKHRoaXMubGVmdERhdGFTb3VyY2UpLFxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMuZ3JvdXBMaXN0QnlJc0xvY2sodGhpcy5yaWdodERhdGFTb3VyY2UpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uRHJhZ1VwZGF0ZShkaXJlY3Rpb246IERpcmVjdGlvbiwgZXZlbnQ6IElubmVyVHJhbnNmZXJEcmFnRXZlbnQpIHtcbiAgICAgICAgY29uc3Qgb3RoZXJEaXJlY3Rpb25EYXRhID0gZGlyZWN0aW9uID09PSBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0ID8gdGhpcy5yaWdodERhdGFTb3VyY2UgOiB0aGlzLmxlZnREYXRhU291cmNlO1xuICAgICAgICBjb25zdCBvdGhlckxpc3REYXRhID0gdGhpcy5ncm91cExpc3RCeUlzTG9jayhvdGhlckRpcmVjdGlvbkRhdGEpO1xuICAgICAgICB0aGlzLnRoeURyYWdnYWJsZVVwZGF0ZS5lbWl0KHtcbiAgICAgICAgICAgIC4uLmV2ZW50LmRyYWdFdmVudCxcbiAgICAgICAgICAgIGxlZnQ6IGRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCA/IGV2ZW50Lmxpc3REYXRhIDogb3RoZXJMaXN0RGF0YSxcbiAgICAgICAgICAgIHJpZ2h0OiBkaXJlY3Rpb24gPT09IFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0ID8gZXZlbnQubGlzdERhdGEgOiBvdGhlckxpc3REYXRhXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==