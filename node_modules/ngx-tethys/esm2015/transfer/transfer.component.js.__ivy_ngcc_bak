import { Component, Input, Output, ViewEncapsulation, HostBinding, EventEmitter, ContentChild, TemplateRef } from '@angular/core';
import { TransferDirection } from './transfer.interface';
export class ThyTransferComponent {
    constructor() {
        this.hostClass = 'thy-transfer';
        this.leftDataSource = [];
        this.rightDataSource = [];
        this.allDataSource = [];
        this.rightDraggable = false;
        this._autoMove = true;
        this.thyDraggableUpdate = new EventEmitter();
        this.thyChange = new EventEmitter();
    }
    set thyData(value) {
        if (value) {
            this.initializeTransferData(value);
        }
    }
    // @Input() transferToRight
    set thyTitles(value) {
        this.leftTitle = value[0] || '';
        this.rightTitle = value[1] || '';
    }
    // Currently not implemented, in order to support the selections move
    set thyAutoMove(value) {
        this._autoMove = value;
    }
    ngOnInit() { }
    initializeTransferData(data = []) {
        this.allDataSource = [];
        this.leftDataSource = [];
        this.rightDataSource = [];
        data.forEach(item => {
            this.allDataSource.push(item);
            if (item.direction === TransferDirection.left) {
                this.leftDataSource.push(item);
            }
            if (item.direction === TransferDirection.right) {
                this.rightDataSource.push(item);
            }
        });
    }
    onSelect(from, event) {
        if (event.item.isFixed) {
            return;
        }
        const to = from === TransferDirection.left ? TransferDirection.right : TransferDirection.left;
        event.item.checked = !event.item.checked;
        if (this._autoMove) {
            this.onMove(to);
        }
    }
    selectItem(event) {
        this.onSelect(TransferDirection.left, event);
    }
    unselectItem(event) {
        this.onSelect(TransferDirection.right, event);
    }
    groupListByIsLock(list = []) {
        const lock = [], unlock = [];
        list.forEach(item => {
            if (item.isLock) {
                lock.push(item);
            }
            else {
                unlock.push(item);
            }
        });
        return { lock: lock, unlock: unlock };
    }
    onMove(to) {
        const fromDataSource = to === TransferDirection.right ? this.leftDataSource : this.rightDataSource;
        const toDataSource = to === TransferDirection.right ? this.rightDataSource : this.leftDataSource;
        const selections = fromDataSource.filter(item => item.checked);
        const changeEvent = {
            from: to === TransferDirection.right ? TransferDirection.left : TransferDirection.right,
            to: to,
            items: [...selections]
        };
        selections.forEach(item => {
            const index = fromDataSource.indexOf(item);
            const removed = fromDataSource.splice(index, 1)[0];
            removed.checked = !removed.checked;
            removed.direction = to;
            toDataSource.push(removed);
        });
        this.thyChange.emit(Object.assign(Object.assign({}, changeEvent), { left: this.groupListByIsLock(this.leftDataSource), right: this.groupListByIsLock(this.rightDataSource) }));
    }
    onDragUpdate(direction, event) {
        const otherDirectionData = direction === TransferDirection.left ? this.rightDataSource : this.leftDataSource;
        const otherListData = this.groupListByIsLock(otherDirectionData);
        this.thyDraggableUpdate.emit(Object.assign(Object.assign({}, event.dragEvent), { left: direction === TransferDirection.left ? event.listData : otherListData, right: direction === TransferDirection.right ? event.listData : otherListData }));
    }
}
ThyTransferComponent.decorators = [
    { type: Component, args: [{
                selector: 'thy-transfer',
                template: "<thy-transfer-list\n  [items]=\"allDataSource\"\n  [title]=\"leftTitle\"\n  [draggable]=\"thyLeftDraggable\"\n  [renderContentRef]=\"leftContentRef\"\n  (draggableUpdate)=\"onDragUpdate('left', $event)\"\n  [template]=\"leftTemplateRef\"\n  (selectItem)=\"selectItem($event)\"\n  (unselectItem)=\"unselectItem($event)\"\n>\n  <ng-template #leftTemplateRef let-item>\n    <div (click)=\"onSelect(item.direction === 'left' ? 'left' : 'right', { item: item })\" class=\"list-item-content\">\n      <ng-container *ngIf=\"thyLeftDraggable\">\n        <thy-icon thyIconName=\"drag\" class=\"drag-handle\"></thy-icon>\n      </ng-container>\n      <div class=\"item-name\" [ngClass]=\"{ 'un-select-item': item.direction !== 'right' }\">\n        <ng-template [ngTemplateOutlet]=\"thyTransferListItem\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n      </div>\n      <thy-icon *ngIf=\"item.direction === 'right'\" class=\"text-primary item-status\" thyIconName=\"check\"></thy-icon>\n    </div>\n  </ng-template>\n</thy-transfer-list>\n\n<div class=\"thy-transfer-operation\">\n  <div class=\"thy-transfer-operation-body\">\n    <thy-icon thyIconName=\"angle-right\" class=\"operation-link\"></thy-icon>\n    <br />\n    <thy-icon thyIconName=\"angle-left\" class=\"operation-link\"></thy-icon>\n  </div>\n</div>\n\n<thy-transfer-list\n  [items]=\"rightDataSource\"\n  [title]=\"rightTitle\"\n  [draggable]=\"thyRightDraggable\"\n  (draggableUpdate)=\"onDragUpdate('right', $event)\"\n  [canLock]=\"thyRightCanLock\"\n  [maxLock]=\"thyRightLockMax\"\n  [template]=\"rightTemplateRef\"\n  [renderContentRef]=\"rightContentRef\"\n  (selectItem)=\"selectItem($event)\"\n  (unselectItem)=\"unselectItem($event)\"\n>\n  <ng-template #rightTemplateRef let-item>\n    <ng-container *ngIf=\"thyRightDraggable\">\n      <thy-icon thyIconName=\"drag\" class=\"drag-handle\"></thy-icon>\n    </ng-container>\n    <div class=\"item-name\">\n      <ng-template [ngTemplateOutlet]=\"thyTransferListItem\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n    </div>\n    <a class=\"link-secondary\" *ngIf=\"item.direction === 'right' && !item.isFixed\" (click)=\"onSelect('right', { item: item })\">\n      <thy-icon class=\"item-status\" thyIconName=\"close\"></thy-icon>\n    </a>\n  </ng-template>\n</thy-transfer-list>\n\n<ng-template #thyTransferListItem let-item>\n  <ng-template *ngIf=\"templateRef\" [ngTemplateOutlet]=\"templateRef\" [ngTemplateOutletContext]=\"{ $implicit: item }\"></ng-template>\n  <ng-container *ngIf=\"!templateRef\">\n    <thy-flexible-text [thyTooltipContent]=\"item.title\">\n      {{ item.title }}\n    </thy-flexible-text>\n  </ng-container>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None
            },] }
];
ThyTransferComponent.propDecorators = {
    hostClass: [{ type: HostBinding, args: ['class',] }],
    thyData: [{ type: Input }],
    thyrenderLeftTemplateRef: [{ type: Input }],
    thyrenderRightTemplateRef: [{ type: Input }],
    thyTitles: [{ type: Input }],
    thyRightCanLock: [{ type: Input }],
    thyRightLockMax: [{ type: Input }],
    thyAutoMove: [{ type: Input }],
    thyLeftDraggable: [{ type: Input }],
    thyRightDraggable: [{ type: Input }],
    thyDraggableUpdate: [{ type: Output }],
    thyChange: [{ type: Output }],
    templateRef: [{ type: ContentChild, args: ['renderTemplate',] }],
    leftContentRef: [{ type: ContentChild, args: ['renderLeftTemplate',] }],
    rightContentRef: [{ type: ContentChild, args: ['renderRightTemplate',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RyYW5zZmVyL3RyYW5zZmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBRTFJLE9BQU8sRUFPSCxpQkFBaUIsRUFDcEIsTUFBTSxzQkFBc0IsQ0FBQztBQU85QixNQUFNLE9BQU8sb0JBQW9CO0lBTGpDO1FBTTBCLGNBQVMsR0FBRyxjQUFjLENBQUM7UUFFMUMsbUJBQWMsR0FBc0IsRUFBRSxDQUFDO1FBRXZDLG9CQUFlLEdBQXNCLEVBQUUsQ0FBQztRQUV4QyxrQkFBYSxHQUFzQixFQUFFLENBQUM7UUFNdEMsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFFdEIsY0FBUyxHQUFHLElBQUksQ0FBQztRQW1DZix1QkFBa0IsR0FBdUMsSUFBSSxZQUFZLEVBQXdCLENBQUM7UUFFbEcsY0FBUyxHQUF5QyxJQUFJLFlBQVksRUFBMEIsQ0FBQztJQXlGM0csQ0FBQztJQTVIRyxJQUNJLE9BQU8sQ0FBQyxLQUF3QjtRQUNoQyxJQUFJLEtBQUssRUFBRTtZQUNQLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN0QztJQUNMLENBQUM7SUFNRCwyQkFBMkI7SUFFM0IsSUFDSSxTQUFTLENBQUMsS0FBZTtRQUN6QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFNRCxxRUFBcUU7SUFDckUsSUFDSSxXQUFXLENBQUMsS0FBYztRQUMx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QixDQUFDLElBQUksaUNBQ3JCLEtBQUssQ0FBQyxTQUFTLEtBQ2xCLElBQUksRUFBRSxTQUFTLEtBQUssaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQzNFLEtBQUssRUFBRSxTQUFTLEtBQUssaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLElBQy9FLENBQUM7SUFDUCxDQUFDOzs7WUFqSkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxjQUFjO2dCQUN4QixtcUZBQXdDO2dCQUN4QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTthQUN4Qzs7O3dCQUVJLFdBQVcsU0FBQyxPQUFPO3NCQWdCbkIsS0FBSzt1Q0FPTCxLQUFLO3dDQUVMLEtBQUs7d0JBSUwsS0FBSzs4QkFNTCxLQUFLOzhCQUVMLEtBQUs7MEJBR0wsS0FBSzsrQkFLTCxLQUFLO2dDQUVMLEtBQUs7aUNBRUwsTUFBTTt3QkFFTixNQUFNOzBCQUVOLFlBQVksU0FBQyxnQkFBZ0I7NkJBRTdCLFlBQVksU0FBQyxvQkFBb0I7OEJBRWpDLFlBQVksU0FBQyxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBpc09ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgVmlld0VuY2Fwc3VsYXRpb24sIEhvc3RCaW5kaW5nLCBFdmVudEVtaXR0ZXIsIENvbnRlbnRDaGlsZCwgVGVtcGxhdGVSZWYsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICAgIFRoeVRyYW5zZmVySXRlbSxcbiAgICBUaHlUcmFuc2ZlckNoYW5nZUV2ZW50LFxuICAgIFRoeVRyYW5zZmVyU2VsZWN0RXZlbnQsXG4gICAgVGh5VHJhbnNmZXJEcmFnRXZlbnQsXG4gICAgSW5uZXJUcmFuc2ZlckRyYWdFdmVudCxcbiAgICBEaXJlY3Rpb24sXG4gICAgVHJhbnNmZXJEaXJlY3Rpb25cbn0gZnJvbSAnLi90cmFuc2Zlci5pbnRlcmZhY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RoeS10cmFuc2ZlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RyYW5zZmVyLmNvbXBvbmVudC5odG1sJyxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFRoeVRyYW5zZmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgaG9zdENsYXNzID0gJ3RoeS10cmFuc2Zlcic7XG5cbiAgICBwdWJsaWMgbGVmdERhdGFTb3VyY2U6IFRoeVRyYW5zZmVySXRlbVtdID0gW107XG5cbiAgICBwdWJsaWMgcmlnaHREYXRhU291cmNlOiBUaHlUcmFuc2Zlckl0ZW1bXSA9IFtdO1xuXG4gICAgcHVibGljIGFsbERhdGFTb3VyY2U6IFRoeVRyYW5zZmVySXRlbVtdID0gW107XG5cbiAgICBwdWJsaWMgbGVmdFRpdGxlOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgcmlnaHRUaXRsZTogc3RyaW5nO1xuXG4gICAgcHVibGljIHJpZ2h0RHJhZ2dhYmxlID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIF9hdXRvTW92ZSA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlEYXRhKHZhbHVlOiBUaHlUcmFuc2Zlckl0ZW1bXSkge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZVRyYW5zZmVyRGF0YSh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKSB0aHlyZW5kZXJMZWZ0VGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBASW5wdXQoKSB0aHlyZW5kZXJSaWdodFRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gICAgLy8gQElucHV0KCkgdHJhbnNmZXJUb1JpZ2h0XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlUaXRsZXModmFsdWU6IHN0cmluZ1tdKSB7XG4gICAgICAgIHRoaXMubGVmdFRpdGxlID0gdmFsdWVbMF0gfHwgJyc7XG4gICAgICAgIHRoaXMucmlnaHRUaXRsZSA9IHZhbHVlWzFdIHx8ICcnO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIHRoeVJpZ2h0Q2FuTG9jazogYm9vbGVhbjtcblxuICAgIEBJbnB1dCgpIHRoeVJpZ2h0TG9ja01heDogbnVtYmVyO1xuXG4gICAgLy8gQ3VycmVudGx5IG5vdCBpbXBsZW1lbnRlZCwgaW4gb3JkZXIgdG8gc3VwcG9ydCB0aGUgc2VsZWN0aW9ucyBtb3ZlXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5QXV0b01vdmUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5fYXV0b01vdmUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKSB0aHlMZWZ0RHJhZ2dhYmxlOiBib29sZWFuO1xuXG4gICAgQElucHV0KCkgdGh5UmlnaHREcmFnZ2FibGU6IGJvb2xlYW47XG5cbiAgICBAT3V0cHV0KCkgdGh5RHJhZ2dhYmxlVXBkYXRlOiBFdmVudEVtaXR0ZXI8VGh5VHJhbnNmZXJEcmFnRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUaHlUcmFuc2ZlckRyYWdFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKSB0aHlDaGFuZ2U6IEV2ZW50RW1pdHRlcjxUaHlUcmFuc2ZlckNoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGh5VHJhbnNmZXJDaGFuZ2VFdmVudD4oKTtcblxuICAgIEBDb250ZW50Q2hpbGQoJ3JlbmRlclRlbXBsYXRlJykgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBAQ29udGVudENoaWxkKCdyZW5kZXJMZWZ0VGVtcGxhdGUnKSBsZWZ0Q29udGVudFJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIEBDb250ZW50Q2hpbGQoJ3JlbmRlclJpZ2h0VGVtcGxhdGUnKSByaWdodENvbnRlbnRSZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBuZ09uSW5pdCgpIHt9XG5cbiAgICBpbml0aWFsaXplVHJhbnNmZXJEYXRhKGRhdGE6IFRoeVRyYW5zZmVySXRlbVtdID0gW10pIHtcbiAgICAgICAgdGhpcy5hbGxEYXRhU291cmNlID0gW107XG4gICAgICAgIHRoaXMubGVmdERhdGFTb3VyY2UgPSBbXTtcbiAgICAgICAgdGhpcy5yaWdodERhdGFTb3VyY2UgPSBbXTtcbiAgICAgICAgZGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgdGhpcy5hbGxEYXRhU291cmNlLnB1c2goaXRlbSk7XG4gICAgICAgICAgICBpZiAoaXRlbS5kaXJlY3Rpb24gPT09IFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxlZnREYXRhU291cmNlLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5kaXJlY3Rpb24gPT09IFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodERhdGFTb3VyY2UucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25TZWxlY3QoZnJvbTogRGlyZWN0aW9uLCBldmVudDogVGh5VHJhbnNmZXJTZWxlY3RFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuaXRlbS5pc0ZpeGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG8gPSBmcm9tID09PSBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0ID8gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQgOiBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0O1xuICAgICAgICBldmVudC5pdGVtLmNoZWNrZWQgPSAhZXZlbnQuaXRlbS5jaGVja2VkO1xuICAgICAgICBpZiAodGhpcy5fYXV0b01vdmUpIHtcbiAgICAgICAgICAgIHRoaXMub25Nb3ZlKHRvKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlbGVjdEl0ZW0oZXZlbnQ6IFRoeVRyYW5zZmVyU2VsZWN0RXZlbnQpIHtcbiAgICAgICAgdGhpcy5vblNlbGVjdChUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0LCBldmVudCk7XG4gICAgfVxuXG4gICAgdW5zZWxlY3RJdGVtKGV2ZW50OiBUaHlUcmFuc2ZlclNlbGVjdEV2ZW50KSB7XG4gICAgICAgIHRoaXMub25TZWxlY3QoVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQsIGV2ZW50KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdyb3VwTGlzdEJ5SXNMb2NrKGxpc3Q6IFRoeVRyYW5zZmVySXRlbVtdID0gW10pIHtcbiAgICAgICAgY29uc3QgbG9jazogVGh5VHJhbnNmZXJJdGVtW10gPSBbXSxcbiAgICAgICAgICAgIHVubG9jazogVGh5VHJhbnNmZXJJdGVtW10gPSBbXTtcbiAgICAgICAgbGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXNMb2NrKSB7XG4gICAgICAgICAgICAgICAgbG9jay5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB1bmxvY2sucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IGxvY2s6IGxvY2ssIHVubG9jazogdW5sb2NrIH07XG4gICAgfVxuXG4gICAgb25Nb3ZlKHRvOiBEaXJlY3Rpb24pIHtcbiAgICAgICAgY29uc3QgZnJvbURhdGFTb3VyY2UgPSB0byA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQgPyB0aGlzLmxlZnREYXRhU291cmNlIDogdGhpcy5yaWdodERhdGFTb3VyY2U7XG4gICAgICAgIGNvbnN0IHRvRGF0YVNvdXJjZSA9IHRvID09PSBUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCA/IHRoaXMucmlnaHREYXRhU291cmNlIDogdGhpcy5sZWZ0RGF0YVNvdXJjZTtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9ucyA9IGZyb21EYXRhU291cmNlLmZpbHRlcihpdGVtID0+IGl0ZW0uY2hlY2tlZCk7XG4gICAgICAgIGNvbnN0IGNoYW5nZUV2ZW50OiBUaHlUcmFuc2ZlckNoYW5nZUV2ZW50ID0ge1xuICAgICAgICAgICAgZnJvbTogdG8gPT09IFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0ID8gVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCA6IFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0LFxuICAgICAgICAgICAgdG86IHRvLFxuICAgICAgICAgICAgaXRlbXM6IFsuLi5zZWxlY3Rpb25zXVxuICAgICAgICB9O1xuICAgICAgICBzZWxlY3Rpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGZyb21EYXRhU291cmNlLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICBjb25zdCByZW1vdmVkID0gZnJvbURhdGFTb3VyY2Uuc3BsaWNlKGluZGV4LCAxKVswXTtcbiAgICAgICAgICAgIHJlbW92ZWQuY2hlY2tlZCA9ICFyZW1vdmVkLmNoZWNrZWQ7XG4gICAgICAgICAgICByZW1vdmVkLmRpcmVjdGlvbiA9IHRvO1xuICAgICAgICAgICAgdG9EYXRhU291cmNlLnB1c2gocmVtb3ZlZCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRoeUNoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgIC4uLmNoYW5nZUV2ZW50LFxuICAgICAgICAgICAgbGVmdDogdGhpcy5ncm91cExpc3RCeUlzTG9jayh0aGlzLmxlZnREYXRhU291cmNlKSxcbiAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmdyb3VwTGlzdEJ5SXNMb2NrKHRoaXMucmlnaHREYXRhU291cmNlKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvbkRyYWdVcGRhdGUoZGlyZWN0aW9uOiBEaXJlY3Rpb24sIGV2ZW50OiBJbm5lclRyYW5zZmVyRHJhZ0V2ZW50KSB7XG4gICAgICAgIGNvbnN0IG90aGVyRGlyZWN0aW9uRGF0YSA9IGRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCA/IHRoaXMucmlnaHREYXRhU291cmNlIDogdGhpcy5sZWZ0RGF0YVNvdXJjZTtcbiAgICAgICAgY29uc3Qgb3RoZXJMaXN0RGF0YSA9IHRoaXMuZ3JvdXBMaXN0QnlJc0xvY2sob3RoZXJEaXJlY3Rpb25EYXRhKTtcbiAgICAgICAgdGhpcy50aHlEcmFnZ2FibGVVcGRhdGUuZW1pdCh7XG4gICAgICAgICAgICAuLi5ldmVudC5kcmFnRXZlbnQsXG4gICAgICAgICAgICBsZWZ0OiBkaXJlY3Rpb24gPT09IFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQgPyBldmVudC5saXN0RGF0YSA6IG90aGVyTGlzdERhdGEsXG4gICAgICAgICAgICByaWdodDogZGlyZWN0aW9uID09PSBUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCA/IGV2ZW50Lmxpc3REYXRhIDogb3RoZXJMaXN0RGF0YVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=