import { ThyTranslate } from 'ngx-tethys/core';
import { coerceBooleanProperty } from 'ngx-tethys/util';
import { Component, ContentChild, ElementRef, HostBinding, Input, NgZone, Renderer2, TemplateRef } from '@angular/core';
import { ThyEmptyConfig } from './empty.config';
const sizeClassMap = {
    lg: ['thy-empty-state', 'thy-empty-state--lg'],
    md: ['thy-empty-state'],
    sm: ['thy-empty-state', 'thy-empty-state--sm']
};
const sizeMap = {
    lg: {
        height: 168,
        offsetTop: 30,
        defaultMarginTop: 120 // 不自动计算默认的 top 距离
    },
    md: {
        height: 118,
        offsetTop: 20,
        defaultMarginTop: 10
    },
    sm: {
        height: 78,
        offsetTop: 10,
        defaultMarginTop: 10
    }
};
export class ThyEmptyComponent {
    constructor(thyTranslate, thyEmptyConfig, elementRef, renderer, ngZone) {
        this.thyTranslate = thyTranslate;
        this.thyEmptyConfig = thyEmptyConfig;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.ngZone = ngZone;
        this.sizeClass = sizeClassMap['md'].join(' ');
    }
    set thySize(value) {
        const classList = sizeClassMap[value || 'md'];
        if (classList) {
            this.sizeClass = classList.join(' ');
        }
    }
    get displayText() {
        if (this.thyMessage) {
            return this.thyMessage;
        }
        else if (this.thyTranslationKey) {
            return this.thyTranslate.instant(this.thyTranslationKey, this.thyTranslationValues);
        }
        else if (this.thyEntityName) {
            return this.thyTranslate.instant(this.thyEmptyConfig.noResultWithTargetTranslateKey, {
                target: this.thyEntityName
            });
        }
        else if (this.thyEntityNameTranslateKey) {
            return this.thyTranslate.instant(this.thyEmptyConfig.noResultWithTargetTranslateKey, {
                target: this.thyTranslate.instant(this.thyEntityNameTranslateKey)
            });
        }
        else {
            return this.thyTranslate.instant(this.thyEmptyConfig.noResultTranslateKey);
        }
    }
    _calculatePosition() {
        const sizeOptions = sizeMap[this.thySize || 'md'];
        const topAuto = coerceBooleanProperty(this.thyTopAuto);
        let marginTop = null;
        if (topAuto) {
            // 选择参考父容器居中
            const containerElement = this.thyContainer ? this.thyContainer.nativeElement : this.elementRef.nativeElement.parentElement;
            // containerElement.height;
            let emptyStateHeight = this.elementRef.nativeElement.offsetHeight;
            // 高度没有自动计算出来使用默认值
            if (emptyStateHeight <= 10) {
                emptyStateHeight = sizeOptions.height;
            }
            marginTop = (containerElement.offsetHeight - emptyStateHeight) / 2 - sizeOptions.offsetTop;
            // marginTop = (containerElement.offsetHeight - emptyStateHeight) / 2;
            if (marginTop < 0) {
                marginTop = 0; // sizeOptions.defaultMarginTop;
            }
        }
        else {
            if (this.thyMarginTop) {
                marginTop = this.thyMarginTop;
            }
            else {
                marginTop = 0; // sizeOptions.defaultMarginTop;
            }
        }
        if (marginTop) {
            this.renderer.setStyle(this.elementRef.nativeElement, 'marginTop', marginTop + 'px');
        }
    }
    ngOnInit() { }
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            setTimeout(() => {
                this._calculatePosition();
            }, 50);
        });
    }
}
ThyEmptyComponent.decorators = [
    { type: Component, args: [{
                selector: 'thy-empty',
                template: "<div class=\"thy-empty-icon\">\n  <img *ngIf=\"thyImageUrl; else icon\" [src]=\"thyImageUrl\" class=\"empty-img\" />\n  <ng-template #icon>\n    <thy-icon class=\"empty-icon\" [thyIconName]=\"thyIconName\" *ngIf=\"thyIconName; else svg\"></thy-icon>\n    <ng-template #svg>\n      <ng-container>\n        <svg\n          width=\"148px\"\n          height=\"134px\"\n          viewBox=\"0 0 148 134\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n        >\n          <defs>\n            <filter x=\"0.0%\" y=\"0.0%\" width=\"100.0%\" height=\"100.0%\" filterUnits=\"objectBoundingBox\" id=\"filter-1\">\n              <feGaussianBlur stdDeviation=\"0\" in=\"SourceGraphic\"></feGaussianBlur>\n            </filter>\n          </defs>\n          <g id=\"148x134\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <g id=\"\u7F16\u7EC4-6\" transform=\"translate(1.000000, 1.000000)\">\n              <ellipse\n                id=\"\u692D\u5706\u5F62\"\n                fill=\"#EDEEF2\"\n                opacity=\"0.3\"\n                filter=\"url(#filter-1)\"\n                cx=\"73.0800017\"\n                cy=\"115.920003\"\n                rx=\"73.0800017\"\n                ry=\"16.8000004\"\n              ></ellipse>\n              <g id=\"\u7F16\u7EC4-5\" transform=\"translate(15.120000, 0.000000)\">\n                <polygon\n                  id=\"\u77E9\u5F62\"\n                  fill=\"#E2E4E9\"\n                  points=\"19.2789848 49.5600011 99.1200023 48.7200011 117.600003 75.9297673 117.600003 92.313049 0 92.313049 0 75.0356267\"\n                ></polygon>\n                <path\n                  d=\"M23.5200005,0 L94.0800002,0 C97.7913538,2.06413823e-16 100.8,3.00864655 100.8,6.72000015 L100.8,99.1200023 L100.8,99.1200023 L16.8000004,99.1200023 L16.8000004,6.72000015 C16.8000004,3.00864655 19.8086469,1.56994302e-15 23.5200005,0 Z\"\n                  id=\"\u77E9\u5F62\"\n                  fill=\"#F9FAFB\"\n                ></path>\n                <path\n                  d=\"M30.9200007,12.4400003 L86.6800019,12.4400003 C88.5356787,12.4400003 90.040002,13.9443236 90.040002,15.8000004 L90.040002,42.000001 C90.040002,43.8556778 88.5356787,45.360001 86.6800019,45.360001 L30.9200007,45.360001 C29.0643239,45.360001 27.5600006,43.8556778 27.5600006,42.000001 L27.5600006,15.8000004 C27.5600006,13.9443236 29.0643239,12.4400003 30.9200007,12.4400003 Z\"\n                  id=\"\u77E9\u5F62\"\n                  fill=\"#E8EAEE\"\n                ></path>\n                <text\n                  id=\"&lt;/null&gt;\"\n                  font-family=\"PingFangSC-Medium, PingFang SC\"\n                  font-size=\"15.1200003\"\n                  font-weight=\"400\"\n                  fill=\"#BCBECD\"\n                >\n                  <tspan x=\"33.6000008\" y=\"32.8000004\">&lt;/null&gt;</tspan>\n                </text>\n                <rect id=\"\u77E9\u5F62\" fill=\"#E8EAEE\" x=\"27.5600006\" y=\"52.0800012\" width=\"61.4800014\" height=\"5.04000011\" rx=\"2.52000006\"></rect>\n                <rect\n                  id=\"\u77E9\u5F62\u5907\u4EFD\"\n                  fill=\"#E8EAEE\"\n                  x=\"27.5600006\"\n                  y=\"63.8400014\"\n                  width=\"61.4800014\"\n                  height=\"5.04000011\"\n                  rx=\"2.52000006\"\n                ></rect>\n                <path\n                  d=\"M0,75.6000017 L29.280235,75.6000017 C32.0637502,75.6000017 34.3202352,77.8564866 34.3202352,80.6400018 L34.3202352,86.2591426 C34.3202352,89.0426578 36.5767201,91.2991427 39.3602353,91.2991427 L78.4136737,91.2991427 C81.1971889,91.2991427 83.4536738,89.0426578 83.4536738,86.2591426 L83.4536738,80.6400018 C83.4536738,77.8564866 85.7101587,75.6000017 88.4936739,75.6000017 L117.600003,75.6000017 L117.600003,75.6000017 L117.600003,110.880003 C117.600003,115.519195 113.839194,119.280003 109.200002,119.280003 L8.40000019,119.280003 C3.76080819,119.280003 -6.53729019e-15,115.519195 0,110.880003 L0,75.6000017 L0,75.6000017 Z\"\n                  id=\"\u77E9\u5F62\"\n                  fill=\"#EDEFF2\"\n                ></path>\n              </g>\n            </g>\n          </g>\n        </svg>\n      </ng-container>\n    </ng-template>\n  </ng-template>\n</div>\n\n<div [ngClass]=\"{ 'thy-empty-text': !thyDescription, 'thy-empty-text-with-extra': thyDescription }\">\n  {{ displayText }}\n</div>\n\n<div class=\"thy-empty-description\" *ngIf=\"thyDescription\">\n  {{ thyDescription }}\n</div>\n\n<div class=\"thy-empty-extra\" *ngIf=\"extraTemplateRef\">\n  <ng-template [ngTemplateOutlet]=\"extraTemplateRef\"></ng-template>\n</div>\n"
            },] }
];
ThyEmptyComponent.ctorParameters = () => [
    { type: ThyTranslate },
    { type: ThyEmptyConfig },
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone }
];
ThyEmptyComponent.propDecorators = {
    sizeClass: [{ type: HostBinding, args: ['class',] }],
    thyMessage: [{ type: Input }],
    thyTranslationKey: [{ type: Input }],
    thyTranslationValues: [{ type: Input }],
    thyEntityName: [{ type: Input }],
    thyEntityNameTranslateKey: [{ type: Input }],
    thyIconName: [{ type: Input }],
    thySize: [{ type: Input }],
    thyMarginTop: [{ type: Input }],
    thyTopAuto: [{ type: Input }],
    thyContainer: [{ type: Input }],
    thyImageUrl: [{ type: Input }],
    thyDescription: [{ type: Input }],
    extraTemplateRef: [{ type: ContentChild, args: ['extra',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1wdHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2VtcHR5L2VtcHR5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFeEQsT0FBTyxFQUVILFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLFdBQVcsRUFDWCxLQUFLLEVBQ0wsTUFBTSxFQUVOLFNBQVMsRUFDVCxXQUFXLEVBQ2QsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhELE1BQU0sWUFBWSxHQUFRO0lBQ3RCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixFQUFFLHFCQUFxQixDQUFDO0lBQzlDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO0lBQ3ZCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixFQUFFLHFCQUFxQixDQUFDO0NBQ2pELENBQUM7QUFDRixNQUFNLE9BQU8sR0FBUTtJQUNqQixFQUFFLEVBQUU7UUFDQSxNQUFNLEVBQUUsR0FBRztRQUNYLFNBQVMsRUFBRSxFQUFFO1FBQ2IsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLGtCQUFrQjtLQUMzQztJQUNELEVBQUUsRUFBRTtRQUNBLE1BQU0sRUFBRSxHQUFHO1FBQ1gsU0FBUyxFQUFFLEVBQUU7UUFDYixnQkFBZ0IsRUFBRSxFQUFFO0tBQ3ZCO0lBQ0QsRUFBRSxFQUFFO1FBQ0EsTUFBTSxFQUFFLEVBQUU7UUFDVixTQUFTLEVBQUUsRUFBRTtRQUNiLGdCQUFnQixFQUFFLEVBQUU7S0FDdkI7Q0FDSixDQUFDO0FBTUYsTUFBTSxPQUFPLGlCQUFpQjtJQXNGMUIsWUFDWSxZQUEwQixFQUMxQixjQUE4QixFQUM5QixVQUFzQixFQUN0QixRQUFtQixFQUNu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Q0FBQzthQUNqQztpQkFBTTtnQkFDSCxTQUFTLEdBQUcsQ0FBQyxDQUFDLENBQUMsZ0NBQWdDO2FBQ2xEO1NBQ0o7UUFDRCxJQUFJLFNBQVMsRUFBRTtZQUNYLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFdBQVcsRUFBRSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDeEY7SUFDTCxDQUFDO0lBU0QsUUFBUSxLQUFJLENBQUM7SUFFYixlQUFlO1FBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDL0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDWixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUM5QixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7OztZQTFHSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLHlxSkFBcUM7YUFDeEM7OztZQTVDUSxZQUFZO1lBZ0JaLGNBQWM7WUFUbkIsVUFBVTtZQUtWLFNBQVM7WUFGVCxNQUFNOzs7d0JBb0NMLFdBQVcsU0FBQyxPQUFPO3lCQUduQixLQUFLO2dDQUdMLEtBQUs7bUNBRUwsS0FBSzs0QkFHTCxLQUFLO3dDQUdMLEtBQUs7MEJBRUwsS0FBSztzQkFFTCxLQUFLOzJCQVFMLEtBQUs7eUJBRUwsS0FBSzsyQkFFTCxLQUFLOzBCQUVMLEtBQUs7NkJBRUwsS0FBSzsrQkFFTCxZQUFZLFNBQUMsT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRoeVRyYW5zbGF0ZSB9IGZyb20gJ25neC10ZXRoeXMvY29yZSc7XG5pbXBvcnQgeyBjb2VyY2VCb29sZWFuUHJvcGVydHkgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuXG5pbXBvcnQge1xuICAgIEFmdGVyVmlld0luaXQsXG4gICAgQ29tcG9uZW50LFxuICAgIENvbnRlbnRDaGlsZCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIElucHV0LFxuICAgIE5nWm9uZSxcbiAgICBPbkluaXQsXG4gICAgUmVuZGVyZXIyLFxuICAgIFRlbXBsYXRlUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBUaHlFbXB0eUNvbmZpZyB9IGZyb20gJy4vZW1wdHkuY29uZmlnJztcblxuY29uc3Qgc2l6ZUNsYXNzTWFwOiBhbnkgPSB7XG4gICAgbGc6IFsndGh5LWVtcHR5LXN0YXRlJywgJ3RoeS1lbXB0eS1zdGF0ZS0tbGcnXSxcbiAgICBtZDogWyd0aHktZW1wdHktc3RhdGUnXSxcbiAgICBzbTogWyd0aHktZW1wdHktc3RhdGUnLCAndGh5LWVtcHR5LXN0YXRlLS1zbSddXG59O1xuY29uc3Qgc2l6ZU1hcDogYW55ID0ge1xuICAgIGxnOiB7XG4gICAgICAgIGhlaWdodDogMTY4LCAvLyDnqbrmj5DnpLrnmoTpq5jluqZcbiAgICAgICAgb2Zmc2V0VG9wOiAzMCwgLy8g56m65o+Q56S65Zu+5qCH5ZKM5aSn5bCP5LmL6Ze055qE56m655m96Led56a777yM6ZyA6KaB6Zmk5Y6777yM5ZCm5YiZ5Lya5LiN5bGF5LitXG4gICAgICAgIGRlZmF1bHRNYXJnaW5Ub3A6IDEyMCAvLyDkuI3oh6rliqjorqHnrpfpu5jorqTnmoQgdG9wIOi3neemu1xuICAgIH0sXG4gICAgbWQ6IHtcbiAgICAgICAgaGVpZ2h0OiAxMTgsXG4gICAgICAgIG9mZnNldFRvcDogMjAsXG4gICAgICAgIGRlZmF1bHRNYXJnaW5Ub3A6IDEwXG4gICAgfSxcbiAgICBzbToge1xuICAgICAgICBoZWlnaHQ6IDc4LFxuICAgICAgICBvZmZzZXRUb3A6IDEwLFxuICAgICAgICBkZWZhdWx0TWFyZ2luVG9wOiAxMFxuICAgIH1cbn07XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGh5LWVtcHR5JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZW1wdHkuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFRoeUVtcHR5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgc2l6ZUNsYXNzID0gc2l6ZUNsYXNzTWFwWydtZCddLmpvaW4oJyAnKTtcblxuICAgIC8vIOaYvuekuueahOaWh+acrO+8jOS8mOWFiOe6pyAxMDAg5pyA6auYXG4gICAgQElucHV0KCkgdGh5TWVzc2FnZTogc3RyaW5nO1xuXG4gICAgLy8g5pi+56S65paH5pys55qE5aSa6K+t6KiAIEtleSDkvJjlhYjnuqcgOTlcbiAgICBASW5wdXQoKSB0aHlUcmFuc2xhdGlvbktleTogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgdGh5VHJhbnNsYXRpb25WYWx1ZXM6IGFueTtcblxuICAgIC8vIOaYvuekuum7mOiupOaPkOekuuS/oeaBr++8jOabv+aNouebruagh+WQjeensFxuICAgIEBJbnB1dCgpIHRoeUVudGl0eU5hbWU6IHN0cmluZztcblxuICAgIC8vIOaYvuekuum7mOiupOaPkOekuuS/oeaBr++8jOabv+aNouebruagh+WQjeensOeahCB0cmFuc2xhdGVLZXlcbiAgICBASW5wdXQoKSB0aHlFbnRpdHlOYW1lVHJhbnNsYXRlS2V5OiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSB0aHlJY29uTmFtZTogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5U2l6ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzTGlzdCA9IHNpemVDbGFzc01hcFt2YWx1ZSB8fCAnbWQnXTtcbiAgICAgICAgaWYgKGNsYXNzTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5zaXplQ2xhc3MgPSBjbGFzc0xpc3Quam9pbignICcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KCkgdGh5TWFyZ2luVG9wOiBudW1iZXIgfCBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSB0aHlUb3BBdXRvOiBib29sZWFuO1xuXG4gICAgQElucHV0KCkgdGh5Q29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gICAgQElucHV0KCkgdGh5SW1hZ2VVcmw6IHN0cmluZztcblxuICAgIEBJbnB1dCgpIHRoeURlc2NyaXB0aW9uOiBzdHJpbmc7XG5cbiAgICBAQ29udGVudENoaWxkKCdleHRyYScpIGV4dHJhVGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBnZXQgZGlzcGxheVRleHQoKSB7XG4gICAgICAgIGlmICh0aGlzLnRoeU1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRoeU1lc3NhZ2U7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50aHlUcmFuc2xhdGlvbktleSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGh5VHJhbnNsYXRlLmluc3RhbnQodGhpcy50aHlUcmFuc2xhdGlvbktleSwgdGhpcy50aHlUcmFuc2xhdGlvblZhbHVlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50aHlFbnRpdHlOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aHlUcmFuc2xhdGUuaW5zdGFudCh0aGlzLnRoeUVtcHR5Q29uZmlnLm5vUmVzdWx0V2l0aFRhcmdldFRyYW5zbGF0ZUtleSwge1xuICAgICAgICAgICAgICAgIHRhcmdldDogdGhpcy50aHlFbnRpdHlOYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRoeUVudGl0eU5hbWVUcmFuc2xhdGVLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRoeVRyYW5zbGF0ZS5pbnN0YW50KHRoaXMudGh5RW1wdHlDb25maWcubm9SZXN1bHRXaXRoVGFyZ2V0VHJhbnNsYXRlS2V5LCB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0aGlzLnRoeVRyYW5zbGF0ZS5pbnN0YW50KHRoaXMudGh5RW50aXR5TmFtZVRyYW5zbGF0ZUtleSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGh5VHJhbnNsYXRlLmluc3RhbnQodGhpcy50aHlFbXB0eUNvbmZpZy5ub1Jlc3VsdFRyYW5zbGF0ZUtleSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfY2FsY3VsYXRlUG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHNpemVPcHRpb25zID0gc2l6ZU1hcFt0aGlzLnRoeVNpemUgfHwgJ21kJ107XG4gICAgICAgIGNvbnN0IHRvcEF1dG8gPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodGhpcy50aHlUb3BBdXRvKTtcbiAgICAgICAgbGV0IG1hcmdpblRvcCA9IG51bGw7XG4gICAgICAgIGlmICh0b3BBdXRvKSB7XG4gICAgICAgICAgICAvLyDpgInmi6nlj4LogIPniLblrrnlmajlsYXkuK1cbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckVsZW1lbnQgPSB0aGlzLnRoeUNvbnRhaW5lciA/IHRoaXMudGh5Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQgOiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgLy8gY29udGFpbmVyRWxlbWVudC5oZWlnaHQ7XG4gICAgICAgICAgICBsZXQgZW1wdHlTdGF0ZUhlaWdodCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIC8vIOmrmOW6puayoeacieiHquWKqOiuoeeul+WHuuadpeS9v+eUqOm7mOiupOWAvFxuICAgICAgICAgICAgaWYgKGVtcHR5U3RhdGVIZWlnaHQgPD0gMTApIHtcbiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlSGVpZ2h0ID0gc2l6ZU9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWFyZ2luVG9wID0gKGNvbnRhaW5lckVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZW1wdHlTdGF0ZUhlaWdodCkgLyAyIC0gc2l6ZU9wdGlvbnMub2Zmc2V0VG9wO1xuICAgICAgICAgICAgLy8gbWFyZ2luVG9wID0gKGNvbnRhaW5lckVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZW1wdHlTdGF0ZUhlaWdodCkgLyAyO1xuICAgICAgICAgICAgaWYgKG1hcmdpblRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICBtYXJnaW5Ub3AgPSAwOyAvLyBzaXplT3B0aW9ucy5kZWZhdWx0TWFyZ2luVG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMudGh5TWFyZ2luVG9wKSB7XG4gICAgICAgICAgICAgICAgbWFyZ2luVG9wID0gdGhpcy50aHlNYXJnaW5Ub3A7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1hcmdpblRvcCA9IDA7IC8vIHNpemVPcHRpb25zLmRlZmF1bHRNYXJnaW5Ub3A7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmdpblRvcCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ21hcmdpblRvcCcsIG1hcmdpblRvcCArICdweCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHRoeVRyYW5zbGF0ZTogVGh5VHJhbnNsYXRlLFxuICAgICAgICBwcml2YXRlIHRoeUVtcHR5Q29uZmlnOiBUaHlFbXB0eUNvbmZpZyxcbiAgICAgICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmVcbiAgICApIHt9XG5cbiAgICBuZ09uSW5pdCgpIHt9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==