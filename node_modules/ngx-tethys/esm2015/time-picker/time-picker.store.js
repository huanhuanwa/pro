import { __decorate, __metadata } from "tslib";
import { Store, Action } from 'ngx-tethys/store';
import { canChangeHours, canChangeMinutes, canChangeSeconds, canChangeValue, timePickerControls } from './time-picker-controls.util';
import { changeTime, setTime, isValidLimit } from './time-picker.utils';
import { Injectable } from '@angular/core';
import { TimePickerConfig } from './time-picker.config';
import * as ɵngcc0 from '@angular/core';
export const initialState = {
    value: null,
    config: new TimePickerConfig(),
    controls: {
        canIncrementHours: true,
        canIncrementMinutes: true,
        canIncrementSeconds: true,
        canDecrementHours: true,
        canDecrementMinutes: true,
        canDecrementSeconds: true,
        canToggleMeridian: true
    }
};
export class ThyTimePickerStore extends Store {
    constructor() {
        super(initialState);
    }
    writeValue(value) {
        this.setState({ value: value });
    }
    changeHours(event) {
        const state = this.snapshot;
        if (!canChangeValue(state.config, event) || !canChangeHours(event, state.controls)) {
            return state;
        }
        const _newTime = changeTime(state.value, { hour: event.step });
        if ((state.config.max || state.config.min) && !isValidLimit(state.config, _newTime)) {
            return state;
        }
        this.setState({ value: _newTime });
    }
    changeMinutes(event) {
        const state = this.snapshot;
        if (!canChangeValue(state.config, event) || !canChangeMinutes(event, state.controls)) {
            return state;
        }
        const _newTime = changeTime(state.value, { minute: event.step });
        if ((state.config.max || state.config.min) && !isValidLimit(state.config, _newTime)) {
            return state;
        }
        this.setState({ value: _newTime });
    }
    changeSeconds(event) {
        const state = this.snapshot;
        if (!canChangeValue(state.config, event) || !canChangeSeconds(event, state.controls)) {
            return state;
        }
        const _newTime = changeTime(state.value, {
            seconds: event.step
        });
        if ((state.config.max || state.config.min) && !isValidLimit(state.config, _newTime)) {
            return state;
        }
        this.setState({ value: _newTime });
    }
    setTime(value) {
        const state = this.snapshot;
        if (!canChangeValue(state.config)) {
            return state;
        }
        const _newTime = setTime(state.value, value);
        this.setState({ value: _newTime });
    }
    updateControls(value) {
        const state = this.snapshot;
        const _newControlsState = timePickerControls(state.value, value);
        const _newState = {
            value: state.value,
            config: value,
            controls: _newControlsState
        };
        if (state.config.showMeridian !== _newState.config.showMeridian) {
            if (state.value) {
                _newState.value = new Date(state.value);
            }
        }
        this.setState(_newState);
    }
}
ThyTimePickerStore.ɵfac = function ThyTimePickerStore_Factory(t) { return new (t || ThyTimePickerStore)(); };
ThyTimePickerStore.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: ThyTimePickerStore, factory: ThyTimePickerStore.ɵfac });
ThyTimePickerStore.ctorParameters = () => [];
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Date]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "writeValue", null);
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "changeHours", null);
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "changeMinutes", null);
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "changeSeconds", null);
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "setTime", null);
__decorate([
    Action(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], ThyTimePickerStore.prototype, "updateControls", null);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyTimePickerStore, [{
        type: Injectable
    }], function () { return []; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1waWNrZXIuc3RvcmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90aW1lLXBpY2tlci90aW1lLXBpY2tlci5zdG9yZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVqRCxPQUFPLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3JJLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7O0FBUXhELE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBb0I7QUFDN0MsSUFBSSxLQUFLLEVBQUUsSUFBSTtBQUNmLElBQUksTUFBTSxFQUFFLElBQUksZ0JBQWdCLEVBQUU7QUFDbEMsSUFBSSxRQUFRLEVBQUU7QUFDZCxRQUFRLGlCQUFpQixFQUFFLElBQUk7QUFDL0IsUUFBUSxtQkFBbUIsRUFBRSxJQUFJO0FBQ2pDLFFBQVEsbUJBQW1CLEVBQUUsSUFBSTtBQUNqQyxRQUNRLGlCQUFpQixFQUFFLElBQUk7QUFDL0IsUUFBUSxtQkFBbUIsRUFBRSxJQUFJO0FBQ2pDLFFBQVEsbUJBQW1CLEVBQUUsSUFBSTtBQUNqQyxRQUNRLGlCQUFpQixFQUFFLElBQUk7QUFDL0IsS0FBSztBQUNMLENBQUMsQ0FBQztBQUdGLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSxLQUFzQjtBQUM5RCxJQUFJO0FBQ0osUUFBUSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDNUIsSUFBSSxDQUFDO0FBQ0wsSUFFSSxVQUFVLENBQUMsS0FBVztBQUMxQixRQUFRLElBQUksQ0FBQyxRQUFR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QU1DO0FBQWEsSUFEWixNQUFNLEVBQUU7QUFDWjtBQUNXLHFDQURVLElBQUk7QUFDMUI7QUFDRyxvREFBRTtBQUdEO0FBQWEsSUFEWixNQUFNLEVBQUU7QUFDWjtBQUNEO0FBQ1U7QUFBNEMscURBV2pEO0FBR0Q7QUFBYSxJQURaLE1BQU0sRUFBRTtBQUNaO0FBQXlDO0FBRWxDO0FBQTRDLHVEQVcvQztBQUdEO0FBQWEsSUFEWixNQUFNLEVBQUU7QUFDWjtBQUF5QztBQUVsQztBQUE0Qyx1REFhL0M7QUFHRDtBQUFhLElBRFosTUFBTSxFQUFFO0FBQ1o7QUFDYztBQUNVO0FBQ0QsaURBS25CO0FBR0Q7QUFBYSxJQURaLE1BQU0sRUFBRTtBQUNaO0FBQXlDO0FBQ1A7QUFDTyx3REFjckM7OztnREFDTDtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmUsIEFjdGlvbiB9IGZyb20gJ25neC10ZXRoeXMvc3RvcmUnO1xuaW1wb3J0IHsgVGltZUNoYW5nZUV2ZW50LCBUaW1lUGlja2VyQ29tcG9uZW50U3RhdGUsIFRpbWUsIFRpbWVQaWNrZXJDb250cm9scyB9IGZyb20gJy4vdGltZS1waWNrZXIubW9kZWxzJztcbmltcG9ydCB7IGNhbkNoYW5nZUhvdXJzLCBjYW5DaGFuZ2VNaW51dGVzLCBjYW5DaGFuZ2VTZWNvbmRzLCBjYW5DaGFuZ2VWYWx1ZSwgdGltZVBpY2tlckNvbnRyb2xzIH0gZnJvbSAnLi90aW1lLXBpY2tlci1jb250cm9scy51dGlsJztcbmltcG9ydCB7IGNoYW5nZVRpbWUsIHNldFRpbWUsIGlzVmFsaWRMaW1pdCB9IGZyb20gJy4vdGltZS1waWNrZXIudXRpbHMnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGltZVBpY2tlckNvbmZpZyB9IGZyb20gJy4vdGltZS1waWNrZXIuY29uZmlnJztcblxuZXhwb3J0IGludGVyZmFjZSBUaW1lUGlja2VyU3RhdGUge1xuICAgIHZhbHVlOiBEYXRlO1xuICAgIGNvbmZpZzogVGltZVBpY2tlckNvbXBvbmVudFN0YXRlO1xuICAgIGNvbnRyb2xzOiBUaW1lUGlja2VyQ29udHJvbHM7XG59XG5cbmV4cG9ydCBjb25zdCBpbml0aWFsU3RhdGU6IFRpbWVQaWNrZXJTdGF0ZSA9IHtcbiAgICB2YWx1ZTogbnVsbCxcbiAgICBjb25maWc6IG5ldyBUaW1lUGlja2VyQ29uZmlnKCksXG4gICAgY29udHJvbHM6IHtcbiAgICAgICAgY2FuSW5jcmVtZW50SG91cnM6IHRydWUsXG4gICAgICAgIGNhbkluY3JlbWVudE1pbnV0ZXM6IHRydWUsXG4gICAgICAgIGNhbkluY3JlbWVudFNlY29uZHM6IHRydWUsXG5cbiAgICAgICAgY2FuRGVjcmVtZW50SG91cnM6IHRydWUsXG4gICAgICAgIGNhbkRlY3JlbWVudE1pbnV0ZXM6IHRydWUsXG4gICAgICAgIGNhbkRlY3JlbWVudFNlY29uZHM6IHRydWUsXG5cbiAgICAgICAgY2FuVG9nZ2xlTWVyaWRpYW46IHRydWVcbiAgICB9XG59O1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVGh5VGltZVBpY2tlclN0b3JlIGV4dGVuZHMgU3RvcmU8VGltZVBpY2tlclN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKGluaXRpYWxTdGF0ZSk7XG4gICAgfVxuXG4gICAgQEFjdGlvbigpXG4gICAgd3JpdGVWYWx1ZSh2YWx1ZTogRGF0ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgIH1cblxuICAgIEBBY3Rpb24oKVxuICAgIGNoYW5nZUhvdXJzKGV2ZW50OiBUaW1lQ2hhbmdlRXZlbnQpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnNuYXBzaG90O1xuICAgICAgICBpZiAoIWNhbkNoYW5nZVZhbHVlKHN0YXRlLmNvbmZpZywgZXZlbnQpIHx8ICFjYW5DaGFuZ2VIb3VycyhldmVudCwgc3RhdGUuY29udHJvbHMpKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBfbmV3VGltZSA9IGNoYW5nZVRpbWUoc3RhdGUudmFsdWUsIHsgaG91cjogZXZlbnQuc3RlcCB9KTtcblxuICAgICAgICBpZiAoKHN0YXRlLmNvbmZpZy5tYXggfHwgc3RhdGUuY29uZmlnLm1pbikgJiYgIWlzVmFsaWRMaW1pdChzdGF0ZS5jb25maWcsIF9uZXdUaW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiBfbmV3VGltZSB9KTtcbiAgICB9XG5cbiAgICBAQWN0aW9uKClcbiAgICBjaGFuZ2VNaW51dGVzKGV2ZW50OiBUaW1lQ2hhbmdlRXZlbnQpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnNuYXBzaG90O1xuICAgICAgICBpZiAoIWNhbkNoYW5nZVZhbHVlKHN0YXRlLmNvbmZpZywgZXZlbnQpIHx8ICFjYW5DaGFuZ2VNaW51dGVzKGV2ZW50LCBzdGF0ZS5jb250cm9scykpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IF9uZXdUaW1lID0gY2hhbmdlVGltZShzdGF0ZS52YWx1ZSwgeyBtaW51dGU6IGV2ZW50LnN0ZXAgfSk7XG5cbiAgICAgICAgaWYgKChzdGF0ZS5jb25maWcubWF4IHx8IHN0YXRlLmNvbmZpZy5taW4pICYmICFpc1ZhbGlkTGltaXQoc3RhdGUuY29uZmlnLCBfbmV3VGltZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogX25ld1RpbWUgfSk7XG4gICAgfVxuXG4gICAgQEFjdGlvbigpXG4gICAgY2hhbmdlU2Vjb25kcyhldmVudDogVGltZUNoYW5nZUV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5zbmFwc2hvdDtcbiAgICAgICAgaWYgKCFjYW5DaGFuZ2VWYWx1ZShzdGF0ZS5jb25maWcsIGV2ZW50KSB8fCAhY2FuQ2hhbmdlU2Vjb25kcyhldmVudCwgc3RhdGUuY29udHJvbHMpKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBfbmV3VGltZSA9IGNoYW5nZVRpbWUoc3RhdGUudmFsdWUsIHtcbiAgICAgICAgICAgIHNlY29uZHM6IGV2ZW50LnN0ZXBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKChzdGF0ZS5jb25maWcubWF4IHx8IHN0YXRlLmNvbmZpZy5taW4pICYmICFpc1ZhbGlkTGltaXQoc3RhdGUuY29uZmlnLCBfbmV3VGltZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogX25ld1RpbWUgfSk7XG4gICAgfVxuXG4gICAgQEFjdGlvbigpXG4gICAgc2V0VGltZSh2YWx1ZTogVGltZSkge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc25hcHNob3Q7XG4gICAgICAgIGlmICghY2FuQ2hhbmdlVmFsdWUoc3RhdGUuY29uZmlnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgX25ld1RpbWUgPSBzZXRUaW1lKHN0YXRlLnZhbHVlLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogX25ld1RpbWUgfSk7XG4gICAgfVxuXG4gICAgQEFjdGlvbigpXG4gICAgdXBkYXRlQ29udHJvbHModmFsdWU6IFRpbWVQaWNrZXJDb21wb25lbnRTdGF0ZSkge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc25hcHNob3Q7XG4gICAgICAgIGNvbnN0IF9uZXdDb250cm9sc1N0YXRlID0gdGltZVBpY2tlckNvbnRyb2xzKHN0YXRlLnZhbHVlLCB2YWx1ZSk7XG4gICAgICAgIGNvbnN0IF9uZXdTdGF0ZTogVGltZVBpY2tlclN0YXRlID0ge1xuICAgICAgICAgICAgdmFsdWU6IHN0YXRlLnZhbHVlLFxuICAgICAgICAgICAgY29uZmlnOiB2YWx1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xzOiBfbmV3Q29udHJvbHNTdGF0ZVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChzdGF0ZS5jb25maWcuc2hvd01lcmlkaWFuICE9PSBfbmV3U3RhdGUuY29uZmlnLnNob3dNZXJpZGlhbikge1xuICAgICAgICAgICAgaWYgKHN0YXRlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgX25ld1N0YXRlLnZhbHVlID0gbmV3IERhdGUoc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZShfbmV3U3RhdGUpO1xuICAgIH1cbn1cbiJdfQ==