import { MixinBase, mixinUnsubscribe, UpdateHostClassService } from 'ngx-tethys/core';
import { coerceBooleanProperty, get, isString, keyBy, set } from 'ngx-tethys/util';
import { merge, of } from 'rxjs';
import { delay, takeUntil } from 'rxjs/operators';
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { ViewportRuler } from '@angular/cdk/overlay';
import { DOCUMENT } from '@angular/common';
import { Component, Input, Output, ViewEncapsulation, TemplateRef, EventEmitter, ContentChild, ContentChildren, ElementRef, HostBinding, Inject, IterableDiffers, QueryList, ViewChild } from '@angular/core';
import { THY_TABLE_COLUMN_PARENT_COMPONENT, ThyTableColumnComponent } from './table-column.component';
const tableThemeMap = {
    default: 'table-default',
    bordered: 'table-bordered'
};
const tableSizeMap = {
    sm: 'table-sm'
};
const customType = {
    index: 'index',
    checkbox: 'checkbox',
    radio: 'radio',
    switch: 'switch'
};
const _MixinBase = mixinUnsubscribe(MixinBase);
export class ThyTableComponent extends _MixinBase {
    constructor(elementRef, _differs, viewportRuler, updateHostClassService, document) {
        super();
        this.elementRef = elementRef;
        this._differs = _differs;
        this.viewportRuler = viewportRuler;
        this.updateHostClassService = updateHostClassService;
        this.document = document;
        this.customType = customType;
        this.model = [];
        this.groups = [];
        this.rowKey = '_id';
        this.mode = 'list';
        this.columns = [];
        this.theme = 'default';
        this.className = '';
        this.size = 'default';
        this.loadingDone = true;
        this.emptyOptions = {};
        this.draggable = false;
        this.selectedRadioRow = null;
        this.pagination = { index: 1, size: 20, total: 0 };
        this.wholeRowSelect = false;
        this._filter = null;
        this.initialized = false;
        this._oldThyClassName = '';
        this.thyShowHeader = true;
        this.showTotal = false;
        this.thyIndent = 20;
        this.thyChildrenKey = 'children';
        this.thyOnSwitchChange = new EventEmitter();
        this.thyOnPageChange = new EventEmitter();
        this.thyOnPageIndexChange = new EventEmitter();
        this.thyOnMultiSelectChange = new EventEmitter();
        this.thyOnRadioSelectChange = new EventEmitter();
        this.thyOnDraggableChange = new EventEmitter();
        this.thyOnRowClick = new EventEmitter();
        this.thyOnRowContextMenu = new EventEmitter();
        this.isTableClass = true;
        // 数据的折叠展开状态
        this.expandStatusMap = {};
        this._bindTrackFn();
    }
    set thyMode(value) {
        this.mode = value || this.mode;
    }
    set thyGroupBy(value) {
        this.groupBy = value;
    }
    set thyRowKey(value) {
        this.rowKey = value || this.rowKey;
    }
    set thyGroups(value) {
        if (this.mode === 'group') {
            this.buildGroups(value);
        }
    }
    set thyModel(value) {
        this.model = value || [];
        this._diff = this._differs.find(this.model).create();
        this._initializeDataModel();
        if (this.mode === 'group') {
            this.buildModel();
        }
    }
    set thyTheme(value) {
        this.theme = value || this.theme;
        this._setClass();
    }
    set thySize(value) {
        this.size = value || this.size;
        this._setClass();
    }
    set thyClassName(value) {
        const list = this.className.split(' ').filter(a => a.trim());
        const index = list.findIndex(item => item === this._oldThyClassName);
        if (index !== -1) {
            list.splice(index, 1, value);
        }
        else {
            list.push(value);
        }
        this._oldThyClassName = value;
        this.className = list.join(' ');
    }
    set thyRowClassName(value) {
        this.rowClassName = value;
    }
    set thyLoadingDone(value) {
        this.loadingDone = value;
    }
    set thyLoadingText(value) {
        this.loadingText = value;
    }
    set thyEmptyOptions(value) {
        this.emptyOptions = value;
    }
    set thyDraggable(value) {
        this.draggable = coerceBooleanProperty(value);
        if (this.mode !== 'list' && this.draggable) {
            throw new Error('Only list mode sorting is supported');
        }
    }
    set thyFilter(value) {
        this._filter = value;
    }
    set thyPageIndex(value) {
        this.pagination.index = value;
    }
    set thyPageSize(value) {
        this.pagination.size = value;
    }
    set thyPageTotal(value) {
        this.pagination.total = value;
    }
    set thyWholeRowSelect(value) {
        if (value) {
            this.className += ' table-hover';
        }
        this.wholeRowSelect = value;
    }
    set listOfColumnComponents(components) {
        if (components) {
            this._listOfColumnComponents = components;
            this._initializeColumns();
            this._initializeDataModel();
        }
    }
    _getSelectionKeys(selections) {
        return selections.map((item) => {
            if (typeof item === 'number' || typeof item === 'string') {
                return item;
            }
            else {
                return item[this.rowKey];
            }
        });
    }
    _initializeColumns() {
        const components = this._listOfColumnComponents ? this._listOfColumnComponents.toArray() : [];
        const hasExpand = components.some(item => item.expand === true);
        this.columns = components.map((component, i) => {
            const selections = this._getSelectionKeys(component.selections);
            return {
                key: component.key,
                model: component.model,
                title: component.title,
                type: component.type,
                selections: selections,
                width: component.width,
                className: component.className,
                headerClassName: component.headerClassName,
                disabled: component.disabled,
                defaultText: component.defaultText,
                expand: hasExpand ? component.expand : i === 0,
                templateRef: component.cellTemplateRef,
                headerTemplateRef: component.headerTemplateRef
            };
        });
    }
    _initializeDataModel() {
        this.model.forEach(row => {
            this.columns.forEach(column => {
                this._initialSelections(row, column);
                this._initialCustomModelValue(row, column);
            });
        });
    }
    _initialSelections(row, column) {
        if (column.selections) {
            if (column.type === 'checkbox') {
                row[column.key] = column.selections.includes(row[this.rowKey]);
                this.onModelChange(row, column);
            }
            if (column.type === 'radio') {
                if (column.selections.includes(row[this.rowKey])) {
                    this.selectedRadioRow = row;
                }
            }
        }
    }
    _initialCustomModelValue(row, column) {
        if (column.type === customType.switch) {
            row[column.key] = get(row, column.model);
        }
    }
    _refreshCustomModelValue(row) {
        this.columns.forEach(column => {
            this._initialCustomModelValue(row, column);
        });
    }
    _applyDiffChanges(changes) {
        if (changes) {
            changes.forEachAddedItem((record) => {
                this._refreshCustomModelValue(record.item);
            });
        }
    }
    _bindTrackFn() {
        this.trackByFn = function (index, row) {
            return row && this.rowKey ? row[this.rowKey] : index;
        }.bind(this);
    }
    _destroyInvalidAttribute() {
        this.model.forEach(row => {
            for (const key in row) {
                if (key.includes('[$$column]')) {
                    delete row[key];
                }
            }
        });
    }
    _setClass(first = false) {
        if (!first && !this.initialized) {
            return;
        }
        const classNames = [];
        if (tableSizeMap[this.size]) {
            classNames.push(tableSizeMap[this.size]);
        }
        if (tableThemeMap[this.theme]) {
            classNames.push(tableThemeMap[this.theme]);
        }
        if (tableSizeMap[this.size] === tableSizeMap['sm'] && tableThemeMap[this.theme] === tableThemeMap['default']) {
            classNames.push('table-default-sm-bottom-padding');
        }
        this.updateHostClassService.updateClass(classNames);
    }
    _filterModel() {
        if (this.model && this.model.length > 0) {
            if (this._filter) {
            }
        }
    }
    updateColumnSelections(key, selections) {
        const column = this.columns.find(item => item.key === key);
        column.selections = this._getSelectionKeys(selections);
        this.model.forEach(row => {
            this._initialSelections(row, column);
        });
    }
    isTemplateRef(ref) {
        return ref instanceof TemplateRef;
    }
    getModelValue(row, path) {
        return get(row, path);
    }
    renderRowClassName(row, index) {
        if (!this.rowClassName) {
            return null;
        }
        if (isString(this.rowClassName)) {
            return this.rowClassName;
        }
        else {
            return this.rowClassName(row, index);
        }
    }
    onModelChange(row, column) {
        if (column.model) {
            set(row, column.model, row[column.key]);
        }
    }
    onStopPropagation(event) {
        if (this.wholeRowSelect) {
            event.stopPropagation();
        }
    }
    onPageChange(event) {
        this.thyOnPageChange.emit(event);
    }
    onPageIndexChange(event) {
        this.thyOnPageIndexChange.emit(event);
    }
    onCheckboxChange(row, column) {
        this.onModelChange(row, column);
        this.onMultiSelectChange(null, row, column);
    }
    onMultiSelectChange(event, row, column) {
        const rows = this.model.filter(item => {
            return item[column.key];
        });
        const multiSelectEvent = {
            event: event,
            row: row,
            rows: rows
        };
        this.thyOnMultiSelectChange.emit(multiSelectEvent);
    }
    onRadioSelectChange(event, row) {
        const radioSelectEvent = {
            event: event,
            row: row
        };
        this.thyOnRadioSelectChange.emit(radioSelectEvent);
    }
    onSwitchChange(event, row, column) {
        const switchEvent = {
            event: event,
            row: row,
            refresh: (value) => {
                value = value || row;
                setTimeout(() => {
                    value[column.key] = get(value, column.model);
                });
            }
        };
        this.thyOnSwitchChange.emit(switchEvent);
    }
    showExpand(row) {
        return row[this.thyChildrenKey] && row[this.thyChildrenKey].length > 0;
    }
    isExpanded(row) {
        return this.expandStatusMap[row[this.rowKey]];
    }
    iconIndentComputed(level) {
        if (this.mode === 'tree') {
            return level * this.thyIndent - 10;
        }
    }
    tdIndentComputed(level) {
        return {
            position: 'relative',
            paddingLeft: `${(level + 1) * this.thyIndent - 10}px`
        };
    }
    expandChildren(event, row) {
        event.stopPropagation();
        if (this.isExpanded(row)) {
            this.expandStatusMap[row[this.rowKey]] = false;
        }
        else {
            this.expandStatusMap[row[this.rowKey]] = true;
        }
    }
    onDragStarted() {
        setTimeout(() => {
            const preview = this.document.getElementsByClassName('cdk-drag-preview')[0];
            if (preview) {
                preview.classList.add('thy-table-drag-preview');
            }
        });
    }
    onDragDropped(event) {
        const dragEvent = {
            model: event.item,
            models: this.model,
            oldIndex: event.previousIndex,
            newIndex: event.currentIndex
        };
        moveItemInArray(this.model, event.previousIndex, event.currentIndex);
        this.thyOnDraggableChange.emit(dragEvent);
    }
    onRowClick(event, row) {
        if (this.wholeRowSelect) {
            const column = this.columns.find(item => {
                return item.type === customType.checkbox || item.type === customType.radio;
            });
            if (!column.disabled) {
                if (column.type === customType.checkbox) {
                    row[column.key] = !row[column.key];
                    this.onModelChange(row, column);
                    this.onMultiSelectChange(event, row, column);
                }
                if (column.type === customType.radio) {
                    this.selectedRadioRow = row;
                    this.onRadioSelectChange(event, row);
                }
            }
        }
        const rowEvent = {
            event: event,
            row: row
        };
        this.thyOnRowClick.emit(rowEvent);
    }
    onRowContextMenu(event, row) {
        const contextMenuEvent = {
            event: event,
            row: row
        };
        this.thyOnRowContextMenu.emit(contextMenuEvent);
    }
    draggableStopPropagation(event) {
        if (!this.draggable) {
            event.stopPropagation();
        }
    }
    _refreshColumns() {
        const components = this._listOfColumnComponents ? this._listOfColumnComponents.toArray() : [];
        const _columns = components.map(component => {
            return {
                width: component.width,
                className: component.className
            };
        });
        this.columns.forEach((n, i) => {
            Object.assign(n, _columns[i]);
        });
    }
    buildGroups(originGroups) {
        const collapsedIds = this.groups.filter(group => !group.expand).map(group => group.id);
        this.groups = [];
        originGroups.forEach((origin) => {
            const group = { id: origin[this.rowKey], children: [], origin };
            group.expand = !collapsedIds.includes(group.id);
            this.groups.push(group);
        });
    }
    buildModel() {
        const groupsMap = keyBy(this.groups, 'id');
        this.model.forEach(row => {
            const group = groupsMap[row[this.groupBy]];
            if (group) {
                group.children.push(row);
            }
        });
    }
    expandGroup(group) {
        group.expand = !group.expand;
    }
    ngOnInit() {
        this.updateHostClassService.initializeElement(this.tableElementRef.nativeElement);
        this._setClass(true);
        this.initialized = true;
        merge(this.viewportRuler.change(200), of(null).pipe(delay(200)))
            .pipe(takeUntil(this.ngUnsubscribe$))
            .subscribe(() => {
            this._refreshColumns();
        });
    }
    ngOnChanges(simpleChangs) {
        const modeChange = simpleChangs.thyMode;
        const thyGroupsChange = simpleChangs.thyGroups;
        const isGroupMode = modeChange && modeChange.currentValue === 'group';
        if (isGroupMode && thyGroupsChange && thyGroupsChange.firstChange) {
            this.buildGroups(thyGroupsChange.currentValue);
            this.buildModel();
        }
    }
    ngDoCheck() {
        if (this._diff) {
            const changes = this._diff.diff(this.model);
            this._applyDiffChanges(changes);
        }
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this._destroyInvalidAttribute();
    }
}
ThyTableComponent.decorators = [
    { type: Component, args: [{
                selector: 'thy-grid,thy-table',
                template: "<table #table class=\"table\" [ngClass]=\"[className]\" [class.table-draggable]=\"draggable\" [class.table-group]=\"mode === 'group'\">\n  <colgroup>\n    <col *ngFor=\"let column of columns\" [width]=\"column.width\" />\n  </colgroup>\n\n  <thead *ngIf=\"thyShowHeader\">\n    <tr>\n      <th *ngFor=\"let column of columns\" [ngClass]=\"column.headerClassName\">\n        <ng-container *ngIf=\"!column.headerTemplateRef\">\n          {{ column.title }}\n        </ng-container>\n        <ng-container *ngIf=\"column.headerTemplateRef\">\n          <ng-template [ngTemplateOutlet]=\"column.headerTemplateRef\" [ngTemplateOutletContext]=\"{ $implicit: column }\"></ng-template>\n        </ng-container>\n      </th>\n    </tr>\n  </thead>\n\n  <tbody *ngIf=\"loadingDone\" thyDragDrop cdkDropList [cdkDropListDisabled]=\"!draggable\" (cdkDropListDropped)=\"onDragDropped($event)\">\n    <!-- group -->\n    <ng-container *ngIf=\"mode === 'group'\">\n      <ng-container *ngFor=\"let group of groups\">\n        <tr class=\"thy-table-group\" (click)=\"expandGroup(group)\">\n          <td [attr.colspan]=\"columns.length\">\n            <div class=\"thy-table-group-container\">\n              <thy-icon class=\"expand-icon\" [thyIconName]=\"group.expand ? 'angle-down' : 'angle-right'\"></thy-icon>\n              <ng-container *ngIf=\"groupTemplate\">\n                <ng-template\n                  [ngTemplateOutlet]=\"groupTemplate\"\n                  [ngTemplateOutletContext]=\"{ $implicit: group.origin, group: group.origin }\"\n                ></ng-template>\n              </ng-container>\n            </div>\n          </td>\n        </tr>\n        <ng-container *ngIf=\"group.children?.length && group.expand\">\n          <ng-container *ngFor=\"let row of group.children; trackBy: trackByFn; let i = index\">\n            <ng-template [ngTemplateOutlet]=\"trTemplate\" [ngTemplateOutletContext]=\"{ row: row, index: i, level: 0 }\"></ng-template>\n          </ng-container>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n\n    <!-- list\u6A21\u5F0F\u4E0B\u6CA1\u6709\u76F4\u63A5\u4F7F\u7528item\u6A21\u677F\uFF0C\u662F\u56E0\u4E3A\u4F7F\u7528\u4E86\u6A21\u677F\u5F71\u54CD\u4E86Angular\u7684\u4F9D\u8D56\u6811\uFF0C\u5BFC\u81F4CdkDragDrop\u6392\u5E8F\u5931\u6548\uFF0C\u76EE\u524D\u8FD9\u6837\u4FEE\u6539\u53EF\u4EE5\u6682\u65F6\u89E3\u51B3\u7EBF\u4E0A\u4E0D\u80FD\u6392\u5E8F\u7684\u95EE\u9898\uFF0CTree\u6A21\u5F0F\u7684\u6392\u5E8F\u6682\u65F6\u4E0D\u652F\u6301 -->\n    <ng-container *ngIf=\"mode === 'list'\">\n      <tr\n        *ngFor=\"let row of model; trackBy: trackByFn; let i = index\"\n        class=\"thy-sortable-item\"\n        cdkDrag\n        [cdkDragData]=\"row\"\n        (cdkDragStarted)=\"onDragStarted()\"\n        [ngClass]=\"renderRowClassName(row, i)\"\n        (mousedown)=\"draggableStopPropagation($event)\"\n        (touchstart)=\"draggableStopPropagation($event)\"\n        (pointerdown)=\"draggableStopPropagation($event)\"\n        (click)=\"onRowClick($event, row)\"\n        (thyContextMenu)=\"onRowContextMenu($event, row)\"\n      >\n        <ng-template [ngTemplateOutlet]=\"tdsTemplate\" [ngTemplateOutletContext]=\"{ row: row, index: i, level: 0 }\"></ng-template>\n      </tr>\n    </ng-container>\n\n    <ng-container *ngIf=\"mode === 'tree'\">\n      <ng-container *ngFor=\"let row of model; trackBy: trackByFn; let i = index\">\n        <ng-template [ngTemplateOutlet]=\"trTemplate\" [ngTemplateOutletContext]=\"{ row: row, index: i, level: 0 }\"></ng-template>\n      </ng-container>\n    </ng-container>\n\n    <ng-template #trTemplate let-row=\"row\" let-i=\"index\" let-level=\"level\">\n      <tr\n        class=\"thy-sortable-item\"\n        cdkDrag\n        [cdkDragData]=\"row\"\n        (cdkDragStarted)=\"onDragStarted()\"\n        [ngClass]=\"renderRowClassName(row, i)\"\n        (mousedown)=\"draggableStopPropagation($event)\"\n        (touchstart)=\"draggableStopPropagation($event)\"\n        (pointerdown)=\"draggableStopPropagation($event)\"\n        (click)=\"onRowClick($event, row)\"\n        (thyContextMenu)=\"onRowContextMenu($event, row)\"\n      >\n        <ng-template [ngTemplateOutlet]=\"tdsTemplate\" [ngTemplateOutletContext]=\"{ row: row, index: i, level: level + 1 }\"></ng-template>\n      </tr>\n\n      <ng-container *ngIf=\"mode === 'tree' && isExpanded(row)\">\n        <ng-template\n          *ngFor=\"let child of row[thyChildrenKey]; trackBy: trackByFn; let j = index\"\n          [ngTemplateOutlet]=\"trTemplate\"\n          [ngTemplateOutletContext]=\"{ row: child, index: j, level: level + 1 }\"\n        ></ng-template>\n      </ng-container>\n    </ng-template>\n\n    <ng-template #tdsTemplate let-row=\"row\" let-i=\"index\" let-level=\"level\">\n      <td\n        *ngFor=\"let column of columns; let j = index\"\n        [ngClass]=\"column.className\"\n        [class.thy-table-checkbox-column]=\"column.type === customType.checkbox\"\n        [ngStyle]=\"mode === 'tree' && column.expand ? tdIndentComputed(level) : null\"\n      >\n        <ng-container *ngIf=\"j === 0 && draggable\">\n          <thy-icon class=\"table-draggable-icon\" thyIconName=\"drag\"></thy-icon>\n        </ng-container>\n\n        <!--template-->\n        <ng-container *ngIf=\"isTemplateRef(column.templateRef)\">\n          <thy-icon\n            class=\"tree-expand-icon cursor-pointer\"\n            *ngIf=\"mode === 'tree' && column.expand\"\n            [thyIconName]=\"isExpanded(row) ? 'angle-down' : 'angle-right'\"\n            [style.visibility]=\"showExpand(row) ? 'visible' : 'hidden'\"\n            [style.left.px]=\"iconIndentComputed(level)\"\n            (click)=\"expandChildren($event, row)\"\n          ></thy-icon>\n          <ng-template [ngTemplateOutlet]=\"column.templateRef\" [ngTemplateOutletContext]=\"{ $implicit: row }\"></ng-template>\n        </ng-container>\n\n        <!--not template-->\n        <ng-container *ngIf=\"!isTemplateRef(column.templateRef)\">\n          <!-- default -->\n          <ng-container *ngIf=\"column.model && !column.type\">\n            <thy-icon\n              class=\"tree-expand-icon cursor-pointer\"\n              *ngIf=\"mode === 'tree' && column.expand\"\n              [thyIconName]=\"isExpanded(row) ? 'angle-down' : 'angle-right'\"\n              [style.visibility]=\"showExpand(row) ? 'visible' : 'hidden'\"\n              [style.marginLeft.px]=\"iconIndentComputed(level)\"\n              (click)=\"expandChildren($event, row)\"\n            ></thy-icon>\n            <ng-container *ngIf=\"getModelValue(row, column.model) | isValidModelValue; else default\">\n              {{ getModelValue(row, column.model) }}\n            </ng-container>\n            <ng-template #default>\n              <div class=\"text-desc\">\n                {{ column.defaultText }}\n              </div>\n            </ng-template>\n          </ng-container>\n\n          <!-- index -->\n          <ng-container *ngIf=\"column.type === customType.index\">\n            {{ i + 1 }}\n          </ng-container>\n\n          <!-- checkbox -->\n          <ng-container *ngIf=\"column.type === customType.checkbox\">\n            <input\n              type=\"checkbox\"\n              [(ngModel)]=\"row[column.key]\"\n              (ngModelChange)=\"onCheckboxChange(row, column)\"\n              (click)=\"onStopPropagation($event)\"\n              [disabled]=\"column.disabled\"\n            />\n          </ng-container>\n\n          <!-- radio -->\n          <ng-container *ngIf=\"column.type === customType.radio\">\n            <input\n              type=\"radio\"\n              [(ngModel)]=\"selectedRadioRow\"\n              [value]=\"row\"\n              [disabled]=\"column.disabled\"\n              (click)=\"onStopPropagation($event)\"\n              (change)=\"onRadioSelectChange($event, row)\"\n            />\n          </ng-container>\n\n          <!-- switch -->\n          <ng-container *ngIf=\"column.type === customType.switch\">\n            <thy-switch\n              [(ngModel)]=\"row[column.key]\"\n              (ngModelChange)=\"onModelChange(row, column)\"\n              [disabled]=\"column.disabled\"\n              (thyChange)=\"onSwitchChange($event, row, column)\"\n            ></thy-switch>\n          </ng-container>\n        </ng-container>\n      </td>\n    </ng-template>\n  </tbody>\n</table>\n\n<div *ngIf=\"loadingDone && model.length === 0 && groups.length === 0\" class=\"thy-table-empty clear-hover\">\n  <ng-container *ngIf=\"emptyTemplate; else defaultEmpty\">\n    <ng-template [ngTemplateOutlet]=\"emptyTemplate\"></ng-template>\n  </ng-container>\n  <ng-template #defaultEmpty>\n    <thy-empty\n      [thyMessage]=\"emptyOptions.message\"\n      [thyTranslationKey]=\"emptyOptions.translationKey\"\n      [thyTranslationValues]=\"emptyOptions.translationValues\"\n      [thyEntityName]=\"emptyOptions.entityName\"\n      [thyEntityNameTranslateKey]=\"emptyOptions.entityNameTranslateKey\"\n      [thyIconName]=\"emptyOptions.iconName\"\n      [thySize]=\"emptyOptions.size\"\n      [thyMarginTop]=\"emptyOptions.marginTop\"\n      [thyTopAuto]=\"emptyOptions.topAuto\"\n      [thyContainer]=\"emptyOptions.container\"\n    ></thy-empty>\n  </ng-template>\n</div>\n\n<thy-loading [thyDone]=\"loadingDone\" [thyTip]=\"loadingText\"></thy-loading>\n\n<div class=\"thy-table-footer\" *ngIf=\"pagination.total > pagination.size\" [class.thy-table-footer-has-padding]=\"theme === 'default'\">\n  <thy-pagination\n    [thyPageIndex]=\"pagination.index\"\n    [thyTotal]=\"pagination.total\"\n    [thyPageSize]=\"pagination.size\"\n    [thyShowTotal]=\"showTotal\"\n    (thyPageChanged)=\"onPageChange($event)\"\n    (thyPageIndexChange)=\"onPageIndexChange($event)\"\n  ></thy-pagination>\n</div>\n\n<ng-template>\n  <ng-content></ng-content>\n</ng-template>\n",
                providers: [
                    {
                        provide: THY_TABLE_COLUMN_PARENT_COMPONENT,
                        useExisting: ThyTableComponent
                    },
                    UpdateHostClassService
                ],
                encapsulation: ViewEncapsulation.None
            },] }
];
ThyTableComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: IterableDiffers },
    { type: ViewportRuler },
    { type: UpdateHostClassService },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
ThyTableComponent.propDecorators = {
    emptyTemplate: [{ type: ContentChild, args: ['empty',] }],
    tableElementRef: [{ type: ViewChild, args: ['table', { static: true },] }],
    thyMode: [{ type: Input }],
    thyGroupBy: [{ type: Input }],
    thyRowKey: [{ type: Input }],
    thyGroups: [{ type: Input }],
    thyModel: [{ type: Input }],
    thyTheme: [{ type: Input }],
    thySize: [{ type: Input }],
    thyClassName: [{ type: Input }],
    thyRowClassName: [{ type: Input }],
    thyLoadingDone: [{ type: Input }],
    thyLoadingText: [{ type: Input }],
    thyEmptyOptions: [{ type: Input }],
    thyDraggable: [{ type: Input }],
    thyFilter: [{ type: Input }],
    thyPageIndex: [{ type: Input }],
    thyPageSize: [{ type: Input }],
    thyPageTotal: [{ type: Input }],
    thyWholeRowSelect: [{ type: Input }],
    thyShowHeader: [{ type: Input }],
    showTotal: [{ type: Input, args: ['thyShowTotal',] }],
    thyIndent: [{ type: Input }],
    thyChildrenKey: [{ type: Input }],
    thyHoverDisplayOperation: [{ type: HostBinding, args: ['class.thy-table-hover-display-operation',] }, { type: Input }],
    thyOnSwitchChange: [{ type: Output }],
    thyOnPageChange: [{ type: Output }],
    thyOnPageIndexChange: [{ type: Output }],
    thyOnMultiSelectChange: [{ type: Output }],
    thyOnRadioSelectChange: [{ type: Output }],
    thyOnDraggableChange: [{ type: Output }],
    thyOnRowClick: [{ type: Output }],
    thyOnRowContextMenu: [{ type: Output }],
    groupTemplate: [{ type: ContentChild, args: ['group', { static: true },] }],
    listOfColumnComponents: [{ type: ContentChildren, args: [ThyTableColumnComponent,] }],
    isTableClass: [{ type: HostBinding, args: ['class.thy-table',] }]
};
/**
 * @deprecated ThyGridComponent is deprecated, please use ThyTableComponent
 */
export const ThyGridComponent = ThyTableComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RhYmxlL3RhYmxlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWUsU0FBUyxFQUFFLGdCQUFnQixFQUFrQixzQkFBc0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRW5ILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRixPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqQyxPQUFPLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWxELE9BQU8sRUFBZSxlQUFlLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFDSCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixpQkFBaUIsRUFDakIsV0FBVyxFQUdYLFlBQVksRUFDWixZQUFZLEVBQ1osZUFBZSxFQUVmLFVBQVUsRUFDVixXQUFXLEVBQ1gsTUFBTSxFQUlOLGVBQWUsRUFFZixTQUFTLEVBQ1QsU0FBUyxFQUVaLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBa0MsaUNBQWlDLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQXVDdEksTUFBTSxhQUFhLEdBQUc7SUFDbEIsT0FBTyxFQUFFLGVBQWU7SUFDeEIsUUFBUSxFQUFFLGdCQUFnQjtDQUM3QixDQUFDO0FBRUYsTUFBTSxZQUFZLEdBQUc7SUFDakIsRUFBRSxFQUFFLFVBQVU7Q0FDakIsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHO0lB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QU07a0NBRU4sTUFBTTs0QkFFTixZQUFZLFNBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtxQ0FFdEMsZUFBZSxTQUFDLHVCQUF1QjsyQkFTdkMsV0FBVyxTQUFDLGlCQUFpQjs7QUEyWGxDOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsaUJBQWlCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25zdHJ1Y3RvciwgTWl4aW5CYXNlLCBtaXhpblVuc3Vic2NyaWJlLCBUaHlVbnN1YnNjcmliZSwgVXBkYXRlSG9zdENsYXNzU2VydmljZSB9IGZyb20gJ25neC10ZXRoeXMvY29yZSc7XG5pbXBvcnQgeyBEaWN0aW9uYXJ5IH0gZnJvbSAnbmd4LXRldGh5cy90eXBlcyc7XG5pbXBvcnQgeyBjb2VyY2VCb29sZWFuUHJvcGVydHksIGdldCwgaXNTdHJpbmcsIGtleUJ5LCBzZXQgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuaW1wb3J0IHsgbWVyZ2UsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBDZGtEcmFnRHJvcCwgbW92ZUl0ZW1JbkFycmF5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2RyYWctZHJvcCc7XG5pbXBvcnQgeyBWaWV3cG9ydFJ1bGVyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgSW5wdXQsXG4gICAgT3V0cHV0LFxuICAgIFZpZXdFbmNhcHN1bGF0aW9uLFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIE9uSW5pdCxcbiAgICBPbkNoYW5nZXMsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIENvbnRlbnRDaGlsZCxcbiAgICBDb250ZW50Q2hpbGRyZW4sXG4gICAgRG9DaGVjayxcbiAgICBFbGVtZW50UmVmLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIEluamVjdCxcbiAgICBJdGVyYWJsZUNoYW5nZVJlY29yZCxcbiAgICBJdGVyYWJsZUNoYW5nZXMsXG4gICAgSXRlcmFibGVEaWZmZXIsXG4gICAgSXRlcmFibGVEaWZmZXJzLFxuICAgIE9uRGVzdHJveSxcbiAgICBRdWVyeUxpc3QsXG4gICAgVmlld0NoaWxkLFxuICAgIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IElUaHlUYWJsZUNvbHVtblBhcmVudENvbXBvbmVudCwgVEhZX1RBQkxFX0NPTFVNTl9QQVJFTlRfQ09NUE9ORU5ULCBUaHlUYWJsZUNvbHVtbkNvbXBvbmVudCB9IGZyb20gJy4vdGFibGUtY29sdW1uLmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICAgIFBhZ2VDaGFuZ2VkRXZlbnQsXG4gICAgVGh5VGFibGVDb2x1bW4sXG4gICAgVGh5VGFibGVEcmFnZ2FibGVFdmVudCxcbiAgICBUaHlUYWJsZUVtcHR5T3B0aW9ucyxcbiAgICBUaHlUYWJsZUV2ZW50LFxuICAgIFRoeVRhYmxlUm93RXZlbnQsXG4gICAgVGh5TXVsdGlTZWxlY3RFdmVudCxcbiAgICBUaHlQYWdlLFxuICAgIFRoeVJhZGlvU2VsZWN0RXZlbnQsXG4gICAgVGh5U3dpdGNoRXZlbnRcbn0gZnJvbSAnLi90YWJsZS5pbnRlcmZhY2UnO1xuXG5leHBvcnQgdHlwZSBUaHlUYWJsZVRoZW1lID0gJ2RlZmF1bHQnIHwgJ2JvcmRlcmVkJztcbi8qKlxuICogQGRlcHJlY2F0ZWQgVGh5R3JpZFRoZW1lIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgVGh5VGFibGVUaGVtZVxuICovXG5leHBvcnQgdHlwZSBUaHlHcmlkVGhlbWUgPSBUaHlUYWJsZVRoZW1lO1xuXG5leHBvcnQgdHlwZSBUaHlUYWJsZU1vZGUgPSAnbGlzdCcgfCAnZ3JvdXAnIHwgJ3RyZWUnO1xuLyoqXG4gKiBAZGVwcmVjYXRlZCBUaHlHcmlkTW9kZSBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIFRoeVRhYmxlTW9kZVxuICovXG5leHBvcnQgdHlwZSBUaHlHcmlkTW9kZSA9IFRoeVRhYmxlTW9kZTtcblxuZXhwb3J0IHR5cGUgVGh5VGFibGVTaXplID0gJ2RlZmF1bHQnIHwgJ3NtJztcbi8qKlxuICogQGRlcHJlY2F0ZWQgVGh5R3JpZFNpemUgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBUaHlUYWJsZVNpemVcbiAqL1xuZXhwb3J0IHR5cGUgVGh5R3JpZFNpemUgPSBUaHlUYWJsZVNpemU7XG5cbmludGVyZmFjZSBUaHlUYWJsZUdyb3VwPFQgPSB1bmtub3duPiB7XG4gICAgaWQ/OiBzdHJpbmc7XG4gICAgZXhwYW5kPzogYm9vbGVhbjtcbiAgICBjaGlsZHJlbj86IG9iamVjdFtdO1xuICAgIG9yaWdpbj86IFQ7XG59XG5cbmNvbnN0IHRhYmxlVGhlbWVNYXAgPSB7XG4gICAgZGVmYXVsdDogJ3RhYmxlLWRlZmF1bHQnLFxuICAgIGJvcmRlcmVkOiAndGFibGUtYm9yZGVyZWQnXG59O1xuXG5jb25zdCB0YWJsZVNpemVNYXAgPSB7XG4gICAgc206ICd0YWJsZS1zbSdcbn07XG5cbmNvbnN0IGN1c3RvbVR5cGUgPSB7XG4gICAgaW5kZXg6ICdpbmRleCcsXG4gICAgY2hlY2tib3g6ICdjaGVja2JveCcsXG4gICAgcmFkaW86ICdyYWRpbycsXG4gICAgc3dpdGNoOiAnc3dpdGNoJ1xufTtcblxuY29uc3QgX01peGluQmFzZTogQ29uc3RydWN0b3I8VGh5VW5zdWJzY3JpYmU+ICYgdHlwZW9mIE1peGluQmFzZSA9IG1peGluVW5zdWJzY3JpYmUoTWl4aW5CYXNlKTtcbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGh5LWdyaWQsdGh5LXRhYmxlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGFibGUuY29tcG9uZW50Lmh0bWwnLFxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBUSFlfVEFCTEVfQ09MVU1OX1BBUkVOVF9DT01QT05FTlQsXG4gICAgICAgICAgICB1c2VFeGlzdGluZzogVGh5VGFibGVDb21wb25lbnRcbiAgICAgICAgfSxcbiAgICAgICAgVXBkYXRlSG9zdENsYXNzU2VydmljZVxuICAgIF0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBUaHlUYWJsZUNvbXBvbmVudCBleHRlbmRzIF9NaXhpbkJhc2UgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBEb0NoZWNrLCBJVGh5VGFibGVDb2x1bW5QYXJlbnRDb21wb25lbnQge1xuICAgIHB1YmxpYyBjdXN0b21UeXBlID0gY3VzdG9tVHlwZTtcblxuICAgIHB1YmxpYyBtb2RlbDogb2JqZWN0W10gPSBbXTtcblxuICAgIHB1YmxpYyBncm91cHM6IFRoeVRhYmxlR3JvdXBbXSA9IFtdO1xuXG4gICAgcHVibGljIHJvd0tleSA9ICdfaWQnO1xuXG4gICAgcHVibGljIGdyb3VwQnk6IHN0cmluZztcblxuICAgIHB1YmxpYyBtb2RlOiBUaHlUYWJsZU1vZGUgPSAnbGlzdCc7XG5cbiAgICBwdWJsaWMgY29sdW1uczogVGh5VGFibGVDb2x1bW5bXSA9IFtdO1xuXG4gICAgcHVibGljIHRoZW1lOiBUaHlUYWJsZVRoZW1lID0gJ2RlZmF1bHQnO1xuXG4gICAgcHVibGljIGNsYXNzTmFtZSA9ICcnO1xuXG4gICAgcHVibGljIHNpemU6IFRoeVRhYmxlU2l6ZSA9ICdkZWZhdWx0JztcblxuICAgIHB1YmxpYyByb3dDbGFzc05hbWU6IHN0cmluZyB8IEZ1bmN0aW9uO1xuXG4gICAgcHVibGljIGxvYWRpbmdEb25lID0gdHJ1ZTtcblxuICAgIHB1YmxpYyBsb2FkaW5nVGV4dDogc3RyaW5nO1xuXG4gICAgcHVibGljIGVtcHR5T3B0aW9uczogVGh5VGFibGVFbXB0eU9wdGlvbnMgPSB7fTtcblxuICAgIHB1YmxpYyBkcmFnZ2FibGUgPSBmYWxzZTtcblxuICAgIHB1YmxpYyBzZWxlY3RlZFJhZGlvUm93OiBhbnkgPSBudWxsO1xuXG4gICAgcHVibGljIHBhZ2luYXRpb246IFRoeVBhZ2UgPSB7IGluZGV4OiAxLCBzaXplOiAyMCwgdG90YWw6IDAgfTtcblxuICAgIHB1YmxpYyB0cmFja0J5Rm46IGFueTtcblxuICAgIHB1YmxpYyB3aG9sZVJvd1NlbGVjdCA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBfZmlsdGVyOiBhbnkgPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBfZGlmZjogSXRlcmFibGVEaWZmZXI8YW55PjtcblxuICAgIHByaXZhdGUgX2RyYWdnYWJsZU1vZGVsOiBhbnk7XG5cbiAgICBwcml2YXRlIF9saXN0T2ZDb2x1bW5Db21wb25lbnRzOiBRdWVyeUxpc3Q8VGh5VGFibGVDb2x1bW5Db21wb25lbnQ+O1xuXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIHByaXZhdGUgX29sZFRoeUNsYXNzTmFtZSA9ICcnO1xuXG4gICAgQENvbnRlbnRDaGlsZCgnZW1wdHknKSBlbXB0eVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gICAgQFZpZXdDaGlsZCgndGFibGUnLCB7IHN0YXRpYzogdHJ1ZSB9KSB0YWJsZUVsZW1lbnRSZWY6IEVsZW1lbnRSZWY8YW55PjtcblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeU1vZGUodmFsdWU6IFRoeVRhYmxlTW9kZSkge1xuICAgICAgICB0aGlzLm1vZGUgPSB2YWx1ZSB8fCB0aGlzLm1vZGU7XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5R3JvdXBCeSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBCeSA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeVJvd0tleSh2YWx1ZTogYW55KSB7XG4gICAgICAgIHRoaXMucm93S2V5ID0gdmFsdWUgfHwgdGhpcy5yb3dLZXk7XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5R3JvdXBzKHZhbHVlOiBhbnkpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2dyb3VwJykge1xuICAgICAgICAgICAgdGhpcy5idWlsZEdyb3Vwcyh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlNb2RlbCh2YWx1ZTogYW55KSB7XG4gICAgICAgIHRoaXMubW9kZWwgPSB2YWx1ZSB8fCBbXTtcbiAgICAgICAgdGhpcy5fZGlmZiA9IHRoaXMuX2RpZmZlcnMuZmluZCh0aGlzLm1vZGVsKS5jcmVhdGUoKTtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZURhdGFNb2RlbCgpO1xuXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdncm91cCcpIHtcbiAgICAgICAgICAgIHRoaXMuYnVpbGRNb2RlbCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5VGhlbWUodmFsdWU6IFRoeVRhYmxlVGhlbWUpIHtcbiAgICAgICAgdGhpcy50aGVtZSA9IHZhbHVlIHx8IHRoaXMudGhlbWU7XG4gICAgICAgIHRoaXMuX3NldENsYXNzKCk7XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5U2l6ZSh2YWx1ZTogVGh5VGFibGVTaXplKSB7XG4gICAgICAgIHRoaXMuc2l6ZSA9IHZhbHVlIHx8IHRoaXMuc2l6ZTtcbiAgICAgICAgdGhpcy5fc2V0Q2xhc3MoKTtcbiAgICB9XG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5Q2xhc3NOYW1lKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IHRoaXMuY2xhc3NOYW1lLnNwbGl0KCcgJykuZmlsdGVyKGEgPT4gYS50cmltKCkpO1xuICAgICAgICBjb25zdCBpbmRleDogbnVtYmVyID0gbGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtID09PSB0aGlzLl9vbGRUaHlDbGFzc05hbWUpO1xuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBsaXN0LnNwbGljZShpbmRleCwgMSwgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGlzdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9vbGRUaHlDbGFzc05hbWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBsaXN0LmpvaW4oJyAnKTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlSb3dDbGFzc05hbWUodmFsdWU6IHN0cmluZyB8IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMucm93Q2xhc3NOYW1lID0gdmFsdWU7XG4gICAgfVxuXG4gICAgQElucHV0KClcbiAgICBzZXQgdGh5TG9hZGluZ0RvbmUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nRG9uZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeUxvYWRpbmdUZXh0KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nVGV4dCA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeUVtcHR5T3B0aW9ucyh2YWx1ZTogVGh5VGFibGVFbXB0eU9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5lbXB0eU9wdGlvbnMgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlEcmFnZ2FibGUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5kcmFnZ2FibGUgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAnbGlzdCcgJiYgdGhpcy5kcmFnZ2FibGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBsaXN0IG1vZGUgc29ydGluZyBpcyBzdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeUZpbHRlcih2YWx1ZTogYW55KSB7XG4gICAgICAgIHRoaXMuX2ZpbHRlciA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeVBhZ2VJbmRleCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMucGFnaW5hdGlvbi5pbmRleCA9IHZhbHVlO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IHRoeVBhZ2VTaXplKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnNpemUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlQYWdlVG90YWwodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLnBhZ2luYXRpb24udG90YWwgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCB0aHlXaG9sZVJvd1NlbGVjdCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3NOYW1lICs9ICcgdGFibGUtaG92ZXInO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud2hvbGVSb3dTZWxlY3QgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoKSB0aHlTaG93SGVhZGVyID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgndGh5U2hvd1RvdGFsJykgc2hvd1RvdGFsID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKSB0aHlJbmRlbnQgPSAyMDtcblxuICAgIEBJbnB1dCgpIHRoeUNoaWxkcmVuS2V5ID0gJ2NoaWxkcmVuJztcblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MudGh5LXRhYmxlLWhvdmVyLWRpc3BsYXktb3BlcmF0aW9uJylcbiAgICBASW5wdXQoKVxuICAgIHRoeUhvdmVyRGlzcGxheU9wZXJhdGlvbjogYm9vbGVhbjtcblxuICAgIEBPdXRwdXQoKSB0aHlPblN3aXRjaENoYW5nZTogRXZlbnRFbWl0dGVyPFRoeVN3aXRjaEV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGh5U3dpdGNoRXZlbnQ+KCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5T25QYWdlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8UGFnZUNoYW5nZWRFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFBhZ2VDaGFuZ2VkRXZlbnQ+KCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5T25QYWdlSW5kZXhDaGFuZ2U6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgICBAT3V0cHV0KCkgdGh5T25NdWx0aVNlbGVjdENoYW5nZTogRXZlbnRFbWl0dGVyPFRoeU11bHRpU2VsZWN0RXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUaHlNdWx0aVNlbGVjdEV2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpIHRoeU9uUmFkaW9TZWxlY3RDaGFuZ2U6IEV2ZW50RW1pdHRlcjxUaHlSYWRpb1NlbGVjdEV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGh5UmFkaW9TZWxlY3RFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKSB0aHlPbkRyYWdnYWJsZUNoYW5nZTogRXZlbnRFbWl0dGVyPFRoeVRhYmxlRHJhZ2dhYmxlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUaHlUYWJsZURyYWdnYWJsZUV2ZW50PigpO1xuXG4gICAgQE91dHB1dCgpIHRoeU9uUm93Q2xpY2s6IEV2ZW50RW1pdHRlcjxUaHlUYWJsZVJvd0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGh5VGFibGVSb3dFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKSB0aHlPblJvd0NvbnRleHRNZW51OiBFdmVudEVtaXR0ZXI8VGh5VGFibGVFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFRoeVRhYmxlRXZlbnQ+KCk7XG5cbiAgICBAQ29udGVudENoaWxkKCdncm91cCcsIHsgc3RhdGljOiB0cnVlIH0pIGdyb3VwVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBAQ29udGVudENoaWxkcmVuKFRoeVRhYmxlQ29sdW1uQ29tcG9uZW50KVxuICAgIHNldCBsaXN0T2ZDb2x1bW5Db21wb25lbnRzKGNvbXBvbmVudHM6IFF1ZXJ5TGlzdDxUaHlUYWJsZUNvbHVtbkNvbXBvbmVudD4pIHtcbiAgICAgICAgaWYgKGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHRoaXMuX2xpc3RPZkNvbHVtbkNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZUNvbHVtbnMoKTtcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVEYXRhTW9kZWwoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MudGh5LXRhYmxlJykgaXNUYWJsZUNsYXNzID0gdHJ1ZTtcblxuICAgIC8vIOaVsOaNrueahOaKmOWPoOWxleW8gOeKtuaAgVxuICAgIHB1YmxpYyBleHBhbmRTdGF0dXNNYXA6IERpY3Rpb25hcnk8Ym9vbGVhbj4gPSB7fTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSBfZGlmZmVyczogSXRlcmFibGVEaWZmZXJzLFxuICAgICAgICBwcml2YXRlIHZpZXdwb3J0UnVsZXI6IFZpZXdwb3J0UnVsZXIsXG4gICAgICAgIHByaXZhdGUgdXBkYXRlSG9zdENsYXNzU2VydmljZTogVXBkYXRlSG9zdENsYXNzU2VydmljZSxcbiAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55XG4gICAgKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX2JpbmRUcmFja0ZuKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0U2VsZWN0aW9uS2V5cyhzZWxlY3Rpb25zOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbnMubWFwKChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3RoaXMucm93S2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW5pdGlhbGl6ZUNvbHVtbnMoKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLl9saXN0T2ZDb2x1bW5Db21wb25lbnRzID8gdGhpcy5fbGlzdE9mQ29sdW1uQ29tcG9uZW50cy50b0FycmF5KCkgOiBbXTtcbiAgICAgICAgY29uc3QgaGFzRXhwYW5kID0gY29tcG9uZW50cy5zb21lKGl0ZW0gPT4gaXRlbS5leHBhbmQgPT09IHRydWUpO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb21wb25lbnRzLm1hcDxUaHlUYWJsZUNvbHVtbj4oKGNvbXBvbmVudCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9ucyA9IHRoaXMuX2dldFNlbGVjdGlvbktleXMoY29tcG9uZW50LnNlbGVjdGlvbnMpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBrZXk6IGNvbXBvbmVudC5rZXksXG4gICAgICAgICAgICAgICAgbW9kZWw6IGNvbXBvbmVudC5tb2RlbCxcbiAgICAgICAgICAgICAgICB0aXRsZTogY29tcG9uZW50LnRpdGxlLFxuICAgICAgICAgICAgICAgIHR5cGU6IGNvbXBvbmVudC50eXBlLFxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbnM6IHNlbGVjdGlvbnMsXG4gICAgICAgICAgICAgICAgd2lkdGg6IGNvbXBvbmVudC53aWR0aCxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGNvbXBvbmVudC5jbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgaGVhZGVyQ2xhc3NOYW1lOiBjb21wb25lbnQuaGVhZGVyQ2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiBjb21wb25lbnQuZGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgZGVmYXVsdFRleHQ6IGNvbXBvbmVudC5kZWZhdWx0VGV4dCxcbiAgICAgICAgICAgICAgICBleHBhbmQ6IGhhc0V4cGFuZCA/IGNvbXBvbmVudC5leHBhbmQgOiBpID09PSAwLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlUmVmOiBjb21wb25lbnQuY2VsbFRlbXBsYXRlUmVmLFxuICAgICAgICAgICAgICAgIGhlYWRlclRlbXBsYXRlUmVmOiBjb21wb25lbnQuaGVhZGVyVGVtcGxhdGVSZWZcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2luaXRpYWxpemVEYXRhTW9kZWwoKSB7XG4gICAgICAgIHRoaXMubW9kZWwuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsU2VsZWN0aW9ucyhyb3csIGNvbHVtbik7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbEN1c3RvbU1vZGVsVmFsdWUocm93LCBjb2x1bW4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2luaXRpYWxTZWxlY3Rpb25zKHJvdzogb2JqZWN0LCBjb2x1bW46IFRoeVRhYmxlQ29sdW1uKSB7XG4gICAgICAgIGlmIChjb2x1bW4uc2VsZWN0aW9ucykge1xuICAgICAgICAgICAgaWYgKGNvbHVtbi50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgICAgcm93W2NvbHVtbi5rZXldID0gY29sdW1uLnNlbGVjdGlvbnMuaW5jbHVkZXMocm93W3RoaXMucm93S2V5XSk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlKHJvdywgY29sdW1uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4uc2VsZWN0aW9ucy5pbmNsdWRlcyhyb3dbdGhpcy5yb3dLZXldKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUmFkaW9Sb3cgPSByb3c7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW5pdGlhbEN1c3RvbU1vZGVsVmFsdWUocm93OiBvYmplY3QsIGNvbHVtbjogVGh5VGFibGVDb2x1bW4pIHtcbiAgICAgICAgaWYgKGNvbHVtbi50eXBlID09PSBjdXN0b21UeXBlLnN3aXRjaCkge1xuICAgICAgICAgICAgcm93W2NvbHVtbi5rZXldID0gZ2V0KHJvdywgY29sdW1uLm1vZGVsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3JlZnJlc2hDdXN0b21Nb2RlbFZhbHVlKHJvdzogYW55KSB7XG4gICAgICAgIHRoaXMuY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsQ3VzdG9tTW9kZWxWYWx1ZShyb3csIGNvbHVtbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2FwcGx5RGlmZkNoYW5nZXMoY2hhbmdlczogSXRlcmFibGVDaGFuZ2VzPGFueT4pIHtcbiAgICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgICAgIGNoYW5nZXMuZm9yRWFjaEFkZGVkSXRlbSgocmVjb3JkOiBJdGVyYWJsZUNoYW5nZVJlY29yZDxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVmcmVzaEN1c3RvbU1vZGVsVmFsdWUocmVjb3JkLml0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9iaW5kVHJhY2tGbigpIHtcbiAgICAgICAgdGhpcy50cmFja0J5Rm4gPSBmdW5jdGlvbih0aGlzOiBhbnksIGluZGV4OiBudW1iZXIsIHJvdzogYW55KTogYW55IHtcbiAgICAgICAgICAgIHJldHVybiByb3cgJiYgdGhpcy5yb3dLZXkgPyByb3dbdGhpcy5yb3dLZXldIDogaW5kZXg7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9kZXN0cm95SW52YWxpZEF0dHJpYnV0ZSgpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiByb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5LmluY2x1ZGVzKCdbJCRjb2x1bW5dJykpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJvd1trZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2V0Q2xhc3MoZmlyc3QgPSBmYWxzZSkge1xuICAgICAgICBpZiAoIWZpcnN0ICYmICF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2xhc3NOYW1lczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgaWYgKHRhYmxlU2l6ZU1hcFt0aGlzLnNpemVdKSB7XG4gICAgICAgICAgICBjbGFzc05hbWVzLnB1c2godGFibGVTaXplTWFwW3RoaXMuc2l6ZV0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0YWJsZVRoZW1lTWFwW3RoaXMudGhlbWVdKSB7XG4gICAgICAgICAgICBjbGFzc05hbWVzLnB1c2godGFibGVUaGVtZU1hcFt0aGlzLnRoZW1lXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhYmxlU2l6ZU1hcFt0aGlzLnNpemVdID09PSB0YWJsZVNpemVNYXBbJ3NtJ10gJiYgdGFibGVUaGVtZU1hcFt0aGlzLnRoZW1lXSA9PT0gdGFibGVUaGVtZU1hcFsnZGVmYXVsdCddKSB7XG4gICAgICAgICAgICBjbGFzc05hbWVzLnB1c2goJ3RhYmxlLWRlZmF1bHQtc20tYm90dG9tLXBhZGRpbmcnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZUhvc3RDbGFzc1NlcnZpY2UudXBkYXRlQ2xhc3MoY2xhc3NOYW1lcyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZmlsdGVyTW9kZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGVsICYmIHRoaXMubW9kZWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbHRlcikge1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZUNvbHVtblNlbGVjdGlvbnMoa2V5OiBzdHJpbmcsIHNlbGVjdGlvbnM6IGFueSk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmNvbHVtbnMuZmluZChpdGVtID0+IGl0ZW0ua2V5ID09PSBrZXkpO1xuICAgICAgICBjb2x1bW4uc2VsZWN0aW9ucyA9IHRoaXMuX2dldFNlbGVjdGlvbktleXMoc2VsZWN0aW9ucyk7XG4gICAgICAgIHRoaXMubW9kZWwuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbFNlbGVjdGlvbnMocm93LCBjb2x1bW4pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNUZW1wbGF0ZVJlZihyZWY6IGFueSkge1xuICAgICAgICByZXR1cm4gcmVmIGluc3RhbmNlb2YgVGVtcGxhdGVSZWY7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE1vZGVsVmFsdWUocm93OiBhbnksIHBhdGg6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gZ2V0KHJvdywgcGF0aCk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlclJvd0NsYXNzTmFtZShyb3c6IGFueSwgaW5kZXg6IG51bWJlcikge1xuICAgICAgICBpZiAoIXRoaXMucm93Q2xhc3NOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdHJpbmcodGhpcy5yb3dDbGFzc05hbWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yb3dDbGFzc05hbWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKHRoaXMucm93Q2xhc3NOYW1lIGFzIEZ1bmN0aW9uKShyb3csIGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBvbk1vZGVsQ2hhbmdlKHJvdzogYW55LCBjb2x1bW46IFRoeVRhYmxlQ29sdW1uKSB7XG4gICAgICAgIGlmIChjb2x1bW4ubW9kZWwpIHtcbiAgICAgICAgICAgIHNldChyb3csIGNvbHVtbi5tb2RlbCwgcm93W2NvbHVtbi5rZXldKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBvblN0b3BQcm9wYWdhdGlvbihldmVudDogRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMud2hvbGVSb3dTZWxlY3QpIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uUGFnZUNoYW5nZShldmVudDogUGFnZUNoYW5nZWRFdmVudCkge1xuICAgICAgICB0aGlzLnRoeU9uUGFnZUNoYW5nZS5lbWl0KGV2ZW50KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25QYWdlSW5kZXhDaGFuZ2UoZXZlbnQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLnRoeU9uUGFnZUluZGV4Q2hhbmdlLmVtaXQoZXZlbnQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkNoZWNrYm94Q2hhbmdlKHJvdzogYW55LCBjb2x1bW46IFRoeVRhYmxlQ29sdW1uKSB7XG4gICAgICAgIHRoaXMub25Nb2RlbENoYW5nZShyb3csIGNvbHVtbik7XG4gICAgICAgIHRoaXMub25NdWx0aVNlbGVjdENoYW5nZShudWxsLCByb3csIGNvbHVtbik7XG4gICAgfVxuXG4gICAgcHVibGljIG9uTXVsdGlTZWxlY3RDaGFuZ2UoZXZlbnQ6IEV2ZW50LCByb3c6IGFueSwgY29sdW1uOiBUaHlUYWJsZUNvbHVtbikge1xuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5tb2RlbC5maWx0ZXIoaXRlbSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbVtjb2x1bW4ua2V5XTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG11bHRpU2VsZWN0RXZlbnQ6IFRoeU11bHRpU2VsZWN0RXZlbnQgPSB7XG4gICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICByb3c6IHJvdyxcbiAgICAgICAgICAgIHJvd3M6IHJvd3NcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50aHlPbk11bHRpU2VsZWN0Q2hhbmdlLmVtaXQobXVsdGlTZWxlY3RFdmVudCk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uUmFkaW9TZWxlY3RDaGFuZ2UoZXZlbnQ6IEV2ZW50LCByb3c6IGFueSkge1xuICAgICAgICBjb25zdCByYWRpb1NlbGVjdEV2ZW50OiBUaHlSYWRpb1NlbGVjdEV2ZW50ID0ge1xuICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgcm93OiByb3dcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50aHlPblJhZGlvU2VsZWN0Q2hhbmdlLmVtaXQocmFkaW9TZWxlY3RFdmVudCk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uU3dpdGNoQ2hhbmdlKGV2ZW50OiBFdmVudCwgcm93OiBhbnksIGNvbHVtbjogYW55KSB7XG4gICAgICAgIGNvbnN0IHN3aXRjaEV2ZW50OiBUaHlTd2l0Y2hFdmVudCA9IHtcbiAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgIHJvdzogcm93LFxuICAgICAgICAgICAgcmVmcmVzaDogKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IHJvdztcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVbY29sdW1uLmtleV0gPSBnZXQodmFsdWUsIGNvbHVtbi5tb2RlbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGh5T25Td2l0Y2hDaGFuZ2UuZW1pdChzd2l0Y2hFdmVudCk7XG4gICAgfVxuXG4gICAgc2hvd0V4cGFuZChyb3c6IGFueSkge1xuICAgICAgICByZXR1cm4gcm93W3RoaXMudGh5Q2hpbGRyZW5LZXldICYmIHJvd1t0aGlzLnRoeUNoaWxkcmVuS2V5XS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIGlzRXhwYW5kZWQocm93OiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhwYW5kU3RhdHVzTWFwW3Jvd1t0aGlzLnJvd0tleV1dO1xuICAgIH1cblxuICAgIGljb25JbmRlbnRDb21wdXRlZChsZXZlbDogbnVtYmVyKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICd0cmVlJykge1xuICAgICAgICAgICAgcmV0dXJuIGxldmVsICogdGhpcy50aHlJbmRlbnQgLSAxMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRkSW5kZW50Q29tcHV0ZWQobGV2ZWw6IG51bWJlcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICBwYWRkaW5nTGVmdDogYCR7KGxldmVsICsgMSkgKiB0aGlzLnRoeUluZGVudCAtIDEwfXB4YFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGV4cGFuZENoaWxkcmVuKGV2ZW50OiBFdmVudCwgcm93OiBhbnkpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmICh0aGlzLmlzRXhwYW5kZWQocm93KSkge1xuICAgICAgICAgICAgdGhpcy5leHBhbmRTdGF0dXNNYXBbcm93W3RoaXMucm93S2V5XV0gPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kU3RhdHVzTWFwW3Jvd1t0aGlzLnJvd0tleV1dID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uRHJhZ1N0YXJ0ZWQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJldmlldyA9IHRoaXMuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2RrLWRyYWctcHJldmlldycpWzBdO1xuICAgICAgICAgICAgaWYgKHByZXZpZXcpIHtcbiAgICAgICAgICAgICAgICBwcmV2aWV3LmNsYXNzTGlzdC5hZGQoJ3RoeS10YWJsZS1kcmFnLXByZXZpZXcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25EcmFnRHJvcHBlZChldmVudDogQ2RrRHJhZ0Ryb3A8dW5rbm93bj4pIHtcbiAgICAgICAgY29uc3QgZHJhZ0V2ZW50OiBUaHlUYWJsZURyYWdnYWJsZUV2ZW50ID0ge1xuICAgICAgICAgICAgbW9kZWw6IGV2ZW50Lml0ZW0sXG4gICAgICAgICAgICBtb2RlbHM6IHRoaXMubW9kZWwsXG4gICAgICAgICAgICBvbGRJbmRleDogZXZlbnQucHJldmlvdXNJbmRleCxcbiAgICAgICAgICAgIG5ld0luZGV4OiBldmVudC5jdXJyZW50SW5kZXhcbiAgICAgICAgfTtcbiAgICAgICAgbW92ZUl0ZW1JbkFycmF5KHRoaXMubW9kZWwsIGV2ZW50LnByZXZpb3VzSW5kZXgsIGV2ZW50LmN1cnJlbnRJbmRleCk7XG4gICAgICAgIHRoaXMudGh5T25EcmFnZ2FibGVDaGFuZ2UuZW1pdChkcmFnRXZlbnQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblJvd0NsaWNrKGV2ZW50OiBFdmVudCwgcm93OiBhbnkpIHtcbiAgICAgICAgaWYgKHRoaXMud2hvbGVSb3dTZWxlY3QpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuY29sdW1ucy5maW5kKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT09IGN1c3RvbVR5cGUuY2hlY2tib3ggfHwgaXRlbS50eXBlID09PSBjdXN0b21UeXBlLnJhZGlvO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIWNvbHVtbi5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gY3VzdG9tVHlwZS5jaGVja2JveCkge1xuICAgICAgICAgICAgICAgICAgICByb3dbY29sdW1uLmtleV0gPSAhcm93W2NvbHVtbi5rZXldO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2Uocm93LCBjb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTXVsdGlTZWxlY3RDaGFuZ2UoZXZlbnQsIHJvdywgY29sdW1uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbi50eXBlID09PSBjdXN0b21UeXBlLnJhZGlvKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSYWRpb1JvdyA9IHJvdztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblJhZGlvU2VsZWN0Q2hhbmdlKGV2ZW50LCByb3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb3dFdmVudCA9IHtcbiAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgIHJvdzogcm93XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGh5T25Sb3dDbGljay5lbWl0KHJvd0V2ZW50KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25Sb3dDb250ZXh0TWVudShldmVudDogRXZlbnQsIHJvdzogYW55KSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHRNZW51RXZlbnQ6IFRoeVRhYmxlRXZlbnQgPSB7XG4gICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICByb3c6IHJvd1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRoeU9uUm93Q29udGV4dE1lbnUuZW1pdChjb250ZXh0TWVudUV2ZW50KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZHJhZ2dhYmxlU3RvcFByb3BhZ2F0aW9uKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBpZiAoIXRoaXMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3JlZnJlc2hDb2x1bW5zKCkge1xuICAgICAgICBjb25zdCBjb21wb25lbnRzID0gdGhpcy5fbGlzdE9mQ29sdW1uQ29tcG9uZW50cyA/IHRoaXMuX2xpc3RPZkNvbHVtbkNvbXBvbmVudHMudG9BcnJheSgpIDogW107XG4gICAgICAgIGNvbnN0IF9jb2x1bW5zID0gY29tcG9uZW50cy5tYXAoY29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGNvbXBvbmVudC53aWR0aCxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGNvbXBvbmVudC5jbGFzc05hbWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY29sdW1ucy5mb3JFYWNoKChuLCBpKSA9PiB7XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKG4sIF9jb2x1bW5zW2ldKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBidWlsZEdyb3VwcyhvcmlnaW5Hcm91cHM6IGFueSkge1xuICAgICAgICBjb25zdCBjb2xsYXBzZWRJZHMgPSB0aGlzLmdyb3Vwcy5maWx0ZXIoZ3JvdXAgPT4gIWdyb3VwLmV4cGFuZCkubWFwKGdyb3VwID0+IGdyb3VwLmlkKTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSBbXTtcbiAgICAgICAgb3JpZ2luR3JvdXBzLmZvckVhY2goKG9yaWdpbjogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cDogVGh5VGFibGVHcm91cCA9IHsgaWQ6IG9yaWdpblt0aGlzLnJvd0tleV0sIGNoaWxkcmVuOiBbXSwgb3JpZ2luIH07XG4gICAgICAgICAgICBncm91cC5leHBhbmQgPSAhY29sbGFwc2VkSWRzLmluY2x1ZGVzKGdyb3VwLmlkKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzLnB1c2goZ3JvdXApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkTW9kZWwoKSB7XG4gICAgICAgIGNvbnN0IGdyb3Vwc01hcCA9IGtleUJ5KHRoaXMuZ3JvdXBzLCAnaWQnKTtcbiAgICAgICAgdGhpcy5tb2RlbC5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IGdyb3Vwc01hcFtyb3dbdGhpcy5ncm91cEJ5XV07XG4gICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICBncm91cC5jaGlsZHJlbi5wdXNoKHJvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBleHBhbmRHcm91cChncm91cDogVGh5VGFibGVHcm91cCkge1xuICAgICAgICBncm91cC5leHBhbmQgPSAhZ3JvdXAuZXhwYW5kO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUhvc3RDbGFzc1NlcnZpY2UuaW5pdGlhbGl6ZUVsZW1lbnQodGhpcy50YWJsZUVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3NldENsYXNzKHRydWUpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICBtZXJnZSh0aGlzLnZpZXdwb3J0UnVsZXIuY2hhbmdlKDIwMCksIG9mKG51bGwpLnBpcGUoZGVsYXkoMjAwKSkpXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5uZ1Vuc3Vic2NyaWJlJCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWZyZXNoQ29sdW1ucygpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoc2ltcGxlQ2hhbmdzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IG1vZGVDaGFuZ2UgPSBzaW1wbGVDaGFuZ3MudGh5TW9kZTtcbiAgICAgICAgY29uc3QgdGh5R3JvdXBzQ2hhbmdlID0gc2ltcGxlQ2hhbmdzLnRoeUdyb3VwcztcbiAgICAgICAgY29uc3QgaXNHcm91cE1vZGUgPSBtb2RlQ2hhbmdlICYmIG1vZGVDaGFuZ2UuY3VycmVudFZhbHVlID09PSAnZ3JvdXAnO1xuICAgICAgICBpZiAoaXNHcm91cE1vZGUgJiYgdGh5R3JvdXBzQ2hhbmdlICYmIHRoeUdyb3Vwc0NoYW5nZS5maXJzdENoYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5idWlsZEdyb3Vwcyh0aHlHcm91cHNDaGFuZ2UuY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuYnVpbGRNb2RlbCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdEb0NoZWNrKCkge1xuICAgICAgICBpZiAodGhpcy5fZGlmZikge1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX2RpZmYuZGlmZih0aGlzLm1vZGVsKTtcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5RGlmZkNoYW5nZXMoY2hhbmdlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgc3VwZXIubmdPbkRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fZGVzdHJveUludmFsaWRBdHRyaWJ1dGUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgVGh5R3JpZENvbXBvbmVudCBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIFRoeVRhYmxlQ29tcG9uZW50XG4gKi9cbmV4cG9ydCBjb25zdCBUaHlHcmlkQ29tcG9uZW50ID0gVGh5VGFibGVDb21wb25lbnQ7XG4iXX0=