import { Component, ElementRef, ViewChild, Inject, ChangeDetectorRef, Renderer2 } from '@angular/core';
import { CdkPortalOutlet } from '@angular/cdk/portal';
import { DOCUMENT } from '@angular/common';
import { ThyAbstractOverlayContainer } from 'ngx-tethys/core';
import { Subject } from 'rxjs';
import { slideUpperOverlayOptions, ThySlideConfig } from './slide.config';
import { filter, takeUntil, startWith } from 'rxjs/operators';
import { thySlideAnimations } from './slide-animations';
import { helpers } from 'ngx-tethys/util';
import { ViewportRuler } from '@angular/cdk/overlay';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './slide.config';
import * as ɵngcc2 from '@angular/cdk/overlay';
import * as ɵngcc3 from '@angular/cdk/portal';

function ThySlideContainerComponent_ng_template_0_Template(rf, ctx) { }
export class ThySlideContainerComponent extends ThyAbstractOverlayContainer {
    constructor(elementRef, document, config, changeDetectorRef, renderer, viewportRuler) {
        super(slideUpperOverlayOptions, changeDetectorRef);
        this.elementRef = elementRef;
        this.document = document;
        this.config = config;
        this.renderer = renderer;
        this.viewportRuler = viewportRuler;
        this.animationState = 'void';
        this.slideContainerStyles = {};
        this.ngUnsubscribe$ = new Subject();
        this.animationOpeningDone = this.animationStateChanged.pipe(filter((event) => {
            return event.phaseName === 'done' && event.toState === this.animationState;
        }));
        this.animationClosingDone = this.animationStateChanged.pipe(filter((event) => {
            return event.phaseName === 'done' && event.toState === 'exit';
        }));
        this.setDrawerContainerElement();
        this.checkContainerWithinViewport();
        this.addDrawerContainerElementClass();
    }
    get isPush() {
        return this.config.mode === 'push' && !!this.drawerContainerElement;
    }
    get isSide() {
        return this.config.mode === 'side' && !!this.drawerContainerElement;
    }
    get isLeftOrRight() {
        return this.config.from === 'left' || this.config.from === 'right';
    }
    get hostOffset() {
        let offset = 0;
        if (this.isLeftOrRight) {
            offset = this.elementRef.nativeElement.clientWidth + this.config.offset || 0;
        }
        else {
            offset = this.elementRef.nativeElement.clientHeight + this.config.offset || 0;
        }
        return offset;
    }
    get transform() {
        switch (this.config.from) {
            case 'left':
                return `translateX(${this.hostOffset}px)`;
            case 'right':
                return `translateX(-${this.hostOffset}px)`;
            case 'top':
                return `translateY(${this.hostOffset}px)`;
            case 'bottom':
                return `translateY(${this.hostOffset}px)`;
        }
    }
    get drawerContainerElementClass() {
        return `thy-slide-${this.config.mode}-drawer-container`;
    }
    setDrawerContainerElement() {
        if (typeof this.config.drawerContainer === 'string') {
            this.drawerContainerElement = this.config.drawerContainer && document.querySelector(this.config.drawerContainer);
        }
        if (this.config.drawerContainer instanceof ElementRef) {
            this.drawerContainerElement = this.config.drawerContainer.nativeElement;
        }
        if (this.config.drawerContainer instanceof HTMLElement) {
            this.drawerContainerElement = this.config.drawerContainer;
        }
    }
    setSlideContainerStyles() {
        let width, height, top, left;
        const drawerContainerElementRect = (this.drawerContainerElement || document.body).getBoundingClientRect();
        if (this.isLeftOrRight) {
            height = drawerContainerElementRect.height;
            top = drawerContainerElementRect.top;
            this.renderer.setStyle(this.elementRef.nativeElement, 'top', `${top}px`);
        }
        else {
            width = drawerContainerElementRect.width;
            left = drawerContainerElementRect.left;
            this.renderer.setStyle(this.elementRef.nativeElement, 'left', `${left}px`);
        }
        this.slideContainerStyles = {
            width: width,
            height: height
        };
    }
    checkContainerWithinViewport() {
        this.viewportRuler
            .change(100)
            .pipe(startWith(null), takeUntil(this.ngUnsubscribe$))
            .subscribe(() => {
            this.setSlideContainerStyles();
        });
    }
    addDrawerContainerElementClass() {
        if (this.drawerContainerElement) {
            this.renderer.addClass(this.drawerContainerElement, this.drawerContainerElementClass);
        }
    }
    removeDrawerContainerElementClass() {
        if (this.drawerContainerElement) {
            this.renderer.removeClass(this.drawerContainerElement, this.drawerContainerElementClass);
        }
    }
    setDrawerContainerElementStyle() {
        if (this.isSide) {
            this.renderer.setStyle(this.drawerContainerElement, `margin-${this.config.from}`, `${this.hostOffset}px`);
        }
        else if (this.isPush) {
            this.renderer.setStyle(this.drawerContainerElement, `transform`, this.transform);
        }
    }
    removeDrawerContainerElementStyle() {
        if (this.isSide) {
            this.renderer.removeStyle(this.drawerContainerElement, `margin-${this.config.from}`);
        }
        else if (this.isPush) {
            this.renderer.removeStyle(this.drawerContainerElement, `transform`);
        }
    }
    beforeAttachPortal() {
        if (this.config.offset) {
            this.renderer.setStyle(this.elementRef.nativeElement, this.config.from, `${this.config.offset}px`);
            this.animationState = helpers.camelCase(['offset', this.config.from]);
        }
        else {
            this.animationState = this.config.from;
        }
        this.setDrawerContainerElementStyle();
    }
    beforeDetachPortal() {
        this.removeDrawerContainerElementStyle();
    }
    onAnimationDone(event) {
        this.animationStateChanged.emit(event);
    }
    onAnimationStart(event) {
        this.animationStateChanged.emit(event);
    }
    ngOnDestroy() {
        super.destroy();
        this.removeDrawerContainerElementClass();
        this.ngUnsubscribe$.next();
        this.ngUnsubscribe$.complete();
    }
}
ThySlideContainerComponent.ɵfac = function ThySlideContainerComponent_Factory(t) { return new (t || ThySlideContainerComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(DOCUMENT), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ThySlideConfig), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ViewportRuler)); };
ThySlideContainerComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThySlideContainerComponent, selectors: [["thy-slide-container"]], viewQuery: function ThySlideContainerComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(CdkPortalOutlet, true);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.portalOutlet = _t.first);
    } }, hostAttrs: ["tabindex", "-1", 1, "thy-slide-container"], hostVars: 14, hostBindings: function ThySlideContainerComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵsyntheticHostListener("@slideContainer.start", function ThySlideContainerComponent_animation_slideContainer_start_HostBindingHandler($event) { return ctx.onAnimationStart($event); })("@slideContainer.done", function ThySlideContainerComponent_animation_slideContainer_done_HostBindingHandler($event) { return ctx.onAnimationDone($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("role", "slide");
        ɵngcc0.ɵɵsyntheticHostProperty("@slideContainer", ctx.animationState);
        ɵngcc0.ɵɵstyleProp("width", ctx.slideContainerStyles.width, "px")("height", ctx.slideContainerStyles.height, "px")("max-height", ctx.slideContainerStyles.height, "px");
        ɵngcc0.ɵɵclassProp("thy-slide-push", ctx.isPush)("thy-slide-side", ctx.isSide)("thy-slide-over", !ctx.isPush && !ctx.isSide);
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 1, vars: 0, consts: [["cdkPortalOutlet", ""]], template: function ThySlideContainerComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ThySlideContainerComponent_ng_template_0_Template, 0, 0, "ng-template", 0);
    } }, directives: [ɵngcc3.CdkPortalOutlet], encapsulation: 2, data: { animation: [thySlideAnimations.slideContainer] } });
ThySlideContainerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: ThySlideConfig },
    { type: ChangeDetectorRef },
    { type: Renderer2 },
    { type: ViewportRuler }
];
ThySlideContainerComponent.propDecorators = {
    portalOutlet: [{ type: ViewChild, args: [CdkPortalOutlet, { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThySlideContainerComponent, [{
        type: Component,
        args: [{
                selector: 'thy-slide-container',
                template: `
        <ng-template cdkPortalOutlet></ng-template>
    `,
                animations: [thySlideAnimations.slideContainer],
                host: {
                    class: 'thy-slide-container',
                    '[class.thy-slide-push]': 'isPush',
                    '[class.thy-slide-side]': 'isSide',
                    '[class.thy-slide-over]': '!isPush && !isSide',
                    tabindex: '-1',
                    '[attr.role]': `'slide'`,
                    '[@slideContainer]': 'animationState',
                    '(@slideContainer.start)': 'onAnimationStart($event)',
                    '(@slideContainer.done)': 'onAnimationDone($event)',
                    '[style.width.px]': 'slideContainerStyles.width',
                    '[style.height.px]': 'slideContainerStyles.height',
                    '[style.max-height.px]': 'slideContainerStyles.height'
                }
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: undefined, decorators: [{
                type: Inject,
                args: [DOCUMENT]
            }] }, { type: ɵngcc1.ThySlideConfig }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.ViewportRuler }]; }, { portalOutlet: [{
            type: ViewChild,
            args: [CdkPortalOutlet, { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGUtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NsaWRlL3NsaWRlLWNvbnRhaW5lci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDbEgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM5RCxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTNDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxjQUFjLEVBQXFCLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0YsT0FBTyxFQUFFLE1BQU0sRUFBTyxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDeEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7OztBQXVCckQsTUFBTSxPQUFPLDBCQUEyQixTQUFRLDJCQUEyQjtBQUFHLElBdUQxRSxZQUNZLFVBQXNCLEVBQ0osUUFBYSxFQUNoQyxNQUFzQixFQUM3QixpQkFBb0MsRUFDNUIsUUFBbUIsRUFDbkIsYUFBNEI7QUFDekMsUUFDSyxLQUFLLENBQUMsd0JBQXdCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztBQUMzRCxRQVJnQixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFDTCxhQUFRLEdBQVIsUUFBUSxDQUFLO0FBQUMsUUFDakMsV0FB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QUFTLFNBQUMsa0JBQ1AsUUFBUSxFQUFFLHFCQUFxQixrQkFDL0IsUUFBUSxFQUFFLDJEQUVULGtCQUNELFVBQVUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxrQkFDL0MsSUFBSSxFQUFFLHNCQUNGLEtBQUssRUFBRSxxQkFBcUIsc0JBQzVCLHdCQUF3QixFQUFFLFFBQVE7bUJBQ2xDLHdCQUF3QixFQUFFLFFBQVEsc0JBQ2xDLHdCQUF3QixFQUFFLG9CQUFvQixzQkFDOUMsUUFBUSxFQUFFLElBQUksc0JBQ2QsYUFBYSxFQUFFLFNBQVM7Y0FDeEIsbUJBQW1CLEVBQUUsZ0JBQWdCO2dCQUNyQzs7S0FBeUIsRUFBRSwwQkFBMEIsc0JBQ3JELHdCQUF3QixFQUFFO2VBQXlCLHNCQUNuRCxrQkFBa0IsRUFBRSw0QkFBNEIsc0JBQ2hELG1CQUFtQixFQUFFLDZCQUE2QjtXQUNsRCx1QkFBdUIsRUFBRSw2QkFBNkIsa0JBQ3pELGNBQ0o7Ozs7Ozs7OzZIQUNJO0FBQUM7QUFBb0QsWUFqQ3RDLFVBQVU7QUFBSSw0Q0EwRnpCLE1BQU0sU0FBQyxRQUFRO0FBQVMsWUFwRkUsY0FBYztBQUFJLFlBTkYsaUJBQWlCO0FBQUksWUFBRixTQUFTO0FBQUksWUFVMUUsYUFBYTtBQUFHO0FBQUc7QUFHdEIsMkJBcUJELFNBQVMsU0FBQyxlQUFlLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO0FBQzVDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBJbmplY3QsIENoYW5nZURldGVjdG9yUmVmLCBSZW5kZXJlcjIsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2RrUG9ydGFsT3V0bGV0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBUaHlBYnN0cmFjdE92ZXJsYXlDb250YWluZXIgfSBmcm9tICduZ3gtdGV0aHlzL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQW5pbWF0aW9uRXZlbnQgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IHNsaWRlVXBwZXJPdmVybGF5T3B0aW9ucywgVGh5U2xpZGVDb25maWcsIFRoeVNsaWRlRnJvbVR5cGVzIH0gZnJvbSAnLi9zbGlkZS5jb25maWcnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHRha2VVbnRpbCwgc3RhcnRXaXRoIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgdGh5U2xpZGVBbmltYXRpb25zIH0gZnJvbSAnLi9zbGlkZS1hbmltYXRpb25zJztcbmltcG9ydCB7IGhlbHBlcnMgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuaW1wb3J0IHsgVmlld3BvcnRSdWxlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0aHktc2xpZGUtY29udGFpbmVyJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8bmctdGVtcGxhdGUgY2RrUG9ydGFsT3V0bGV0PjwvbmctdGVtcGxhdGU+XG4gICAgYCxcbiAgICBhbmltYXRpb25zOiBbdGh5U2xpZGVBbmltYXRpb25zLnNsaWRlQ29udGFpbmVyXSxcbiAgICBob3N0OiB7XG4gICAgICAgIGNsYXNzOiAndGh5LXNsaWRlLWNvbnRhaW5lcicsXG4gICAgICAgICdbY2xhc3MudGh5LXNsaWRlLXB1c2hdJzogJ2lzUHVzaCcsXG4gICAgICAgICdbY2xhc3MudGh5LXNsaWRlLXNpZGVdJzogJ2lzU2lkZScsXG4gICAgICAgICdbY2xhc3MudGh5LXNsaWRlLW92ZXJdJzogJyFpc1B1c2ggJiYgIWlzU2lkZScsXG4gICAgICAgIHRhYmluZGV4OiAnLTEnLFxuICAgICAgICAnW2F0dHIucm9sZV0nOiBgJ3NsaWRlJ2AsXG4gICAgICAgICdbQHNsaWRlQ29udGFpbmVyXSc6ICdhbmltYXRpb25TdGF0ZScsXG4gICAgICAgICcoQHNsaWRlQ29udGFpbmVyLnN0YXJ0KSc6ICdvbkFuaW1hdGlvblN0YXJ0KCRldmVudCknLFxuICAgICAgICAnKEBzbGlkZUNvbnRhaW5lci5kb25lKSc6ICdvbkFuaW1hdGlvbkRvbmUoJGV2ZW50KScsXG4gICAgICAgICdbc3R5bGUud2lkdGgucHhdJzogJ3NsaWRlQ29udGFpbmVyU3R5bGVzLndpZHRoJyxcbiAgICAgICAgJ1tzdHlsZS5oZWlnaHQucHhdJzogJ3NsaWRlQ29udGFpbmVyU3R5bGVzLmhlaWdodCcsXG4gICAgICAgICdbc3R5bGUubWF4LWhlaWdodC5weF0nOiAnc2xpZGVDb250YWluZXJTdHlsZXMuaGVpZ2h0J1xuICAgIH1cbn0pXG5leHBvcnQgY2xhc3MgVGh5U2xpZGVDb250YWluZXJDb21wb25lbnQgZXh0ZW5kcyBUaHlBYnN0cmFjdE92ZXJsYXlDb250YWluZXIgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAgIEBWaWV3Q2hpbGQoQ2RrUG9ydGFsT3V0bGV0LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIHBvcnRhbE91dGxldDogQ2RrUG9ydGFsT3V0bGV0O1xuXG4gICAgYW5pbWF0aW9uT3BlbmluZ0RvbmU6IE9ic2VydmFibGU8QW5pbWF0aW9uRXZlbnQ+O1xuXG4gICAgYW5pbWF0aW9uQ2xvc2luZ0RvbmU6IE9ic2VydmFibGU8QW5pbWF0aW9uRXZlbnQ+O1xuXG4gICAgYW5pbWF0aW9uU3RhdGU6IFRoeVNsaWRlRnJvbVR5cGVzID0gJ3ZvaWQnO1xuXG4gICAgc2xpZGVDb250YWluZXJTdHlsZXM6IHsgd2lkdGg/OiBudW1iZXI7IGhlaWdodD86IG51bWJlciB9ID0ge307XG5cbiAgICBwcml2YXRlIGRyYXdlckNvbnRhaW5lckVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuXG4gICAgcHJpdmF0ZSBuZ1Vuc3Vic2NyaWJlJCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICBnZXQgaXNQdXNoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcubW9kZSA9PT0gJ3B1c2gnICYmICEhdGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50O1xuICAgIH1cblxuICAgIGdldCBpc1NpZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5tb2RlID09PSAnc2lkZScgJiYgISF0aGlzLmRyYXdlckNvbnRhaW5lckVsZW1lbnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgaXNMZWZ0T3JSaWdodCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmZyb20gPT09ICdsZWZ0JyB8fCB0aGlzLmNvbmZpZy5mcm9tID09PSAncmlnaHQnO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0IGhvc3RPZmZzZXQoKSB7XG4gICAgICAgIGxldCBvZmZzZXQgPSAwO1xuICAgICAgICBpZiAodGhpcy5pc0xlZnRPclJpZ2h0KSB7XG4gICAgICAgICAgICBvZmZzZXQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCArIHRoaXMuY29uZmlnLm9mZnNldCB8fCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0ICsgdGhpcy5jb25maWcub2Zmc2V0IHx8IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9mZnNldDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCB0cmFuc2Zvcm0oKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5jb25maWcuZnJvbSkge1xuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGVYKCR7dGhpcy5ob3N0T2Zmc2V0fXB4KWA7XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGVYKC0ke3RoaXMuaG9zdE9mZnNldH1weClgO1xuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gYHRyYW5zbGF0ZVkoJHt0aGlzLmhvc3RPZmZzZXR9cHgpYDtcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGVZKCR7dGhpcy5ob3N0T2Zmc2V0fXB4KWA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCBkcmF3ZXJDb250YWluZXJFbGVtZW50Q2xhc3MoKSB7XG4gICAgICAgIHJldHVybiBgdGh5LXNsaWRlLSR7dGhpcy5jb25maWcubW9kZX0tZHJhd2VyLWNvbnRhaW5lcmA7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55LFxuICAgICAgICBwdWJsaWMgY29uZmlnOiBUaHlTbGlkZUNvbmZpZyxcbiAgICAgICAgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgICAgIHByaXZhdGUgdmlld3BvcnRSdWxlcjogVmlld3BvcnRSdWxlclxuICAgICkge1xuICAgICAgICBzdXBlcihzbGlkZVVwcGVyT3ZlcmxheU9wdGlvbnMsIGNoYW5nZURldGVjdG9yUmVmKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25PcGVuaW5nRG9uZSA9IHRoaXMuYW5pbWF0aW9uU3RhdGVDaGFuZ2VkLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKGV2ZW50OiBBbmltYXRpb25FdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5waGFzZU5hbWUgPT09ICdkb25lJyAmJiBldmVudC50b1N0YXRlID09PSB0aGlzLmFuaW1hdGlvblN0YXRlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25DbG9zaW5nRG9uZSA9IHRoaXMuYW5pbWF0aW9uU3RhdGVDaGFuZ2VkLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKGV2ZW50OiBBbmltYXRpb25FdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5waGFzZU5hbWUgPT09ICdkb25lJyAmJiBldmVudC50b1N0YXRlID09PSAnZXhpdCc7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnNldERyYXdlckNvbnRhaW5lckVsZW1lbnQoKTtcbiAgICAgICAgdGhpcy5jaGVja0NvbnRhaW5lcldpdGhpblZpZXdwb3J0KCk7XG4gICAgICAgIHRoaXMuYWRkRHJhd2VyQ29udGFpbmVyRWxlbWVudENsYXNzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXREcmF3ZXJDb250YWluZXJFbGVtZW50KCkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuY29uZmlnLmRyYXdlckNvbnRhaW5lciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd2VyQ29udGFpbmVyRWxlbWVudCA9IHRoaXMuY29uZmlnLmRyYXdlckNvbnRhaW5lciAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuY29uZmlnLmRyYXdlckNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmRyYXdlckNvbnRhaW5lciBpbnN0YW5jZW9mIEVsZW1lbnRSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd2VyQ29udGFpbmVyRWxlbWVudCA9IHRoaXMuY29uZmlnLmRyYXdlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5kcmF3ZXJDb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50ID0gdGhpcy5jb25maWcuZHJhd2VyQ29udGFpbmVyIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRTbGlkZUNvbnRhaW5lclN0eWxlcygpIHtcbiAgICAgICAgbGV0IHdpZHRoLCBoZWlnaHQsIHRvcCwgbGVmdDtcbiAgICAgICAgY29uc3QgZHJhd2VyQ29udGFpbmVyRWxlbWVudFJlY3QgPSAodGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBpZiAodGhpcy5pc0xlZnRPclJpZ2h0KSB7XG4gICAgICAgICAgICBoZWlnaHQgPSBkcmF3ZXJDb250YWluZXJFbGVtZW50UmVjdC5oZWlnaHQ7XG4gICAgICAgICAgICB0b3AgPSBkcmF3ZXJDb250YWluZXJFbGVtZW50UmVjdC50b3A7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndG9wJywgYCR7dG9wfXB4YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aWR0aCA9IGRyYXdlckNvbnRhaW5lckVsZW1lbnRSZWN0LndpZHRoO1xuICAgICAgICAgICAgbGVmdCA9IGRyYXdlckNvbnRhaW5lckVsZW1lbnRSZWN0LmxlZnQ7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIGAke2xlZnR9cHhgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNsaWRlQ29udGFpbmVyU3R5bGVzID0ge1xuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHRcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrQ29udGFpbmVyV2l0aGluVmlld3BvcnQoKSB7XG4gICAgICAgIHRoaXMudmlld3BvcnRSdWxlclxuICAgICAgICAgICAgLmNoYW5nZSgxMDApXG4gICAgICAgICAgICAucGlwZShzdGFydFdpdGgobnVsbCksIHRha2VVbnRpbCh0aGlzLm5nVW5zdWJzY3JpYmUkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U2xpZGVDb250YWluZXJTdHlsZXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkRHJhd2VyQ29udGFpbmVyRWxlbWVudENsYXNzKCkge1xuICAgICAgICBpZiAodGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZHJhd2VyQ29udGFpbmVyRWxlbWVudCwgdGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50Q2xhc3MpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVEcmF3ZXJDb250YWluZXJFbGVtZW50Q2xhc3MoKSB7XG4gICAgICAgIGlmICh0aGlzLmRyYXdlckNvbnRhaW5lckVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50LCB0aGlzLmRyYXdlckNvbnRhaW5lckVsZW1lbnRDbGFzcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldERyYXdlckNvbnRhaW5lckVsZW1lbnRTdHlsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTaWRlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZHJhd2VyQ29udGFpbmVyRWxlbWVudCwgYG1hcmdpbi0ke3RoaXMuY29uZmlnLmZyb219YCwgYCR7dGhpcy5ob3N0T2Zmc2V0fXB4YCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1B1c2gpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5kcmF3ZXJDb250YWluZXJFbGVtZW50LCBgdHJhbnNmb3JtYCwgdGhpcy50cmFuc2Zvcm0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVEcmF3ZXJDb250YWluZXJFbGVtZW50U3R5bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzU2lkZSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLmRyYXdlckNvbnRhaW5lckVsZW1lbnQsIGBtYXJnaW4tJHt0aGlzLmNvbmZpZy5mcm9tfWApO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNQdXNoKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKHRoaXMuZHJhd2VyQ29udGFpbmVyRWxlbWVudCwgYHRyYW5zZm9ybWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYmVmb3JlQXR0YWNoUG9ydGFsKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jb25maWcub2Zmc2V0KSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLmNvbmZpZy5mcm9tLCBgJHt0aGlzLmNvbmZpZy5vZmZzZXR9cHhgKTtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RhdGUgPSBoZWxwZXJzLmNhbWVsQ2FzZShbJ29mZnNldCcsIHRoaXMuY29uZmlnLmZyb21dKSBhcyBUaHlTbGlkZUZyb21UeXBlcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RhdGUgPSB0aGlzLmNvbmZpZy5mcm9tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0RHJhd2VyQ29udGFpbmVyRWxlbWVudFN0eWxlKCk7XG4gICAgfVxuXG4gICAgYmVmb3JlRGV0YWNoUG9ydGFsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlbW92ZURyYXdlckNvbnRhaW5lckVsZW1lbnRTdHlsZSgpO1xuICAgIH1cblxuICAgIG9uQW5pbWF0aW9uRG9uZShldmVudDogQW5pbWF0aW9uRXZlbnQpIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25TdGF0ZUNoYW5nZWQuZW1pdChldmVudCk7XG4gICAgfVxuXG4gICAgb25BbmltYXRpb25TdGFydChldmVudDogQW5pbWF0aW9uRXZlbnQpIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25TdGF0ZUNoYW5nZWQuZW1pdChldmVudCk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5yZW1vdmVEcmF3ZXJDb250YWluZXJFbGVtZW50Q2xhc3MoKTtcbiAgICAgICAgdGhpcy5uZ1Vuc3Vic2NyaWJlJC5uZXh0KCk7XG4gICAgICAgIHRoaXMubmdVbnN1YnNjcmliZSQuY29tcGxldGUoKTtcbiAgICB9XG59XG4iXX0=