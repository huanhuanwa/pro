import { Component, Input, ElementRef, ViewContainerRef } from '@angular/core';
import { TooltipService } from 'ngx-tethys/tooltip';
import { UpdateHostClassService } from 'ngx-tethys/core';
import { ContentObserver } from '@angular/cdk/observers';
import { debounceTime } from 'rxjs/operators';
import { isUndefinedOrNull } from 'ngx-tethys/util';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-tethys/tooltip';
import * as ɵngcc2 from 'ngx-tethys/core';
import * as ɵngcc3 from '@angular/cdk/observers';

const _c0 = ["*"];
export class ThyFlexibleTextComponent {
    constructor(elementRef, viewContainerRef, tooltipService, updateHostClassService, contentObserver) {
        this.elementRef = elementRef;
        this.viewContainerRef = viewContainerRef;
        this.tooltipService = tooltipService;
        this.updateHostClassService = updateHostClassService;
        this.contentObserver = contentObserver;
        this.isOverflow = false;
        this.subscription = null;
        this.updateHostClassService.initializeElement(this.elementRef);
    }
    get thyContainerClass() {
        return this.containerClass;
    }
    set thyContainerClass(value) {
        this.containerClass = value;
        this.updateContainerClass();
    }
    set thyContent(value) {
        this.content = value;
        if (this.tooltipService.thyTooltipDirective) {
            this.tooltipService.thyTooltipDirective.content = this.content;
        }
    }
    set thyPlacement(value) {
        this.placement = value;
        if (this.tooltipService.thyTooltipDirective) {
            this.tooltipService.thyTooltipDirective.placement = this.placement;
        }
    }
    ngOnInit() {
        this.updateContainerClass();
        this.tooltipService.attach(this.elementRef, this.viewContainerRef, this.trigger);
        if (this.placement) {
            this.tooltipService.thyTooltipDirective.placement = this.placement;
        }
        this.tooltipService.thyTooltipDirective.content = this.content;
        this.tooltipService.thyTooltipDirective.thyTooltipDisabled = true;
    }
    ngAfterContentInit() {
        this.applyOverflow();
        this.subscription = this.contentObserver
            .observe(this.elementRef)
            .pipe(debounceTime(100))
            .subscribe((value) => {
            this.applyOverflow();
        });
    }
    ngOnDestroy() {
        this.tooltipService.detach();
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    applyOverflow() {
        const nativeElement = this.elementRef.nativeElement;
        if (nativeElement.clientWidth < nativeElement.scrollWidth) {
            this.isOverflow = true;
        }
        else {
            this.isOverflow = false;
        }
        this.tooltipService.thyTooltipDirective.thyTooltipDisabled = !this.isOverflow;
    }
    updateContainerClass() {
        const containerClass = isUndefinedOrNull(this.containerClass) ? 'flexible-text-container' : this.containerClass;
        const flexibleTextClass = {
            'text-truncate': true,
            [containerClass]: containerClass !== ''
        };
        this.updateHostClassService.updateClassByMap(flexibleTextClass);
    }
}
ThyFlexibleTextComponent.ɵfac = function ThyFlexibleTextComponent_Factory(t) { return new (t || ThyFlexibleTextComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TooltipService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.UpdateHostClassService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.ContentObserver)); };
ThyFlexibleTextComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ThyFlexibleTextComponent, selectors: [["thy-flexible-text"], ["", "thyFlexibleText", ""]], inputs: { thyContainerClass: "thyContainerClass", thyContent: ["thyTooltipContent", "thyContent"], thyPlacement: ["thyTooltipPlacement", "thyPlacement"], trigger: ["thyTooltipTrigger", "trigger"] }, exportAs: ["thyFlexibleText"], features: [ɵngcc0.ɵɵProvidersFeature([TooltipService, UpdateHostClassService])], ngContentSelectors: _c0, decls: 1, vars: 0, template: function ThyFlexibleTextComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
    } }, encapsulation: 2 });
ThyFlexibleTextComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ViewContainerRef },
    { type: TooltipService },
    { type: UpdateHostClassService },
    { type: ContentObserver }
];
ThyFlexibleTextComponent.propDecorators = {
    trigger: [{ type: Input, args: ['thyTooltipTrigger',] }],
    thyContainerClass: [{ type: Input, args: ['thyContainerClass',] }],
    thyContent: [{ type: Input, args: ['thyTooltipContent',] }],
    thyPlacement: [{ type: Input, args: ['thyTooltipPlacement',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ThyFlexibleTextComponent, [{
        type: Component,
        args: [{
                selector: 'thy-flexible-text,[thyFlexibleText]',
                exportAs: 'thyFlexibleText',
                template: "<ng-content></ng-content>\n",
                providers: [TooltipService, UpdateHostClassService]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.ViewContainerRef }, { type: ɵngcc1.TooltipService }, { type: ɵngcc2.UpdateHostClassService }, { type: ɵngcc3.ContentObserver }]; }, { thyContainerClass: [{
            type: Input,
            args: ['thyContainerClass']
        }], thyContent: [{
            type: Input,
            args: ['thyTooltipContent']
        }], thyPlacement: [{
            type: Input,
            args: ['thyTooltipPlacement']
        }], trigger: [{
            type: Input,
            args: ['thyTooltipTrigger']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGlibGUtdGV4dC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mbGV4aWJsZS10ZXh0L2ZsZXhpYmxlLXRleHQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFlLFVBQVUsRUFBVSxnQkFBZ0IsRUFBK0IsTUFBTSxlQUFlLENBQUM7QUFFakksT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7Ozs7QUFRcEQsTUFBTSxPQUFPLHdCQUF3QjtBQUFHLElBcUNwQyxZQUNZLFVBQXNCLEVBQ3RCLGdCQUFrQyxFQUNuQyxjQUE4QixFQUM3QixzQkFBOEMsRUFDOUMsZUFBZ0M7QUFDN0MsUUFMYSxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFDdkIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtBQUFDLFFBQ3BDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtBQUFDLFFBQzlCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7QUFBQyxRQUMvQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFDaEQsUUExQ0ksZUFBVSxHQUFHLEtBQUssQ0FBQztBQUN2QixRQU9JLGlCQUFZLEdBQXdCLElBQUksQ0FBQztBQUM3QyxRQWtDUSxJQUFJLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3ZFLElBQUksQ0FBQztBQUNMLElBakNJLElBQ0ksaUJBQWlCO0FBQUssUUFDdEIsT0FBTyxJQUFJ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Q0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO0FBQ3RGLElBQUksQ0FBQztBQUNMLElBQ0ksb0JBQW9CO0FBQ3hCLFFBQVEsTUFBTSxjQUFjLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztBQUN4SCxRQUFRLE1BQU0saUJBQWlCLEdBQUc7QUFDbEMsWUFBWSxlQUFlLEVBQUUsSUFBSTtBQUNqQyxZQUFZLENBQUMsY0FBYyxDQUFDLEVBQUUsY0FBYyxLQUFLLEVBQUU7QUFDbkQsU0FBUyxDQUFDO0FBQ1YsUUFBUSxJQUFJLENBQUMsc0JBQXNCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUN4RSxJQUFJLENBQUM7QUFDTDtvREFsR0MsU0FBUyxTQUFDLGtCQUNQLFFBQVEsRUFBRSxxQ0FBcUMsa0JBQy9DLFFBQVEsRUFBRSxpQkFBaUIsa0JBQzNCLHVDQUE2QyxrQkFDN0MsU0FBUyxFQUFFLENBQUMsY0FBYyxFQUFFLHNCQUFzQixDQUFDLGNBQ3REOzs7OzZCQUNJO0FBQUM7QUFBa0QsWUFmaEIsVUFBVTtBQUFJLFlBQU0sZ0JBQWdCO0FBQUksWUFFdkUsY0FBYztBQUFJLFlBQ2xCLHNCQUFzQjtBQUFJLFlBQzFCLGVBQWU7QUFBRztBQUFHO0FBQ2Qsc0JBcUJYLEtBQUssU0FBQyxtQkFBbUI7QUFBTyxnQ0FFaEMsS0FBSyxTQUFDLG1CQUFtQjtBQUN6Qix5QkFTQSxLQUFLLFNBQUMsbUJBQW1CO0FBQU8sMkJBT2hDLEtBQUssU0FBQyxxQkFBcUI7QUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBUZW1wbGF0ZVJlZiwgRWxlbWVudFJlZiwgT25Jbml0LCBWaWV3Q29udGFpbmVyUmVmLCBPbkRlc3Ryb3ksIEFmdGVyQ29udGVudEluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRpbWVyLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRvb2x0aXBTZXJ2aWNlIH0gZnJvbSAnbmd4LXRldGh5cy90b29sdGlwJztcbmltcG9ydCB7IFVwZGF0ZUhvc3RDbGFzc1NlcnZpY2UgfSBmcm9tICduZ3gtdGV0aHlzL2NvcmUnO1xuaW1wb3J0IHsgQ29udGVudE9ic2VydmVyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL29ic2VydmVycyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBUaHlQbGFjZW1lbnQgfSBmcm9tICduZ3gtdGV0aHlzL2NvcmUnO1xuaW1wb3J0IHsgaXNVbmRlZmluZWRPck51bGwgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RoeS1mbGV4aWJsZS10ZXh0LFt0aHlGbGV4aWJsZVRleHRdJyxcbiAgICBleHBvcnRBczogJ3RoeUZsZXhpYmxlVGV4dCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZsZXhpYmxlLXRleHQuY29tcG9uZW50Lmh0bWwnLFxuICAgIHByb3ZpZGVyczogW1Rvb2x0aXBTZXJ2aWNlLCBVcGRhdGVIb3N0Q2xhc3NTZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBUaHlGbGV4aWJsZVRleHRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSB7XG4gICAgaXNPdmVyZmxvdyA9IGZhbHNlO1xuXG4gICAgY29udGVudDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8SFRNTEVsZW1lbnQ+O1xuXG4gICAgcGxhY2VtZW50OiBUaHlQbGFjZW1lbnQ7XG5cbiAgICBjb250YWluZXJDbGFzczogc3RyaW5nO1xuXG4gICAgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gfCBudWxsID0gbnVsbDtcblxuICAgIEBJbnB1dCgndGh5VG9vbHRpcFRyaWdnZXInKSB0cmlnZ2VyOiAnaG92ZXInIHwgJ2ZvY3VzJyB8ICdjbGljayc7XG5cbiAgICBASW5wdXQoJ3RoeUNvbnRhaW5lckNsYXNzJylcbiAgICBnZXQgdGh5Q29udGFpbmVyQ2xhc3MoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyQ2xhc3M7XG4gICAgfVxuXG4gICAgc2V0IHRoeUNvbnRhaW5lckNsYXNzKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXJDbGFzcyA9IHZhbHVlO1xuICAgICAgICB0aGlzLnVwZGF0ZUNvbnRhaW5lckNsYXNzKCk7XG4gICAgfVxuXG4gICAgQElucHV0KCd0aHlUb29sdGlwQ29udGVudCcpIHNldCB0aHlDb250ZW50KHZhbHVlOiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxIVE1MRWxlbWVudD4pIHtcbiAgICAgICAgdGhpcy5jb250ZW50ID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLnRvb2x0aXBTZXJ2aWNlLnRoeVRvb2x0aXBEaXJlY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcFNlcnZpY2UudGh5VG9vbHRpcERpcmVjdGl2ZS5jb250ZW50ID0gdGhpcy5jb250ZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQElucHV0KCd0aHlUb29sdGlwUGxhY2VtZW50Jykgc2V0IHRoeVBsYWNlbWVudCh2YWx1ZTogVGh5UGxhY2VtZW50KSB7XG4gICAgICAgIHRoaXMucGxhY2VtZW50ID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLnRvb2x0aXBTZXJ2aWNlLnRoeVRvb2x0aXBEaXJlY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcFNlcnZpY2UudGh5VG9vbHRpcERpcmVjdGl2ZS5wbGFjZW1lbnQgPSB0aGlzLnBsYWNlbWVudDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgcHVibGljIHRvb2x0aXBTZXJ2aWNlOiBUb29sdGlwU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB1cGRhdGVIb3N0Q2xhc3NTZXJ2aWNlOiBVcGRhdGVIb3N0Q2xhc3NTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGNvbnRlbnRPYnNlcnZlcjogQ29udGVudE9ic2VydmVyXG4gICAgKSB7XG4gICAgICAgIHRoaXMudXBkYXRlSG9zdENsYXNzU2VydmljZS5pbml0aWFsaXplRWxlbWVudCh0aGlzLmVsZW1lbnRSZWYpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUNvbnRhaW5lckNsYXNzKCk7XG4gICAgICAgIHRoaXMudG9vbHRpcFNlcnZpY2UuYXR0YWNoKHRoaXMuZWxlbWVudFJlZiwgdGhpcy52aWV3Q29udGFpbmVyUmVmLCB0aGlzLnRyaWdnZXIpO1xuICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcFNlcnZpY2UudGh5VG9vbHRpcERpcmVjdGl2ZS5wbGFjZW1lbnQgPSB0aGlzLnBsYWNlbWVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRvb2x0aXBTZXJ2aWNlLnRoeVRvb2x0aXBEaXJlY3RpdmUuY29udGVudCA9IHRoaXMuY29udGVudDtcbiAgICAgICAgdGhpcy50b29sdGlwU2VydmljZS50aHlUb29sdGlwRGlyZWN0aXZlLnRoeVRvb2x0aXBEaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICB0aGlzLmFwcGx5T3ZlcmZsb3coKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLmNvbnRlbnRPYnNlcnZlclxuICAgICAgICAgICAgLm9ic2VydmUodGhpcy5lbGVtZW50UmVmKVxuICAgICAgICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDEwMCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh2YWx1ZTogTXV0YXRpb25SZWNvcmRbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlPdmVyZmxvdygpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMudG9vbHRpcFNlcnZpY2UuZGV0YWNoKCk7XG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFwcGx5T3ZlcmZsb3coKSB7XG4gICAgICAgIGNvbnN0IG5hdGl2ZUVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKG5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGggPCBuYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoKSB7XG4gICAgICAgICAgICB0aGlzLmlzT3ZlcmZsb3cgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc092ZXJmbG93ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b29sdGlwU2VydmljZS50aHlUb29sdGlwRGlyZWN0aXZlLnRoeVRvb2x0aXBEaXNhYmxlZCA9ICF0aGlzLmlzT3ZlcmZsb3c7XG4gICAgfVxuXG4gICAgdXBkYXRlQ29udGFpbmVyQ2xhc3MoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckNsYXNzID0gaXNVbmRlZmluZWRPck51bGwodGhpcy5jb250YWluZXJDbGFzcykgPyAnZmxleGlibGUtdGV4dC1jb250YWluZXInIDogdGhpcy5jb250YWluZXJDbGFzcztcbiAgICAgICAgY29uc3QgZmxleGlibGVUZXh0Q2xhc3MgPSB7XG4gICAgICAgICAgICAndGV4dC10cnVuY2F0ZSc6IHRydWUsXG4gICAgICAgICAgICBbY29udGFpbmVyQ2xhc3NdOiBjb250YWluZXJDbGFzcyAhPT0gJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVIb3N0Q2xhc3NTZXJ2aWNlLnVwZGF0ZUNsYXNzQnlNYXAoZmxleGlibGVUZXh0Q2xhc3MpO1xuICAgIH1cbn1cbiJdfQ==