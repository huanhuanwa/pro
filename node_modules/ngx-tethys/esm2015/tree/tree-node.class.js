import { ThyTreeNodeCheckState } from './tree.class';
import { helpers } from 'ngx-tethys/util';
export class ThyTreeNode {
    constructor(node, parent = null, service) {
        this.level = 0;
        this.title = node.title;
        this.key = node.key;
        this.children = [];
        this.parentNode = parent;
        this.level = parent ? parent.level + 1 : this.level;
        this.origin = node;
        this.isDisabled = node.disabled || false;
        this.isExpanded = node.expanded || false;
        this.isChecked = node.checked ? ThyTreeNodeCheckState.checked : ThyTreeNodeCheckState.unchecked;
        this.isLoading = false;
        if (node.children) {
            node.children.forEach(childNode => {
                this.children.push(new ThyTreeNode(childNode, this));
            });
        }
        this.service = service;
    }
    get treeService() {
        if (this.service) {
            return this.service;
        }
        else if (this.parentNode) {
            return this.parentNode.treeService;
        }
    }
    setKey(key) {
        this.origin.key = key;
        this.key = key;
    }
    setTitle(title) {
        this.origin.title = title;
        this.title = title;
    }
    setExpanded(expanded, propagate = false) {
        this.origin.expanded = expanded;
        this.isExpanded = expanded;
        if (propagate && this.children) {
            this.children.forEach(n => n.setExpanded(expanded, propagate));
        }
    }
    setLoading(loading) {
        this.isLoading = loading;
    }
    setChecked(checked, propagateUp = true, propagateDown = true) {
        this.treeService.setNodeChecked(this, checked, propagateUp, propagateDown);
    }
    syncNodeCheckState() {
        this.treeService.syncNodeCheckState(this);
    }
    getParentNode() {
        return this.parentNode;
    }
    getChildren() {
        return this.children;
    }
    addChildren(children, index = -1) {
        children = helpers.coerceArray(children);
        (children || []).forEach((childNode, i) => {
            if (index === -1) {
                this.children.push(new ThyTreeNode(childNode, this));
            }
            else {
                this.children.splice(index + i, 0, new ThyTreeNode(childNode, this, this.treeService));
            }
        });
        this.origin.children = this.getChildren().map(n => n.origin);
        this.setLoading(false);
        this.treeService.$statusChange.next({
            eventName: 'addChildren',
            node: this
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1ub2RlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RyZWUvdHJlZS1ub2RlLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBbUIscUJBQXFCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFdEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTFDLE1BQU0sT0FBTyxXQUFXO0lBK0JwQixZQUFZLElBQXFCLEVBQUUsU0FBc0IsSUFBSSxFQUFFLE9BQXdCO1FBdEJ2RixVQUFLLEdBQUcsQ0FBQyxDQUFDO1FBdUJOLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3BELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUM7UUFDekMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDO1FBQ2hHLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksSUFBSSxDQUFDLFFBQVEs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QUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7WUFDaEMsU0FBUyxFQUFFLGFBQWE7WUFDeEIsSUFBSSxFQUFFLElBQUk7U0FDYixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaHlUcmVlTm9kZURhdGEsIFRoeVRyZWVOb2RlQ2hlY2tTdGF0ZSB9IGZyb20gJy4vdHJlZS5jbGFzcyc7XG5pbXBvcnQgeyBUaHlUcmVlU2VydmljZSB9IGZyb20gJy4vdHJlZS5zZXJ2aWNlJztcbmltcG9ydCB7IGhlbHBlcnMgfSBmcm9tICduZ3gtdGV0aHlzL3V0aWwnO1xuXG5leHBvcnQgY2xhc3MgVGh5VHJlZU5vZGU8VCA9IGFueT4ge1xuICAgIGtleT86IG51bWJlciB8IHN0cmluZztcblxuICAgIHRpdGxlPzogc3RyaW5nO1xuXG4gICAgY2hpbGRyZW46IFRoeVRyZWVOb2RlW107XG5cbiAgICBwYXJlbnROb2RlOiBUaHlUcmVlTm9kZTtcblxuICAgIGxldmVsID0gMDtcblxuICAgIG9yaWdpbjogVGh5VHJlZU5vZGVEYXRhPFQ+O1xuXG4gICAgaXNFeHBhbmRlZDogYm9vbGVhbjtcblxuICAgIGlzQ2hlY2tlZDogVGh5VHJlZU5vZGVDaGVja1N0YXRlO1xuXG4gICAgaXNMb2FkaW5nOiBib29sZWFuO1xuXG4gICAgaXNEaXNhYmxlZDogYm9vbGVhbjtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgc2VydmljZTogVGh5VHJlZVNlcnZpY2U7XG5cbiAgICBnZXQgdHJlZVNlcnZpY2UoKTogVGh5VHJlZVNlcnZpY2Uge1xuICAgICAgICBpZiAodGhpcy5zZXJ2aWNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS50cmVlU2VydmljZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKG5vZGU6IFRoeVRyZWVOb2RlRGF0YSwgcGFyZW50OiBUaHlUcmVlTm9kZSA9IG51bGwsIHNlcnZpY2U/OiBUaHlUcmVlU2VydmljZSkge1xuICAgICAgICB0aGlzLnRpdGxlID0gbm9kZS50aXRsZTtcbiAgICAgICAgdGhpcy5rZXkgPSBub2RlLmtleTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgICAgICB0aGlzLnBhcmVudE5vZGUgPSBwYXJlbnQ7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBwYXJlbnQgPyBwYXJlbnQubGV2ZWwgKyAxIDogdGhpcy5sZXZlbDtcbiAgICAgICAgdGhpcy5vcmlnaW4gPSBub2RlO1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBub2RlLmRpc2FibGVkIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSBub2RlLmV4cGFuZGVkIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQ2hlY2tlZCA9IG5vZGUuY2hlY2tlZCA/IFRoeVRyZWVOb2RlQ2hlY2tTdGF0ZS5jaGVja2VkIDogVGh5VHJlZU5vZGVDaGVja1N0YXRlLnVuY2hlY2tlZDtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChuZXcgVGh5VHJlZU5vZGUoY2hpbGROb2RlLCB0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRLZXkoa2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5vcmlnaW4ua2V5ID0ga2V5O1xuICAgICAgICB0aGlzLmtleSA9IGtleTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0VGl0bGUodGl0bGU6IHN0cmluZykge1xuICAgICAgICB0aGlzLm9yaWdpbi50aXRsZSA9IHRpdGxlO1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgfVxuXG4gICAgcHVibGljIHNldEV4cGFuZGVkKGV4cGFuZGVkOiBib29sZWFuLCBwcm9wYWdhdGUgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLm9yaWdpbi5leHBhbmRlZCA9IGV4cGFuZGVkO1xuICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSBleHBhbmRlZDtcbiAgICAgICAgaWYgKHByb3BhZ2F0ZSAmJiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2gobiA9PiBuLnNldEV4cGFuZGVkKGV4cGFuZGVkLCBwcm9wYWdhdGUpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzZXRMb2FkaW5nKGxvYWRpbmc6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBsb2FkaW5nO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRDaGVja2VkKGNoZWNrZWQ6IGJvb2xlYW4sIHByb3BhZ2F0ZVVwID0gdHJ1ZSwgcHJvcGFnYXRlRG93biA9IHRydWUpIHtcbiAgICAgICAgdGhpcy50cmVlU2VydmljZS5zZXROb2RlQ2hlY2tlZCh0aGlzLCBjaGVja2VkLCBwcm9wYWdhdGVVcCwgcHJvcGFnYXRlRG93bik7XG4gICAgfVxuXG4gICAgcHVibGljIHN5bmNOb2RlQ2hlY2tTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy50cmVlU2VydmljZS5zeW5jTm9kZUNoZWNrU3RhdGUodGhpcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFBhcmVudE5vZGUoKTogVGh5VHJlZU5vZGUge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnROb2RlO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDaGlsZHJlbigpOiBUaHlUcmVlTm9kZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW47XG4gICAgfVxuXG4gICAgcHVibGljIGFkZENoaWxkcmVuKGNoaWxkcmVuOiBUaHlUcmVlTm9kZURhdGEgfCBUaHlUcmVlTm9kZURhdGFbXSwgaW5kZXg6IG51bWJlciA9IC0xKTogdm9pZCB7XG4gICAgICAgIGNoaWxkcmVuID0gaGVscGVycy5jb2VyY2VBcnJheShjaGlsZHJlbik7XG4gICAgICAgICgoY2hpbGRyZW4gYXMgVGh5VHJlZU5vZGVEYXRhW10pIHx8IFtdKS5mb3JFYWNoKChjaGlsZE5vZGU6IFRoeVRyZWVOb2RlRGF0YSwgaTogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKG5ldyBUaHlUcmVlTm9kZShjaGlsZE5vZGUsIHRoaXMpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXggKyBpLCAwLCBuZXcgVGh5VHJlZU5vZGUoY2hpbGROb2RlLCB0aGlzLCB0aGlzLnRyZWVTZXJ2aWNlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub3JpZ2luLmNoaWxkcmVuID0gdGhpcy5nZXRDaGlsZHJlbigpLm1hcChuID0+IG4ub3JpZ2luKTtcbiAgICAgICAgdGhpcy5zZXRMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgdGhpcy50cmVlU2VydmljZS4kc3RhdHVzQ2hhbmdlLm5leHQoe1xuICAgICAgICAgICAgZXZlbnROYW1lOiAnYWRkQ2hpbGRyZW4nLFxuICAgICAgICAgICAgbm9kZTogdGhpc1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=